"use strict";function _typeof2(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function _typeof(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}!function(e){if("object"===("undefined"==typeof exports?"undefined":_typeof2(exports))&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Zotero=e()}}(function(){var e;return function t(e,r,a){function o(n,s){if(!r[n]){if(!e[n]){var l="function"==typeof require&&require;if(!s&&l)return l(n,!0);if(i)return i(n,!0);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}var d=r[n]={exports:{}};e[n][0].call(d.exports,function(t){var r=e[n][1][t];return o(r?r:t)},d,d.exports,t,e,r,a)}return r[n].exports}for(var i="function"==typeof require&&require,n=0;n<a.length;n++)o(a[n]);return o}({1:[function(e,t,r){(function(r){if("undefined"==typeof window){var a=r;a.XMLHttpRequest||(a.XMLHttpRequest=e("w3c-xmlhttprequest").XMLHttpRequest)}else{var a=window;"undefined"==typeof Promise&&e("es6-promise").polyfill()}var o=e("./src/Base.js");a.Zotero=a.Z=o,o.Cache=e("./src/Cache.js"),o.Ajax=o.ajax=e("./src/Ajax.js"),o.ApiObject=e("./src/ApiObject.js"),o.ApiResponse=e("./src/ApiResponse.js"),o.Net=o.net=e("./src/Net.js"),o.Library=e("./src/Library.js"),o.Container=e("./src/Container"),o.Collections=e("./src/Collections.js"),o.Items=e("./src/Items.js"),o.Tags=e("./src/Tags.js"),o.Groups=e("./src/Groups.js"),o.Searches=e("./src/Searches.js"),o.Deleted=e("./src/Deleted.js"),o.Collection=e("./src/Collection.js"),o.Localizations=o.localizations=e("./src/Localizations.js"),o.Item=e("./src/Item.js"),o.Tag=e("./src/Tag.js"),o.Search=e("./src/Search.js"),o.Group=e("./src/Group.js"),o.User=e("./src/User.js"),o.Utils=o.utils=e("./src/Utils.js"),o.Url=o.url=e("./src/Url.js"),o.File=o.file=e("./src/File.js"),o.Idb=e("./src/Idb.js"),o.Preferences=e("./src/Preferences.js"),t.exports=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./src/Ajax.js":97,"./src/ApiObject.js":98,"./src/ApiResponse.js":99,"./src/Base.js":100,"./src/Cache.js":101,"./src/Collection.js":102,"./src/Collections.js":103,"./src/Container":104,"./src/Deleted.js":105,"./src/File.js":106,"./src/Group.js":107,"./src/Groups.js":108,"./src/Idb.js":109,"./src/Item.js":110,"./src/Items.js":112,"./src/Library.js":113,"./src/Localizations.js":114,"./src/Net.js":115,"./src/Preferences.js":116,"./src/Search.js":117,"./src/Searches.js":118,"./src/Tag.js":119,"./src/Tags.js":120,"./src/Url.js":121,"./src/User.js":122,"./src/Utils.js":123,"es6-promise":83,"w3c-xmlhttprequest":2}],2:[function(e,t,r){},{}],3:[function(e,t,r){var a,o=e("es5-ext/object/assign"),i=e("es5-ext/object/normalize-options"),n=e("es5-ext/object/is-callable"),s=e("es5-ext/string/#/contains");a=t.exports=function(e,t){var r,a,n,l,c;return arguments.length<2||"string"!=typeof e?(l=t,t=e,e=null):l=arguments[2],null==e?(r=n=!0,a=!1):(r=s.call(e,"c"),a=s.call(e,"e"),n=s.call(e,"w")),c={value:t,configurable:r,enumerable:a,writable:n},l?o(i(l),c):c},a.gs=function(e,t,r){var a,l,c,d;return"string"!=typeof e?(c=r,r=t,t=e,e=null):c=arguments[3],null==t?t=void 0:n(t)?null==r?r=void 0:n(r)||(c=r,r=void 0):(c=t,t=r=void 0),null==e?(a=!0,l=!1):(a=s.call(e,"c"),l=s.call(e,"e")),d={get:t,set:r,configurable:a,enumerable:l},c?o(i(c),d):d}},{"es5-ext/object/assign":60,"es5-ext/object/is-callable":65,"es5-ext/object/normalize-options":71,"es5-ext/string/#/contains":75}],4:[function(e,t,r){var a,o,i,n=e("es5-ext/object/valid-callable"),s=e("d"),l=e("es5-ext/object/is-callable"),c=e("event-emitter"),d=e("./is-promise"),u=Object.create,p=Object.defineProperty;t.exports=r=function(e){function t(t,r,a,o){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t,a,o){e=String(e),n(o)&&(null==a||n(a))&&n(t),p(r._unresolved,e,s(t)),r._onresolve[e]=a,p(r._resolved,e,s(o)),r._names.push(e)}),r._names=["done","then","valueOf"],r._unresolved=c(u(Function.prototype,{then:s(function(e,t){var r;return this.pending||(this.pending=[]),r=a(),this.pending.push("then",[e,t,r.resolve,r.reject]),r.promise}),done:s(function(e,t){null==e||n(e),null==t||n(t),this.pending||(this.pending=[]),this.pending.push("done",arguments)}),resolved:s(!1),returnsPromise:s(!0),valueOf:s(function(){return this})})),r._onresolve={then:function(e,t,r,a){var o,i=this.failed?t:e;if(null==i)return void(this.failed?a(this.value):r(this.value));if(l(i)){if(d(i))return i.resolved?void(i.failed?a(i.value):r(i.value)):void i.done(r,a);try{o=i(this.value)}catch(n){return void a(n)}return void r(o)}r(i)},done:function(e,t){if(this.failed){if(t)return void t(this.value);throw this.value}e&&e(this.value)}},r._resolved=c(u(Function.prototype,{then:s(function(e,t){var r,a=this.failed?t:e;if(null==a)return this;if(l(a)){if(d(a))return a;try{r=a(this.value)}catch(n){return i(n)}return o(r)}return o(a)}),done:s(function(e,t){if(null==e||n(e),null==t||n(t),this.failed){if(t)return void t(this.value);throw this.value}e&&e(this.value)}),resolved:s(!0),returnsPromise:s(!0),valueOf:s(function(){return this.value})})),a=e("./deferred"),o=a.resolve,i=a.reject,a.extend=r},{"./deferred":6,"./is-promise":33,d:3,"es5-ext/object/is-callable":65,"es5-ext/object/valid-callable":72,"event-emitter":89}],5:[function(e,t,r){var a=e("es5-ext/object/is-object"),o=e("./is-promise"),i=e("./deferred"),n=e("next-tick"),s=Object.getPrototypeOf;t.exports=function l(e){var t,r,c,d,u;if(!e)return e;try{t=e.then}catch(p){return e}if("function"!=typeof t)return e;if(o(e))return e;if(!a(e))return e;if(!s(e))return e;try{r=e.done}catch(m){}if(c=i(),d=function(e){c.resolve(l(e))},u=function(e){c.reject(e)},"function"==typeof r){try{r.call(e,d,u)}catch(p){return c.reject(p)}return c.promise}try{t.call(e,function(e){n(function(){d(e)})},function(e){n(function(){u(e)})})}catch(p){return c.reject(p)}return c.promise}},{"./deferred":6,"./is-promise":33,"es5-ext/object/is-object":66,"next-tick":91}],6:[function(e,t,r){var a,o,i,n,s,l,c,d=e("es5-ext/error/is-error"),u=e("es5-ext/function/noop"),p=e("./is-promise"),m=Array.prototype.every,g=Array.prototype.push,f=0,h=Boolean(p.__proto__);n=function(e){s._names.forEach(function(t){e[t]=function(){return e.__proto__[t].apply(e,arguments)}}),e.returnsPromise=!0,e.resolved=e.__proto__.resolved},l=function(e,t){var r=function a(e,t){return a.then(e,t)};return r.value=e,r.failed=t,r.__proto__=s._resolved,h||n(r),o._profile&&o._profile(!0),r},a=function(){var e=function t(e,r){return t.then(e,r)};f||(i=setTimeout(u,1e9)),++f,o._monitor&&(e.monitor=o._monitor()),e.__proto__=s._unresolved,h||n(e),o._profile&&o._profile(),this.promise=e,this.resolve=this.resolve.bind(this),this.reject=this.reject.bind(this)},a.prototype={resolved:!1,_settle:function(e){var t,r,a,o,i,n;for(this.promise.value=e,this.promise.__proto__=s._resolved,h||(this.promise.resolved=!0),o=this.promise.dependencies,delete this.promise.dependencies;o;){for(t=0;i=o[t];++t)i.value=e,i.failed=this.failed,i.__proto__=s._resolved,h||(i.resolved=!0),delete i.pending,i.dependencies&&(n?g.apply(n,i.dependencies):n=i.dependencies,delete i.dependencies);o=n,n=null}if(a=this.promise.pending){for(t=0;r=a[t];++t)s._onresolve[r].apply(this.promise,a[++t]);delete this.promise.pending}return this.promise},resolve:function(e){if(this.resolved)return this.promise;if(this.resolved=!0,--f||clearTimeout(i),this.promise.monitor&&clearTimeout(this.promise.monitor),e=c(e),p(e)){if(!e.resolved)return e.dependencies||(e.dependencies=[]),e.dependencies.push(this.promise),this.promise.pending?e.pending?(g.apply(e.pending,this.promise.pending),this.promise.pending=e.pending,this.promise.dependencies&&this.promise.dependencies.forEach(function t(r){r.pending=e.pending,r.dependencies&&r.dependencies.forEach(t)})):e.pending=this.promise.pending:e.pending?this.promise.pending=e.pending:this.promise.pending=e.pending=[],this.promise;this.promise.failed=e.failed,e=e.value}return this._settle(e)},reject:function(e){return this.resolved?this.promise:(this.resolved=!0,--f||clearTimeout(i),this.promise.monitor&&clearTimeout(this.promise.monitor),this.promise.failed=!0,this._settle(e))}},t.exports=o=function(e){var t,r,o,i,n=arguments.length;return n?n>1?(t=new a,r=0,i=new Array(n),m.call(arguments,function(e,a){return e=c(e),p(e)?e.resolved?e.failed?(t.reject(e.value),!1):(i[a]=e.value,!0):(++r,e.done(function(e){i[a]=e,!--r&&o&&t.resolve(i)},t.reject),!0):(i[a]=e,!0)}),o=!0,r||t.resolve(i),t.promise):(e=c(e),p(e)?e:l(e,d(e))):new a},o.Deferred=a,o.reject=function(e){return l(e,!0)},o.resolve=function(e){return e=c(e),p(e)?e:l(e,!1)},s=e("./_ext"),c=e("./assimilate")},{"./_ext":4,"./assimilate":5,"./is-promise":33,"es5-ext/error/is-error":45,"es5-ext/function/noop":51}],7:[function(e,t,r){var a,o=e("es5-ext/array/from"),i=e("es5-ext/iterable/validate-object"),n=e("es5-ext/object/assign"),s=e("./deferred"),l=e("./is-promise"),c=e("./assimilate");t.exports=a=function(e){return this instanceof a?(e=o(i(e)),n(this,s()),e.every(this.add,this),this.waiting?void(this.initialized=!0):void this.resolve()):new a(e)},a.prototype={waiting:0,initialized:!1,add:function(e){if(this.promise.resolved)throw new Error("Queue was already resolved");if(++this.waiting,e=c(e),l(e)){if(!e.resolved)return e.done(this._processValue.bind(this),this.reject),!0;if(e.failed)return this.reject(e.value),!1}return this._processValue()},_processValue:function(){return this.promise.resolved?void 0:(!--this.waiting&&this.initialized&&this.resolve(),!0)}}},{"./assimilate":5,"./deferred":6,"./is-promise":33,"es5-ext/array/from":38,"es5-ext/iterable/validate-object":53,"es5-ext/object/assign":60}],8:[function(e,t,r){var a=e("es5-ext/array/of"),o=e("../deferred"),i=e("../is-promise"),n=e("../assimilate"),s=Array.prototype.push,l=Array.prototype.slice;t.exports=function(e,t){var r,c,d;for(null!=t&&e.length!==t&&(e=l.call(e,0,t),e.length<t&&s.apply(e,new Array(t-e.length))),r=0,c=e.length;c>r;++r)if(d=n(e[r]),i(d)){if(!d.resolved)return c>1?o.apply(null,e):d(a);if(d.failed)return d;e[r]=d.value}return e}},{"../assimilate":5,"../deferred":6,"../is-promise":33,"es5-ext/array/of":41}],9:[function(e,t,r){t.exports=e("../../lib/some-every")(!1)},{"../../lib/some-every":34}],10:[function(e,t,r){var a,o=e("es5-ext/object/assign"),i=e("es5-ext/object/valid-value"),n=e("es5-ext/object/valid-callable"),s=e("../../deferred"),l=e("../../is-promise"),c=e("../../assimilate"),d=Function.prototype.call,u=s.resolve;a=function(e,t,r){for(this.list=e,this.cb=t,this.context=r,this.length=e.length>>>0;this.current<this.length;){if(this.current in e)return o(this,s()),this.processCb=this.processCb.bind(this),this.process(),this.promise;++this.current}return u(void 0)},a.prototype={current:0,process:function(){var e=c(this.list[this.current]);if(l(e)){if(!e.resolved)return void e.done(this.processCb,this.reject);if(e.failed)return void this.reject(e.value);e=e.value}this.processCb(e)},processCb:function(e){var t;if(this.cb){try{t=d.call(this.cb,this.context,e,this.current,this.list)}catch(r){return void this.reject(r)}if(t=c(t),l(t)){if(!t.resolved)return void t.done(this.processValue.bind(this,e),this.reject);if(t.failed)return void this.reject(t.value);t=t.value}}else t=e;this.processValue(e,t)},processValue:function(e,t){if(t)return void this.resolve(e);for(;++this.current<this.length;)if(this.current in this.list)return void this.process();this.resolve(void 0)}},t.exports=function(e){return i(this),null==e||n(e),new a(this,e,arguments[1])}},{"../../assimilate":5,"../../deferred":6,"../../is-promise":33,"es5-ext/object/assign":60,"es5-ext/object/valid-callable":72,"es5-ext/object/valid-value":74}],11:[function(e,t,r){var a,o=e("es5-ext/object/assign"),i=e("es5-ext/object/valid-value"),n=e("es5-ext/object/valid-callable"),s=e("../../deferred"),l=e("../../is-promise"),c=e("../../assimilate"),d=Array.prototype.every,u=Function.prototype.call;a=function(e,t,r){return this.list=e,this.cb=t,this.context=r,this.result=new Array(e.length>>>0),o(this,s()),d.call(e,this.process,this),this.waiting?(this.initialized=!0,this.promise):this.resolve(this.result)},a.prototype={waiting:0,initialized:!1,process:function(e,t){if(++this.waiting,e=c(e),l(e)){if(!e.resolved)return e.done(this.processCb.bind(this,t),this.reject),!0;if(e.failed)return this.reject(e.value),!1;e=e.value}return this.processCb(t,e)},processCb:function(e,t){if(this.promise.resolved)return!1;if(this.cb){try{t=u.call(this.cb,this.context,t,e,this.list)}catch(r){return this.reject(r),!1}if(t=c(t),l(t)){if(!t.resolved)return t.done(this.processValue.bind(this,e),this.reject),!0;if(t.failed)return this.reject(t.value),!1;t=t.value}}return this.processValue(e,t),!0},processValue:function(e,t){this.promise.resolved||(this.result[e]=t,!--this.waiting&&this.initialized&&this.resolve(this.result))}},t.exports=function(e){return i(this),null==e||n(e),new a(this,e,arguments[1])}},{"../../assimilate":5,"../../deferred":6,"../../is-promise":33,"es5-ext/object/assign":60,"es5-ext/object/valid-callable":72,"es5-ext/object/valid-value":74}],12:[function(e,t,r){var a,o=e("es5-ext/object/assign"),i=e("es5-ext/object/valid-value"),n=e("es5-ext/object/valid-callable"),s=e("../../deferred"),l=e("../../is-promise"),c=e("../../assimilate"),d=Function.prototype.call,u=Object.prototype.hasOwnProperty,p=s.resolve;a=function(e,t,r,a){if(this.list=e,this.cb=t,this.initialized=a,this.length=e.length>>>0,r=c(r),l(r)){if(!r.resolved)return o(this,s()),r.done(function(e){this.value=e,this.init()}.bind(this),this.reject),this.promise;if(this.value=r.value,r.failed)return r}else this.value=r;return this.init()},a.prototype={current:0,state:!1,init:function(){for(;this.current<this.length&&!u.call(this.list,this.current);)++this.current;if(this.current===this.length){if(!this.initialized)throw new Error("Reduce of empty array with no initial value");return this.resolve?this.resolve(this.value):p(this.value)}return this.promise||o(this,s()),this.processCb=this.processCb.bind(this),this.processValue=this.processValue.bind(this),this["continue"](),this.promise},"continue":function(){for(var e;!this.state&&(e=this.process(),"cb"===this.state)&&(e=this.processCb(e),"value"===this.state);)this.processValue(e)},process:function(){var e=c(this.list[this.current]);if(l(e)){if(!e.resolved)return void e.done(function(e){e=this.processCb(e),"value"===this.state&&(this.processValue(e),this.state||this["continue"]())}.bind(this),this.reject);if(e.failed)return void this.reject(e.value);e=e.value}return this.state="cb",e},processCb:function(e){if(!this.initialized)return this.initialized=!0,this.state="value",e;if(this.cb){try{e=d.call(this.cb,void 0,this.value,e,this.current,this.list)}catch(t){return void this.reject(t)}if(e=c(e),l(e)){if(!e.resolved)return void e.done(function(e){this.state="value",this.processValue(e),this.state||this["continue"]()}.bind(this),this.reject);if(e.failed)return void this.reject(e.value);e=e.value}}return this.state="value",e},processValue:function(e){for(this.value=e;++this.current<this.length;)if(u.call(this.list,this.current))return void(this.state=!1);this.resolve(this.value)}},t.exports=function(e){return i(this),null==e||n(e),new a(this,e,arguments[1],arguments.length>1)}},{"../../assimilate":5,"../../deferred":6,"../../is-promise":33,"es5-ext/object/assign":60,"es5-ext/object/valid-callable":72,"es5-ext/object/valid-value":74}],13:[function(e,t,r){t.exports=e("../../lib/some-every")(!0)},{"../../lib/some-every":34}],14:[function(e,t,r){var a,o,i=e("es5-ext/array/to-array"),n=e("es5-ext/object/valid-callable"),s=e("../../deferred"),l=e("../../is-promise"),c=e("../_process-arguments"),d=Array.prototype.slice,u=Function.prototype.apply;a=function(e,t,r){t=i(t),u.call(e,this,t.concat(function(e,t){null==e?r.resolve(arguments.length>2?d.call(arguments,1):t):r.reject(e)}))},o=function(e,t,r,o){var i;if(o=c(o,t),l(o))return o.failed?o:(i=s(),o.done(function(t){if(e.returnsPromise)return u.call(e,r,t);try{a.call(r,e,t,i)}catch(o){i.reject(o)}},i.reject),i.promise);if(e.returnsPromise)return u.call(e,r,o);i=s();try{a.call(r,e,o,i)}catch(n){throw i.reject(n),n}return i.promise},t.exports=r=function(e){return o(n(this),null,e,d.call(arguments,1))},Object.defineProperty(r,"_base",{configurable:!0,enumerable:!1,writable:!0,value:o})},{"../../deferred":6,"../../is-promise":33,"../_process-arguments":8,"es5-ext/array/to-array":44,"es5-ext/object/valid-callable":72}],15:[function(e,t,r){var a,o=e("es5-ext/object/valid-callable"),i=e("next-tick"),n=e("timers-ext/valid-timeout"),s=e("../../deferred"),l=Function.prototype.apply;a=function(e,t,r,a){var o;try{o=l.call(e,this,t)}catch(i){return void a(i)}r(o)},t.exports=function(e){var t,r,l;return t=o(this),null==e?l=i:(e=n(e),l=setTimeout),r=function(){var r=s();return l(a.bind(this,t,arguments,r.resolve,r.reject),e),r.promise},r.returnsPromise=!0,r}},{"../../deferred":6,"es5-ext/object/valid-callable":72,"next-tick":91,"timers-ext/valid-timeout":96}],16:[function(e,t,r){var a,o=e("es5-ext/number/to-pos-integer"),i=e("es5-ext/object/valid-callable"),n=e("event-emitter/unify"),s=e("../../deferred"),l=e("../../is-promise"),c=e("../../assimilate"),d=s.resolve,u=s.reject,p=Function.prototype.apply,m=Math.max;e("../promise/finally"),a=function(){var e=new Error("Too many calls");return e.type="deferred-gate-rejected",u(e)},t.exports=function(e,t){var r,g,f,h,b,y,v;return r=i(this),e=m(o(e),1),t=null==t||isNaN(t)?1/0:o(t),g=0,b=[],y=function(e,t,a){var o;try{o=p.call(r,e,t)}catch(i){return a?(a.reject(i),void h()):u(i)}if(o=c(o),l(o)){if(a&&n(a.promise,o),!o.resolved)return++g,a&&a.resolve(o),o["finally"](f);o=o.value}return a?(a.resolve(o),void h()):d(o)},f=function(){--g,h()},h=function(){var e;(e=b.shift())&&y.apply(null,e)},v=function(){var r;return g>=e?b.length<t?(r=s(),b.push([this,arguments,r]),r.promise):a():y(this,arguments)},v.returnsPromise=!0,v}},{"../../assimilate":5,"../../deferred":6,"../../is-promise":33,"../promise/finally":23,"es5-ext/number/to-pos-integer":58,"es5-ext/object/valid-callable":72,"event-emitter/unify":90}],17:[function(e,t,r){var a,o=e("es5-ext/object/valid-callable"),i=e("../../deferred"),n=e("../../is-promise"),s=e("../_process-arguments"),l=Function.prototype.apply;a=function(e,t,r,a){var o;try{o=l.call(e,this,t)}catch(i){return void a(i)}r(o)},t.exports=function(e){var t,r;return t=o(this),t.returnsPromise?t:(null!=e&&(e>>>=0),r=function(){var r,o;if(r=s(arguments,e),n(r)){if(r.failed)return r;o=i(),r.done(function(e){a.call(this,t,e,o.resolve,o.reject)}.bind(this),o.reject)}else o=i(),a.call(this,t,r,o.resolve,o.reject);return o.promise},r.returnsPromise=!0,r)}},{"../../deferred":6,"../../is-promise":33,"../_process-arguments":8,"es5-ext/object/valid-callable":72}],18:[function(e,t,r){var a=e("es5-ext/object/valid-callable"),o=e("./call-async")._base;t.exports=function(e){var t,r;return t=a(this),t.returnsPromise?t:(null!=e&&(e>>>=0),r=function(){return o(t,e,this,arguments)},r.returnsPromise=!0,r)}},{"./call-async":14,"es5-ext/object/valid-callable":72}],19:[function(e,t,r){var a=e("es5-ext/object/valid-callable"),o=e("../../deferred"),i=o.reject;t.exports=function(e,t){o.extend(e,function(t){var r;return null==t||a(t),this.pending||(this.pending=[]),r=o(),this.pending.push(e,[arguments,r.resolve,r.reject]),r.promise},function(e,r,a){var o;if(this.failed)return void a(this.value);try{o=t.apply(this.value,e)}catch(i){return void a(i)}r(o)},function(e){if(null==e||a(e),this.failed)return this;try{return t.apply(this.value,arguments)}catch(r){return i(r)}})}},{"../../deferred":6,"es5-ext/object/valid-callable":72}],20:[function(e,t,r){var a=e("es5-ext/object/valid-callable"),o=e("../../deferred");o.extend("aside",function(e,t){return null==e||a(e),null==t||a(t),(e||t)&&(this.pending||(this.pending=[]),this.pending.push("aside",arguments)),this},function(e,t){var r=this.failed?t:e;r&&r(this.value)},function(e,t){var r;return null==e||a(e),null==t||a(t),r=this.failed?t:e,r&&r(this.value),this})},{"../../deferred":6,"es5-ext/object/valid-callable":72}],21:[function(e,t,r){var a=e("es5-ext/object/is-callable"),o=e("es5-ext/object/valid-value"),i=e("../../deferred"),n=e("../../is-promise"),s=i.resolve,l=i.reject;i.extend("catch",function(e){var t;return o(e),this.pending||(this.pending=[]),t=i(),this.pending.push("catch",[e,t.resolve,t.reject]),t.promise},function(e,t,r){var o;if(!this.failed)return void t(this.value);if(a(e)){if(n(e))return void(e.resolved?e.failed?r(e.value):t(e.value):e.done(t,r));try{o=e(this.value)}catch(i){return void r(i)}return void t(o)}t(e)},function(e){var t;if(o(e),!this.failed)return this;if(a(e)){if(n(e))return e;try{t=e(this.value)}catch(r){return l(r)}return s(t)}return s(e)})},{"../../deferred":6,"../../is-promise":33,"es5-ext/object/is-callable":65,"es5-ext/object/valid-value":74}],22:[function(e,t,r){var a=e("es5-ext/object/valid-callable"),o=e("next-tick"),i=e("../../deferred");i.extend("cb",function(e){return null==e?this:(a(e),o(function(){this.resolved?this.failed?e(this.value):e(null,this.value):(this.pending||(this.pending=[]),this.pending.push("cb",[e]))}.bind(this)),this)},function(e){this.failed?e(this.value):e(null,this.value)},function(e){return null==e?this:(a(e),o(function(){this.failed?e(this.value):e(null,this.value)}.bind(this)),this)})},{"../../deferred":6,"es5-ext/object/valid-callable":72,"next-tick":91}],23:[function(e,t,r){var a=e("es5-ext/object/valid-callable"),o=e("../../deferred");o.extend("finally",function(e){return a(e),this.pending||(this.pending=[]),this.pending.push("finally",arguments),this},function(e){e()},function(e){return a(e)(),this})},{"../../deferred":6,"es5-ext/object/valid-callable":72}],24:[function(e,t,r){var a=e("es5-ext/object/valid-value"),o=e("../../deferred"),i=Array.prototype.reduce,n=o.resolve,s=o.reject;o.extend("get",function(){var e;return this.pending||(this.pending=[]),e=o(),this.pending.push("get",[arguments,e.resolve,e.reject]),e.promise},function(e,t,r){var o;this.failed&&r(this.value);try{o=i.call(e,function(e,t){return a(e)[String(t)]},this.value)}catch(n){return void r(n)}t(o)},function(){var e;if(this.failed)return this;try{e=i.call(arguments,function(e,t){return a(e)[String(t)]},this.value)}catch(t){return s(t)}return n(e)})},{"../../deferred":6,"es5-ext/object/valid-value":74}],25:[function(e,t,r){var a,o=e("es5-ext/array/to-array"),i=e("es5-ext/object/is-callable"),n=e("../../deferred"),s=e("../../is-promise"),l=e("../_process-arguments"),c=Array.prototype.slice,d=Function.prototype.apply,u=n.reject;a=function(e,t,r,a){var i;if(e.returnsPromise){try{i=d.call(e,this,t)}catch(n){return void a(n)}return r(i)}t=o(t).concat(function(e,t){null==e?r(arguments.length>2?c.call(arguments,1):t):a(e)});try{d.call(e,this,t)}catch(s){a(s)}},n.extend("invokeAsync",function(e){var t;return this.pending||(this.pending=[]),t=n(),this.pending.push("invokeAsync",[arguments,t.resolve,t.reject]),t.promise},function(e,t,r){var o;if(this.failed)return void r(this.value);if(null==this.value)return void r(new TypeError("Cannot use null or undefined"));if(o=e[0],!i(o)){if(o=String(o),!i(this.value[o]))return void r(new TypeError(o+" is not a function"));o=this.value[o]}if(e=l(c.call(e,1)),s(e)){if(e.failed)return void r(e.value);e.done(function(e){a.call(this,o,e,t,r)}.bind(this.value),r)}else a.call(this.value,o,e,t,r)},function(e){var t,r;if(this.failed)return this;if(null==this.value)return u(new TypeError("Cannot use null or undefined"));if(!i(e)){if(e=String(e),!i(this.value[e]))return u(new TypeError(e+" is not a function"));e=this.value[e]}if(t=l(c.call(arguments,1)),s(t)){if(t.failed)return t;r=n(),t.done(function(t){a.call(this,e,t,r.resolve,r.reject)}.bind(this.value),r.reject)}else{if(e.returnsPromise)return a.call(this.value,e,t,n,u);r=n(),a.call(this.value,e,t,r.resolve,r.reject)}return r.promise})},{"../../deferred":6,"../../is-promise":33,"../_process-arguments":8,"es5-ext/array/to-array":44,"es5-ext/object/is-callable":65}],26:[function(e,t,r){var a,o=e("es5-ext/object/is-callable"),i=e("../../deferred"),n=e("../../is-promise"),s=e("../_process-arguments"),l=Array.prototype.slice,c=Function.prototype.apply,d=i.reject;a=function(e,t,r,a){var o;try{o=c.call(e,this,t)}catch(i){return a(i)}return r(o)},i.extend("invoke",function(e){var t;return this.pending||(this.pending=[]),t=i(),this.pending.push("invoke",[arguments,t.resolve,t.reject]),t.promise},function(e,t,r){var i;if(this.failed)return void r(this.value);if(null==this.value)return void r(new TypeError("Cannot use null or undefined"));if(i=e[0],!o(i)){if(i=String(i),!o(this.value[i]))return void r(new TypeError(i+" is not a function"));i=this.value[i]}if(e=s(l.call(e,1)),n(e)){if(e.failed)return void r(e.value);e.done(function(e){a.call(this,i,e,t,r)}.bind(this.value),r)}else a.call(this.value,i,e,t,r)},function(e){var t,r;if(this.failed)return this;if(null==this.value)return d(new TypeError("Cannot use null or undefined"));if(!o(e)){if(e=String(e),!o(this.value[e]))return d(new TypeError(e+" is not a function"));e=this.value[e]}return t=s(l.call(arguments,1)),n(t)?t.failed?t:(r=i(),t.done(function(t){a.call(this,e,t,r.resolve,r.reject)}.bind(this.value),r.reject),r.promise):a.call(this.value,e,t,i,d)})},{"../../deferred":6,"../../is-promise":33,"../_process-arguments":8,"es5-ext/object/is-callable":65}],27:[function(e,t,r){e("./_array")("map",e("../array/map"))},{"../array/map":11,"./_array":19}],28:[function(e,t,r){e("./_array")("reduce",e("../array/reduce"))},{"../array/reduce":12,"./_array":19}],29:[function(e,t,r){e("./_array")("some",e("../array/some"))},{"../array/some":13,"./_array":19}],30:[function(e,t,r){var a=e("es5-ext/function/#/spread"),o=e("es5-ext/object/valid-callable"),i=e("es5-ext/object/is-callable"),n=e("../../is-promise"),s=e("../../deferred"),l=s.resolve,c=s.reject;s.extend("spread",function(e,t){var r;return null==e||o(e),e||null!=t?(this.pending||(this.pending=[]),r=s(),this.pending.push("spread",[e,t,r.resolve,r.reject]),r.promise):this},function(e,t,r,o){var s,l;if(s=this.failed?t:e,null==s&&(this.failed?o(this.value):r(this.value)),i(s)){if(n(s))return void(s.resolved?s.failed?o(s.value):r(s.value):s.done(r,o));this.failed||(s=a.call(s));try{l=s(this.value)}catch(c){return void o(c)}r(l)}else r(s)},function(e,t){var r,o;if(r=this.failed?t:e,null==r)return this;if(i(r)){if(n(r))return r;this.failed||(r=a.call(r));try{o=r(this.value)}catch(s){return c(s)}return l(o)}return l(r)})},{"../../deferred":6,"../../is-promise":33,"es5-ext/function/#/spread":47,"es5-ext/object/is-callable":65,"es5-ext/object/valid-callable":72}],31:[function(e,t,r){var a=Function.prototype.call,o=e("es5-ext/object/assign");t.exports=o(e("./deferred"),{invokeAsync:e("./invoke-async"),isPromise:e("./is-promise"),dynamicQueue:e("./dynamic-queue"),validPromise:e("./valid-promise"),callAsync:a.bind(e("./ext/function/call-async")),delay:a.bind(e("./ext/function/delay")),gate:a.bind(e("./ext/function/gate")),monitor:e("./monitor"),promisify:a.bind(e("./ext/function/promisify")),promisifySync:a.bind(e("./ext/function/promisify-sync")),every:a.bind(e("./ext/array/every")),find:a.bind(e("./ext/array/find")),map:a.bind(e("./ext/array/map")),reduce:a.bind(e("./ext/array/reduce")),some:a.bind(e("./ext/array/some"))},e("./profiler")),e("./ext/promise/aside"),e("./ext/promise/catch"),e("./ext/promise/cb"),e("./ext/promise/finally"),e("./ext/promise/get"),e("./ext/promise/invoke"),e("./ext/promise/invoke-async"),e("./ext/promise/map"),e("./ext/promise/spread"),e("./ext/promise/some"),e("./ext/promise/reduce")},{"./deferred":6,"./dynamic-queue":7,"./ext/array/every":9,"./ext/array/find":10,"./ext/array/map":11,"./ext/array/reduce":12,"./ext/array/some":13,"./ext/function/call-async":14,"./ext/function/delay":15,"./ext/function/gate":16,"./ext/function/promisify":18,"./ext/function/promisify-sync":17,"./ext/promise/aside":20,"./ext/promise/catch":21,"./ext/promise/cb":22,"./ext/promise/finally":23,"./ext/promise/get":24,"./ext/promise/invoke":26,"./ext/promise/invoke-async":25,"./ext/promise/map":27,"./ext/promise/reduce":28,"./ext/promise/some":29,"./ext/promise/spread":30,"./invoke-async":32,"./is-promise":33,"./monitor":35,"./profiler":36,"./valid-promise":37,"es5-ext/object/assign":60}],32:[function(e,t,r){var a=e("es5-ext/object/is-callable"),o=e("es5-ext/object/valid-callable"),i=e("es5-ext/object/valid-value"),n=e("./ext/function/call-async")._base,s=Array.prototype.slice;t.exports=function(e,t){return i(e),a(t)||(t=o(e[t])),n(t,null,e,s.call(arguments,2))}},{"./ext/function/call-async":14,"es5-ext/object/is-callable":65,"es5-ext/object/valid-callable":72,"es5-ext/object/valid-value":74}],33:[function(e,t,r){t.exports=function(e){return"function"==typeof e&&"function"==typeof e.then&&e.end!==e.done}},{}],34:[function(e,t,r){var a=e("es5-ext/object/assign"),o=e("es5-ext/object/valid-value"),i=e("es5-ext/object/valid-callable"),n=e("../deferred"),s=e("../is-promise"),l=e("../assimilate"),c=Function.prototype.call,d=n.resolve;t.exports=function(e){var t=function(t,r,o){for(this.list=t,this.cb=r,this.context=o,this.length=t.length>>>0;this.current<this.length;){if(this.current in t)return a(this,n()),this.processCb=this.processCb.bind(this),this.processValue=this.processValue.bind(this),this["continue"](),this.promise;++this.current}return d(!e)};return t.prototype={current:0,state:!1,"continue":function(){for(var e;!this.state&&(e=this.process(),"cb"===this.state)&&(e=this.processCb(e),"value"===this.state);)this.processValue(e)},process:function(){var e=l(this.list[this.current]);if(s(e)){if(!e.resolved)return void e.done(function(e){e=this.processCb(e),"value"===this.state&&(this.processValue(e),this.state||this["continue"]())}.bind(this),this.reject);if(e.failed)return void this.reject(e.value);e=e.value}return this.state="cb",e},processCb:function(e){if(this.cb){try{e=c.call(this.cb,this.context,e,this.current,this.list)}catch(t){return void this.reject(t)}if(e=l(e),s(e)){if(!e.resolved)return void e.done(function(e){this.state="value",this.processValue(e),this.state||this["continue"]()}.bind(this),this.reject);if(e.failed)return void this.reject(e.value);e=e.value}}return this.state="value",e},processValue:function(t){if(Boolean(t)===e)return void this.resolve(e);for(;++this.current<this.length;)if(this.current in this.list)return void(this.state=!1);this.resolve(!e)}},function(e){return o(this),null==e||i(e),new t(this,e,arguments[1])}}},{"../assimilate":5,"../deferred":6,"../is-promise":33,"es5-ext/object/assign":60,"es5-ext/object/valid-callable":72,"es5-ext/object/valid-value":74}],35:[function(e,t,r){var a=Math.max,o=e("es5-ext/object/valid-callable"),i=e("es5-ext/object/is-callable"),n=e("es5-ext/number/to-pos-integer"),s=e("./deferred");r=t.exports=function(e,t){return e===!1?(delete s._monitor,delete r.timeout,void delete r.callback):(r.timeout=e=a(n(e)||5e3,50),null==t?"undefined"!=typeof console&&console&&i(console.error)&&(t=function(e){console.error(e.stack&&e.stack.toString()||"Unresolved promise: no stack available")}):o(t),r.callback=t,void(s._monitor=function(){var r=new Error("Unresolved promise");return setTimeout(function(){t&&t(r)},e)}))}},{"./deferred":6,"es5-ext/number/to-pos-integer":58,"es5-ext/object/is-callable":65,"es5-ext/object/valid-callable":72}],36:[function(e,t,r){var a,o,i,n,s,l=e("es5-ext/function/#/partial"),c=e("es5-ext/object/for-each"),d=e("es5-ext/string/#/pad"),u=e("./deferred");r.profile=function(){a=0,o={},i=0,n={},u._profile=s},s=function(e){var t,r;e?(++a,r=o):(++i,r=n),t=(new Error).stack,t.split("\n").slice(3).some(function(e){return-1===e.search(/[\/\\]deferred[\/\\]/)&&-1===e.search(/[\/\\]es5-ext[\/\\]/)&&-1===e.indexOf(" (native)")?(e=e.replace(/\n/g,"\\n").trim(),
r[e]||(r[e]={count:0}),++r[e].count,!0):void 0})||(r.unknown||(r.unknown={count:0,stack:t}),++r.unknown.count)},r.profileEnd=function(){var e,t,r="";if(!u._profile)throw new Error("Deferred profiler was not initialized");return delete u._profile,r+="------------------------------------------------------------\n",r+="Deferred usage statistics:\n\n",e=String(a+i),t=l.call(d," ",e.length),r+=e+" Total promises initialized\n",r+=t.call(i)+" Initialized as Unresolved\n",r+=t.call(a)+" Initialized as Resolved\n",i&&(r+="\nUnresolved promises were initialized at:\n",c(n,function(e,a){r+=t.call(e.count)+" "+a+"\n"},null,function(e,t){return this[t].count-this[e].count})),a&&(r+="\nResolved promises were initialized at:\n",c(o,function(e,a){r+=t.call(e.count)+" "+a+"\n"},null,function(e,t){return this[t].count-this[e].count})),r+="------------------------------------------------------------\n",{log:r,resolved:{count:a,stats:o},unresolved:{count:i,stats:n}}}},{"./deferred":6,"es5-ext/function/#/partial":46,"es5-ext/object/for-each":63,"es5-ext/string/#/pad":78}],37:[function(e,t,r){var a=e("./is-promise");t.exports=function(e){if(!a(e))throw new TypeError(e+" is not a promise object");return e}},{"./is-promise":33}],38:[function(e,t,r){t.exports=e("./is-implemented")()?Array.from:e("./shim")},{"./is-implemented":39,"./shim":40}],39:[function(e,t,r){t.exports=function(){var e,t,r=Array.from;return"function"!=typeof r?!1:(e=["raz","dwa"],t=r(e),Boolean(t&&t!==e&&"dwa"===t[1]))}},{}],40:[function(e,t,r){var a=e("es6-symbol").iterator,o=e("../../function/is-arguments"),i=e("../../function/is-function"),n=e("../../number/to-pos-integer"),s=e("../../object/valid-callable"),l=e("../../object/valid-value"),c=e("../../string/is-string"),d=Array.isArray,u=Function.prototype.call,p={configurable:!0,enumerable:!0,writable:!0,value:null},m=Object.defineProperty;t.exports=function(e){var t,r,g,f,h,b,y,v,Z,w,R=arguments[1],E=arguments[2];if(e=Object(l(e)),null!=R&&s(R),this&&this!==Array&&i(this))t=this;else{if(!R){if(o(e))return h=e.length,1!==h?Array.apply(null,e):(f=new Array(1),f[0]=e[0],f);if(d(e)){for(f=new Array(h=e.length),r=0;h>r;++r)f[r]=e[r];return f}}f=[]}if(!d(e))if(void 0!==(Z=e[a])){for(y=s(Z).call(e),t&&(f=new t),v=y.next(),r=0;!v.done;)w=R?u.call(R,E,v.value,r):v.value,t?(p.value=w,m(f,r,p)):f[r]=w,v=y.next(),++r;h=r}else if(c(e)){for(h=e.length,t&&(f=new t),r=0,g=0;h>r;++r)w=e[r],h>r+1&&(b=w.charCodeAt(0),b>=55296&&56319>=b&&(w+=e[++r])),w=R?u.call(R,E,w,g):w,t?(p.value=w,m(f,g,p)):f[g]=w,++g;h=g}if(void 0===h)for(h=n(e.length),t&&(f=new t(h)),r=0;h>r;++r)w=R?u.call(R,E,e[r],r):e[r],t?(p.value=w,m(f,r,p)):f[r]=w;return t&&(p.value=null,f.length=h),f}},{"../../function/is-arguments":49,"../../function/is-function":50,"../../number/to-pos-integer":58,"../../object/valid-callable":72,"../../object/valid-value":74,"../../string/is-string":82,"es6-symbol":84}],41:[function(e,t,r){t.exports=e("./is-implemented")()?Array.of:e("./shim")},{"./is-implemented":42,"./shim":43}],42:[function(e,t,r){t.exports=function(){var e,t=Array.of;return"function"!=typeof t?!1:(e=t("foo","bar"),Boolean(e&&"bar"===e[1]))}},{}],43:[function(e,t,r){var a=e("../../function/is-function"),o=Array.prototype.slice,i=Object.defineProperty,n={configurable:!0,enumerable:!0,writable:!0,value:null};t.exports=function(){var e,t,r;if(!this||this===Array||!a(this))return o.call(arguments);for(e=new this(r=arguments.length),t=0;r>t;++t)n.value=arguments[t],i(e,t,n);return n.value=null,e.length=r,e}},{"../../function/is-function":50}],44:[function(e,t,r){var a=e("./from"),o=Array.isArray;t.exports=function(e){return o(e)?e:a(e)}},{"./from":38}],45:[function(e,t,r){var a=Object.prototype.toString,o=a.call(new Error);t.exports=function(e){return e&&(e instanceof Error||a.call(e)===o)||!1}},{}],46:[function(e,t,r){var a=e("../../object/valid-callable"),o=e("../../array/from"),i=e("../_define-length"),n=Function.prototype.apply;t.exports=function(){var e=a(this),t=o(arguments);return i(function(){return n.call(e,this,t.concat(o(arguments)))},e.length-t.length)}},{"../../array/from":38,"../../object/valid-callable":72,"../_define-length":48}],47:[function(e,t,r){var a=e("../../object/valid-callable"),o=Function.prototype.apply;t.exports=function(){var e=a(this);return function(t){return o.call(e,this,t)}}},{"../../object/valid-callable":72}],48:[function(e,t,r){var a,o,i,n,s=e("../number/to-pos-integer"),l=function(e,t){};try{Object.defineProperty(l,"length",{configurable:!0,writable:!1,enumerable:!1,value:1})}catch(c){}1===l.length?(a={configurable:!0,writable:!1,enumerable:!1},o=Object.defineProperty,t.exports=function(e,t){return t=s(t),e.length===t?e:(a.value=t,o(e,"length",a))}):(n=e("../object/mixin"),i=function(){var e=[];return function(t){var r,a=0;if(e[t])return e[t];for(r=[];t--;)r.push("a"+(++a).toString(36));return new Function("fn","return function ("+r.join(", ")+") { return fn.apply(this, arguments); };")}}(),t.exports=function(e,t){var r;if(t=s(t),e.length===t)return e;r=i(t)(e);try{n(r,e)}catch(a){}return r})},{"../number/to-pos-integer":58,"../object/mixin":70}],49:[function(e,t,r){var a=Object.prototype.toString,o=a.call(function(){return arguments}());t.exports=function(e){return a.call(e)===o}},{}],50:[function(e,t,r){var a=Object.prototype.toString,o=a.call(e("./noop"));t.exports=function(e){return"function"==typeof e&&a.call(e)===o}},{"./noop":51}],51:[function(e,t,r){t.exports=function(){}},{}],52:[function(e,t,r){var a=e("es6-symbol").iterator,o=e("../object/is-array-like");t.exports=function(e){return null==e?!1:"function"==typeof e[a]?!0:o(e)}},{"../object/is-array-like":64,"es6-symbol":84}],53:[function(e,t,r){var a=e("../object/is-object"),o=e("./is");t.exports=function(e){if(o(e)&&a(e))return e;throw new TypeError(e+" is not an iterable or array-like object")}},{"../object/is-object":66,"./is":52}],54:[function(e,t,r){t.exports=e("./is-implemented")()?Math.sign:e("./shim")},{"./is-implemented":55,"./shim":56}],55:[function(e,t,r){t.exports=function(){var e=Math.sign;return"function"!=typeof e?!1:1===e(10)&&-1===e(-20)}},{}],56:[function(e,t,r){t.exports=function(e){return e=Number(e),isNaN(e)||0===e?e:e>0?1:-1}},{}],57:[function(e,t,r){var a=e("../math/sign"),o=Math.abs,i=Math.floor;t.exports=function(e){return isNaN(e)?0:(e=Number(e),0!==e&&isFinite(e)?a(e)*i(o(e)):e)}},{"../math/sign":54}],58:[function(e,t,r){var a=e("./to-integer"),o=Math.max;t.exports=function(e){return o(0,a(e))}},{"./to-integer":57}],59:[function(e,t,r){var a=e("./valid-callable"),o=e("./valid-value"),i=Function.prototype.bind,n=Function.prototype.call,s=Object.keys,l=Object.prototype.propertyIsEnumerable;t.exports=function(e,t){return function(r,c){var d,u=arguments[2],p=arguments[3];return r=Object(o(r)),a(c),d=s(r),p&&d.sort("function"==typeof p?i.call(p,r):void 0),"function"!=typeof e&&(e=d[e]),n.call(e,d,function(e,a){return l.call(r,e)?n.call(c,u,r[e],e,r,a):t})}}},{"./valid-callable":72,"./valid-value":74}],60:[function(e,t,r){t.exports=e("./is-implemented")()?Object.assign:e("./shim")},{"./is-implemented":61,"./shim":62}],61:[function(e,t,r){t.exports=function(){var e,t=Object.assign;return"function"!=typeof t?!1:(e={foo:"raz"},t(e,{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},{}],62:[function(e,t,r){var a=e("../keys"),o=e("../valid-value"),i=Math.max;t.exports=function(e,t){var r,n,s,l=i(arguments.length,2);for(e=Object(o(e)),s=function(a){try{e[a]=t[a]}catch(o){r||(r=o)}},n=1;l>n;++n)t=arguments[n],a(t).forEach(s);if(void 0!==r)throw r;return e}},{"../keys":67,"../valid-value":74}],63:[function(e,t,r){t.exports=e("./_iterate")("forEach")},{"./_iterate":59}],64:[function(e,t,r){var a=e("../function/is-function"),o=e("./is-object");t.exports=function(e){return null!=e&&"number"==typeof e.length&&(o(e)&&!a(e)||"string"==typeof e)||!1}},{"../function/is-function":50,"./is-object":66}],65:[function(e,t,r){t.exports=function(e){return"function"==typeof e}},{}],66:[function(e,t,r){var a={"function":!0,object:!0};t.exports=function(e){return null!=e&&a["undefined"==typeof e?"undefined":_typeof2(e)]||!1}},{}],67:[function(e,t,r){t.exports=e("./is-implemented")()?Object.keys:e("./shim")},{"./is-implemented":68,"./shim":69}],68:[function(e,t,r){t.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},{}],69:[function(e,t,r){var a=Object.keys;t.exports=function(e){return a(null==e?e:Object(e))}},{}],70:[function(e,t,r){var a=e("./valid-value"),o=Object.defineProperty,i=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames;t.exports=function(e,t){var r;if(e=Object(a(e)),n(Object(a(t))).forEach(function(a){try{o(e,a,i(t,a))}catch(n){r=n}}),void 0!==r)throw r;return e}},{"./valid-value":74}],71:[function(e,t,r){var a=Array.prototype.forEach,o=Object.create,i=function(e,t){var r;for(r in e)t[r]=e[r]};t.exports=function(e){var t=o(null);return a.call(arguments,function(e){null!=e&&i(Object(e),t)}),t}},{}],72:[function(e,t,r){t.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},{}],73:[function(e,t,r){var a=e("./is-object");t.exports=function(e){if(!a(e))throw new TypeError(e+" is not an Object");return e}},{"./is-object":66}],74:[function(e,t,r){t.exports=function(e){if(null==e)throw new TypeError("Cannot use null or undefined");return e}},{}],75:[function(e,t,r){t.exports=e("./is-implemented")()?String.prototype.contains:e("./shim")},{"./is-implemented":76,"./shim":77}],76:[function(e,t,r){var a="razdwatrzy";t.exports=function(){return"function"!=typeof a.contains?!1:a.contains("dwa")===!0&&a.contains("foo")===!1}},{}],77:[function(e,t,r){var a=String.prototype.indexOf;t.exports=function(e){return a.call(this,e,arguments[1])>-1}},{}],78:[function(e,t,r){var a=e("../../number/to-integer"),o=e("../../object/valid-value"),i=e("./repeat"),n=Math.abs,s=Math.max;t.exports=function(e){var t=String(o(this)),r=t.length,l=arguments[1];return l=isNaN(l)?1:a(l),e=i.call(String(e),n(l)),l>=0?e.slice(0,s(0,l-r))+t:t+(r+l>=0?"":e.slice(l+r))}},{"../../number/to-integer":57,"../../object/valid-value":74,"./repeat":79}],79:[function(e,t,r){t.exports=e("./is-implemented")()?String.prototype.repeat:e("./shim")},{"./is-implemented":80,"./shim":81}],80:[function(e,t,r){var a="foo";t.exports=function(){return"function"!=typeof a.repeat?!1:"foofoo"===a.repeat(2)}},{}],81:[function(e,t,r){var a=e("../../../object/valid-value"),o=e("../../../number/to-integer");t.exports=function(e){var t,r=String(a(this));if(e=o(e),0>e)throw new RangeError("Count must be >= 0");if(!isFinite(e))throw new RangeError("Count must be < ∞");if(t="",!e)return t;for(;;){if(1&e&&(t+=r),e>>>=1,0>=e)break;r+=r}return t}},{"../../../number/to-integer":57,"../../../object/valid-value":74}],82:[function(e,t,r){var a=Object.prototype.toString,o=a.call("");t.exports=function(e){return"string"==typeof e||e&&"object"===("undefined"==typeof e?"undefined":_typeof2(e))&&(e instanceof String||a.call(e)===o)||!1}},{}],83:[function(t,r,a){(function(a,o){(function(){function i(e){return"function"==typeof e||"object"===("undefined"==typeof e?"undefined":_typeof2(e))&&null!==e}function n(e){return"function"==typeof e}function s(e){z=e}function l(e){Q=e}function c(){return function(){a.nextTick(g)}}function d(){return function(){B(g)}}function u(){var e=0,t=new X(g),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}function p(){var e=new MessageChannel;return e.port1.onmessage=g,function(){e.port2.postMessage(0)}}function m(){return function(){setTimeout(g,1)}}function g(){for(var e=0;H>e;e+=2){var t=re[e],r=re[e+1];t(r),re[e]=void 0,re[e+1]=void 0}H=0}function f(){try{var e=t,r=e("vertx");return B=r.runOnLoop||r.runOnContext,d()}catch(a){return m()}}function h(e,t){var r=this,a=r._state;if(a===ne&&!e||a===se&&!t)return this;var o=new this.constructor(y),i=r._result;if(a){var n=arguments[a-1];Q(function(){L(a,o,n,i)})}else T(r,o,e,t);return o}function b(e){var t=this;if(e&&"object"===("undefined"==typeof e?"undefined":_typeof2(e))&&e.constructor===t)return e;var r=new t(y);return C(r,e),r}function y(){}function v(){return new TypeError("You cannot resolve a promise with itself")}function Z(){return new TypeError("A promises callback cannot return that same promise.")}function w(e){try{return e.then}catch(t){return le.error=t,le}}function R(e,t,r,a){try{e.call(t,r,a)}catch(o){return o}}function E(e,t,r){Q(function(e){var a=!1,o=R(r,t,function(r){a||(a=!0,t!==r?C(e,r):S(e,r))},function(t){a||(a=!0,k(e,t))},"Settle: "+(e._label||" unknown promise"));!a&&o&&(a=!0,k(e,o))},e)}function x(e,t){t._state===ne?S(e,t._result):t._state===se?k(e,t._result):T(t,void 0,function(t){C(e,t)},function(t){k(e,t)})}function I(e,t,r){t.constructor===e.constructor&&r===ae&&constructor.resolve===oe?x(e,t):r===le?k(e,le.error):void 0===r?S(e,t):n(r)?E(e,t,r):S(e,t)}function C(e,t){e===t?k(e,v()):i(t)?I(e,t,w(t)):S(e,t)}function j(e){e._onerror&&e._onerror(e._result),D(e)}function S(e,t){e._state===ie&&(e._result=t,e._state=ne,0!==e._subscribers.length&&Q(D,e))}function k(e,t){e._state===ie&&(e._state=se,e._result=t,Q(j,e))}function T(e,t,r,a){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+ne]=r,o[i+se]=a,0===i&&e._state&&Q(D,e)}function D(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var a,o,i=e._result,n=0;n<t.length;n+=3)a=t[n],o=t[n+r],a?L(r,a,o,i):o(i);e._subscribers.length=0}}function N(){this.error=null}function O(e,t){try{return e(t)}catch(r){return ce.error=r,ce}}function L(e,t,r,a){var o,i,s,l,c=n(r);if(c){if(o=O(r,a),o===ce?(l=!0,i=o.error,o=null):s=!0,t===o)return void k(t,Z())}else o=a,s=!0;t._state!==ie||(c&&s?C(t,o):l?k(t,i):e===ne?S(t,o):e===se&&k(t,o))}function _(e,t){try{t(function(t){C(e,t)},function(t){k(e,t)})}catch(r){k(e,r)}}function A(e){return new fe(this,e).promise}function P(e){function t(e){C(o,e)}function r(e){k(o,e)}var a=this,o=new a(y);if(!G(e))return k(o,new TypeError("You must pass an array to race.")),o;for(var i=e.length,n=0;o._state===ie&&i>n;n++)T(a.resolve(e[n]),void 0,t,r);return o}function M(e){var t=this,r=new t(y);return k(r,e),r}function J(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function U(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function F(e){this._id=me++,this._state=void 0,this._result=void 0,this._subscribers=[],y!==e&&("function"!=typeof e&&J(),this instanceof F?_(this,e):U())}function V(e,t){this._instanceConstructor=e,this.promise=new e(y),Array.isArray(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?S(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&S(this.promise,this._result))):k(this.promise,this._validationError())}function K(){var e;if("undefined"!=typeof o)e=o;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var r=e.Promise;(!r||"[object Promise]"!==Object.prototype.toString.call(r.resolve())||r.cast)&&(e.Promise=ge)}var q;q=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var B,z,W,G=q,H=0,Q=function(e,t){re[H]=e,re[H+1]=t,H+=2,2===H&&(z?z(g):W())},$="undefined"!=typeof window?window:void 0,Y=$||{},X=Y.MutationObserver||Y.WebKitMutationObserver,ee="undefined"!=typeof a&&"[object process]"==={}.toString.call(a),te="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,re=new Array(1e3);W=ee?c():X?u():te?p():void 0===$&&"function"==typeof t?f():m();var ae=h,oe=b,ie=void 0,ne=1,se=2,le=new N,ce=new N,de=A,ue=P,pe=M,me=0,ge=F;F.all=de,F.race=ue,F.resolve=oe,F.reject=pe,F._setScheduler=s,F._setAsap=l,F._asap=Q,F.prototype={constructor:F,then:ae,"catch":function(e){return this.then(null,e)}};var fe=V;V.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},V.prototype._enumerate=function(){for(var e=this.length,t=this._input,r=0;this._state===ie&&e>r;r++)this._eachEntry(t[r],r)},V.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,a=r.resolve;if(a===oe){var o=w(e);if(o===ae&&e._state!==ie)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(r===ge){var i=new r(y);I(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new r(function(t){t(e)}),t)}else this._willSettleAt(a(e),t)},V.prototype._settledAt=function(e,t,r){var a=this.promise;a._state===ie&&(this._remaining--,e===se?k(a,r):this._result[t]=r),0===this._remaining&&S(a,this._result)},V.prototype._willSettleAt=function(e,t){var r=this;T(e,void 0,function(e){r._settledAt(ne,t,e)},function(e){r._settledAt(se,t,e)})};var he=K,be={Promise:ge,polyfill:he};"function"==typeof e&&e.amd?e(function(){return be}):"undefined"!=typeof r&&r.exports?r.exports=be:"undefined"!=typeof this&&(this.ES6Promise=be),he()}).call(this)}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:92}],84:[function(e,t,r){t.exports=e("./is-implemented")()?Symbol:e("./polyfill")},{"./is-implemented":85,"./polyfill":87}],85:[function(e,t,r){t.exports=function(){var e;if("function"!=typeof Symbol)return!1;e=Symbol("test symbol");try{String(e)}catch(t){return!1}return"symbol"===_typeof2(Symbol.iterator)?!0:"object"!==_typeof2(Symbol.isConcatSpreadable)?!1:"object"!==_typeof2(Symbol.iterator)?!1:"object"!==_typeof2(Symbol.toPrimitive)?!1:"object"!==_typeof2(Symbol.toStringTag)?!1:"object"!==_typeof2(Symbol.unscopables)?!1:!0}},{}],86:[function(e,t,r){t.exports=function(e){return e&&("symbol"===("undefined"==typeof e?"undefined":_typeof2(e))||"Symbol"===e["@@toStringTag"])||!1}},{}],87:[function(e,t,r){var a,o,i,n=e("d"),s=e("./validate-symbol"),l=Object.create,c=Object.defineProperties,d=Object.defineProperty,u=Object.prototype,p=l(null);"function"==typeof Symbol&&(a=Symbol);var m=function(){var e=l(null);return function(t){for(var r,a,o=0;e[t+(o||"")];)++o;return t+=o||"",e[t]=!0,r="@@"+t,d(u,r,n.gs(null,function(e){a||(a=!0,d(this,r,n(e)),a=!1)})),r}}();i=function(e){if(this instanceof i)throw new TypeError("TypeError: Symbol is not a constructor");return o(e)},t.exports=o=function g(e){var t;if(this instanceof g)throw new TypeError("TypeError: Symbol is not a constructor");return t=l(i.prototype),e=void 0===e?"":String(e),c(t,{__description__:n("",e),__name__:n("",m(e))})},c(o,{"for":n(function(e){return p[e]?p[e]:p[e]=o(String(e))}),keyFor:n(function(e){var t;s(e);for(t in p)if(p[t]===e)return t}),hasInstance:n("",a&&a.hasInstance||o("hasInstance")),isConcatSpreadable:n("",a&&a.isConcatSpreadable||o("isConcatSpreadable")),iterator:n("",a&&a.iterator||o("iterator")),match:n("",a&&a.match||o("match")),replace:n("",a&&a.replace||o("replace")),search:n("",a&&a.search||o("search")),species:n("",a&&a.species||o("species")),split:n("",a&&a.split||o("split")),toPrimitive:n("",a&&a.toPrimitive||o("toPrimitive")),toStringTag:n("",a&&a.toStringTag||o("toStringTag")),unscopables:n("",a&&a.unscopables||o("unscopables"))}),c(i.prototype,{constructor:n(o),toString:n("",function(){return this.__name__})}),c(o.prototype,{toString:n(function(){return"Symbol ("+s(this).__description__+")"}),valueOf:n(function(){return s(this)})}),d(o.prototype,o.toPrimitive,n("",function(){return s(this)})),d(o.prototype,o.toStringTag,n("c","Symbol")),d(i.prototype,o.toStringTag,n("c",o.prototype[o.toStringTag])),d(i.prototype,o.toPrimitive,n("c",o.prototype[o.toPrimitive]))},{"./validate-symbol":88,d:3}],88:[function(e,t,r){var a=e("./is-symbol");t.exports=function(e){if(!a(e))throw new TypeError(e+" is not a symbol");return e}},{"./is-symbol":86}],89:[function(e,t,r){var a,o,i,n,s,l,c,d=e("d"),u=e("es5-ext/object/valid-callable"),p=Function.prototype.apply,m=Function.prototype.call,g=Object.create,f=Object.defineProperty,h=Object.defineProperties,b=Object.prototype.hasOwnProperty,y={configurable:!0,enumerable:!1,writable:!0};a=function(e,t){var r;return u(t),b.call(this,"__ee__")?r=this.__ee__:(r=y.value=g(null),f(this,"__ee__",y),y.value=null),r[e]?"object"===_typeof2(r[e])?r[e].push(t):r[e]=[r[e],t]:r[e]=t,this},o=function(e,t){var r,o;return u(t),o=this,a.call(this,e,r=function(){i.call(o,e,r),p.call(t,this,arguments)}),r.__eeOnceListener__=t,this},i=function(e,t){var r,a,o,i;if(u(t),!b.call(this,"__ee__"))return this;if(r=this.__ee__,!r[e])return this;if(a=r[e],"object"===("undefined"==typeof a?"undefined":_typeof2(a)))for(i=0;o=a[i];++i)(o===t||o.__eeOnceListener__===t)&&(2===a.length?r[e]=a[i?0:1]:a.splice(i,1));else(a===t||a.__eeOnceListener__===t)&&delete r[e];return this},n=function(e){var t,r,a,o,i;if(b.call(this,"__ee__")&&(o=this.__ee__[e]))if("object"===("undefined"==typeof o?"undefined":_typeof2(o))){for(r=arguments.length,i=new Array(r-1),t=1;r>t;++t)i[t-1]=arguments[t];for(o=o.slice(),t=0;a=o[t];++t)p.call(a,this,i)}else switch(arguments.length){case 1:m.call(o,this);break;case 2:m.call(o,this,arguments[1]);break;case 3:m.call(o,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,i=new Array(r-1),t=1;r>t;++t)i[t-1]=arguments[t];p.call(o,this,i)}},s={on:a,once:o,off:i,emit:n},l={on:d(a),once:d(o),off:d(i),emit:d(n)},c=h({},l),t.exports=r=function(e){return null==e?g(c):h(Object(e),l)},r.methods=s},{d:3,"es5-ext/object/valid-callable":72}],90:[function(e,t,r){var a=e("es5-ext/object/for-each"),o=e("es5-ext/object/valid-object"),i=Array.prototype.apply,n=Object.defineProperty,s=Object.create,l=Object.prototype.hasOwnProperty,c={configurable:!0,enumerable:!1,writable:!0};t.exports=function(e,t){var r;return o(e)&&o(t),l.call(e,"__ee__")?(r=c.value=e.__ee__,l.call(t,"__ee__")?void(r!==t.__ee__&&(a(t.__ee__,function(e,t){return r[t]?void("object"===_typeof2(r[t])?"object"===("undefined"==typeof e?"undefined":_typeof2(e))?i.apply(r[t],e):r[t].push(e):"object"===("undefined"==typeof e?"undefined":_typeof2(e))?(e.unshift(r[t]),r[t]=e):r[t]=[r[t],e]):void(r[t]=e)}),n(t,"__ee__",c),c.value=null)):(n(t,"__ee__",c),void(c.value=null))):l.call(t,"__ee__")?(c.value=t.__ee__,n(e,"__ee__",c),void(c.value=null)):(c.value=s(null),n(e,"__ee__",c),n(t,"__ee__",c),void(c.value=null))}},{"es5-ext/object/for-each":63,"es5-ext/object/valid-object":73}],91:[function(e,t,r){(function(e){var r,a;r=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e},a=function(e){var t,a=document.createTextNode(""),o=0;return new e(function(){var e;if(t)return e=t,t=null,"function"==typeof e?void e():void e.forEach(function(e){e()})}).observe(a,{characterData:!0}),function(e){return r(e),t?void("function"==typeof t?t=[t,e]:t.push(e)):(t=e,void(a.data=o=++o%2))}},t.exports=function(){if("undefined"!=typeof e&&e&&"function"==typeof e.nextTick)return e.nextTick;if("object"===("undefined"==typeof document?"undefined":_typeof2(document))&&document){if("function"==typeof MutationObserver)return a(MutationObserver);if("function"==typeof WebKitMutationObserver)return a(WebKitMutationObserver)}return"function"==typeof setImmediate?function(e){setImmediate(r(e))}:"function"==typeof setTimeout?function(e){setTimeout(r(e),0)}:null}()}).call(this,e("_process"))},{_process:92}],92:[function(e,t,r){function a(){d=!1,s.length?c=s.concat(c):u=-1,c.length&&o()}function o(){if(!d){var e=setTimeout(a);d=!0;for(var t=c.length;t;){for(s=c,c=[];++u<t;)s&&s[u].run();u=-1,t=c.length}s=null,d=!1,clearTimeout(e)}}function i(e,t){this.fun=e,this.array=t}function n(){}var s,l=t.exports={},c=[],d=!1,u=-1;l.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new i(e,t)),1!==c.length||d||setTimeout(o,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=n,l.addListener=n,l.once=n,l.off=n,l.removeListener=n,l.removeAllListeners=n,l.emit=n,l.binding=function(e){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(e){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},{}],93:[function(t,r,a){!function(t){if("object"===("undefined"==typeof a?"undefined":_typeof2(a)))r.exports=t();else if("function"==typeof e&&e.amd)e(t);else{var o;try{o=window}catch(i){o=self}o.SparkMD5=t()}}(function(e){function t(e,t,r,a,o,i){return t=v(v(t,e),v(a,i)),v(t<<o|t>>>32-o,r)}function r(e,r,a,o,i,n,s){return t(r&a|~r&o,e,r,i,n,s)}function a(e,r,a,o,i,n,s){return t(r&o|a&~o,e,r,i,n,s)}function o(e,r,a,o,i,n,s){return t(r^a^o,e,r,i,n,s)}function i(e,r,a,o,i,n,s){return t(a^(r|~o),e,r,i,n,s)}function n(e,t){var n=e[0],s=e[1],l=e[2],c=e[3];n=r(n,s,l,c,t[0],7,-680876936),c=r(c,n,s,l,t[1],12,-389564586),l=r(l,c,n,s,t[2],17,606105819),s=r(s,l,c,n,t[3],22,-1044525330),n=r(n,s,l,c,t[4],7,-176418897),c=r(c,n,s,l,t[5],12,1200080426),l=r(l,c,n,s,t[6],17,-1473231341),s=r(s,l,c,n,t[7],22,-45705983),n=r(n,s,l,c,t[8],7,1770035416),c=r(c,n,s,l,t[9],12,-1958414417),l=r(l,c,n,s,t[10],17,-42063),s=r(s,l,c,n,t[11],22,-1990404162),n=r(n,s,l,c,t[12],7,1804603682),c=r(c,n,s,l,t[13],12,-40341101),l=r(l,c,n,s,t[14],17,-1502002290),s=r(s,l,c,n,t[15],22,1236535329),n=a(n,s,l,c,t[1],5,-165796510),c=a(c,n,s,l,t[6],9,-1069501632),l=a(l,c,n,s,t[11],14,643717713),s=a(s,l,c,n,t[0],20,-373897302),n=a(n,s,l,c,t[5],5,-701558691),c=a(c,n,s,l,t[10],9,38016083),l=a(l,c,n,s,t[15],14,-660478335),s=a(s,l,c,n,t[4],20,-405537848),n=a(n,s,l,c,t[9],5,568446438),c=a(c,n,s,l,t[14],9,-1019803690),l=a(l,c,n,s,t[3],14,-187363961),s=a(s,l,c,n,t[8],20,1163531501),n=a(n,s,l,c,t[13],5,-1444681467),c=a(c,n,s,l,t[2],9,-51403784),l=a(l,c,n,s,t[7],14,1735328473),s=a(s,l,c,n,t[12],20,-1926607734),n=o(n,s,l,c,t[5],4,-378558),c=o(c,n,s,l,t[8],11,-2022574463),l=o(l,c,n,s,t[11],16,1839030562),s=o(s,l,c,n,t[14],23,-35309556),n=o(n,s,l,c,t[1],4,-1530992060),c=o(c,n,s,l,t[4],11,1272893353),l=o(l,c,n,s,t[7],16,-155497632),s=o(s,l,c,n,t[10],23,-1094730640),n=o(n,s,l,c,t[13],4,681279174),c=o(c,n,s,l,t[0],11,-358537222),l=o(l,c,n,s,t[3],16,-722521979),s=o(s,l,c,n,t[6],23,76029189),n=o(n,s,l,c,t[9],4,-640364487),c=o(c,n,s,l,t[12],11,-421815835),l=o(l,c,n,s,t[15],16,530742520),s=o(s,l,c,n,t[2],23,-995338651),n=i(n,s,l,c,t[0],6,-198630844),c=i(c,n,s,l,t[7],10,1126891415),l=i(l,c,n,s,t[14],15,-1416354905),s=i(s,l,c,n,t[5],21,-57434055),n=i(n,s,l,c,t[12],6,1700485571),c=i(c,n,s,l,t[3],10,-1894986606),l=i(l,c,n,s,t[10],15,-1051523),s=i(s,l,c,n,t[1],21,-2054922799),n=i(n,s,l,c,t[8],6,1873313359),c=i(c,n,s,l,t[15],10,-30611744),l=i(l,c,n,s,t[6],15,-1560198380),s=i(s,l,c,n,t[13],21,1309151649),n=i(n,s,l,c,t[4],6,-145523070),c=i(c,n,s,l,t[11],10,-1120210379),l=i(l,c,n,s,t[2],15,718787259),s=i(s,l,c,n,t[9],21,-343485551),e[0]=v(n,e[0]),e[1]=v(s,e[1]),e[2]=v(l,e[2]),e[3]=v(c,e[3])}function s(e){var t,r=[];for(t=0;64>t;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function l(e){var t,r=[];for(t=0;64>t;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function c(e){var t,r,a,o,i,l,c=e.length,d=[1732584193,-271733879,-1732584194,271733878];for(t=64;c>=t;t+=64)n(d,s(e.substring(t-64,t)));for(e=e.substring(t-64),r=e.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;r>t;t+=1)a[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(a[t>>2]|=128<<(t%4<<3),t>55)for(n(d,a),t=0;16>t;t+=1)a[t]=0;return o=8*c,o=o.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(o[2],16),l=parseInt(o[1],16)||0,a[14]=i,a[15]=l,n(d,a),d}function d(e){var t,r,a,o,i,s,c=e.length,d=[1732584193,-271733879,-1732584194,271733878];for(t=64;c>=t;t+=64)n(d,l(e.subarray(t-64,t)));for(e=c>t-64?e.subarray(t-64):new Uint8Array(0),r=e.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;r>t;t+=1)a[t>>2]|=e[t]<<(t%4<<3);if(a[t>>2]|=128<<(t%4<<3),t>55)for(n(d,a),t=0;16>t;t+=1)a[t]=0;return o=8*c,o=o.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(o[2],16),s=parseInt(o[1],16)||0,a[14]=i,a[15]=s,n(d,a),d}function u(e){var t,r="";for(t=0;4>t;t+=1)r+=Z[e>>8*t+4&15]+Z[e>>8*t&15];return r}function p(e){var t;for(t=0;t<e.length;t+=1)e[t]=u(e[t]);return e.join("")}function m(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function g(e,t){var r,a=e.length,o=new ArrayBuffer(a),i=new Uint8Array(o);for(r=0;a>r;r+=1)i[r]=e.charCodeAt(r);return t?i:o}function f(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function h(e,t,r){var a=new Uint8Array(e.byteLength+t.byteLength);return a.set(new Uint8Array(e)),a.set(new Uint8Array(t),e.byteLength),r?a:a.buffer}function b(e){var t,r=[],a=e.length;for(t=0;a-1>t;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function y(){this.reset()}var v=function(e,t){return e+t&4294967295},Z=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==p(c("hello"))&&(v=function(e,t){var r=(65535&e)+(65535&t),a=(e>>16)+(t>>16)+(r>>16);return a<<16|65535&r}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function t(e,t){return e=0|e||0,0>e?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,a){var o,i,n,s,l=this.byteLength,c=t(r,l),d=l;return a!==e&&(d=t(a,l)),c>d?new ArrayBuffer(0):(o=d-c,i=new ArrayBuffer(o),n=new Uint8Array(i),s=new Uint8Array(this,c,o),n.set(s),i)}}(),y.prototype.append=function(e){return this.appendBinary(m(e)),this},y.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,r=this._buff.length;for(t=64;r>=t;t+=64)n(this._hash,s(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},y.prototype.end=function(e){var t,r,a=this._buff,o=a.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;o>t;t+=1)i[t>>2]|=a.charCodeAt(t)<<(t%4<<3);return this._finish(i,o),r=p(this._hash),e&&(r=b(r)),this.reset(),r},y.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},y.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},y.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},y.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},y.prototype._finish=function(e,t){var r,a,o,i=t;if(e[i>>2]|=128<<(i%4<<3),i>55)for(n(this._hash,e),i=0;16>i;i+=1)e[i]=0;r=8*this._length,r=r.toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(r[2],16),o=parseInt(r[1],16)||0,e[14]=a,e[15]=o,n(this._hash,e)},y.hash=function(e,t){return y.hashBinary(m(e),t)},y.hashBinary=function(e,t){var r=c(e),a=p(r);return t?b(a):a},y.ArrayBuffer=function(){this.reset()},y.ArrayBuffer.prototype.append=function(e){var t,r=h(this._buff.buffer,e,!0),a=r.length;for(this._length+=e.byteLength,t=64;a>=t;t+=64)n(this._hash,l(r.subarray(t-64,t)));return this._buff=a>t-64?new Uint8Array(r.buffer.slice(t-64)):new Uint8Array(0),this},y.ArrayBuffer.prototype.end=function(e){var t,r,a=this._buff,o=a.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;o>t;t+=1)i[t>>2]|=a[t]<<(t%4<<3);return this._finish(i,o),r=p(this._hash),e&&(r=b(r)),this.reset(),r},y.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},y.ArrayBuffer.prototype.getState=function(){var e=y.prototype.getState.call(this);return e.buff=f(e.buff),e},y.ArrayBuffer.prototype.setState=function(e){return e.buff=g(e.buff,!0),y.prototype.setState.call(this,e)},y.ArrayBuffer.prototype.destroy=y.prototype.destroy,y.ArrayBuffer.prototype._finish=y.prototype._finish,y.ArrayBuffer.hash=function(e,t){var r=d(new Uint8Array(e)),a=p(r);return t?b(a):a},y})},{}],94:[function(t,r,a){!function(t,a){
"function"==typeof e&&e.amd?e([],a):"object"===("undefined"==typeof r?"undefined":_typeof2(r))&&r.exports?r.exports=a():t.striptags=a()}(this,function(){function e(e,s){function l(e){m==r?f+=e:s&&m==a&&(h+=e)}function c(){var e,t,r,a="",o=!1;e:for(e=0,t=h.length;t>e;e++)switch(r=h[e].toLowerCase()){case"<":break;case">":break e;case"/":o=!0;break;default:if(r.match(n)){if(o)break e}else o=!0,a+=r}-1!==s.indexOf(a)&&(f+=h),h=""}var d,u,p,e=e||"",m=r,g=0,f="",h="",b=!1;for("string"==typeof s?s=t(s):Array.isArray(s)||(s=null),d=0,u=e.length;u>d;d++)switch(p=e[d]){case"<":if(b)break;if(" "==e[d+1]){l(p);break}if(m==r){m=a,l(p);break}if(m==a){g++;break}l(p);break;case">":if(g){g--;break}if(b)break;if(m==a){b=m=0,s&&(h+=">",c());break}if(m==o){b=m=0,h="";break}if(m==i&&"-"==e[d-1]&&"-"==e[d-2]){b=m=0,h="";break}l(p);break;case'"':case"'":m==a&&(b==p?b=!1:b||(b=p)),l(p);break;case"!":if(m==a&&"<"==e[d-1]){m=o;break}l(p);break;case"-":if(m==o&&"-"==e[d-1]&&"!"==e[d-2]){m=i;break}l(p);break;case"E":case"e":if(m==o&&"doctype"==e.substr(d-6,7).toLowerCase()){m=a;break}l(p);break;default:l(p)}return f}function t(e){for(var t,r=[];null!==(t=s.exec(e));)r.push(t[1]);return 0!==r.length?r:null}var r=0,a=1,o=2,i=3,n=/\s/,s=/<(\w*)>/g;return e})},{}],95:[function(e,t,r){t.exports=2147483647},{}],96:[function(e,t,r){var a=e("es5-ext/number/to-pos-integer"),o=e("./max-timeout");t.exports=function(e){if(e=a(e),e>o)throw new TypeError(e+" exceeds maximum possible timeout");return e}},{"./max-timeout":95,"es5-ext/number/to-pos-integer":58}],97:[function(e,t,r){var a={};a.errorCallback=function(e){Z.error(e),Z.debug("ajax error callback",2),Z.debug("textStatus: "+e.textStatus,2),Z.debug("errorThrown: ",2),Z.debug(e.errorThrown,2),Z.debug(e.jqxhr,2)},a.error=a.errorCallback,a.activeRequests=[],a.apiRequestUrl=function(e){if(Z.debug("Zotero.Ajax.apiRequestUrl",4),Z.debug(e,4),Object.keys(e).forEach(function(t){var r=e[t];"string"==typeof r&&(r=r.split("#",1),e[t]=r[0]),Zotero.validator.validate(r,t)===!1&&(Zotero.warn("API argument failed validation: "+t+" cannot be "+r),Zotero.warn(e),delete e[t])}),!e.target)throw new Error("No target defined for api request");if("user"!=e.libraryType&&"group"!=e.libraryType&&""!==e.libraryType)throw new Error("Unexpected libraryType for api request "+JSON.stringify(e));if(e.libraryType&&!e.libraryID)throw new Error("No libraryID defined for api request");if("publications"==e.target&&"user"!=e.libraryType)throw new Error("publications is only valid for user libraries");var t,r=Zotero.config.baseApiUrl;if(""!==e.libraryType){if(t=r+"/"+e.libraryType+"s/"+e.libraryID,e.collectionKey){if("trash"==e.collectionKey)return t+="/items/trash";-1!==e.collectionKey.indexOf(",")||"collections"!=e.target&&(t+="/collections/"+e.collectionKey)}}else t=r;switch(e.target){case"items":t+="/items";break;case"item":t+=e.itemKey?"/items/"+e.itemKey:"/items";break;case"collections":t+="/collections";break;case"childCollections":t+="/collections";break;case"collection":break;case"tags":t+="/tags";break;case"children":t+="/items/"+e.itemKey+"/children";break;case"key":t=r+"/users/"+e.libraryID+"/keys/"+e.apiKey;break;case"deleted":t+="/deleted";break;case"userGroups":t=r+"/users/"+e.libraryID+"/groups";break;case"settings":t+="/settings/"+(e.settingsKey||"");break;case"publications":t+="/publications/items";break;default:return!1}switch(e.targetModifier){case"top":t+="/top";break;case"file":t+="/file";break;case"viewsnapshot":t+="/file/view"}return t},a.apiQueryString=function(e,t){if(Z.debug("Zotero.Ajax.apiQueryString",4),Z.debug(e,4),(null===t||"undefined"==typeof t)&&(t=!0),Object.keys(e).forEach(function(t){var r=e[t];"string"==typeof r&&(r=r.split("#",1),e[t]=r[0])}),e.hasOwnProperty("order")&&"creatorSummary"==e.order&&(e.order="creator"),e.hasOwnProperty("order")&&"year"==e.order&&(e.order="date"),t&&Zotero.config.sessionAuth){var r=Zotero.utils.readCookie(Zotero.config.sessionCookieName);e.session=r}else t&&Zotero.config.apiKey&&(e.key=Zotero.config.apiKey);e.hasOwnProperty("sort")&&"undefined"==e.sort&&(e.sort="asc"),Z.debug(e,4);var a="?",o=[],i=["start","limit","order","sort","content","include","format","q","fq","itemType","itemKey","collectionKey","searchKey","locale","tag","tagType","key","style","linkMode","linkwrap","session","newer","since"];i.sort();var n={};return i.forEach(function(t){e.hasOwnProperty(t)&&""!==e[t]&&(n[t]=e[t])}),e.hasOwnProperty("target")&&"items"!==e.target&&n.hasOwnProperty("itemKey")&&-1==n.itemKey.indexOf(",")&&delete n.itemKey,e.hasOwnProperty("target")&&"collections"!==e.target&&n.hasOwnProperty("collectionKey")&&-1===n.collectionKey.indexOf(",")&&delete n.collectionKey,Object.keys(n).forEach(function(e){var t=n[e];Array.isArray(t)?t.forEach(function(t){"tag"==e&&"-"==t[0]&&(t="\\"+t),o.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}):("tag"==e&&"-"==t[0]&&(t="\\"+t),o.push(encodeURIComponent(e)+"="+encodeURIComponent(t)))}),a+=o.join("&")},a.apiRequestString=function(e){return a.apiRequestUrl(e)+a.apiQueryString(e)},a.proxyWrapper=function(e,t){return Zotero.config.proxy?(t||(t="GET"),Zotero.config.proxyPath+"?requestMethod="+t+"&requestUrl="+encodeURIComponent(e)):e},a.parseQueryString=function(e){},a.webUrl=function(e){},a.downloadBlob=function(e){return new Promise(function(t,r){var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="blob",a.addEventListener("load",function(){200===a.status?(Z.debug("downloadBlob Image retrieved. resolving",3),t(a.response)):r(a.response)}),a.send()})},t.exports=a},{}],98:[function(e,t,r){var a="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":_typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":_typeof2(e)};t.exports=function(){this.instance="Zotero.ApiObject",this.version=0},t.exports.prototype.associateWithLibrary=function(e){var t=this;return t.owningLibrary=e,"object"==a(this.apiObj.library)&&(this.apiObj.library.type=e.type,this.apiObj.library.id=e.libraryID),t},t.exports.prototype.fieldComparer=function(e){if(Intl){var t=new Intl.Collator;return function(r,a){return t.compare(r.apiObj.data[e],a.apiObj.data[e])}}return function(t,r){return t.apiObj.data[e].toLowerCase()==r.apiObj.data[e].toLowerCase()?0:t.apiObj.data[e].toLowerCase()<r.apiObj.data[e].toLowerCase()?-1:1}}},{}],99:[function(e,t,r){t.exports=function(e){Z.debug("Zotero.ApiResponse",3),this.totalResults=0,this.apiVersion=null,this.lastModifiedVersion=0,this.linkHeader="",this.links={},e&&(e.isError?this.isError=!0:this.isError=!1,this.data=e.data,this.parseResponse(e))},t.exports.prototype.parseResponse=function(e){Z.debug("parseResponse");var t=this;if(t.jqxhr=e.jqxhr,t.status=e.jqxhr.status,t.lastModifiedVersion=e.jqxhr.getResponseHeader("Last-Modified-Version"),t.apiVersion=e.jqxhr.getResponseHeader("Zotero-API-Version"),t.backoff=e.jqxhr.getResponseHeader("Backoff"),t.retryAfter=e.jqxhr.getResponseHeader("Retry-After"),t.contentType=e.jqxhr.getResponseHeader("Content-Type"),t.linkHeader=e.jqxhr.getResponseHeader("Link"),t.totalResults=e.jqxhr.getResponseHeader("Total-Results"),t.backoff&&(t.backoff=parseInt(t.backoff,10)),t.retryAfter&&(t.retryAfter=parseInt(t.retryAfter,10)),Z.debug("parse link header"),Z.debug(t.linkHeader),t.linkHeader){for(var r=t.linkHeader.split(","),a={},o=/^<([^>]+)>; rel="([^\"]*)"$/,i=0;i<r.length;i++){var n=o.exec(r[i].trim());n[2]&&(a[n[2]]=n[1])}t.parsedLinks=a}Z.debug("done parsing response")}},{}],100:[function(e,t,r){var a="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":_typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":_typeof2(e)},o={callbacks:{},ui:{callbacks:{},keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}},offline:{},temp:{},config:{librarySettings:{},baseApiUrl:"https://api.zotero.org",baseWebsiteUrl:"https://zotero.org",baseFeedUrl:"https://api.zotero.org",baseZoteroWebsiteUrl:"https://www.zotero.org",baseDownloadUrl:"https://www.zotero.org",nonparsedBaseUrl:"",debugLogEndpoint:"",storeDebug:!0,directDownloads:!0,proxyPath:"/proxyrequest",ignoreLoggedInStatus:!1,storePrefsRemote:!0,preferUrlItem:!0,sessionAuth:!1,proxy:!1,apiKey:"",apiVersion:3,locale:"en-US",cacheStoreType:"localStorage",preloadCachedLibrary:!0,sortOrdering:{dateAdded:"desc",dateModified:"desc",date:"desc",year:"desc",accessDate:"desc",title:"asc",creator:"asc"},defaultSortColumn:"title",defaultSortOrder:"asc",largeFields:{title:1,abstractNote:1,extra:1},richTextFields:{note:1},maxFieldSummaryLength:{title:60},exportFormats:["bibtex","bookmarks","mods","refer","rdf_bibliontology","rdf_dc","rdf_zotero","ris","wikipedia"],exportFormatsMap:{bibtex:"BibTeX",bookmarks:"Bookmarks",mods:"MODS",refer:"Refer/BibIX",rdf_bibliontology:"Bibliontology RDF",rdf_dc:"Unqualified Dublin Core RDF",rdf_zotero:"Zotero RDF",ris:"RIS",wikipedia:"Wikipedia Citation Templates"},defaultApiArgs:{order:"title",sort:"asc",limit:50,start:0}},debug:function(e,t){var r=3;o.config.storeDebug&&r>=t&&(o.debugstring+="DEBUG:"+e+"\n"),"undefined"!=typeof console&&("number"!=typeof t&&(t=1),void 0!==o.preferences&&(r=o.preferences.getPref("debug_level")),r>=t&&console.log(e))},warn:function(e){o.config.storeDebug&&(o.debugstring+="WARN:"+e+"\n"),"undefined"==typeof console||"undefined"==typeof console.warn?this.debug(e):console.warn(e)},error:function(e){o.config.storeDebug&&(o.debugstring+="ERROR:"+e+"\n"),"undefined"==typeof console||"undefined"==typeof console.error?this.debug(e):console.error(e)},submitDebugLog:function(){o.net.ajax({url:o.config.debugLogEndpoint,data:{debug_string:o.debugstring}}).then(function(e){var t=JSON.parse(e.responseText);t.logID?alert("ZoteroWWW debug logID:"+t.logID):t.error&&alert("Error submitting ZoteroWWW debug log:"+t.error)})},catchPromiseError:function(e){o.error(e)},libraries:{},validator:{patterns:{itemKey:/^.+$/,collectionKey:/^([A-Z0-9]{8,})|trash$/,libraryID:/^[0-9]+$/,libraryType:/^(user|group|)$/,target:/^(items?|collections?|tags|children|deleted|userGroups|key|settings|publications)$/,targetModifier:/^(top|file|file\/view)$/,sort:/^(asc|desc)$/,start:/^[0-9]*$/,limit:/^[0-9]*$/,order:/^\S*$/,content:/^((html|json|data|bib|none|bibtex|bookmarks|coins|csljson|mods|refer|rdf_bibliontology|rdf_dc|ris|tei|wikipedia),?)+$/,include:/^((html|json|data|bib|none|bibtex|bookmarks|coins|csljson|mods|refer|rdf_bibliontology|rdf_dc|ris|tei|wikipedia),?)+$/,q:/^.*$/,fq:/^\S*$/,itemType:/^\S*$/,locale:/^\S*$/,tag:/^.*$/,tagType:/^(0|1)$/,key:/^\S*/,format:/^(json|atom|bib|keys|versions|bibtex|bookmarks|mods|refer|rdf_bibliontology|rdf_dc|rdf_zotero|ris|wikipedia)$/,style:/^\S*$/,linkwrap:/^(0|1)*$/},validate:function(e,t){if(Z.debug("Zotero.validate",4),""===e)return null;if(null===e)return!0;Z.debug(e+" "+t,4);var r=this.patterns;return r.hasOwnProperty(t)?r[t].test(e):null}},_logEnabled:0,enableLogging:function(){o._logEnabled++,o._logEnabled>0},disableLogging:function(){o._logEnabled--,o._logEnabled<=0&&(o._logEnabled=0)},init:function(){var e;e="localStorage"==o.config.cacheStoreType&&"undefined"!=typeof localStorage?localStorage:"sessionStorage"==o.config.cacheStoreType&&"undefined"!=typeof sessionStorage?sessionStorage:{},o.store=e,o.cache=new o.Cache(e),o.preferences=new o.Preferences(o.store,"global");var t="en-US";o.config.locale&&(t=o.config.locale),t="en-US"}};o.ajaxRequest=function(e,t,r){Z.debug("Zotero.ajaxRequest ==== "+e,3),t||(t="GET"),r||(r={});var a={url:e,type:t};return a=Z.extend({},a,r),Z.debug(a,3),o.net.queueRequest(a)},o.eventmanager={callbacks:{}},o.trigger=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];r&&(Z.debug("filter is not false",3),e+="_"+r),o.debug("Triggering eventful "+e,3),Z.debug(t),t.zeventful=!0;try{if(o.eventmanager.callbacks.hasOwnProperty(e)){var a=o.eventmanager.callbacks[e];a.forEach(function(e){var r=Z.extend({},t,e.data),a={data:r};e.f(a)})}}catch(i){Z.error("failed triggering:"+e),Z.error(i)}},o.listen=function(e,t,r,a){Z.debug("Zotero.listen: "+e);var i=e.split(" ");if(i.length>0&&a)for(var n=0;n<i.length;n++)i[n]+="_"+a;i.forEach(function(e){o.eventmanager.callbacks.hasOwnProperty(e)?o.eventmanager.callbacks[e].push({data:r,f:t}):o.eventmanager.callbacks[e]=[{data:r,f:t}]})},o.extend=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];"object"==("undefined"==typeof r?"undefined":a(r))&&Object.keys(r).forEach(function(t){e[t]=r[t]})}return e},t.exports=o},{}],101:[function(e,t,r){t.exports=function(e){this.store=e;var t=this.store._registry;(null===t||"undefined"==typeof t)&&(t={},this.store._registry=JSON.stringify(t))},t.exports.prototype.objectCacheString=function(e){var t=[];Object.keys(e).forEach(function(r){var a=e[r];a&&(Array.isArray(a)?a.forEach(function(e){t.push(r+"/"+encodeURIComponent(e))}):t.push(r+"/"+encodeURIComponent(a)))}),t.sort(),Z.debug(t,4);var r=t.join("/");return r},t.exports.prototype.save=function(e,t,r){Array.isArray(r)||(r=[]);var a=JSON.parse(this.store._registry);a||(a={});var o=this.objectCacheString(e);this.store[o]=JSON.stringify(t);var i={id:o,saved:Date.now(),cachetags:r};a[o]=i,this.store._registry=JSON.stringify(a)},t.exports.prototype.load=function(e){Z.debug("Zotero.Cache.load",3);var t=this.objectCacheString(e);Z.debug(t,4);try{var r=this.store[t];return r?JSON.parse(r):(Z.warn("No value found in cache store - "+t,3),null)}catch(a){return Z.error("Error parsing retrieved cache data: "+t+" : "+r),null}},t.exports.prototype.expireCacheTag=function(e){Z.debug("Zotero.Cache.expireCacheTag",3);var t=JSON.parse(this.store._registry),r=this.store;Object.keys(t).forEach(function(a){var o=t[a];-1!=o.cachetags.indexOf(e)&&(Z.debug("tag "+e+" found for item "+o.id+" : expiring",4),delete r[o.id],delete t[o.id])})},t.exports.prototype.clear=function(){"function"==typeof this.store.clear?this.store.clear():this.store={}}},{}],102:[function(e,t,r){t.exports=function(e){this.instance="Zotero.Collection",this.libraryUrlIdentifier="",this.itemKeys=!1,this.key="",this.version=0,this.synced=!1,this.pristineData=null,this.apiObj={key:"",version:0,library:{},links:{},meta:{},data:{key:"",version:0,name:"",parentCollection:!1,relations:{}}},this.children=[],this.topLevel=!0,e&&this.parseJsonCollection(e)},t.exports.prototype=new Zotero.ApiObject,t.exports.prototype.instance="Zotero.Collection",t.exports.prototype.updateObjectKey=function(e){this.updateCollectionKey(e)},t.exports.prototype.updateCollectionKey=function(e){var t=this;return t.key=e,t.apiObj.key=e,t.apiObj.data.key=e,t},t.exports.prototype.parseJsonCollection=function(e){Z.debug("parseJsonCollection",4);var t=this;t.key=e.key,t.version=e.version,t.apiObj=Z.extend({},e),t.pristineData=Z.extend({},e.data),t.parentCollection=!1,t.topLevel=!0,t.synced=!0,t.initSecondaryData()},t.exports.prototype.initSecondaryData=function(){var e=this;e.apiObj.data.parentCollection?e.topLevel=!1:e.topLevel=!0,Zotero.config.librarySettings.libraryPathString?e.websiteCollectionLink=Zotero.config.librarySettings.libraryPathString+"/collectionKey/"+e.apiObj.key:e.websiteCollectionLink="",e.hasChildren=e.apiObj.meta.numCollections?!0:!1},t.exports.prototype.nestCollection=function(e){Z.debug("Zotero.Collection.nestCollection",4);var t=this,r=t.get("parentCollection");if(r!==!1&&e.hasOwnProperty(r)){var a=e[r];return a.children.push(t),a.hasChildren=!0,t.topLevel=!1,!0}return!1},t.exports.prototype.addItems=function(e){Z.debug("Zotero.Collection.addItems",3);var t=this,r={target:"items",libraryType:t.apiObj.library.type,libraryID:t.apiObj.library.id,collectionKey:t.key},a=e.join(" ");return Zotero.ajaxRequest(r,"POST",{data:a})},t.exports.prototype.getMemberItemKeys=function(){Z.debug("Zotero.Collection.getMemberItemKeys",3);var e=this,t={target:"items",libraryType:e.apiObj.library.type,libraryID:e.apiObj.library.id,collectionKey:e.key,format:"keys"};return Zotero.ajaxRequest(t,"GET",{processData:!1}).then(function(t){Z.debug("getMemberItemKeys proxied callback",3);var r=t.data,a=r.trim().split(/[\s]+/);return e.itemKeys=a,a})},t.exports.prototype.removeItem=function(e){var t=this,r={target:"item",libraryType:t.apiObj.library.type,libraryID:t.apiObj.library.id,collectionKey:t.key,itemKey:e};return Zotero.ajaxRequest(r,"DELETE",{processData:!1,cache:!1})},t.exports.prototype.update=function(e,t){var r=this;t||(t=!1);var a={target:"collection",libraryType:r.apiObj.library.type,libraryID:r.apiObj.library.id,collectionKey:r.key};r.set("name",e),r.set("parentCollection",t);var o=r.writeApiObj(),i=JSON.stringify(o);return Zotero.ajaxRequest(a,"PUT",{data:i,processData:!1,headers:{"If-Unmodified-Since-Version":r.version},cache:!1})},t.exports.prototype.writeApiObj=function(){var e=this,t=Z.extend({},e.pristineData,e.apiObj.data);return t},t.exports.prototype.remove=function(){Z.debug("Zotero.Collection.delete",3);var e=this,t=e.owningLibrary,r={target:"collection",libraryType:e.apiObj.library.type,libraryID:e.apiObj.library.id,collectionKey:e.key};return Zotero.ajaxRequest(r,"DELETE",{processData:!1,headers:{"If-Unmodified-Since-Version":e.version},cache:!1}).then(function(){Z.debug("done deleting collection. remove local copy.",3),t.collections.removeLocalCollection(e.key),t.trigger("libraryCollectionsUpdated")})},t.exports.prototype.get=function(e){var t=this;switch(e){case"title":case"name":return t.apiObj.data.name;case"collectionKey":case"key":return t.apiObj.key||t.key;case"collectionVersion":case"version":return t.apiObj.version;case"parentCollection":return t.apiObj.data.parentCollection}return e in t.apiObj.data?t.apiObj.data[e]:t.apiObj.meta.hasOwnProperty(e)?t.apiObj.meta[e]:t.hasOwnProperty(e)?t[e]:null},t.exports.prototype.set=function(e,t){var r=this;switch(e in r.apiObj.data&&(r.apiObj.data[e]=t),e){case"title":case"name":r.apiObj.data.name=t;break;case"collectionKey":case"key":r.key=t,r.apiObj.key=t,r.apiObj.data.key=t;break;case"parentCollection":r.apiObj.data.parentCollection=t;break;case"collectionVersion":case"version":r.version=t,r.apiObj.version=t,r.apiObj.data.version=t}r.hasOwnProperty(e)&&(r[e]=t)}},{}],103:[function(e,t,r){t.exports=function(e){this.instance="Zotero.Collections",this.version=0,this.syncState={earliestVersion:null,latestVersion:null},this.collectionObjects={},this.collectionsArray=[],this.objectMap=this.collectionObjects,this.objectArray=this.collectionsArray,this.dirty=!1,this.loaded=!1,e&&(this.addCollectionsFromJson(e),this.initSecondaryData())},t.exports.prototype=new Zotero.Container,t.exports.prototype.initSecondaryData=function(){Z.debug("Zotero.Collections.initSecondaryData",3);var e=this;e.collectionsArray=[],Object.keys(e.collectionObjects).forEach(function(t){var r=e.collectionObjects[t];e.collectionsArray.push(r)}),e.collectionsArray.sort(Zotero.ApiObject.prototype.fieldComparer("name")),e.nestCollections(),e.assignDepths(0,e.collectionsArray)},t.exports.prototype.addCollection=function(e){return this.addObject(e),this},t.exports.prototype.addCollectionsFromJson=function(e){Z.debug("addCollectionsFromJson"),Z.debug(e);var t=this,r=[];return e.forEach(function(e){var a=new Zotero.Collection(e);t.addObject(a),r.push(a)}),r},t.exports.prototype.assignDepths=function(e,t){Z.debug("Zotero.Collections.assignDepths",3);var r=this,a=function o(e,t){t.forEach(function(t){t.nestingDepth=e,t.hasChildren&&o(e+1,t.children)})};r.collectionsArray.forEach(function(e){e.topLevel&&(e.nestingDepth=1,e.hasChildren&&a(2,e.children))})},t.exports.prototype.nestedOrderingArray=function(){Z.debug("Zotero.Collections.nestedOrderingArray",3);var e=this,t=[],r=function a(e,t){t.forEach(function(t){e.push(t),t.hasChildren&&a(e,t.children)})};return e.collectionsArray.forEach(function(e){e.topLevel&&(t.push(e),e.hasChildren&&r(t,e.children))}),Z.debug("Done with nestedOrderingArray",3),t},t.exports.prototype.getCollection=function(e){return this.getObject(e)},t.exports.prototype.remoteDeleteCollection=function(e){var t=this;return t.removeLocalCollection(e)},t.exports.prototype.removeLocalCollection=function(e){var t=this;return t.removeLocalCollections([e])},t.exports.prototype.removeLocalCollections=function(e){for(var t=this,r=0;r<e.length;r++)delete t.collectionObjects[e[r]];t.initSecondaryData()},t.exports.prototype.nestCollections=function(){var e=this;e.collectionsArray.forEach(function(e){e.children=[]}),e.collectionsArray.sort(Zotero.ApiObject.prototype.fieldComparer("name")),e.collectionsArray.forEach(function(t){t.nestCollection(e.collectionObjects)})},t.exports.prototype.writeCollections=function(e){Z.debug("Zotero.Collections.writeCollections",3);var t,r=this,a=r.owningLibrary,o={target:"collections",libraryType:r.owningLibrary.libraryType,libraryID:r.owningLibrary.libraryID},i=Zotero.ajax.apiRequestString(o);for(t=0;t<e.length;t++){var n=e[t],s=n.get("key");if(""===s||null===s){var l=Zotero.utils.getKey();n.set("key",l),n.set("version",0)}}var c=r.chunkObjectsArray(e),d=r.rawChunks(c),u=function(e){Z.debug("writeCollections successCallback",3);var t=this.library,r=this.writeChunk;t.collections.updateObjectsFromWriteResponse(this.writeChunk,e);for(var a=0;a<r.length;a++){var o=r[a];o.synced&&!o.writeFailure&&(t.collections.addCollection(o),Zotero.config.useIndexedDB&&(Z.debug("updating indexedDB collections"),t.idbLibrary.updateCollections(r)))}return e.returnCollections=r,e};Z.debug("collections.version: "+r.version,3),Z.debug("collections.libraryVersion: "+r.libraryVersion,3);var p=[];for(t=0;t<c.length;t++){var m={writeChunk:c[t],library:a},g=JSON.stringify(d[t]);p.push({url:i,type:"POST",data:g,processData:!1,headers:{},success:u.bind(m)})}return a.sequentialRequests(p).then(function(e){return Z.debug("Done with writeCollections sequentialRequests promise",3),r.initSecondaryData(),e.forEach(function(e){if(e.isError||e.data.hasOwnProperty("failed")&&Object.keys(e.data.failed).length>0)throw new Error("failure when writing collections")}),e})["catch"](function(e){throw Z.error(e),e})}},{}],104:[function(e,t,r){t.exports=function(){},t.exports.prototype.initSecondaryData=function(){},t.exports.prototype.addObject=function(e){Zotero.debug("Zotero.Container.addObject",4);var t=this;return t.objectArray.push(e),t.objectMap[e.key]=e,t.owningLibrary&&e.associateWithLibrary(t.owningLibrary),t},t.exports.prototype.fieldComparer=function(e){if(Intl){var t=new Intl.Collator;return function(r,a){return t.compare(r.apiObj.data[e],a.apiObj.data[e])}}return function(t,r){return t.apiObj.data[e].toLowerCase()==r.apiObj.data[e].toLowerCase()?0:t.apiObj.data[e].toLowerCase()<r.apiObj.data[e].toLowerCase()?-1:1}},t.exports.prototype.getObject=function(e){var t=this;return t.objectMap.hasOwnProperty(e)?t.objectMap[e]:!1},t.exports.prototype.getObjects=function(e){for(var t,r=this,a=[],o=0;o<e.length;o++)t=r.getObject(e[o]),t&&a.push(t);return a},t.exports.prototype.removeObject=function(e){var t=this;t.objectMap.hasOwnProperty(e)&&(delete t.objectmap[e],t.initSecondaryData())},t.exports.prototype.removeObjects=function(e){for(var t=this,r=0;r<e.length;r++)delete t.objectMap[e[r]];t.initSecondaryData()},t.exports.prototype.writeObjects=function(e){},t.exports.prototype.assignKeys=function(e){for(var t,r=0;r<e.length;r++){t=e[r];var a=t.get("key");if(!a){var o=Zotero.utils.getKey();t.set("key",o),t.set("version",0)}}return e},t.exports.prototype.chunkObjectsArray=function(e){for(var t=50,r=[],a=0;a<e.length;a+=t)r.push(e.slice(a,a+t));return r},t.exports.prototype.rawChunks=function(e){for(var t=[],r=0;r<e.length;r++){t[r]=[];for(var a=0;a<e[r].length;a++)t[r].push(e[r][a].writeApiObj())}return t},t.exports.prototype.updateSyncState=function(e){var t=this;if(Z.debug("updateSyncState: "+e,3),!t.hasOwnProperty("syncState"))throw Z.debug("no syncState property"),new Error("Attempt to update sync state of object with no syncState property");null===t.syncState.earliestVersion&&(t.syncState.earliestVersion=e),null===t.syncState.latestVersion&&(t.syncState.latestVersion=e),e<t.syncState.earliestVersion&&(t.syncState.earliestVersion=e),e>t.syncState.latestVersion&&(t.syncState.latestVersion=e),Z.debug("done updating sync state",3)},t.exports.prototype.updateSyncedVersion=function(e){var t=this;null!==t.syncState.earliestVersion&&t.syncState.earliestVersion==t.syncState.latestVersion?(t.version=t.syncState.latestVersion,t.synced=!0):null!==t.syncState.earliestVersion&&(t.version=t.syncState.earliestVersion)},t.exports.prototype.processDeletions=function(e){for(var t=this,r=0;r<e.length;r++){var a=t.get(e[r]);a!==!1&&a.synced===!0&&t.removeObjects([e[r]])}},t.exports.prototype.updateObjectsFromWriteResponse=function(e,t){Z.debug("Zotero.Container.updateObjectsFromWriteResponse",3),Z.debug("statusCode: "+t.status,3);var r=t.data;200==t.status?(Z.debug("newLastModifiedVersion: "+t.lastModifiedVersion,3),r.hasOwnProperty("success")&&Object.keys(r.success).forEach(function(a){var o=parseInt(a,10),i=r.success[a],n=e[o];if(""!==n.key&&n.key!==i)throw new Error("object key mismatch in multi-write response");""===n.key&&n.updateObjectKey(i),n.set("version",t.lastModifiedVersion),n.synced=!0,n.writeFailure=!1}),r.hasOwnProperty("failed")&&(Z.debug("updating objects with failed writes",3),Object.keys(r.failed).forEach(function(t){var a=r.failed[t];Z.error("failed write "+t+" - "+a);var o=parseInt(t,10),i=e[o];i.writeFailure=a}))):204==t.status&&(e[0].synced=!0)},t.exports.prototype.extractKey=function(e){return"string"==typeof e?e:e.get("key")}},{}],105:[function(e,t,r){t.exports=function(e){this.instance="Zotero.Deleted","string"==typeof e?this.deletedData=JSON.parse(e):this.deletedData=e,this.untilVersion=null,this.sinceVersion=null,this.waitingPromises=[],this.pending=!1},t.exports.prototype.addWaiter=function(){}},{}],106:[function(e,t,r){var a=e("spark-md5");t.exports={},t.exports.getFileInfo=function(e){return"undefined"==typeof FileReader?Promise.reject(new Error("FileReader not supported")):new Promise(function(t,r){var o={},i=new FileReader;i.onload=function(r){Z.debug("Zotero.file.getFileInfo onloadFunc",3);var i=r.target.result;Zotero.debug(i,3),o.md5=a.ArrayBuffer.hash(i),o.filename=e.name,o.filesize=e.size,o.mtime=Date.now(),o.contentType=e.type,o.filedata=i,t(o)},i.readAsArrayBuffer(e)})},t.exports.uploadFile=function(e,t){Z.debug("Zotero.file.uploadFile",3),Z.debug(e,4);var r=new FormData;Object.keys(e.params).forEach(function(t){var a=e.params[t];r.append(t,a)});var a=new Blob([t.filedata],{type:t.contentType});r.append("file",a);var o=new XMLHttpRequest;return o.open("POST",e.url,!0),new Promise(function(e,t){o.onload=function(r){Z.debug("uploadFile onload event",3),201==this.status?(Z.debug("successful upload - 201",3),e()):(Z.error("uploadFile failed - "+o.status),t({message:"Failure uploading file.",code:o.status,serverMessage:o.responseText}))},o.onprogress=function(e){Z.debug("progress event"),Z.debug(e)},o.send(r)})}},{"spark-md5":93}],107:[function(e,t,r){t.exports=function(e){var t=this;t.instance="Zotero.Group",e&&this.parseJsonGroup(e)},t.exports.prototype=new Zotero.ApiObject,t.exports.prototype.parseJsonGroup=function(e){var t=this;t.apiObj=e},t.exports.prototype.get=function(e){var t=this;switch(e){case"title":case"name":return t.apiObj.data.name}return e in t.apiObj?t.apiObj[e]:e in t.apiObj.data?t.apiObj.data[e]:e in t.apiObj.meta?t.apiObj.meta[e]:t.hasOwnProperty(e)?t[e]:null},t.exports.prototype.isWritable=function(e){var t=this;switch(!0){case t.get("owner")==e:return!0;case t.apiObj.data.admins&&-1!=t.apiObj.data.admins.indexOf(e):return!0;case"members"==t.apiObj.data.libraryEditing&&t.apiObj.data.members&&-1!=t.apiObj.data.members.indexOf(e):return!0;default:return!1}},t.exports.prototype.typeMap={Private:"Private",PublicOpen:"Public, Open Membership",PublicClosed:"Public, Closed Membership"},t.exports.prototype.accessMap={all:{members:"Anyone can view, only members can edit",admins:"Anyone can view, only admins can edit"},members:{members:"Only members can view and edit",admins:"Only members can view, only admins can edit"},admins:{members:"Only admins can view, only members can edit",admins:"Only admins can view and edit"}}},{}],108:[function(e,t,r){t.exports=function(){this.instance="Zotero.Groups",this.groupsArray=[]},t.exports.prototype.addGroupsFromJson=function(e){var t=this,r=[];return e.forEach(function(e){Z.debug(e,3);var a=new Zotero.Group(e);t.groupsArray.push(a),r.push(a)}),r},t.exports.prototype.fetchUserGroups=function(e,t){var r=this,a={target:"userGroups",libraryType:"user",libraryID:e,order:"title"};return t?a.key=t:r.owningLibrary&&(a.key=r.owningLibrary._apiKey),Zotero.ajaxRequest(a).then(function(e){Z.debug("fetchUserGroups proxied callback",3);var t=r.addGroupsFromJson(e.data);return e.fetchedGroups=t,e})}},{}],109:[function(e,t,r){t.exports={},t.exports.Library=function(e){Z.debug("Zotero.Idb.Library",3),Z.debug("Initializing Zotero IDB",3),this.libraryString=e,this.owningLibrary=null,this.initialized=!1},t.exports.Library.prototype.init=function(){var e=this;return new Promise(function(t,r){var a=window.indexedDB;e.indexedDB=a,Z.debug("requesting indexedDb from browser",3);var o=a.open("Zotero_"+e.libraryString,4);o.onerror=function(e){Zotero.error("ERROR OPENING INDEXED DB"),r()};var i=function(t){Z.debug("Zotero.Idb onupgradeneeded or onsuccess",3);var r=t.oldVersion;Z.debug("oldVersion: "+t.oldVersion,3);var a=t.target.result;if(e.db=a,4>r){Z.debug("Existing object store names:",3),Z.debug(JSON.stringify(a.objectStoreNames),3),Z.debug("Deleting old object stores",3),a.objectStoreNames.items&&a.deleteObjectStore("items"),a.objectStoreNames.tags&&a.deleteObjectStore("tags"),a.objectStoreNames.collections&&a.deleteObjectStore("collections"),a.objectStoreNames.files&&a.deleteObjectStore("files"),a.objectStoreNames.versions&&a.deleteObjectStore("versions"),Z.debug("Existing object store names:",3),Z.debug(JSON.stringify(a.objectStoreNames),3);var o=a.createObjectStore("items",{keyPath:"key"}),i=a.createObjectStore("collections",{keyPath:"key"}),n=a.createObjectStore("tags",{keyPath:"tag"});a.createObjectStore("files"),a.createObjectStore("versions");Z.debug("itemStore index names:",3),Z.debug(JSON.stringify(o.indexNames),3),Z.debug("collectionStore index names:",3),Z.debug(JSON.stringify(i.indexNames),3),Z.debug("tagStore index names:",3),Z.debug(JSON.stringify(n.indexNames),3),Object.keys(Zotero.Item.prototype.fieldMap).forEach(function(e){Z.debug("Creating index on "+e,3),o.createIndex(e,"data."+e,{unique:!1})}),o.createIndex("collectionKeys","data.collections",{unique:!1,multiEntry:!0}),o.createIndex("itemTagStrings","_supplement.tagstrings",{unique:!1,multiEntry:!0}),o.createIndex("parentItemKey","data.parentItem",{unique:!1}),o.createIndex("libraryKey","libraryKey",{unique:!1}),o.createIndex("deleted","data.deleted",{unique:!1}),i.createIndex("name","data.name",{unique:!1}),i.createIndex("key","key",{unique:!1}),i.createIndex("parentCollection","data.parentCollection",{unique:!1}),n.createIndex("tag","tag",{unique:!1})}};o.onupgradeneeded=i,o.onsuccess=function(){Z.debug("IDB success",3),e.db=o.result,e.initialized=!0,t(e)}})},t.exports.Library.prototype.deleteDB=function(){var e=this;return e.db.close(),new Promise(function(t,r){var a=e.indexedDB.deleteDatabase("Zotero_"+e.libraryString);a.onerror=function(){Z.error("Error deleting indexedDB"),r()},a.onsuccess=function(){Z.debug("Successfully deleted indexedDB",2),t()}})},t.exports.Library.prototype.getObjectStore=function(e,t){var r=this,a=r.db.transaction(e,t);return a.objectStore(e)},t.exports.Library.prototype.clearObjectStore=function(e){var t=this,r=t.getObjectStore(e,"readwrite");return new Promise(function(e,t){
var a=r.clear();a.onsuccess=function(t){Z.debug("Store cleared",3),e()},a.onerror=function(e){Z.error("clearObjectStore:",e.target.errorCode),t()}})},t.exports.Library.prototype.addItems=function(e){return this.addObjects(e,"item")},t.exports.Library.prototype.updateItems=function(e){return this.updateObjects(e,"item")},t.exports.Library.prototype.removeItems=function(e){return this.removeObjects(e,"item")},t.exports.Library.prototype.getItem=function(e){var t=this;return new Promise(function(r,a){var o=function(e){r(e.target.result)};t.db.transaction("items").objectStore(["items"],"readonly").get(e).onsuccess=o})},t.exports.Library.prototype.getAllItems=function(){return this.getAllObjects("item")},t.exports.Library.prototype.getOrderedItemKeys=function(e,t){var r=this;return Z.debug("Zotero.Idb.getOrderedItemKeys",3),Z.debug(""+e+" "+t,3),new Promise(function(a,o){var i=r.db.transaction(["items"],"readonly").objectStore("items"),n=i.index(e);if(!n)throw new Error("Index for requested field '"+e+"'' not found");var s="next";"desc"==t&&(s="prev");var l=n.openKeyCursor(null,s),c=[];l.onsuccess=function(e){var t=e.target.result;t?(c.push(t.primaryKey),t["continue"]()):(Z.debug("No more cursor: done. Resolving deferred.",3),a(c))}.bind(this),l.onfailure=function(e){o()}.bind(this)})},t.exports.Library.prototype.filterItems=function(e,t){var r=this;return Z.debug("Zotero.Idb.filterItems "+e+" - "+t,3),new Promise(function(a,o){var i=[],n=r.db.transaction(["items"],"readonly").objectStore("items"),s=n.index(e);if(!s)throw new Error("Index for requested field '"+e+"'' not found");var l="next",c=IDBKeyRange.only(t),d=s.openKeyCursor(c,l);d.onsuccess=function(e){var t=e.target.result;t?(i.push(t.primaryKey),t["continue"]()):(Z.debug("No more cursor: done. Resolving deferred.",3),a(i))}.bind(this),d.onfailure=function(e){o()}.bind(this)})},t.exports.Library.prototype.inferType=function(e){if(!e)return!1;if(!e.instance)return!1;switch(e.instance){case"Zotero.Item":return"item";case"Zotero.Collection":return"collection";case"Zotero.Tag":return"tag";default:return!1}},t.exports.Library.prototype.getTransactionAndStore=function(e,t){var r,a,o=this;switch(e){case"item":r=o.db.transaction(["items"],t),a=r.objectStore("items");break;case"collection":r=o.db.transaction(["collections"],t),a=r.objectStore("collections");break;case"tag":r=o.db.transaction(["tags"],t),a=r.objectStore("tags");break;default:return Promise.reject()}return[r,a]},t.exports.Library.prototype.addObjects=function(e,t){Z.debug("Zotero.Idb.Library.addObjects",3);var r=this;t||(t=r.inferType(e[0]));var a=r.getTransactionAndStore(t,"readwrite"),o=a[0],i=a[1];return new Promise(function(t,r){o.oncomplete=function(e){Zotero.debug("Add Objects transaction completed.",3),t()},o.onerror=function(e){Zotero.error("Add Objects transaction failed."),r()};var a=function(e){Zotero.debug("Added Object "+e.target.result,4)};for(var n in e){var s=i.add(e[n].apiObj);s.onsuccess=a}})},t.exports.Library.prototype.updateObjects=function(e,t){Z.debug("Zotero.Idb.Library.updateObjects",3);var r=this;t||(t=r.inferType(e[0]));var a=r.getTransactionAndStore(t,"readwrite"),o=a[0],i=a[1];return new Promise(function(t,r){o.oncomplete=function(e){Zotero.debug("Update Objects transaction completed.",3),t()},o.onerror=function(e){Zotero.error("Update Objects transaction failed."),r()};var a=function(e){Zotero.debug("Updated Object "+e.target.result,4)};for(var n in e){var s=i.put(e[n].apiObj);s.onsuccess=a}})},t.exports.Library.prototype.removeObjects=function(e,t){var r=this;t||(t=r.inferType(e[0]));var a=r.getTransactionAndStore(t,"readwrite"),o=a[0],i=a[1];return new Promise(function(t,r){o.oncomplete=function(e){Zotero.debug("Remove Objects transaction completed.",3),t()},o.onerror=function(e){Zotero.error("Remove Objects transaction failed."),r()};var a=function(e){Zotero.debug("Removed Object "+e.target.result,4)};for(var n in e){var s=i["delete"](e[n].key);s.onsuccess=a}})},t.exports.Library.prototype.getAllObjects=function(e){var t=this;return new Promise(function(r,a){var o=[],i=t.db.transaction(e+"s").objectStore(e+"s");i.openCursor().onsuccess=function(e){var t=e.target.result;t?(o.push(t.value),t["continue"]()):r(o)}})},t.exports.Library.prototype.addCollections=function(e){return this.addObjects(e,"collection")},t.exports.Library.prototype.updateCollections=function(e){return Z.debug("Zotero.Idb.Library.updateCollections",3),this.updateObjects(e,"collection")},t.exports.Library.prototype.getCollection=function(e){var t=this;return new Promise(function(r,a){var o=function(e){r(e.target.result)};t.db.transaction("collections").objectStore(["collections"],"readonly").get(e).onsuccess=o})},t.exports.Library.prototype.removeCollections=function(e){return Z.debug("Zotero.Idb.Library.removeCollections",3),this.removeObjects(e,"collection")},t.exports.Library.prototype.getAllCollections=function(){return Z.debug("Zotero.Idb.Library.getAllCollections",3),this.getAllObjects("collection")},t.exports.Library.prototype.addTags=function(e){return this.addObjects(e,"tag")},t.exports.Library.prototype.updateTags=function(e){return Z.debug("Zotero.Idb.Library.updateTags",3),this.updateObjects(e,"tag")},t.exports.Library.prototype.getAllTags=function(){return Z.debug("getAllTags",3),this.getAllObjects("tag")},t.exports.Library.prototype.setVersion=function(e,t){Z.debug("Zotero.Idb.Library.setVersion",3);var r=this;return new Promise(function(a,o){var i=r.db.transaction(["versions"],"readwrite");i.oncomplete=function(e){Zotero.debug("set version transaction completed.",3),a()},i.onerror=function(e){Zotero.error("set version transaction failed."),o()};var n=i.objectStore("versions"),s=function(e){Zotero.debug("Set Version"+e.target.result,3)},l=n.put(t,e);l.onsuccess=s})},t.exports.Library.prototype.getVersion=function(e){Z.debug("Zotero.Idb.Library.getVersion",3);var t=this;return new Promise(function(r,a){var o=function(e){Z.debug("done getting version"),r(e.target.result)};t.db.transaction(["versions"],"readonly").objectStore("versions").get(e).onsuccess=o})},t.exports.Library.prototype.setFile=function(e,t){Z.debug("Zotero.Idb.Library.setFile",3);var r=this;return new Promise(function(a,o){var i=r.db.transaction(["files"],"readwrite");i.oncomplete=function(e){Zotero.debug("set file transaction completed.",3),a()},i.onerror=function(e){Zotero.error("set file transaction failed."),o()};var n=i.objectStore("files"),s=function(e){Zotero.debug("Set File"+e.target.result,3)},l=n.put(t,e);l.onsuccess=s})},t.exports.Library.prototype.getFile=function(e){Z.debug("Zotero.Idb.Library.getFile",3);var t=this;return new Promise(function(r,a){var o=function(e){Z.debug("done getting file"),r(e.target.result)};t.db.transaction(["files"],"readonly").objectStore("files").get(e).onsuccess=o})},t.exports.Library.prototype.deleteFile=function(e){Z.debug("Zotero.Idb.Library.deleteFile",3);var t=this;return new Promise(function(r,a){var o=t.db.transaction(["files"],"readwrite");o.oncomplete=function(e){Zotero.debug("delete file transaction completed.",3),r()},o.onerror=function(e){Zotero.error("delete file transaction failed."),a()};var i=o.objectStore("files"),n=function(e){Zotero.debug("Deleted File"+e.target.result,4)},s=i["delete"](e);s.onsuccess=n})},t.exports.Library.prototype.intersect=function(e,t){for(var r=[],a=0;a<e.length;a++)-1!==t.indexOf(e[a])&&r.push(e[a]);return r},t.exports.Library.prototype.intersectAll=function(e){for(var t=this,r=e[0],a=0;a<e.length-1;a++)r=t.intersect(r,e[a+1]);return r}},{}],110:[function(e,t,r){var a=e("striptags"),o=e("./ItemMaps.js"),i=function(e){this.instance="Zotero.Item",this.version=0,this.key="",this.synced=!1,this.apiObj={},this.pristineData=null,this.childItemKeys=[],this.writeErrors=[],this.notes=[],e?this.parseJsonItem(e):this.parseJsonItem(this.emptyJsonItem()),this.initSecondaryData()};i.prototype=new Zotero.ApiObject,i.prototype.parseJsonItem=function(e){Z.debug("parseJsonItem",3);var t=this;t.version=e.version,t.key=e.key,t.apiObj=Z.extend({},e),t.pristineData=Z.extend({},e.data),t.apiObj._supplement||(t.apiObj._supplement={})},i.prototype.emptyJsonItem=function(){return{key:"",version:0,library:{},links:{},data:{key:"",version:0,title:"",creators:[],collections:[],tags:[],relations:{}},meta:{},_supplement:{}}},i.prototype.initSecondaryData=function(){Z.debug("initSecondaryData",3);var e=this;e.version=e.apiObj.version,"attachment"==e.apiObj.data.itemType&&(e.mimeType=e.apiObj.data.contentType,e.translatedMimeType=Zotero.utils.translateMimeType(e.mimeType)),"linkMode"in e.apiObj&&(e.linkMode=e.apiObj.data.linkMode),e.attachmentDownloadUrl=Zotero.url.attachmentDownloadUrl(e),e.apiObj.meta.parsedDate?e.parsedDate=new Date(e.apiObj.meta.parsedDate):e.parsedDate=!1,e.synced=!1,e.updateTagStrings(),Z.debug("done with initSecondaryData",3)},i.prototype.updateTagStrings=function(){for(var e=this,t=[],r=0;r<e.apiObj.data.tags.length;r++)t.push(e.apiObj.data.tags[r].tag);e.apiObj._supplement.tagstrings=t},i.prototype.initEmpty=function(e,t){var r=this;return r.getItemTemplate(e,t).then(function(e){return r.initEmptyFromTemplate(e),r})},i.prototype.initEmptyNote=function(){var e=this;e.version=0;var t={itemType:"note",note:"",tags:[],collections:[],relations:{}};return e.initEmptyFromTemplate(t),e},i.prototype.initEmptyFromTemplate=function(e){var t=this;return t.version=0,t.key="",t.pristineData=Z.extend({},e),t.apiObj={key:"",version:0,library:{},links:{},data:e,meta:{},_supplement:{}},t.initSecondaryData(),t},i.prototype.isSupplementaryItem=function(){var e=this,t=e.get("itemType");return"attachment"==t||"note"==t?!0:!1},i.prototype.isSnapshot=function(){var e=this;if(e.apiObj.links.enclosure){var t=e.apiObj.links.enclosure.type;if(!e.apiObj.links.enclosure.length&&"text/html"==t)return!0}return!1},i.prototype.updateObjectKey=function(e){return this.updateItemKey(e)},i.prototype.updateItemKey=function(e){var t=this;return t.key=e,t.apiObj.key=e,t.apiObj.data.key=e,t.pristineData.key=e,t},i.prototype.writeItem=function(){var e=this;if(!e.owningLibrary)throw new Error("Item must be associated with a library");return e.owningLibrary.items.writeItems([e])},i.prototype.writeApiObj=function(){var e=this;if(e.apiObj.data.creators){var t=e.apiObj.data.creators.filter(function(e){return e.name||e.firstName||e.lastName?!0:!1});e.apiObj.data.creators=t}var r=Z.extend({},e.pristineData,e.apiObj.data);return r},i.prototype.createChildNotes=function(e){var t=this,r=[],a=[];return e.forEach(function(e){var o=new i,n=o.initEmpty("note").then(function(a){a.set("note",e.note),a.set("parentItem",t.key),r.push(a)});a.push(n)}),Promise.all(a).then(function(){return t.owningLibrary.writeItems(r)})},i.prototype.writePatch=function(){},i.prototype.getChildren=function(e){Z.debug("Zotero.Item.getChildren");var t=this;return Promise.resolve().then(function(){if(!t.apiObj.meta.numChildren)return[];var r={url:{target:"children",libraryType:t.apiObj.library.type,libraryID:t.apiObj.library.id,itemKey:t.key}};return Zotero.net.queueRequest(r).then(function(t){Z.debug("getChildren proxied callback",4);for(var r=e.items,a=r.addItemsFromJson(t.data),o=a.length-1;o>=0;o--)a[o].associateWithLibrary(e);return a})})},i.prototype.getItemTypes=function(e){Z.debug("Zotero.Item.prototype.getItemTypes",3),e||(e="en-US"),e="en-US";var t=Zotero.cache.load({locale:e,target:"itemTypes"});if(t)return Z.debug("have itemTypes in localStorage",3),void(i.prototype.itemTypes=t);var r=Zotero.ajax.apiQueryString({locale:e}),a=Zotero.config.baseApiUrl+"/itemTypes"+r;Zotero.net.ajax({url:Zotero.ajax.proxyWrapper(a,"GET"),type:"GET"}).then(function(t){Z.debug("got itemTypes response",3),Z.debug(t.response,4),i.prototype.itemTypes=JSON.parse(t.responseText),Zotero.cache.save({locale:e,target:"itemTypes"},i.prototype.itemTypes)})},i.prototype.getItemFields=function(e){Z.debug("Zotero.Item.prototype.getItemFields",3),e||(e="en-US"),e="en-US";var t=Zotero.cache.load({locale:e,target:"itemFields"});if(t)return Z.debug("have itemFields in localStorage",3),i.prototype.itemFields=t,void Object.keys(i.prototype.itemFields).forEach(function(e){var t=i.prototype.itemFields[e];Zotero.localizations.fieldMap[t.field]=t.localized});var r=Zotero.ajax.apiQueryString({locale:e}),a=Zotero.config.baseApiUrl+"/itemFields"+r;Zotero.net.ajax({url:Zotero.ajax.proxyWrapper(a),type:"GET"}).then(function(t){Z.debug("got itemTypes response",4);var r=JSON.parse(t.responseText);i.prototype.itemFields=r,Zotero.cache.save({locale:e,target:"itemFields"},r),Object.keys(i.prototype.itemFields).forEach(function(e){var t=i.prototype.itemFields[e];Zotero.localizations.fieldMap[t.field]=t.localized})})},i.prototype.getItemTemplate=function(){var e=arguments.length<=0||void 0===arguments[0]?"document":arguments[0],t=arguments.length<=1||void 0===arguments[1]?"":arguments[1];if(Z.debug("Zotero.Item.prototype.getItemTemplate",3),"attachment"==e&&""==t)throw new Error("attachment template requested with no linkMode");var r=Zotero.ajax.apiQueryString({itemType:e,linkMode:t}),a=Zotero.config.baseApiUrl+"/items/new"+r,o={itemType:e,target:"itemTemplate"},i=Zotero.cache.load(o);if(i){Z.debug("have itemTemplate in localStorage",3);var n=i;return Promise.resolve(n)}return Zotero.ajaxRequest(a,"GET",{dataType:"json"}).then(function(e){return Z.debug("got itemTemplate response",3),Zotero.cache.save(o,e.data),e.data})},i.prototype.getUploadAuthorization=function(e){Z.debug("Zotero.Item.getUploadAuthorization",3);var t=this,r={target:"item",targetModifier:"file",libraryType:t.owningLibrary.type,libraryID:t.owningLibrary.libraryID,itemKey:t.key},a={"Content-Type":"application/x-www-form-urlencoded"},o=t.get("md5");return o?a["If-Match"]=o:a["If-None-Match"]="*",Zotero.ajaxRequest(r,"POST",{processData:!0,data:e,headers:a})},i.prototype.registerUpload=function(e){Z.debug("Zotero.Item.registerUpload",3);var t=this,r={target:"item",targetModifier:"file",libraryType:t.owningLibrary.type,libraryID:t.owningLibrary.libraryID,itemKey:t.key},a={"Content-Type":"application/x-www-form-urlencoded"},o=t.get("md5");return o?a["If-Match"]=o:a["If-None-Match"]="*",Zotero.ajaxRequest(r,"POST",{processData:!0,data:{upload:e},headers:a})},i.prototype.fullUpload=function(e){},i.prototype.creatorTypes={},i.prototype.getCreatorTypes=function(e){Z.debug("Zotero.Item.prototype.getCreatorTypes: "+e,3),e||(e="document");var t=Zotero.cache.load({target:"creatorTypes"});if(t&&(Z.debug("have creatorTypes in localStorage",3),i.prototype.creatorTypes=t),i.prototype.creatorTypes[e])return Z.debug("creatorTypes of requested itemType available in localStorage",3),Z.debug(i.prototype.creatorTypes,4),Promise.resolve(i.prototype.creatorTypes[e]);Z.debug("sending request for creatorTypes",3);var r=Zotero.ajax.apiQueryString({itemType:e}),a=Zotero.config.baseApiUrl+"/itemTypeCreatorTypes"+r;return Zotero.ajaxRequest(a,"GET",{dataType:"json"}).then(function(t){return Z.debug("got creatorTypes response",4),i.prototype.creatorTypes[e]=t.data,Zotero.cache.save({target:"creatorTypes"},i.prototype.creatorTypes),i.prototype.creatorTypes[e]})},i.prototype.getCreatorFields=function(e){Z.debug("Zotero.Item.prototype.getCreatorFields",3);var t=Zotero.cache.load({target:"creatorFields"});if(t)return Z.debug("have creatorFields in localStorage",3),i.prototype.creatorFields=t,Promise.resolve(t);var r=Zotero.config.baseApiUrl+"/creatorFields";return Zotero.ajaxRequest(r,"GET",{dataType:"json"}).then(function(e){Z.debug("got itemTypes response",4),i.prototype.creatorFields=e.data,Zotero.cache.save({target:"creatorFields"},e.data)})},i.prototype.addItemTypes=function(e,t){},i.prototype.addItemFields=function(e,t){},i.prototype.addCreatorTypes=function(e,t){},i.prototype.addCreatorFields=function(e,t){},i.prototype.addItemTemplates=function(e){},i.prototype.itemTypeImageClass=function(){var e=this;if("attachment"!=e.apiObj.data.itemType)return e.apiObj.data.itemType;switch(e.apiObj.data.linkMode){case"imported_file":return"pdf"==e.translatedMimeType?e.itemTypeImageSrc.attachmentPdf:e.itemTypeImageSrc.attachmentFile;case"imported_url":return"pdf"==e.translatedMimeType?e.itemTypeImageSrc.attachmentPdf:e.itemTypeImageSrc.attachmentSnapshot;case"linked_file":return e.itemTypeImageSrc.attachmentLink;case"linked_url":return e.itemTypeImageSrc.attachmentWeblink;default:return e.itemTypeImageSrc.attachment}},i.prototype.itemTypeIconClass=function(){var e=this,t="fa fa-file-text-o";switch(e.apiObj.data.itemType){case"attachment":switch(e.apiObj.data.linkMode){case"imported_file":return"pdf"==e.translatedMimeType?"fa fa-file-pdf-o":"glyphicons glyphicons-file";case"imported_url":return"pdf"==e.translatedMimeType?"fa fa-file-pdf-o":"glyphicons glyphicons-file";case"linked_file":return"glyphicons glyphicons-link";case"linked_url":return"glyphicons glyphicons-link";default:return"glyphicons glyphicons-paperclip"}return"glyphicons file";case"artwork":return"glyphicons glyphicons-picture";case"audioRecording":return"glyphicons glyphicons-microphone";case"bill":return t;case"blogPost":return"glyphicons glyphicons-blog";case"book":return"glyphicons glyphicons-book";case"bookSection":return"glyphicons glyphicons-book-open";case"case":return t;case"computerProgram":return"glyphicons glyphicons-floppy-disk";case"conferencePaper":return t;case"dictionaryEntry":return"glyphicons glyphicons-translate";case"document":return"glyphicons glyphicons-file";case"email":return"glyphicons glyphicons-envelope";case"encyclopediaArticle":return"glyphicons glyphicons-bookmark";case"film":return"glyphicons glyphicons-film";case"forumPost":return"glyphicons glyphicons-bullhorn";case"hearing":return"fa fa-gavel";case"instantMessage":return"fa fa-comment-o";case"interview":return"fa fa-comments-o";case"journalArticle":return"fa fa-file-text-o";case"letter":return"glyphicons glyphicons-message-full";case"magazineArticle":return t;case"manuscript":return"glyphicons glyphicons-pen";case"map":return"glyphicons glyphicons-google-maps";case"newspaperArticle":return"fa fa-newspaper-o";case"note":return"glyphicons glyphicons-notes noteyellow";case"patent":return"glyphicons glyphicons-lightbulb";case"podcast":return"glyphicons glyphicons-ipod";case"presentation":return"glyphicons glyphicons-keynote";case"radioBroadcast":return"glyphicons glyphicons-wifi-alt";case"report":return"glyphicons glyphicons-notes-2";case"statue":return"glyphicons glyphicons-bank";case"thesis":return"fa fa-graduation-cap";case"tvBroadcast":return"glyphicons glyphicons-display";case"videoRecording":return"glyphicons glyphicons-facetime-video";case"webpage":return"glyphicons glyphicons-embed-close";default:return"glyphicons file"}},i.prototype.get=function(e){var t=this;switch(e){case"title":;return"note"==t.apiObj.data.itemType?t.noteTitle(t.apiObj.data.note):t.apiObj.data.title;case"creatorSummary":case"creator":return"undefined"!=typeof t.apiObj.meta.creatorSummary?t.apiObj.meta.creatorSummary:"";case"year":return t.parsedDate?t.parsedDate.getFullYear():""}return e in t.apiObj.data?t.apiObj.data[e]:e in t.apiObj.meta?t.apiObj.meta[e]:t.hasOwnProperty(e)?t[e]:null},i.prototype.set=function(e,t){var r=this;switch(e in r.apiObj&&(r.apiObj[e]=t),e in r.apiObj.data&&(r.apiObj.data[e]=t),e in r.apiObj.meta&&(r.apiObj.meta[e]=t),e){case"itemKey":case"key":r.key=t,r.apiObj.data.key=t;break;case"itemVersion":case"version":r.version=t,r.apiObj.data.version=t;break;case"itemType":r.itemType=t;break;case"linkMode":break;case"deleted":r.apiObj.data.deleted=t;break;case"parentItem":""===t&&(t=!1),r.apiObj.data.parentItem=t}return r},i.prototype.noteTitle=function(e){var t=120,r=a(e),o=r.indexOf("\n");return-1!=o&&t>o?r.substr(0,o):r.substr(0,t)},i.prototype.setParent=function(e){var t=this;return"string"!=typeof e&&e.hasOwnProperty("instance")&&"Zotero.Item"==e.instance&&(e=e.key),t.set("parentItem",e),t},i.prototype.addToCollection=function(e){var t=this;"string"!=typeof e&&"Zotero.Collection"==e.instance&&(e=e.key),-1===t.apiObj.data.collections.indexOf(e)&&t.apiObj.data.collections.push(e)},i.prototype.removeFromCollection=function(e){var t=this;"string"!=typeof e&&"Zotero.Collection"==e.instance&&(e=e.key);var r=t.apiObj.data.collections.indexOf(e);-1!=r&&t.apiObj.data.collections.splice(r,1)},i.prototype.uploadChildAttachment=function(e,t,r){var a=this;return Z.debug("uploadChildAttachment",3),a.owningLibrary?(e.set("parentItem",a.key),e.associateWithLibrary(a.owningLibrary),e.writeItem().then(function(o){return a.numChildren++,e.uploadFile(t,r)},function(e){throw{message:"Failure during attachmentItem write.",code:e.status,serverMessage:e.jqxhr.responseText,response:e}})):Promise.reject(new Error("Item must be associated with a library"))},i.prototype.uploadFile=function(e,t){var r=this;Z.debug("Zotero.Item.uploadFile",3);var a={md5:e.md5,filename:r.get("title"),filesize:e.filesize,mtime:e.mtime,contentType:e.contentType,params:1};return""===e.contentType&&(a.contentType="application/octet-stream"),r.getUploadAuthorization(a).then(function(t){Z.debug("uploadAuth callback",3);var a;return a="string"==typeof t.data?JSON.parse(t.data):t.data,1==a.exists?{message:"File Exists"}:Zotero.file.uploadFile(a,e).then(function(){return r.registerUpload(a.uploadKey).then(function(e){if(e.isError){var t={message:"Failed to register uploaded file.",code:e.status,serverMessage:e.jqxhr.responseText,response:e};throw Z.error(t),t}return{message:"Upload Successful"}})})})["catch"](function(e){throw Z.debug("Failure caught during upload",3),Z.debug(e,3),{message:"Failure during upload.",code:e.status,serverMessage:e.jqxhr.responseText,response:e}})},i.prototype.cslItem=function(){var e=this,t=e.get("itemType"),r=e.cslTypeMap.hasOwnProperty(t)?e.cslTypeMap[t]:!1;r||(r="article");var a=(e.get("accessDate")||e.get("url"))&&t in{journalArticle:1,newspaperArticle:1,magazineArticle:1}&&e.get("pages")&&e.citePaperJournalArticleURL,o={type:r};e.owningLibrary?o.id=e.apiObj.library.id+"/"+e.get("key"):o.id=Zotero.utils.getKey(),Object.keys(e.cslFieldMap).forEach(function(t){var r=e.cslFieldMap[t];"URL"==t&&a||r.forEach(function(r){var a=e.get(r);a&&(o[t]=a)})});var i=e.get("creators");return i.forEach(function(e){var t=e.creatorType;if(t){var r;r=e.hasOwnProperty("name")?{literal:e.name}:{family:e.lastName,given:e.firstName},o.hasOwnProperty(t)?o[t].push(r):o[t]=[r]}}),Object.keys(e.cslDateMap).forEach(function(t){var r=e.cslDateMap[t],a=e.get(r);a&&(o[t]={raw:a})}),o},Object.keys(o).forEach(function(e){i.prototype[e]=o[e]}),t.exports=i},{"./ItemMaps.js":111,striptags:94}],111:[function(e,t,r){var a={};a.fieldMap={itemType:"Item Type",title:"Title",dateAdded:"Date Added",dateModified:"Date Modified",source:"Source",notes:"Notes",tags:"Tags",attachments:"Attachments",related:"Related",url:"URL",rights:"Rights",series:"Series",volume:"Volume",issue:"Issue",edition:"Edition",place:"Place",publisher:"Publisher",pages:"Pages",ISBN:"ISBN",publicationTitle:"Publication",ISSN:"ISSN",date:"Date",year:"Year",section:"Section",callNumber:"Call Number",archive:"Archive",archiveLocation:"Loc. in Archive",libraryCatalog:"Library Catalog",distributor:"Distributor",extra:"Extra",journalAbbreviation:"Journal Abbr",DOI:"DOI",accessDate:"Accessed",seriesTitle:"Series Title",seriesText:"Series Text",seriesNumber:"Series Number",institution:"Institution",reportType:"Report Type",code:"Code",session:"Session",legislativeBody:"Legislative Body",history:"History",reporter:"Reporter",court:"Court",numberOfVolumes:"# of Volumes",committee:"Committee",assignee:"Assignee",patentNumber:"Patent Number",priorityNumbers:"Priority Numbers",issueDate:"Issue Date",references:"References",legalStatus:"Legal Status",codeNumber:"Code Number",artworkMedium:"Medium",number:"Number",artworkSize:"Artwork Size",repository:"Repository",videoRecordingType:"Recording Type",interviewMedium:"Medium",letterType:"Type",manuscriptType:"Type",mapType:"Type",scale:"Scale",thesisType:"Type",websiteType:"Website Type",audioRecordingType:"Recording Type",label:"Label",presentationType:"Type",meetingName:"Meeting Name",studio:"Studio",runningTime:"Running Time",network:"Network",postType:"Post Type",audioFileType:"File Type",versionNumber:"Version Number",system:"System",company:"Company",conferenceName:"Conference Name",encyclopediaTitle:"Encyclopedia Title",dictionaryTitle:"Dictionary Title",language:"Language",programmingLanguage:"Language",university:"University",abstractNote:"Abstract",websiteTitle:"Website Title",reportNumber:"Report Number",billNumber:"Bill Number",codeVolume:"Code Volume",codePages:"Code Pages",dateDecided:"Date Decided",reporterVolume:"Reporter Volume",firstPage:"First Page",documentNumber:"Document Number",dateEnacted:"Date Enacted",publicLawNumber:"Public Law Number",country:"Country",applicationNumber:"Application Number",forumTitle:"Forum/Listserv Title",episodeNumber:"Episode Number",blogTitle:"Blog Title",caseName:"Case Name",nameOfAct:"Name of Act",subject:"Subject",proceedingsTitle:"Proceedings Title",bookTitle:"Book Title",shortTitle:"Short Title",docketNumber:"Docket Number",numPages:"# of Pages",note:"Note",numChildren:"# of Children",addedBy:"Added By",creator:"Creator"},a.typeMap={note:"Note",attachment:"Attachment",book:"Book",bookSection:"Book Section",journalArticle:"Journal Article",magazineArticle:"Magazine Article",newspaperArticle:"Newspaper Article",thesis:"Thesis",letter:"Letter",manuscript:"Manuscript",interview:"Interview",film:"Film",artwork:"Artwork",webpage:"Web Page",report:"Report",bill:"Bill","case":"Case",hearing:"Hearing",patent:"Patent",statute:"Statute",email:"E-mail",map:"Map",blogPost:"Blog Post",instantMessage:"Instant Message",forumPost:"Forum Post",audioRecording:"Audio Recording",presentation:"Presentation",videoRecording:"Video Recording",tvBroadcast:"TV Broadcast",radioBroadcast:"Radio Broadcast",podcast:"Podcast",computerProgram:"Computer Program",conferencePaper:"Conference Paper",document:"Document",encyclopediaArticle:"Encyclopedia Article",dictionaryEntry:"Dictionary Entry"},a.creatorMap={author:"Author",contributor:"Contributor",editor:"Editor",translator:"Translator",seriesEditor:"Series Editor",interviewee:"Interview With",interviewer:"Interviewer",director:"Director",scriptwriter:"Scriptwriter",producer:"Producer",castMember:"Cast Member",sponsor:"Sponsor",counsel:"Counsel",inventor:"Inventor",attorneyAgent:"Attorney/Agent",recipient:"Recipient",performer:"Performer",composer:"Composer",wordsBy:"Words By",cartographer:"Cartographer",programmer:"Programmer",reviewedAuthor:"Reviewed Author",artist:"Artist",commenter:"Commenter",presenter:"Presenter",guest:"Guest",podcaster:"Podcaster"},a.hideFields=["mimeType","linkMode","charset","md5","mtime","version","key","collections","relations","parentItem","contentType","filename","tags"],a.noEditFields=["accessDate","modified","filename","dateAdded","dateModified"],a.itemTypeImageSrc={note:"note",attachment:"attachment-pdf",attachmentPdf:"attachment-pdf",attachmentWeblink:"attachment-web-link",attachmentSnapshot:"attachment-snapshot",attachmentFile:"attachment-file",attachmentLink:"attachment-link",book:"book",bookSection:"book_open",journalArticle:"page_white_text",magazineArticle:"layout",newspaperArticle:"newspaper",thesis:"report",letter:"email_open",manuscript:"script",interview:"comments",film:"film",artwork:"picture",webpage:"page",report:"report",bill:"page_white","case":"page_white",hearing:"page_white",patent:"page_white",statute:"page_white",email:"email",map:"map",blogPost:"layout",instantMessage:"page_white",forumPost:"page",audioRecording:"ipod",presentation:"page_white",videoRecording:"film",tvBroadcast:"television",radioBroadcast:"transmit",podcast:"ipod_cast",computerProgram:"page_white_code",conferencePaper:"treeitem-conferencePaper",document:"page_white",encyclopediaArticle:"page_white",dictionaryEntry:"page_white"},a.cslNameMap={author:"author",editor:"editor",bookAuthor:"container-author",composer:"composer",interviewer:"interviewer",recipient:"recipient",seriesEditor:"collection-editor",translator:"translator"},a.cslFieldMap={title:["title"],"container-title":["publicationTitle","reporter","code"],"collection-title":["seriesTitle","series"],"collection-number":["seriesNumber"],publisher:["publisher","distributor"],"publisher-place":["place"],authority:["court"],page:["pages"],volume:["volume"],issue:["issue"],"number-of-volumes":["numberOfVolumes"],"number-of-pages":["numPages"],edition:["edition"],versionNumber:["version"],section:["section"],genre:["type","artworkSize"],medium:["medium","system"],archive:["archive"],archive_location:["archiveLocation"],event:["meetingName","conferenceName"],"event-place":["place"],"abstract":["abstractNote"],URL:["url"],DOI:["DOI"],ISBN:["ISBN"],"call-number":["callNumber"],note:["extra"],number:["number"],references:["history"],shortTitle:["shortTitle"],journalAbbreviation:["journalAbbreviation"],language:["language"]},a.cslDateMap={issued:"date",accessed:"accessDate"},a.cslTypeMap={book:"book",bookSection:"chapter",journalArticle:"article-journal",magazineArticle:"article-magazine",newspaperArticle:"article-newspaper",thesis:"thesis",encyclopediaArticle:"entry-encyclopedia",dictionaryEntry:"entry-dictionary",conferencePaper:"paper-conference",letter:"personal_communication",manuscript:"manuscript",interview:"interview",film:"motion_picture",artwork:"graphic",webpage:"webpage",report:"report",bill:"bill","case":"legal_case",hearing:"bill",patent:"patent",statute:"bill",email:"personal_communication",map:"map",blogPost:"webpage",instantMessage:"personal_communication",forumPost:"webpage",audioRecording:"song",presentation:"speech",videoRecording:"motion_picture",tvBroadcast:"broadcast",radioBroadcast:"broadcast",podcast:"song",computerProgram:"book"},a.citePaperJournalArticleURL=!1,t.exports=a},{}],112:[function(e,t,r){t.exports=function(e){this.instance="Zotero.Items",this.itemsVersion=0,this.syncState={earliestVersion:null,latestVersion:null},this.itemObjects={},this.objectMap=this.itemObjects,this.objectArray=[],this.unsyncedItemKeys=[],e&&this.addItemsFromJson(e)},t.exports.prototype=new Zotero.Container,t.exports.prototype.getItem=function(e){return this.getObject(e)},t.exports.prototype.getItems=function(e){return this.getObjects(e)},t.exports.prototype.addItem=function(e){return this.addObject(e),this},t.exports.prototype.addItemsFromJson=function(e){Z.debug("addItemsFromJson",3);var t=this,r=e,a=[];return Z.debug("looping"),r.forEach(function(e){Z.debug("creating new Item");var r=new Zotero.Item(e);t.addItem(r),a.push(r)}),a},t.exports.prototype.removeLocalItem=function(e){return this.removeObject(e)},t.exports.prototype.removeLocalItems=function(e){return this.removeObjects(e)},t.exports.prototype.deleteItem=function(e){Z.debug("Zotero.Items.deleteItem",3);var t,r=this;if(!e)return!1;e=r.extractKey(e),t=r.getItem(e);var a={target:"item",libraryType:r.owningLibrary.libraryType,libraryID:r.owningLibrary.libraryID,itemKey:t.key},o={url:Zotero.ajax.apiRequestString(a),type:"DELETE",headers:{"If-Unmodified-Since-Version":t.get("version")}};return Zotero.net.ajaxRequest(o)},t.exports.prototype.deleteItems=function(e,t){Z.debug("Zotero.Items.deleteItems",3);var r,a=this,o=[];t||0===a.itemsVersion||(t=a.itemsVersion);var i;for(r=0;r<e.length;r++)e[r]&&(i=a.extractKey(e[r]),i&&o.push(i));var n=a.chunkObjectsArray(o),s=[];for(r=0;r<n.length;r++){var l=n[r].join(","),c={target:"items",libraryType:a.owningLibrary.libraryType,libraryID:a.owningLibrary.libraryID,itemKey:l},d={url:c,type:"DELETE"};s.push(d)}return Zotero.net.queueRequest(s)},t.exports.prototype.trashItems=function(e){var t,r=this;for(t=0;t<e.length;t++){var a=e[t];a.set("deleted",1)}return r.writeItems(e)},t.exports.prototype.untrashItems=function(e){var t,r=this;for(t=0;t<e.length;t++){var a=e[t];a.set("deleted",0)}return r.writeItems(e)},t.exports.prototype.findItems=function(e){var t=this,r=[];return Object.keys(t.itemObjects).forEach(function(a){
var o=o.itemObjects[a];e.collectionKey&&-1===o.apiObj.collections.indexOf(e.collectionKey)||r.push(t.itemObjects[a])}),r},t.exports.prototype.atomizeItems=function(e){for(var t,r=[],a=0;a<e.length;a++){t=e[a];var o=t.get("key");if(""===o||null===o){var i=Zotero.utils.getKey();t.set("key",i),t.set("version",0)}if(r.push(t),t.hasOwnProperty("notes")&&t.notes.length>0){for(var n=0;n<t.notes.length;n++)t.notes[n].set("parentItem",t.get("key"));r=r.concat(t.notes)}if(t.hasOwnProperty("attachments")&&t.attachments.length>0){for(var s=0;s<t.attachments.length;s++)t.attachments[s].set("parentItem",t.get("key"));r=r.concat(t.attachments)}}return r},t.exports.prototype.writeItems=function(e){var t,r=this,a=r.owningLibrary,o=r.atomizeItems(e),i={target:"items",libraryType:r.owningLibrary.libraryType,libraryID:r.owningLibrary.libraryID},n=Zotero.ajax.apiRequestString(i),s=r.chunkObjectsArray(o),l=r.rawChunks(s),c=function(e){return Z.debug("writeItem successCallback",3),r.updateObjectsFromWriteResponse(this.writeChunk,e),Zotero.config.useIndexedDB&&this.library.idbLibrary.updateItems(this.writeChunk),Zotero.trigger("itemsChanged",{library:this.library}),e.returnItems=this.writeChunk,e};Z.debug("items.itemsVersion: "+r.itemsVersion,3),Z.debug("items.libraryVersion: "+r.libraryVersion,3);var d=[];for(t=0;t<s.length;t++){var u={writeChunk:s[t],library:a},p=JSON.stringify(l[t]);d.push({url:n,type:"POST",data:p,processData:!1,success:c.bind(u)})}return a.sequentialRequests(d).then(function(e){return Z.debug("Done with writeItems sequentialRequests promise",3),e})}},{}],113:[function(e,t,r){var a=function(e,t,r,a){Z.debug("Zotero.Library constructor",3),Z.debug("Library Constructor: "+e+" "+t+" ",3);var o=this;if(Z.debug(r,4),o.instance="Zotero.Library",o.libraryVersion=0,o.syncState={earliestVersion:null,latestVersion:null},o._apiKey=a||"",Zotero.config.librarySettings?o.libraryBaseWebsiteUrl=Zotero.config.librarySettings.libraryPathString:(o.libraryBaseWebsiteUrl=Zotero.config.baseWebsiteUrl,"group"==e&&(o.libraryBaseWebsiteUrl+="groups/"),r?this.libraryBaseWebsiteUrl+=r+"/items":Z.warn("no libraryUrlIdentifier specified")),o.items=new Zotero.Items,o.items.owningLibrary=o,o.itemKeys=[],o.collections=new Zotero.Collections,o.collections.libraryUrlIdentifier=o.libraryUrlIdentifier,o.collections.owningLibrary=o,o.tags=new Zotero.Tags,o.searches=new Zotero.Searches,o.searches.owningLibrary=o,o.groups=new Zotero.Groups,o.groups.owningLibrary=o,o.deleted=new Zotero.Deleted,o.deleted.owningLibrary=o,!e)return void Z.warn("No type specified for library");if(o.type=e,o.libraryType=e,o.libraryID=t,o.libraryString=Zotero.utils.libraryString(o.libraryType,o.libraryID),o.libraryUrlIdentifier=r,o.preferences=new Zotero.Preferences(Zotero.store,o.libraryString),"undefined"==typeof window)Zotero.config.useIndexedDB=!1,Zotero.warn("Node detected; disabling indexedDB");else{var i=navigator.userAgent.indexOf("Chrome")>-1,n=(navigator.userAgent.indexOf("MSIE")>-1,navigator.userAgent.indexOf("Firefox")>-1,navigator.userAgent.indexOf("Safari")>-1),s=navigator.userAgent.toLowerCase().indexOf("op")>-1;i&&n&&(n=!1),i&&s&&(i=!1),n&&(Zotero.config.useIndexedDB=!1,Zotero.warn("Safari detected; disabling indexedDB"))}if(Zotero.config.useIndexedDB===!0){Z.debug("Library Constructor: indexedDB init",3);var l=new Zotero.Idb.Library(o.libraryString);l.owningLibrary=this,o.idbLibrary=l,l.init().then(function(){if(Z.debug("Library Constructor: idbInitD Done",3),Zotero.config.preloadCachedLibrary===!0){Z.debug("Library Constructor: preloading cached library",3);var e=o.loadIndexedDBCache();e.then(function(){Z.debug("Library Constructor: Library.items.itemsVersion: "+o.items.itemsVersion,3),Z.debug("Library Constructor: Library.collections.collectionsVersion: "+o.collections.collectionsVersion,3),Z.debug("Library Constructor: Library.tags.tagsVersion: "+o.tags.tagsVersion,3),Z.debug("Library Constructor: Triggering cachedDataLoaded",3),o.trigger("cachedDataLoaded")},function(e){throw Z.error("Error loading cached library"),Z.error(e),new Error("Error loading cached library")})}else o.trigger("cachedDataLoaded")},function(){Zotero.config.useIndexedDB=!1,o.trigger("indexedDBError"),o.trigger("cachedDataLoaded"),Z.error("Error initializing indexedDB. Promise rejected.")})}o.dirty=!1,o.tagsChanged=function(){},o.collectionsChanged=function(){},o.itemsChanged=function(){}};a.prototype.sortableColumns=["title","creator","itemType","date","year","publisher","publicationTitle","journalAbbreviation","language","accessDate","libraryCatalog","callNumber","rights","dateAdded","dateModified","addedBy"],a.prototype.displayableColumns=["title","creator","itemType","date","year","publisher","publicationTitle","journalAbbreviation","language","accessDate","libraryCatalog","callNumber","rights","dateAdded","dateModified","numChildren","addedBy"],a.prototype.groupOnlyColumns=["addedBy"],a.prototype.comparer=function(){return Intl?(new Intl.Collator).compare:function(e,t){return e.toLocaleLowerCase()==t.toLocaleLowerCase()?0:e.toLocaleLowerCase()<t.toLocaleLowerCase()?-1:1}},a.prototype.ajaxRequest=function(e,t,r){Z.debug("Library.ajaxRequest",3),t||(t="GET"),r||(r={});var a={url:e,type:t};return a=Z.extend({},a,r),Z.debug(a,3),Zotero.net.queueRequest(a)},a.prototype.sequentialRequests=function(e){Z.debug("Zotero.Library.sequentialRequests",3);return Zotero.net.queueRequest(e)},a.prototype.websiteUrl=function(e){Z.debug("Zotero.library.websiteUrl",3),Z.debug(e,4);var t=this,r=[];Object.keys(e).forEach(function(t){var a=e[t];""!==a&&r.push(t+"/"+a)}),r.sort(),Z.debug(r,4);var a=r.join("/");return t.libraryBaseWebsiteUrl+"/"+a},a.prototype.synchronize=function(){},a.prototype.loadUpdatedItems=function(){Z.debug("Zotero.Library.loadUpdatedItems",3);var e=this,t=e.libraryVersion?e.libraryVersion:e.items.itemsVersion;return Promise.resolve(e.updatedVersions("items",t)).then(function(t){Z.debug("itemVersions resolved",3),Z.debug("items Last-Modified-Version: "+t.lastModifiedVersion,3),e.items.updateSyncState(t.lastModifiedVersion);var r=t.data;e.itemVersions=r;var a=[];return Object.keys(r).forEach(function(t){var o=r[t],i=e.items.getItem(t);i&&i.apiObj.key==o||a.push(t)}),e.loadItemsFromKeys(a)}).then(function(t){Z.debug("loadItemsFromKeys resolved",3),e.items.updateSyncedVersion();var r=Zotero.state.getUrlVars();if(e.buildItemDisplayView(r),Zotero.config.useIndexedDB){e.idbLibrary.updateItems(e.items.objectArray)}})},a.prototype.loadUpdatedCollections=function(){Z.debug("Zotero.Library.loadUpdatedCollections",3);var e=this;Z.debug("library.collections.collectionsVersion:"+e.collections.collectionsVersion);var t=e.libraryVersion?e.libraryVersion:e.collections.collectionsVersion;return e.updatedVersions("collections",t).then(function(t){Z.debug("collectionVersions finished",3),Z.debug("Collections Last-Modified-Version: "+t.lastModifiedVersion,3),e.collections.updateSyncState(t.lastModifiedVersion);var r=t.data;e.collectionVersions=r;var a=[];return Object.keys(r).forEach(function(t){var o=r[t],i=e.collections.getCollection(t);i&&i.apiObj.version==o||a.push(t)}),0===a.length?(Z.debug("No collectionKeys need updating. resolving",3),t):(Z.debug("fetching collections by key",3),e.loadCollectionsFromKeys(a).then(function(){var t=e.collections;t.initSecondaryData(),Z.debug("All updated collections loaded",3),e.collections.updateSyncedVersion();Zotero.state.getUrlVars();return Z.debug("loadUpdatedCollections complete - saving collections to cache before resolving",3),Z.debug("collectionsVersion: "+e.collections.collectionsVersion,3),Zotero.config.useIndexedDB?e.idbLibrary.updateCollections(t.collectionsArray):void 0}))}).then(function(){return Z.debug("done getting collection data. requesting deleted data",3),e.getDeleted(e.libraryVersion)}).then(function(t){Z.debug("got deleted collections data: removing local copies",3),Z.debug(e.deleted),e.deleted.deletedData.collections&&e.deleted.deletedData.collections.length>0&&e.collections.removeLocalCollections(e.deleted.deletedData.collections)})},a.prototype.loadUpdatedTags=function(){Z.debug("Zotero.Library.loadUpdatedTags",3);var e=this;return Z.debug("tagsVersion: "+e.tags.tagsVersion,3),Promise.resolve(e.loadAllTags({since:e.tags.tagsVersion})).then(function(){return Z.debug("done getting tags, request deleted tags data",3),e.getDeleted(e.libraryVersion)}).then(function(t){if(Z.debug("got deleted tags data"),e.deleted.deletedData.tags&&e.deleted.deletedData.tags.length>0&&e.tags.removeTags(e.deleted.deletedData.tags),Zotero.config.useIndexedDB){Z.debug("saving updated tags to IDB",3);e.idbLibrary.updateTags(e.tags.tagsArray)}})},a.prototype.getDeleted=function(e){Z.debug("Zotero.Library.getDeleted",3);var t=this,r={target:"deleted",libraryType:t.libraryType,libraryID:t.libraryID,since:e};return t.deleted.pending?(Z.debug("getDeleted resolving with previously pending promise"),Promise.resolve(t.deleted.pendingPromise)):(Z.debug("version:"+e),Z.debug("sinceVersion:"+t.deleted.sinceVersion),Z.debug("untilVersion:"+t.deleted.untilVersion),t.deleted.untilVersion&&e>=t.deleted.sinceVersion?(Z.debug("deletedVersion matches requested: immediately resolving"),Promise.resolve(t.deleted.deletedData)):(t.deleted.pending=!0,t.deleted.pendingPromise=t.ajaxRequest(r).then(function(r){Z.debug("got deleted response"),t.deleted.deletedData=r.data,Z.debug("Deleted Last-Modified-Version:"+r.lastModifiedVersion,3),t.deleted.untilVersion=r.lastModifiedVersion,t.deleted.sinceVersion=e}).then(function(e){Z.debug("cleaning up deleted pending"),t.deleted.pending=!1,t.deleted.pendingPromise=!1}),t.deleted.pendingPromise))},a.prototype.processDeletions=function(e){var t=this;t.collections.processDeletions(e.collections),t.items.processDeletions(e.items)},a.prototype.loadFullBib=function(e,t){var r=this,a=e.join(","),o={target:"items",libraryType:r.libraryType,libraryID:r.libraryID,itemKey:a,format:"bib",linkwrap:"1"};1==e.length&&(o.target="item"),t&&(o.style=t);var i=r.ajaxRequest(o).then(function(e){return e.data});return i},a.prototype.loadItemBib=function(e,t){Z.debug("Zotero.Library.loadItemBib",3);var r=this,a={target:"item",libraryType:r.libraryType,libraryID:r.libraryID,itemKey:e,content:"bib"};t&&(a.style=t);var o=r.ajaxRequest(a).then(function(e){var t=new Zotero.Item(e.data),r=t.apiObj.bib;return r});return o},a.prototype.loadSettings=function(){Z.debug("Zotero.Library.loadSettings",3);var e=this,t={target:"settings",libraryType:e.libraryType,libraryID:e.libraryID};return e.ajaxRequest(t).then(function(t){var r;if(r="string"==typeof t.data?JSON.parse(t.data):t.data,e.preferences.setPref("settings",r),r.tagColors){var a=r.tagColors.value;e.preferences.setPref("tagColors",a)}return e.trigger("settingsLoaded"),e.preferences})},a.prototype.matchColoredTags=function(e){var t,r=this,a=r.preferences.getPref("tagColors");if(!a)return[];var o={};for(t=0;t<a.length;t++)o[a[t].name.toLowerCase()]=a[t].color;var i=[];for(t=0;t<e.length;t++)o.hasOwnProperty(e[t])&&i.push(o[e[t]]);return i},a.prototype.sendToLibrary=function(e,t){for(var r=[],a=0;a<e.length;a++){var o=e[a],i=o.emptyJsonItem();i.data=Z.extend({},e[a].apiObj.data),i.data.key="",i.data.version=0,i.data.collections=[],delete i.data.dateModified,delete i.data.dateAdded;var n=new Zotero.Item(i);n.pristine=Z.extend({},n.apiObj),n.initSecondaryData(),n.apiObj.data.relations||(n.apiObj.data.relations={}),n.apiObj.data.relations["owl:sameAs"]=Zotero.url.relationUrl(o.owningLibrary.libraryType,o.owningLibrary.libraryID,o.key),r.push(n)}return t.items.writeItems(r)},a.prototype.updatedVersions=function(){var e=arguments.length<=0||void 0===arguments[0]?"items":arguments[0],t=arguments.length<=1||void 0===arguments[1]?this.libraryVersion:arguments[1];Z.debug("Library.updatedVersions",3);var r=this,a={target:e,format:"versions",libraryType:r.libraryType,libraryID:r.libraryID,since:t};return r.ajaxRequest(a)},a.prototype.loadItemsFromKeys=function(e){Zotero.debug("Zotero.Library.loadItemsFromKeys",3);var t=this;return t.loadFromKeys(e,"items")},a.prototype.loadCollectionsFromKeys=function(e){Zotero.debug("Zotero.Library.loadCollectionsFromKeys",3);var t=this;return t.loadFromKeys(e,"collections")},a.prototype.loadSeachesFromKeys=function(e){Zotero.debug("Zotero.Library.loadSearchesFromKeys",3);var t=this;return t.loadFromKeys(e,"searches")},a.prototype.loadFromKeys=function(e,t){Zotero.debug("Zotero.Library.loadFromKeys",3),t||(t="items");for(var r=this,a=[];e.length>0;)a.push(e.splice(0,50));var o=[];a.forEach(function(e){var a=e.join(",");switch(t){case"items":o.push({url:{target:"items",targetModifier:null,itemKey:a,limit:50,libraryType:r.libraryType,libraryID:r.libraryID},type:"GET",success:r.processLoadedItems.bind(r)});break;case"collections":o.push({url:{target:"collections",targetModifier:null,collectionKey:a,limit:50,libraryType:r.libraryType,libraryID:r.libraryID},type:"GET",success:r.processLoadedCollections.bind(r)});break;case"searches":o.push({url:{target:"searches",targetModifier:null,searchKey:a,limit:50,libraryType:r.libraryType,libraryID:r.libraryID},type:"GET"})}});for(var i=[],n=0;n<o.length;n++)i.push(Zotero.net.queueRequest(o[n]));return Promise.all(i)},a.prototype.buildItemDisplayView=function(e){Z.debug("Zotero.Library.buildItemDisplayView",3),Z.debug(e,4);var t=this;if(!t.idbLibrary.db)return Promise.resolve([]);var r=[];e.collectionKey?"trash"==e.collectionKey?r.push(t.idbLibrary.filterItems("deleted",1)):r.push(t.idbLibrary.filterItems("collectionKeys",e.collectionKey)):r.push(t.idbLibrary.getOrderedItemKeys("title"));var a=e.tag||[];"string"==typeof a&&(a=[a]);for(var o=0;o<a.length;o++)Z.debug("adding selected tag filter",3),r.push(t.idbLibrary.filterItems("itemTagStrings",a[o]));return Promise.all(r).then(function(r){var a;for(a=0;a<r.length;a++)Z.debug("result from filterPromise: "+r[a].length,3),Z.debug(r[a],3);var o=t.idbLibrary.intersectAll(r),i=t.items.getItems(o);Z.debug("All filters applied - Down to "+i.length+" items displayed",3),Z.debug("remove child items and, if not viewing trash, deleted items",3);var n=[];for(a=0;a<i.length;a++)i[a].apiObj.data.parentItem||"trash"!=e.collectionKey&&i[a].apiObj.deleted||n.push(i[a]);var s=e.order||"title",l=e.sort||"asc";Z.debug("Sorting by "+s+" - "+l,3);var c=Zotero.Library.prototype.comparer();return n.sort(function(e,t){var r=e.get(s),a=t.get(s);return c(r,a)}),"desc"==l&&(Z.debug("sort is desc - reversing array",4),n.reverse()),Z.debug("triggering publishing displayedItemsUpdated",3),t.trigger("displayedItemsUpdated"),n})},a.prototype.trigger=function(e,t){var r=this;Zotero.trigger(e,t,r.libraryString)},a.prototype.listen=function(e,t,r){var a=this,o=a.libraryString;Zotero.listen(e,t,r,o)},a.prototype.processLoadedCollections=function(e){Z.debug("processLoadedCollections",3);var t=this;Z.debug("adding collections to library.collections");for(var r=t.collections.addCollectionsFromJson(e.data),a=0;a<r.length;a++)r[a].associateWithLibrary(t);return t.collections.updateSyncState(e.lastModifiedVersion),Zotero.trigger("loadedCollectionsProcessed",{library:t,collectionsAdded:r}),e},a.prototype.addCollection=function(e,t){Z.debug("Zotero.Library.addCollection",3);var r=this,a=new Zotero.Collection;return a.associateWithLibrary(r),a.set("name",e),a.set("parentCollection",t),r.collections.writeCollections([a])},a.prototype.fetchItemKeys=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];Z.debug("Zotero.Library.fetchItemKeys",3);var t=this,r=Z.extend(!0,{target:"items",libraryType:this.libraryType,libraryID:this.libraryID,format:"keys"},e);return t.ajaxRequest(r)},a.prototype.getTrashKeys=function(){Z.debug("Zotero.Library.getTrashKeys",3);var e=this,t={target:"items",libraryType:e.libraryType,libraryID:e.libraryID,format:"keys",collectionKey:"trash"};return e.ajaxRequest(t)},a.prototype.emptyTrash=function(){Z.debug("Zotero.Library.emptyTrash",3);var e=this;return e.getTrashKeys().then(function(t){var r=t.data.split("\n");return e.items.deleteItems(r,t.lastModifiedVersion)})},a.prototype.loadItemKeys=function(e){Z.debug("Zotero.Library.loadItemKeys",3);var t=this;return this.fetchItemKeys(e).then(function(e){Z.debug("loadItemKeys proxied callback",3);var r=e.data.split(/[\s]+/);t.itemKeys=r})},a.prototype.loadItems=function(e){Z.debug("Zotero.Library.loadItems",3);var t=this;e||(e={});var r={target:"items",targetModifier:"top",start:0,limit:25,order:Zotero.config.defaultSortColumn,sort:Zotero.config.defaultSortOrder},a=Z.extend({},r,e),o=Z.extend({target:"items",libraryType:t.libraryType,libraryID:t.libraryID},a),i=Zotero.ajax.apiRequestString(o);return t.ajaxRequest(i).then(function(e){Z.debug("loadItems proxied callback",3);var r=t.items,a=r.addItemsFromJson(e.data);Z.debug("Looping over loadedItemsArray");for(var o=0;o<a.length;o++)a[o].associateWithLibrary(t);return e.loadedItems=a,Zotero.trigger("itemsChanged",{library:t}),e})},a.prototype.loadPublications=function(e){Z.debug("Zotero.Library.loadPublications",3);var t=this;e||(e={});var r={target:"publications",start:0,limit:50,order:Zotero.config.defaultSortColumn,sort:Zotero.config.defaultSortOrder,include:"bib"},a=Z.extend({},r,e),o=Z.extend({target:"publications",libraryType:t.libraryType,libraryID:t.libraryID},a),i=Zotero.ajax.apiRequestString(o);return t.ajaxRequest(i).then(function(e){Z.debug("loadPublications proxied callback",3);var t=[],r=e.data;return r.forEach(function(e){var r=new Zotero.Item(e);t.push(r)}),e.publicationItems=t,e})},a.prototype.processLoadedItems=function(e){Z.debug("processLoadedItems",3);for(var t=this,r=t.items,a=r.addItemsFromJson(e.data),o=0;o<a.length;o++)a[o].associateWithLibrary(t);return t.items.updateSyncState(e.lastModifiedVersion),Zotero.trigger("itemsChanged",{library:t,loadedItems:a}),e},a.prototype.loadItem=function(e){Z.debug("Zotero.Library.loadItem",3);var t=this;if(!r)var r={};var a={target:"item",libraryType:t.libraryType,libraryID:t.libraryID,itemKey:e};return t.ajaxRequest(a).then(function(e){Z.debug("Got loadItem response");var r=new Zotero.Item(e.data);return r.owningLibrary=t,t.items.itemObjects[r.key]=r,Zotero.trigger("itemsChanged",{library:t}),r},function(e){Z.debug("Error loading Item")})},a.prototype.trashItem=function(e){var t=this;return t.items.trashItems([t.items.getItem(e)])},a.prototype.untrashItem=function(e){if(Z.debug("Zotero.Library.untrashItem",3),!e)return!1;var t=this.items.getItem(e);return t.apiObj.deleted=0,t.writeItem()},a.prototype.deleteItem=function(e){Z.debug("Zotero.Library.deleteItem",3);var t=this;return t.items.deleteItem(e)},a.prototype.deleteItems=function(e){Z.debug("Zotero.Library.deleteItems",3);var t=this;return t.items.deleteItems(e)},a.prototype.addNote=function(e,t){Z.debug("Zotero.Library.prototype.addNote",3);var r=this,a={target:"children",libraryType:r.libraryType,libraryID:r.libraryID,itemKey:e},o=Zotero.ajax.apiRequestString(a);this.items.getItem(e);return r.ajaxRequest(o,"POST",{processData:!1})},a.prototype.fetchGlobalItems=function(e){Z.debug("Zotero.Library.fetchGlobalItems",3);var t=this;e||(e={});var r={target:"items",start:0,limit:25},a=Z.extend({},r,e),o=Z.extend({target:"items",libraryType:""},a),i=Zotero.ajax.apiRequestString(o);return t.ajaxRequest(i,"GET",{dataType:"json"}).then(function(e){return Z.debug("globalItems callback",3),e.data})},a.prototype.fetchGlobalItem=function(e){Z.debug("Zotero.Library.fetchGlobalItem",3),Z.debug(e);var t=this,r={target:"item"},a=Z.extend({},r),o=Z.extend({target:"item",libraryType:"",itemKey:e},a),i=Zotero.ajax.apiRequestString(o);return t.ajaxRequest(i,"GET",{dataType:"json"}).then(function(e){return Z.debug("globalItem callback",3),e.data})},a.prototype.fetchTags=function(e){Z.debug("Zotero.Library.fetchTags",3);var t={target:"tags",order:"title",sort:"asc",limit:100},r=Z.extend({},t,e),a=Z.extend({target:"tags",libraryType:this.libraryType,libraryID:this.libraryID},r);return Zotero.ajaxRequest(a)},a.prototype.loadTags=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];Z.debug("Zotero.Library.loadTags",3);var t=this;return e.showAutomaticTags&&e.collectionKey&&delete e.collectionKey,t.tags.displayTagsArray=[],t.fetchTags(e).then(function(e){Z.debug("loadTags proxied callback",3);var r=e.lastModifiedVersion;t.tags.updateSyncState(r);t.tags.addTagsFromJson(e.data);return t.tags.updateTagsVersion(r),t.tags.rebuildTagsArray(),e.parsedLinks.hasOwnProperty("next")?(t.tags.hasNextLink=!0,t.tags.nextLink=e.parsedLinks.next):(t.tags.hasNextLink=!1,t.tags.nextLink=null),t.trigger("tagsChanged",{library:t}),t.tags})},a.prototype.loadAllTags=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];Z.debug("Zotero.Library.loadAllTags",3);var t=this,r={target:"tags",order:"title",sort:"asc",limit:100,libraryType:t.libraryType,libraryID:t.libraryID},o=Z.extend({},r,e),i=Z.extend({},o),n=Zotero.ajax.apiRequestString(i),s=t.tags,l=(Z.extend({},r,s.loadedConfig),s.loadedRequestUrl);return Z.debug("requestUrl: "+n,4),Z.debug("loadedConfigRequestUrl: "+l,4),new Promise(function(r,o){var s=function l(r){Z.debug("loadAllTags continueLoadingCallback",3);var o=Zotero.Tags.prototype.plainTagsList(r.tagsArray);if(o.sort(a.prototype.comparer()),r.plainList=o,r.hasNextLink){Z.debug("still has next link.",3),r.tagsArray.sort(Zotero.Tag.prototype.tagComparer()),o=Zotero.Tags.prototype.plainTagsList(r.tagsArray),o.sort(a.prototype.comparer()),r.plainList=o;var i=r.nextLink,s=Zotero.utils.parseQuery(Zotero.utils.querystring(i)),c=Z.extend({},e);return c.start=s.start,c.limit=s.limit,t.loadTags(c).then(l)}Z.debug("no next in tags link",3),r.updateSyncedVersion(),r.tagsArray.sort(Zotero.Tag.prototype.tagComparer()),o=Zotero.Tags.prototype.plainTagsList(r.tagsArray),o.sort(a.prototype.comparer()),r.plainList=o,Z.debug("resolving loadTags deferred",3),t.tagsLoaded=!0,t.tags.loaded=!0,r.loadedConfig=e,r.loadedRequestUrl=n;for(var d=0;d<t.tags.tagsArray.length;d++)r.tagsArray[d].apiObj.version=r.tagsVersion;return t.trigger("tagsChanged",{library:t}),r};r(t.loadTags(i).then(s))})},a.prototype.loadIndexedDBCache=function(){Zotero.debug("Zotero.Library.loadIndexedDBCache",3);var e=this,t=e.idbLibrary.getAllItems(),r=e.idbLibrary.getAllCollections(),a=e.idbLibrary.getAllTags();return t.then(function(t){Z.debug("loadIndexedDBCache itemsD done",3);for(var r=0,a=0;a<t.length;a++){var o=new Zotero.Item(t[a]);e.items.addItem(o),o.version>r&&(r=o.version)}e.items.itemsVersion=r,e.items.loaded=!0,Z.debug("Done loading indexedDB items promise into library",3)}),r.then(function(t){Z.debug("loadIndexedDBCache collectionsD done",3);for(var r=0,a=0;a<t.length;a++){var o=new Zotero.Collection(t[a]);e.collections.addCollection(o),o.version>r&&(r=o.version)}e.collections.collectionsVersion=r,e.collections.initSecondaryData(),e.collections.loaded=!0}),a.then(function(t){Z.debug("loadIndexedDBCache tagsD done",3),Z.debug(t);for(var r=0,a=0,o=0;o<t.length;o++){var i=new Zotero.Tag(t[o]);e.tags.addTag(i),t[o].version>r&&(r=t[o].version)}a=r,e.tags.tagsVersion=a,e.tags.loaded=!0}),Promise.all([t,r,a])},a.prototype.saveIndexedDB=function(){var e=this,t=e.idbLibrary.updateItems(e.items.itemsArray),r=e.idbLibrary.updateCollections(e.collections.collectionsArray),a=e.idbLibrary.updateTags(e.tags.tagsArray);return Promise.all([t,r,a])},t.exports=a},{}],114:[function(e,t,r){var a=e("./ItemMaps.js");t.exports.fieldMap=a.fieldMap,t.exports.typeMap=a.typeMap,t.exports.creatorMap=a.creatorMap},{"./ItemMaps.js":111}],115:[function(e,t,r){var a="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":_typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":_typeof2(e)},o=e("deferred"),i=function(){this.deferredQueue=[],this.numRunning=0,this.numConcurrent=3,this.backingOff=!1};i.prototype.queueDeferred=function(){var e=this,t=new o;return e.deferredQueue.push(t),Promise.resolve(t)},i.prototype.queueRequest=function(e){Z.debug("Zotero.Net.queueRequest",3);var t,r=this;return t=Array.isArray(e)?r.queueDeferred().then(function(){return Z.debug("running sequential after queued deferred resolved",4),r.runSequential(e)}).then(function(e){return Z.debug("runSequential done",3),r.queuedRequestDone(),e}):r.queueDeferred().then(function(){return Z.debug("running concurrent after queued deferred resolved",4),r.runConcurrent(e)}).then(function(e){return Z.debug("done with queuedRequest"),r.queuedRequestDone(),e}),r.runNext(),t["catch"](function(e){Z.error("Error before leaving Zotero.Net"),Z.error(e)})},i.prototype.runConcurrent=function(e){return Z.debug("Zotero.Net.runConcurrent",3),this.ajaxRequest(e).then(function(e){return Z.debug("done with runConcurrent request"),e})},i.prototype.runSequential=function(e){Z.debug("Zotero.Net.runSequential",3);for(var t=this,r=[],a=Promise.resolve(),o=0;o<e.length;o++){var i=e[o];a=a.then(function(){var e=t.ajaxRequest(i).then(function(e){Z.debug("pushing sequential response into result array"),r.push(e)});return e})}return a.then(function(){return Z.debug("done with sequential aggregator promise - returning responses"),r})},i.prototype.individualRequestDone=function(e){Z.debug("Zotero.Net.individualRequestDone",3);var t=this,r=t.checkDelay(e);if(r>0){var a=1e3*r;t.backingOff=!0;var o=Date.now()+a;o>t.waitingExpires&&(t.waitingExpires=o),setTimeout(t.runNext,a)}return e},i.prototype.queuedRequestDone=function(e){Z.debug("queuedRequestDone",3);var t=this;return t.numRunning--,t.runNext(),e},i.prototype.runNext=function(){Z.debug("Zotero.Net.runNext",3);var e=this,t=Date.now();if(e.backingOff&&e.waitingExpires>t-100){Z.debug("currently backing off",3);var r=e.waitingExpires-t;return void setTimeout(e.runNext,r)}for(e.backingOff&&e.waitingExpires<=t-100&&(e.backingOff=!1),Z.debug(e.numRunning+"/"+e.numConcurrent+" Running. "+e.deferredQueue.length+" queued.",3);e.deferredQueue.length>0&&e.numRunning<e.numConcurrent;){e.numRunning++;var a=e.deferredQueue.shift();a.resolve(),Z.debug(e.numRunning+"/"+e.numConcurrent+" Running. "+e.deferredQueue.length+" queued.",3)}},i.prototype.checkDelay=function(e){Z.debug("Zotero.Net.checkDelay"),Z.debug(e);var t=this,r=0;if(Array.isArray(e))for(var a=0;a<e.length;a++){var o=t.checkDelay(e[a]);o>r&&(r=o)}else 429==e.status?r=e.retryAfter:e.backoff&&(r=e.backoff);return r},i.prototype.ajaxRequest=function(e){Z.debug("Zotero.Net.ajaxRequest",3);var t=this,r={type:"GET",headers:{"Zotero-API-Version":Zotero.config.apiVersion,"Content-Type":"application/json"},success:function(e){return e},error:function(e){return Z.error("ajaxRequest rejected:"+e.jqxhr.status+" - "+e.jqxhr.responseText),e}},o=Z.extend({},r.headers,e.headers),i=Z.extend({},r,e);if(i.headers=o,"object"==a(i.url)&&(i.url=Zotero.ajax.apiRequestString(i.url)),i.url=Zotero.ajax.proxyWrapper(i.url,i.type),!i.url)throw"No url specified in Zotero.Net.ajaxRequest";i.zsuccess=i.success,i.zerror=i.error,delete i.success,delete i.error,Z.debug("AJAX config"),Z.debug(i);var n=new Promise(function(e,r){t.ajax(i).then(function(t){var r;if("json"==t.responseType||""===t.responseType&&"application/json"===t.getResponseHeader("content-type"))try{r=JSON.parse(t.response)}catch(a){r=t.response}else r=t.response;var o=new Zotero.ApiResponse({jqxhr:t,data:r,textStatus:t.responseText});e(o)},function(e){var t=new Zotero.ApiResponse({jqxhr:e,textStatus:e.responseText,isError:!0});r(t)})}).then(t.individualRequestDone.bind(t)).then(function(e){if(e.isError)throw Z.error("re-throwing ApiResponse that was a rejection"),e;return e}).then(i.zsuccess,i.zerror);return n},i.prototype.ajax=function(e){e=Zotero.extend({type:"GET"},e);var t=new Promise(function(t,r){var a=new XMLHttpRequest,o=e.url;a.open(e.type,o),e.headers&&Object.keys(e.headers).forEach(function(t){var r=e.headers[t];a.setRequestHeader(t,r)}),a.send(e.data),a.onload=function(){Z.debug("XMLHttpRequest done"),Z.debug(a),a.status>=200&&a.status<300?(Z.debug("200-300 response: resolving Net.ajax promise"),t(a)):(Z.debug("not 200-300 response: rejecting Net.ajax promise"),r(a))},a.onerror=function(){r(a)}});return t},t.exports=new i},{deferred:31}],116:[function(e,t,r){var a="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":_typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":_typeof2(e)};t.exports=function(e,t){this.store=e,this.idString=t,this.preferencesObject={},this.defaults={debug_level:3,debug_log:!0,debug_mock:!1,listDisplayedFields:["title","creator","dateModified"],showAutomaticTags:!1,itemsPerPage:25,order:"title",title:"asc"},this.load()},t.exports.prototype.setPref=function(e,t){var r=this;r.preferencesObject[e]=t,r.persist()},t.exports.prototype.setPrefs=function(e){var t=this;if("object"!=("undefined"==typeof e?"undefined":a(e)))throw new Error("Preferences must be an object");t.preferencesObject=e,t.persist()},t.exports.prototype.getPref=function(e){var t=this;return t.preferencesObject[e]?t.preferencesObject[e]:t.defaults[e]?t.defaults[e]:null},t.exports.prototype.getPrefs=function(){var e=this;return e.preferencesObject},t.exports.prototype.persist=function(){var e=this,t="preferences_"+e.idString;e.store[t]=JSON.stringify(e.preferencesObject)},t.exports.prototype.load=function(){var e=this,t="preferences_"+e.idString,r=e.store[t];r?e.preferencesObject=JSON.parse(r):e.preferencesObject={}}},{}],117:[function(e,t,r){t.exports=function(){this.instance="Zotero.Search",this.searchObject={}}},{}],118:[function(e,t,r){t.exports=function(){this.instance="Zotero.Searches",this.searchObjects={},this.syncState={earliestVersion:null,latestVersion:null}}},{}],119:[function(e,t,r){var a="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":_typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":_typeof2(e)};t.exports=function(e){this.instance="Zotero.Tag",this.color=null,this.version=0,"object"==("undefined"==typeof e?"undefined":a(e))?this.parseJsonTag(e):"string"==typeof e?this.parseJsonTag(this.templateApiObj(e)):this.parseJsonTag(this.tamplateApiObj(""))},t.exports.prototype=new Zotero.ApiObject,t.exports.prototype.parseJsonTag=function(e){var t=this;t.apiObj=Z.extend({},e),t.urlencodedtag=encodeURIComponent(t.apiObj.tag),t.version=t.apiObj.version},t.exports.prototype.templateApiObj=function(e){return{tag:e,links:{},meta:{type:0,numItems:1}}},t.exports.prototype.tagComparer=function(){if(Intl){var e=new Intl.Collator;return function(t,r){return e.compare(t.apiObj.tag,r.apiObj.tag)}}return function(e,t){return e.apiObj.tag.toLocaleLowerCase()==t.apiObj.tag.toLocaleLowerCase()?0:e.apiObj.tag.toLocaleLowerCase()<t.apiObj.tag.toLocaleLowerCase()?-1:1}},t.exports.prototype.set=function(e,t){var r=this;switch(e in r.apiObj&&(r.apiObj[e]=t),e in r.apiObj.meta&&(r.apiObj.meta[e]=t),e){case"tagVersion":case"version":r.version=t,r.apiObj.version=t}return r}},{}],120:[function(e,t,r){t.exports=function(e){this.instance="Zotero.Tags",this.tagsVersion=0,this.syncState={earliestVersion:null,latestVersion:null},this.displayTagsArray=[],this.displayTagsUrl="",this.tagObjects={},this.tagsArray=[],this.loaded=!1,e&&this.addTagsFromJson(e)},t.exports.prototype=new Zotero.Container,t.exports.prototype.addTag=function(e){var t=this;t.tagObjects[e.apiObj.tag]=e,t.tagsArray.push(e),t.owningLibrary&&e.associateWithLibrary(t.owningLibrary)},t.exports.prototype.getTag=function(e){var t=this;return t.tagObjects.hasOwnProperty(e)?this.tagObjects[e]:null},t.exports.prototype.removeTag=function(e){var t=this;delete t.tagObjects[e],t.updateSecondaryData()},t.exports.prototype.removeTags=function(e){var t=this;e.forEach(function(e){delete t.tagObjects[e]}),t.updateSecondaryData()},t.exports.prototype.plainTagsList=function(e){
Z.debug("Zotero.Tags.plainTagsList",3);var t=[];return e.forEach(function(e){t.push(e.apiObj.tag)}),t},t.exports.prototype.clear=function(){Z.debug("Zotero.Tags.clear",3),this.tagsVersion=0,this.syncState.earliestVersion=null,this.syncState.latestVersion=null,this.displayTagsArray=[],this.displayTagsUrl="",this.tagObjects={},this.tagsArray=[]},t.exports.prototype.updateSecondaryData=function(){Z.debug("Zotero.Tags.updateSecondaryData",3);var e=this;e.tagsArray=[],Object.keys(e.tagObjects).forEach(function(t){var r=e.tagObjects[t];e.tagsArray.push(r)}),e.tagsArray.sort(Zotero.Tag.prototype.tagComparer());var t=e.plainTagsList(e.tagsArray);t.sort(Zotero.Library.prototype.comparer()),e.plainList=t},t.exports.prototype.updateTagsVersion=function(e){var t=this;Object.keys(t.tagObjects).forEach(function(r){var a=t.tagObjects[r];a.set("version",e)})},t.exports.prototype.rebuildTagsArray=function(){var e=this;e.tagsArray=[],Object.keys(e.tagObjects).forEach(function(t){var r=e.tagObjects[t];e.tagsArray.push(r)})},t.exports.prototype.addTagsFromJson=function(e){Z.debug("Zotero.Tags.addTagsFromJson",3);var t=this,r=[];return e.forEach(function(e){var a=new Zotero.Tag(e);t.addTag(a),r.push(a)}),r}},{}],121:[function(e,t,r){var a={};a.itemHref=function(e){var t="";return t+=Zotero.config.librarySettings.libraryPathString+"/itemKey/"+e.get("key")},a.attachmentDownloadLink=function(e){var t="",r=e.attachmentDownloadUrl;e.get("contentType");if(e.apiObj.links&&e.apiObj.links.enclosure){if(e.apiObj.links.enclosure.length||!e.isSnapshot()){var a=Zotero.utils.translateMimeType(e.apiObj.links.enclosure.type),o=e.apiObj.links.enclosure,i=parseInt(o.length,10),n=""+i+" B";return i>1073741824?n=""+(i/1073741824).toFixed(1)+" GB":i>1048576?n=""+(i/1048576).toFixed(1)+" MB":i>1024&&(n=""+(i/1024).toFixed(1)+" KB"),Z.debug(a,3),t+='<a href="'+r+'">',t+="undefined"==a||""===a||"undefined"==typeof a?n+"</a>":a+", "+n+"</a>"}t+='<a href="'+r+'">View Snapshot</a>'}return t},a.attachmentDownloadUrl=function(e){return e.apiObj.links&&e.apiObj.links.enclosure?Zotero.config.proxyDownloads?a.wwwDownloadUrl(e):a.apiDownloadUrl(e):!1},a.apiDownloadUrl=function(e){return e.apiObj.links.enclosure?e.apiObj.links.enclosure.href:!1},a.proxyDownloadUrl=function(e){return e.apiObj.links.enclosure?Zotero.config.proxyDownloads?Zotero.config.baseDownloadUrl+"?itemkey="+e.get("key"):a.apiDownloadUrl(e):!1},a.wwwDownloadUrl=function(e){return e.apiObj.links.enclosure?Zotero.config.baseZoteroWebsiteUrl+Zotero.config.librarySettings.libraryPathString+"/"+e.get("key")+"/file/view":!1},a.publicationsDownloadUrl=function(e){return e.apiObj.links.enclosure?e.apiObj.links.enclosure.href:!1},a.attachmentFileDetails=function(e){if(!e.apiObj.links.enclosure)return"";var t=Zotero.utils.translateMimeType(e.apiObj.links.enclosure.type),r=e.apiObj.links.enclosure,a="";if(r.length){var o=parseInt(r.length,10);return a=""+o+" B",o>1073741824?a=""+(o/1073741824).toFixed(1)+" GB":o>1048576?a=""+(o/1048576).toFixed(1)+" MB":o>1024&&(a=""+(o/1024).toFixed(1)+" KB"),"("+t+", "+a+")"}return"("+t+")"},a.userWebLibrary=function(e){return[Zotero.config.baseWebsiteUrl,e,"items"].join("/")},a.groupWebLibrary=function(e){return"Private"==e.type?[Zotero.config.baseWebsiteUrl,"groups",e.get("id"),"items"].join("/"):[Zotero.config.baseWebsiteUrl,"groups",Zotero.utils.slugify(e.get("name")),"items"].join("/")},a.exportUrls=function(e){Z.debug("Zotero.url.exportUrls",3);var t={},r={};return Zotero.config.exportFormats.forEach(function(a){r=Z.extend(e,{format:a}),t[a]=Zotero.ajax.apiRequestUrl(r)+Zotero.ajax.apiQueryString({format:a,limit:"25"})}),t},a.relationUrl=function(e,t,r){return"http://zotero.org/"+e+"s/"+t+"/items/"+r},t.exports=a},{}],122:[function(e,t,r){t.exports=function(){this.instance="Zotero.User"},t.exports.prototype=new Zotero.ApiObject,t.exports.prototype.loadObject=function(e){this.title=e.title,this.author=e.author,this.tagID=e.tagID,this.published=e.published,this.updated=e.updated,this.links=e.links,this.numItems=e.numItems,this.items=e.items,this.tagType=e.tagType,this.modified=e.modified,this.added=e.added,this.key=e.key},t.exports.prototype.parseXmlUser=function(e){this.parseXmlEntry(e);var t=e.find("content>tag");0!==t.length&&(this.tagKey=t.attr("key"),this.libraryID=t.attr("libraryID"),this.tagName=t.attr("name"),this.dateAdded=t.attr("dateAdded"),this.dateModified=t.attr("dateModified"))}},{}],123:[function(e,t,r){var a={randomString:function(e,t){t||(t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"),e||(e=8);for(var r="",a=0;e>a;a++){var o=Math.floor(Math.random()*t.length);r+=t.substring(o,o+1)}return r},getKey:function(){var e="23456789ABCDEFGHIJKMNPQRSTUVWXZ";return a.randomString(8,e)},slugify:function(e){var t=e.trim();return t=t.toLowerCase(),t=t.replace(/[^a-z0-9 ._-]/g,""),t=t.replace(/\s/g,"_")},prependAutocomplete:function(e,t){Z.debug("Zotero.utils.prependAutocomplete",3),Z.debug("prepend match: "+e);var r;if(t||Z.debug("source is not defined"),""===e)return r=t.slice(0);var a=e.length,o=e.toLowerCase();return r=t.map(function(e){return e.substr(0,a).toLowerCase()==o?e:null})},matchAnyAutocomplete:function(e,t){Z.debug("Zotero.utils.matchAnyAutocomplete",3),Z.debug("matchAny match: "+e);var r;if(t||Z.debug("source is not defined"),""===e)return r=t.slice(0);var a=(e.length,e.toLowerCase());return r=t.map(function(e){return-1!=e.toLowerCase().indexOf(a)?e:null})},libraryString:function(e,t){var r="";return"user"==e?r="u":"group"==e&&(r="g"),r+=t},parseLibString:function(e){var t,r;if("u"==e.charAt(0))t="user";else{if("g"!=e.charAt(0))throw new Error("unexpected type character in libraryString");t="group"}return r=parseInt(e.substring(1)),{libraryType:t,libraryID:r}},stale:function(e,t){var r=Date.now(),a=r.getTime()-e.getTime();return a/6e4>t?!0:!1},entityify:function(e){var t={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"};return e.replace(/[<>&"]/g,function(e){return t[e]})},parseApiDate:function(e,t){var r=/([0-9]+)-([0-9]+)-([0-9]+)T([0-9]+):([0-9]+):([0-9]+)Z/,a=r.exec(e);return null===a?(Z.error("error parsing api date: "+e),null):t=new Date(Date.UTC(a[1],a[2]-1,a[3],a[4],a[5],a[6]))},readCookie:function(e){for(var t=e+"=",r=document.cookie.split(";"),a=0;a<r.length;a++){for(var o=r[a];" "==o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return null},translateMimeType:function(e){switch(e){case"text/html":return"html";case"application/pdf":case"application/x-pdf":case"application/acrobat":case"applications/vnd.pdf":case"text/pdf":case"text/x-pdf":return"pdf";case"image/jpg":case"image/jpeg":return"jpg";case"image/gif":return"gif";case"application/msword":case"application/doc":case"application/vnd.msword":case"application/vnd.ms-word":case"application/winword":case"application/word":case"application/x-msw6":case"application/x-msword":return"doc";case"application/vnd.oasis.opendocument.text":case"application/x-vnd.oasis.opendocument.text":return"odt";case"video/flv":case"video/x-flv":return"flv";case"image/tif":case"image/tiff":case"image/x-tif":case"image/x-tiff":case"application/tif":case"application/x-tif":case"application/tiff":case"application/x-tiff":return"tiff";case"application/zip":case"application/x-zip":case"application/x-zip-compressed":case"application/x-compress":case"application/x-compressed":case"multipart/x-zip":return"zip";case"video/quicktime":case"video/x-quicktime":return"mov";case"video/avi":case"video/msvideo":case"video/x-msvideo":return"avi";case"audio/wav":case"audio/x-wav":case"audio/wave":return"wav";case"audio/aiff":case"audio/x-aiff":case"sound/aiff":return"aiff";case"text/plain":return"plain text";case"application/rtf":return"rtf";default:return e}},getKeyPermissions:function(e,t){if(!e)return!1;if(!t)return!1;var r={target:"key",libraryType:"user",libraryID:e,apiKey:t},a=Zotero.ajax.apiRequestString(r);return Zotero.ajaxRequest(a).then(function(e){var t=JSON.parse(e.data);return t})},parseQuery:function(e){for(var t,r={},a=/\+/g,o=/([^&=]+)=?([^&]*)/g,i=function(e){return decodeURIComponent(e.replace(a," "))};t=o.exec(e);)r[i(t[1])]=i(t[2]);return r},querystring:function(e){var t=-1!=e.indexOf("#")?e.indexOf("#"):void 0,r=e.substring(e.indexOf("?")+1,t);return r}};t.exports=a},{}]},{},[1])(1)});var J=jQuery.noConflict();jQuery(document).ready(function(){Z.debug("===== DOM READY =====",3),Zotero.state=new Zotero.State,Zotero.init()}),Zotero.defaultPrefs={debug_level:3,debug_log:!0,debug_mock:!1,javascript_enabled:!1},Zotero.init=function(){if(Z.debug("Zotero init",3),window.zoteroConfig&&(Zotero.config=J.extend({},Zotero.config,window.zoteroConfig)),Zotero.state.rewriteAltUrl(),Zotero.pages&&Zotero.pages.base.init(),window.zoterojsClass&&void 0!==Zotero.pages&&Zotero.pages[zoterojsClass])try{Zotero.pages[zoterojsClass].init()}catch(e){Z.error("Error running page specific init for "+zoterojsClass),Z.error(e)}if("undefined"==typeof zoteroData&&(zoteroData={}),window.nonZendPage!==!0){Zotero.state.parseUrlVars(),Zotero.config.startPageTitle=document.title;var t;t="undefined"==typeof sessionStorage?{}:sessionStorage,Zotero.cache=new Zotero.Cache(t),Zotero.store=t,Zotero.preferences=new Zotero.Preferences(Zotero.store,"global"),Zotero.preferences.defaults=J.extend({},Zotero.preferences.defaults,Zotero.config.defaultPrefs);var r="en-US";zoteroData.locale&&(r=zoteroData.locale),"user_library"==Zotero.config.pageClass||"group_library"==Zotero.config.pageClass||"my_library"==Zotero.config.pageClass?(Z.debug("library page - ",3),Zotero.state.libraryString=Zotero.utils.libraryString(Zotero.config.librarySettings.libraryType,Zotero.config.librarySettings.libraryID),Zotero.state.filter=Zotero.state.libraryString,Zotero.Item.prototype.getItemTypes(r),Zotero.Item.prototype.getItemFields(r),Zotero.Item.prototype.getCreatorFields(r),Zotero.Item.prototype.getCreatorTypes()):Z.debug("non-library page",3),Zotero.ui.init.all(),J.ajaxSettings.traditional=!0,"false"==Zotero.state.getUrlVar("proxy")&&(Zotero.config.proxy=!1),window.onpopstate=function(){Z.debug("popstate",3),J(window).trigger("statechange")},J(window).on("statechange",J.proxy(Zotero.state.popstateCallback,Zotero.state)),Zotero.state.popstateCallback()}},Zotero.State=function(){this.q={},this.f={},this.pathVars={},this.startUrl="",this.replacePush=!1,this.curHref="",this.prevHref="",this.curState={},this.prevState={},this.useLocation=!0,this.filter=null,this.selectedItemKeys=[]},Zotero.State.prototype.rewriteAltUrl=function(){Z.debug("rewriteAltUrl");var e=this,t=!1,r=!1,a=!1,o=!1,i=Zotero.config.nonparsedBaseUrl,n=window.location.pathname,s=(new RegExp(".*"+i+"/?"),/^.*\/items\/collections?\/([A-Z0-9]{8})(?:\/[A-Z0-9]{8})?$/),l=/^.*\/items\/([A-Z0-9]{8})$/;switch(!0){case s.test(n):t=s.exec(n),a=t[1],r=t[2],o=!0;break;case l.test(n):t=l.exec(n),r=t[1],o=!0}a&&e.setUrlVar("collectionKey",a),r&&e.setUrlVar("itemKey",r),o&&e.replaceState()},Zotero.State.prototype.updateCurState=function(){var e=this;e.curState=J.extend({},e.q,e.pathVars)},Zotero.State.prototype.savePrevState=function(){var e=this;e.prevState=e.curState},Zotero.State.prototype.getSelectedItemKeys=function(){var e=this,t={},r=[];return J.each(e.selectedItemKeys,function(e,r){t[r]=!0}),J.each(t,function(e,t){r.push(e)}),0===r.length&&e.getUrlVar("itemKey")&&r.push(e.getUrlVar("itemKey")),r},Zotero.State.prototype.toggleItemSelected=function(e){var t=this,r=[],a=!1,o=t.getSelectedItemKeys();J.each(o,function(t,o){o==e?a=!0:r.push(o)}),a||r.push(e),t.selectedItemKeys=r},Zotero.State.prototype.pushTag=function(e){Z.debug("Zotero.State.pushTag",3);var t=this;if(t.pathVars.tag)if(t.pathVars.tag instanceof Array)t.pathVars.tag.push(e);else{var r=t.pathVars.tag;t.pathVars.tag=[r,e]}else t.pathVars.tag=[e]},Zotero.State.prototype.popTag=function(e){Z.debug("Zotero.State.popTag",3);var t=this;if(t.pathVars.tag){if(t.pathVars.tag instanceof Array){var r=t.pathVars.tag.filter(function(t,r,a){return t!=e});return void(t.pathVars.tag=r)}return t.pathVars.tag==e?void(t.pathVars.tag=[]):void 0}},Zotero.State.prototype.toggleTag=function(e){Z.debug("Zotero.State.toggleTag",3);var t=this;if(!t.pathVars.tag)return void(t.pathVars.tag=[e]);if(J.isArray(t.pathVars.tag)){if(-1!=J.inArray(e,t.pathVars.tag)){var r=t.pathVars.tag.filter(function(t,r,a){return t!=e});return void(t.pathVars.tag=r)}return void t.pathVars.tag.push(e)}if(t.pathVars.tag==e)return void(t.pathVars.tag=[]);if("string"==typeof t.pathVars.tag){var a=t.pathVars.tag;return void(t.pathVars.tag=[a,e])}},Zotero.State.prototype.unsetUrlVar=function(e){Z.debug("Zotero.State.unsetUrlVar",3);var t=this;t.pathVars[e]&&delete t.pathVars[e]},Zotero.State.prototype.clearUrlVars=function(e){Z.debug("Zotero.State.clearUrlVars",3);var t=this;e||(e=[]);var r=t.pathVars;J.each(r,function(t,a){-1==J.inArray(t,e)&&delete r[t]})},Zotero.State.prototype.parseUrlVars=function(){Z.debug("Zotero.State.parseUrlVars",3);var e=this;e.useLocation&&(e.q=Zotero.utils.parseQuery(Zotero.utils.querystring(window.location.href)),e.pathVars=e.parsePathVars())},Zotero.State.prototype.parsePathVars=function(e){Z.debug("Zotero.State.parsePathVars",3);window.history;e||(e=window.location.pathname);var t=Zotero.config.nonparsedBaseUrl;t=t.replace(window.location.origin,"");var r=[],a=new RegExp(".*"+t+"/?"),o=e.replace(a,"");r=o.split("/");for(var i={},n=0;n<r.length-1;n+=2){var s=i[r[n]];if(s)if(s instanceof Array)s.push(decodeURIComponent(r[n+1]));else{var l=[s];l.push(decodeURIComponent(r[n+1])),s=l}else s=decodeURIComponent(r[n+1]);i[r[n]]=s}if(i.itemkey){var c=i.itemkey;i.itemKey=c,delete i.itemkey}return i},Zotero.State.prototype.buildUrl=function(e,t){"undefined"==typeof t&&(t=!1);var r=Zotero.config.nonparsedBaseUrl+"/",a=[];J.each(e,function(e,t){t&&(t instanceof Array?J.each(t,function(t,r){a.push(e+"/"+encodeURIComponent(r))}):a.push(e+"/"+encodeURIComponent(t)))}),a.sort();var o=[];J.each(t,function(e,t){t&&(t instanceof Array?J.each(t,function(t,r){o.push(e+"="+encodeURIComponent(r))}):o.push(e+"="+encodeURIComponent(t)))}),o.sort();var i=a.join("/"),n="";o.length&&(n="?"+o.join("&"));var s=r+i+n;return s},Zotero.State.prototype.mutateUrl=function(e,t){var r=this;e||(e={}),t||(t=[]);var a=J.extend({},r.pathVars);J.each(e,function(e,t){a[e]=t}),J.each(t,function(e,t){delete a[t]});var o=r.buildUrl(a,!1);return o},Zotero.State.prototype.pushState=function(){Z.debug("Zotero.State.pushState",3);var e=this,t=window.history;e.prevHref=e.curHref||window.location.href;var r=J.extend({},e.q,e.pathVars),a=e.pathVars,o=e.q,i=e.buildUrl(a,o,!1);e.curHref=i,Z.debug("about to push url: "+i,3),e.useLocation?e.replacePush===!0?(Z.debug("Zotero.State.pushState - replacePush",3),e.replacePush=!1,t.replaceState(r,document.title,i)):(Z.debug("Zotero.State.pushState - pushState",3),t.pushState(r,document.title,i),e.stateChanged()):e.stateChanged(),Zotero.debug("leaving pushstate",3)},Zotero.State.prototype.replaceState=function(){Z.debug("Zotero.State.replaceState",3);var e=this,t=window.history;e.updateCurState();var r=J.extend({},e.curState),a=e.pathVars,o=e.buildUrl(a,!1);e.useLocation?(t.replaceState(r,null,o),e.curHref=o):e.curHref=o},Zotero.State.prototype.updateStateTitle=function(e){Zotero.debug("Zotero.State.updateStateTitle",3);document.title=e},Zotero.State.prototype.getUrlVar=function(e){var t=this;return t.pathVars.hasOwnProperty(e)&&""!==t.pathVars[e]?t.pathVars[e]:t.q.hasOwnProperty(e)?t.q[e]:void 0},Zotero.State.prototype.setUrlVar=function(e,t){var r=this;r.pathVars[e]=t},Zotero.State.prototype.getUrlVars=function(){var e=this,t=Zotero.utils.parseQuery(Zotero.utils.querystring(window.location.href));return J.extend(!0,{},e.pathVars,t)},Zotero.State.prototype.setQueryVar=function(e,t){var r=this;""===t?delete r.q[e]:r.q[e]=t},Zotero.State.prototype.addQueryVar=function(e,t){var r=this;if(r.q.hasOwnProperty(e))if(J.isArray(r.q[e]))r.q[e].push(t);else{var a=[r.q[e],t];r.q[e]=a}else r.q[e]=t;return r.q[e]},Zotero.State.prototype.popstateCallback=function(e){var t=this;Z.debug("===== popstateCallback =====",3);window.history;t.prevHref=t.curHref,Z.debug("new href, updating href and processing urlchange",3),t.curHref=window.location.href,t.parseUrlVars(),t.stateChanged(e)},Zotero.State.prototype.stateChanged=function(e){var t=this;Z.debug("stateChanged",3),t.savePrevState(),t.updateCurState(),Z.debug("Checking changed variables",3);var r=t.diffState(t.prevHref,t.curHref),a={};J.each(r,function(e,r){var o=r+"Changed";Z.debug(o,3),Zotero.eventful.eventMap.hasOwnProperty(o)&&J.each(Zotero.eventful.eventMap[o],function(e,t){a.hasOwnProperty(t)||(a[t]=1)}),Z.debug("State Filter: "+t.filter,3),Zotero.trigger(o,{},t.filter)}),J.each(a,function(e,r){Z.debug("State Filter: "+t.filter,3),Zotero.trigger(e,{},t.filter)}),Z.debug("===== stateChanged Done =====",3)},Zotero.State.prototype.diffState=function(e,t){Z.debug("Zotero.State.diffState",3);var r=this,a=J.extend({},r.parsePathVars(e)),o=J.extend({},r.parsePathVars(t)),i=["start","limit","order","sort","content","format","q","fq","itemType","itemKey","collectionKey","searchKey","locale","tag","tagType","key","style","session","newer","since","itemPage","mode"],n=[];return J.each(i,function(e,t){(a.hasOwnProperty(t)||o.hasOwnProperty(t))&&a[t]!=o[t]&&n.push(t)}),n},Zotero.Delay=function(e){return new Promise(function(t,r){setTimeout(function(){t()},e)})},Zotero.widgets={},Zotero.eventful={},Zotero.eventful.events=["collectionsDirty","tagsChanged","displayedItemsChanged","displayedItemChanged","selectedItemsChanged","showCitations","showSettings","exportItems","libraryTagsUpdated","uploadSuccessful","refreshGroups","clearLibraryQuery","libraryItemsUpdated","citeItems","itemTypeChanged","addTag","showChildren","selectCollection","selectedCollectionChanged","libraryCollectionsUpdated","loadItemsDone","collectionsChanged","tagsChanged","itemsChanged","loadedCollectionsProcessed","deleteProgress","settingsLoaded","cachedDataLoaded","createItem","newItem","addToCollectionDialog","removeFromCollection","moveToTrash","removeFromTrash","toggleEdit","clearLibraryQuery","librarySettingsDialog","citeItems","exportItemsDialog","syncLibrary","createCollectionDialog","updateCollectionDialog","deleteCollectionDialog","showMoreTags","showFewerTags","indexedDBError"],Zotero.eventful.eventMap={orderChanged:["displayedItemsChanged"],sortChanged:["displayedItemsChanged"],collectionKeyChanged:["displayedItemsChanged","selectedCollectionChanged"],qChanged:["displayedItemsChanged"],tagChanged:["displayedItemsChanged","selectedTagsChanged"],itemPageChanged:["displayedItemsChanged"],itemKeyChanged:["displayedItemChanged"]},Zotero.eventful.initWidgets=function(){Zotero.state.parsePathVars(),J(".eventfulwidget").each(function(e,t){var r=J(t).data("widget");r&&Zotero.ui.widgets[r]&&Zotero.ui.widgets[r].init&&(Z.debug("eventfulwidget init: "+r,3),Zotero.ui.widgets[r].init(t))}),Zotero.eventful.initTriggers()},Zotero.eventful.initTriggers=function(e){Zotero.debug("Zotero.eventful.initTriggers",3),e||(e=J("html"));var t=function(e){Z.debug("triggerOnEvent",3),e.preventDefault();var t=J(e.delegateTarget),r=t.data("triggers");Z.debug("eventName: "+r,3);var a=t.data("library")||"";Zotero.trigger(r,{triggeringElement:e.currentTarget},a)};J(e).find(".eventfultrigger").each(function(e,r){if(!J(r).data("triggerbound")){var a=J(r).data("event");a?(Z.debug("binding "+a+" on "+r.tagName,3),J(r).on(a,t)):J(r).on("click",t),J(r).data("triggerbound",!0)}})},Zotero.ui.formatItemField=function(e,t,r){"undefined"==typeof r&&(r=!1);var a,o={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1};if(window.Intl){var i=new window.Intl.DateTimeFormat(void 0,o);a=i.format}else a=function(e){return e.toLocaleString()};var n,s=0,l="";switch(Zotero.config.maxFieldSummaryLength[e]&&(s=Zotero.config.maxFieldSummaryLength[e]),e){case"itemType":l=Zotero.localizations.typeMap[t.apiObj.data.itemType];break;case"dateModified":t.apiObj.data.dateModified||(l=""),n=Zotero.utils.parseApiDate(t.apiObj.data.dateModified),l=n?a(n):t.apiObj.data.dateModified;break;case"dateAdded":t.apiObj.data.dateAdded||(l=""),n=Zotero.utils.parseApiDate(t.apiObj.data.dateAdded),l=n?a(n):t.apiObj.data.dateAdded;break;case"title":l=t.get("title");break;case"creator":case"creatorSummary":l=t.get("creatorSummary");break;case"addedBy":t.apiObj.meta.createdByUser&&(l=""!==t.apiObj.meta.createdByUser.name?t.apiObj.meta.createdByUser.name:t.apiObj.meta.createdByUser.username);break;case"modifiedBy":t.apiObj.meta.lastModifiedByUser&&(l=""!==t.apiObj.meta.lastModifiedByUser.name?t.apiObj.meta.lastModifiedByUser.name:t.apiObj.meta.lastModifiedByUser.username);break;default:var c=_typeof(t.get(e));"undefined"!=typeof c&&(l=t.get(e))}return"undefined"==typeof l&&(Z.error("formattedString for "+e+" undefined"),Z.error(t)),r?Zotero.ui.trimString(l,s):l},Zotero.ui.trimString=function(e,t){var r=35,a=e;return"undefined"==typeof e?(Z.error("formattedString passed to trimString was undefined."),""):(t&&(r=t),r>0&&a.length>r?a.slice(0,r)+"…":a)},Zotero.ui.formatItemDateField=function(e,t){var r,a,o,i={hour:"numeric",minute:"numeric",second:"numeric",hour12:!1},n={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1};if(window.Intl){var s=new window.Intl.DateTimeFormat(void 0,n);a=s.format;var l=new window.Intl.DateTimeFormat(void 0,i);o=l.format}else a=function(e){return e.toLocaleDateString()},o=function(e){return e.toLocaleTimeString()};switch(e){case"dateModified":return t.apiObj.data.dateModified?(r=Zotero.utils.parseApiDate(t.apiObj.data.dateModified),r?"<span class='localized-date-span'>"+a(r)+"</span> <span class='localized-date-span'>"+o(r)+"</span>":t.apiObj.data.dateModified):"";case"dateAdded":return t.apiObj.data.dateAdded?(r=Zotero.utils.parseApiDate(t.apiObj.data.dateAdded),r?"<span class='localized-date-span'>"+a(r)+"</span> <span class='localized-date-span'>"+o(r)+"</span>":t.apiObj.data.dateAdded):""}return""},Zotero.ui.formatItemContentRow=function(e){if("date"==e.field){if(!e.fieldValue)return"";var t=Zotero.utils.parseApiDate(e.value);return t?t.toLocaleString():e.fieldValue}return e.fieldValue},Zotero.ui.groupUrl=function(e,t){var r;r="Private"==e.groupType?"/groups/"+e.groupID:"/groups/"+Zotero.utils.slugify(e.groupName);var a="/groups/"+e.groupID;switch(Zotero.debug("groupBase: "+r),t){case"groupView":return r;case"groupLibrary":return r+"/items";case"groupSettings":return a+"/settings";case"groupMembers":return a+"/members";case"groupLibrarySettings":return a+"/settings/library";case"groupMembersSettings":return a+"/settings/members"}},Zotero.ui.init={},Zotero.ui.widgets={},Zotero.ui.init.all=function(){switch(Z.debug("ui init based on page",3),Zotero.config.pageClass){case"my_library":case"user_library":case"group_library":Zotero.ui.init.library();break;case"default":}Zotero.eventful.initWidgets(),Zotero.ui.init.rte()},Zotero.ui.init.library=function(){},Zotero.ui.init.rte=function(e,t,r){return Z.debug("init.rte",3),"ckeditor"==Zotero.config.rte?void Zotero.ui.init.ckeditor(e,t,r):void Zotero.ui.init.tinyMce(e,t,r)},Zotero.ui.init.ckeditor=function(e,t,r){Z.debug("init.ckeditor",3),e||(e="default"),r||(r=J("body"));var a={};a.toolbarGroups=[{name:"clipboard",groups:["clipboard","undo"]},{name:"links"},{name:"insert"},{name:"forms"},{name:"tools"},{name:"document",groups:["mode","document","doctools"]},{name:"others"},"/",{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align"]},{name:"styles"},{name:"colors"},{name:"about"}];var o={};o.toolbarGroups=[{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection"]},{name:"insert"},{name:"forms"},{name:"tools"},{name:"document",groups:["mode","document","doctools"]},{name:"others"},"/",{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align"]},{name:"styles"},{name:"colors"},{name:"about"}];var i={};i.toolbarGroups=[],i.readOnly=!0;var n;if(n="nolinks"==e?J.extend(!0,{},o):"readonly"==e?J.extend(!0,{},i):J.extend(!0,{},a),t&&(n.startupFocus=!0),Z.debug("initializing CK editors",3),J(r).is(".rte")){Z.debug("RTE textarea -  - "+J(r).attr("name"),3);var s=J(r).attr("name");if(!CKEDITOR.instances[s]){CKEDITOR.replace(J(r),n)}}else Z.debug("not a direct rte init"),Z.debug(r),J(r).find("textarea.rte").each(function(e,t){Z.debug("RTE textarea - "+e+" - "+J(t).attr("name"),3);var r=J(t).attr("name");if(!CKEDITOR.instances[r]){CKEDITOR.replace(t,n)}})},Zotero.ui.init.tinyMce=function(e,t,r){Z.debug("init.tinyMce",3),e||(e="default");var a="specific_textareas";r?a="exact":r="";var o={mode:a,elements:r,theme:"advanced",theme_advanced_toolbar_location:"top",theme_advanced_buttons1:"bold,italic,underline,strikethrough,separator,sub,sup,separator,forecolorpicker,backcolorpicker,separator,blockquote,separator,link,unlink",theme_advanced_buttons2:"formatselect,separator,justifyleft,justifycenter,justifyright,separator,bullist,numlist,outdent,indent,separator,removeformat,code,",theme_advanced_buttons3:"",theme_advanced_toolbar_align:"left",theme_advanced_statusbar_location:"bottom",theme_advanced_resizing:!0,relative_urls:!1,editor_selector:"default"};return t&&(o.init_instance_callback=function(e){Z.debug("inited "+e.editorId),e.focus()}),"nolinks"!=e&&(o.theme_advanced_buttons1+=",link"),"nolinks"==e&&(o.editor_selector="nolinks"),"readonly"==e&&(o.readonly=1,o.editor_selector="readonly"),tinymce.init(o),o},Zotero.ui.init.libraryTemplates=function(){},Zotero.ui.saveItem=function(e){Z.debug("pre writeItem debug",4),Z.debug(e,4);var t=e.owningLibrary,r=e.writeItem().then(function(t){if(Z.debug("item write finished",3),e.writeFailure)throw Z.error("Error writing item:"+e.writeFailure.message),Zotero.ui.jsNotificationMessage("Error writing item","error"),new Error("Error writing item:"+e.writeFailure.message)});Z.debug("adding new tags to library tags",3);var a=t.tags,o=e.apiObj.data.tags;return J.each(o,function(e,t){var r=t.tag;if(!a.tagObjects.hasOwnProperty(r)){var o=new Zotero.Tag(t);a.addTag(o)}}),a.updateSecondaryData(),r},Zotero.ui.itemTypeClass=function(e){var t=e.apiObj.data.itemType;if("attachment"==e.apiObj.data.itemType)if("application/pdf"==e.mimeType)t+="-pdf";else switch(e.linkMode){case 0:t+="-file";break;case 1:t+="-file";break;case 2:t+="-snapshot";break;case 3:t+="-web-link"}return"img-"+t},Zotero.ui.getAssociatedLibrary=function(e){Z.debug("Zotero.ui.getAssociatedLibrary",3);var t;if("undefined"==typeof e)t=J(".zotero-library").first();else if(t=J(e),(0===t.length||t.is("#eventful"))&&(t=J(".zotero-library").first(),0===t.length))throw Z.debug("No element passed and no default found for getAssociatedLibrary."),new Error("No element passed and no default found for getAssociatedLibrary.");var r,a=t.data("zoterolibrary");return a||(r=J(e).data("library"),r&&(a=Zotero.ui.libStringLibrary(r)),t.data("zoterolibrary",a)),a||(t=J(".zotero-library").first(),r=t.data("library"),r&&(a=Zotero.ui.libStringLibrary(r))),a||Z.error("No associated library found"),a},Zotero.ui.libStringLibrary=function(e){var t;if(Zotero.libraries.hasOwnProperty(e))t=Zotero.libraries[e];else{var r=Zotero.utils.parseLibString(e);t=new Zotero.Library(r.libraryType,r.libraryID),Zotero.libraries[e]=t}return t},Zotero.ui.getEventLibrary=function(e){var t=J(e.triggeringElement);if(e.library)return e.library;if(e.data&&e.data.library)return e.data.library;Z.debug(e);var r=t.data("library");if(!r)throw"no library on event or libString on triggeringElement";if(Zotero.libraries.hasOwnProperty(r))return Zotero.libraries[r];var a=Zotero.ui.parseLibString(r),o=new Zotero.Library(a.libraryType,a.libraryID,"");Zotero.libraries[Zotero.utils.libraryString(a.libraryType,a.libraryID)]=o},Zotero.ui.getPrioritizedVariable=function(e,t){var r=Zotero.state.getUrlVar(e)||Zotero.preferences.getPref(e)||Zotero.config.defaultApiArgs[e]||t;return r},Zotero.ui.scrollToTop=function(){window.scrollBy(0,-5e3)},Zotero.ui.parentWidgetEl=function(e){var t;if(e.hasOwnProperty("data")&&e.data.hasOwnProperty("widgetEl"))return Z.debug("event had widgetEl associated with it"),J(e.data.widgetEl);if(e.hasOwnProperty("currentTarget")){if(Z.debug("event currentTarget set"),t=J(e.currentTarget).closest(".eventfulwidget"),t.length>0)return t.first();Z.debug("no matching closest to currentTarget"),Z.debug(e.currentTarget),Z.debug(e.currentTarget)}return t=J(e).closest(".eventfulwidget"),t.length>0?(Z.debug("returning first closest widget"),t.first()):null},Zotero.ui.getSelectedItemKeys=function(e){Z.debug("Zotero.ui.getSelectedItemKeys",3),e=J(e?e:"body");var t=[],r=Zotero.state.getUrlVar("itemKey");return r&&Zotero.config.preferUrlItem!==!1?t.push(r):e.find("input.itemKey-checkbox:checked").each(function(e,r){t.push(J(r).data("itemkey"))}),t},Zotero.ui.getAllFormItemKeys=function(e){Z.debug("Zotero.ui.getAllFormItemKeys",3),e=J(e?e:"body");var t=[];Zotero.state.getUrlVar("itemKey");return e.find("input.itemKey-checkbox").each(function(e,r){t.push(J(r).data("itemkey"))}),t},Zotero.ui.getRte=function(e){switch(Z.debug("getRte",3),Z.debug("getRte",3),Z.debug(e),Zotero.config.rte){case"ckeditor":return CKEDITOR.instances[e].getData();default:return tinyMCE.get(e).getContent()}},Zotero.ui.updateRte=function(e){switch(Z.debug("updateRte",3),Zotero.config.rte){case"ckeditor":var t="#"+e,r=CKEDITOR.instances[e].getData();J(t).val(r);break;default:tinyMCE.updateContent(e)}},Zotero.ui.deactivateRte=function(e){switch(Z.debug("deactivateRte",3),Zotero.config.rte){case"ckeditor":if(CKEDITOR.instances[e]){Z.debug("deactivating "+e,3);CKEDITOR.instances[e].destroy()}break;default:tinymce.execCommand("mceRemoveControl",!0,e)}},Zotero.ui.cleanUpRte=function(e){Z.debug("cleanUpRte",3),J(e).find("textarea.rte").each(function(e,t){Zotero.ui.deactivateRte(J(t).attr("name"))})},Zotero.ui.jsNotificationMessage=function(e,t,r){if(Z.debug("notificationMessage: "+t+" : "+e,3),!Zotero.config.suppressErrorNotifications){r||r===!1||(r=5);var a="alert-info";if(t)switch(t){case"error":case"danger":a="alert-danger",r=!1;break;case"success":case"confirm":a="alert-success";break;case"info":a="alert-info";break;case"warning":case"warn":a="alert-warning"}r?J("#js-message").append("<div class='alert alert-dismissable "+a+"'><button type='button' class='close' data-dismiss='alert'><span aria-hidden='true'>&times;</span><span class='sr-only'>Close</span></button>"+e+"</div>").children("div").delay(1e3*parseInt(r,10)).slideUp().delay(300).queue(function(){J(this).remove()}):J("#js-message").append("<div class='alert alert-dismissable "+a+"'><button type='button' class='close' data-dismiss='alert'><span aria-hidden='true'>&times;</span><span class='sr-only'>Close</span></button>"+e+"</div>")}},Zotero.ui.ajaxErrorMessage=function(e){if(Z.debug("Zotero.ui.ajaxErrorMessage",3),"undefined"==typeof e)return Z.debug("ajaxErrorMessage called with undefined argument"),"";switch(Z.debug(e,3),e.status){case 403:return Zotero.config.loggedIn||Zotero.config.ignoreLoggedInStatus?"You do not have permission to view this library.":(Zotero.config.suppressErrorNotifications=!0,window.location="/user/login","");case 404:Zotero.ui.jsNotificationMessage("A requested resource could not be found.","error");break;case 400:Zotero.ui.jsNotificationMessage("Bad Request","error");break;case 405:Zotero.ui.jsNotificationMessage("Method not allowed","error");break;case 412:Zotero.ui.jsNotificationMessage("Precondition failed","error");break;case 500:Zotero.ui.jsNotificationMessage("Something went wrong but we're not sure what.","error");break;case 501:Zotero.ui.jsNotificationMessage("We can't do that yet.","error");break;case 503:Zotero.ui.jsNotificationMessage("We've gone away for a little while. Please try again in a few minutes.","error");break;default:Z.debug("jqxhr status did not match any expected case"),
Z.debug(e.status)}return""},Zotero.ui.showSpinner=function(e,t){var r=Zotero.config.baseWebsiteUrl+"/static/images/theme/broken-circle-spinner.gif";t?"horizontal"==t&&J(e).html("<img class='spinner' src='"+r+"'/>"):J(e).html("<img class='spinner' src='"+r+"'/>")},Zotero.ui.appendSpinner=function(e){var t=Zotero.config.baseWebsiteUrl+"static/images/theme/broken-circle-spinner.gif";J(e).append("<img class='spinner' src='"+t+"'/>")},Zotero.ui.fixTableHeaders=function(e){var t=J(e),r=[];t.find("thead th").each(function(e,t){var a=J(t).width();r.push(a),J(t).width(a)}),t.find("tbody>tr:first>td").each(function(e,t){J(t).width(r[e])});var a=t.find("thead").height();t.find("thead").css("position","fixed").css("margin-top",-a).css("background-color","white").css("z-index",10),t.find("tbody").css("margin-top",a),t.css("margin-top",a)},Zotero.ui.zoteroItemUpdated=function(){try{var e=document.createEvent("HTMLEvents");e.initEvent("ZoteroItemUpdated",!0,!0),document.dispatchEvent(e)}catch(t){Zotero.debug("Error triggering ZoteroItemUpdated event")}},Zotero.ui.dialog=function(e,t){Z.debug("Zotero.ui.dialog",3),t.show=!0,t.backdrop=!1,J(e).modal(t),J(e).modal("show"),Z.debug("exiting Zotero.ui.dialog",3)},Zotero.ui.closeDialog=function(e){J(e).modal("hide")},function(e){function t(e,t){if(8==c){var r=g.width(),a=s.debounce(function(){var e=g.width();r!=e&&(r=e,t())},1);g.on(e,a)}else g.on(e,s.debounce(t,1))}function r(e){window&&window.console&&window.console.error&&window.console.error("jQuery.floatThead: "+e)}function a(e){var t=e.getBoundingClientRect();return t.width||t.right-t.left}function o(){var t=e('<div style="width:50px;height:50px;overflow-y:scroll;position:absolute;top:-200px;left:-200px;"><div style="height:100px;width:100%"></div>');e("body").append(t);var r=t.innerWidth(),a=e("div",t).innerWidth();return t.remove(),r-a}function i(e){if(e.dataTableSettings)for(var t=0;t<e.dataTableSettings.length;t++){var r=e.dataTableSettings[t].nTable;if(e[0]==r)return!0}return!1}function n(e,t,r){var a=r?"outerWidth":"width";if(p&&e.css("max-width")){var o=0;r&&(o+=parseInt(e.css("borderLeft"),10),o+=parseInt(e.css("borderRight"),10));for(var i=0;i<t.length;i++)o+=t.get(i).offsetWidth;return o}return e[a]()}e.floatThead=e.floatThead||{},e.floatThead.defaults={headerCellSelector:"tr:visible:first>*:visible",zIndex:1001,position:"auto",top:0,bottom:0,scrollContainer:function(t){return e([])},getSizingRow:function(e,t,r){return e.find("tbody tr:visible:first>*:visible")},floatTableClass:"floatThead-table",floatWrapperClass:"floatThead-wrapper",floatContainerClass:"floatThead-container",copyTableClass:!0,enableAria:!1,autoReflow:!1,debug:!1};var s=window._,l="undefined"!=typeof MutationObserver,c=function(){for(var e=3,t=document.createElement("b"),r=t.all||[];e=1+e,t.innerHTML="<!--[if gt IE "+e+"]><i><![endif]-->",r[0];);return e>4?e:document.documentMode}(),d=/Gecko\//.test(navigator.userAgent),u=/WebKit\//.test(navigator.userAgent),p=function(){if(u){var t=e('<div style="width:0px"><table style="max-width:100%"><tr><th><div style="min-width:100px;">X</div></th></tr></table></div>');e("body").append(t);var r=0==t.find("table").width();return t.remove(),r}return!1},m=!d&&!c,g=e(window);e.fn.floatThead=function(d){if(d=d||{},!s&&(s=window._||e.floatThead._,!s))throw new Error("jquery.floatThead-slim.js requires underscore. You should use the non-lite version since you do not have underscore.");if(8>c)return this;var f=null;if(s.isFunction(p)&&(p=p()),s.isString(d)){var h=d,b=this;return this.filter("table").each(function(){var t=e(this),r=t.data("floatThead-lazy");r&&t.floatThead(r);var a=t.data("floatThead-attached");if(a&&s.isFunction(a[h])){var o=a[h]();"undefined"!=typeof o&&(b=o)}}),b}var y=e.extend({},e.floatThead.defaults||{},d);if(e.each(d,function(t,a){t in e.floatThead.defaults||!y.debug||r("Used ["+t+"] key to init plugin, but that param is not an option for the plugin. Valid options are: "+s.keys(e.floatThead.defaults).join(", "))}),y.debug){var v=e.fn.jquery.split(".");1==parseInt(v[0],10)&&parseInt(v[1],10)<=7&&r("jQuery version "+e.fn.jquery+" detected! This plugin supports 1.8 or better, or 1.7.x with jQuery UI 1.8.24 -> http://jqueryui.com/resources/download/jquery-ui-1.8.24.zip")}return this.filter(":not(."+y.floatTableClass+")").each(function(){function d(e){return e+".fth-"+T+".floatTHead"}function p(){var t=0;if(N.children("tr:visible").each(function(){t+=e(this).outerHeight(!0)}),"collapse"==D.css("border-collapse")){var r=parseInt(D.css("border-top-width"),10),a=parseInt(D.find("thead tr:first").find(">*:first").css("border-top-width"),10);r>a&&(t-=r/2)}oe.outerHeight(t),ie.outerHeight(t)}function h(){var e=n(D,le,!0),t=U.width()||e,r="hidden"!=U.css("overflow-y")?t-P.vertical:t;if(te.width(r),F){var a=100*e/r;Q.css("width",a+"%")}else Q.outerWidth(e)}function b(){L=(s.isFunction(y.top)?y.top(D):y.top)||0,_=(s.isFunction(y.bottom)?y.bottom(D):y.bottom)||0}function v(){var t,r=N.find(y.headerCellSelector);if(X?t=Y.find("col").length:(t=0,r.each(function(){t+=parseInt(e(this).attr("colspan")||1,10)})),t!=J){J=t;for(var a,o=[],i=[],n=[],s=0;t>s;s++)y.enableAria&&(a=r.eq(s).text())?o.push('<th scope="col" class="floatThead-col">'+a+"</th>"):o.push('<th class="floatThead-col"/>'),i.push("<col/>"),n.push("<fthtd style='display:table-cell;height:0;width:auto;'/>");i=i.join(""),o=o.join(""),m&&(n=n.join(""),ee.html(n),le=ee.find("fthtd")),oe.html(o),ie=oe.find("th"),X||Y.html(i),ne=Y.find("col"),$.html(i),se=$.find("col")}return t}function Z(){if(!A){if(A=!0,V){var e=n(D,le,!0),t=G.width();e>t&&D.css("minWidth",e)}D.css(ue),Q.css(ue),Q.append(N),O.before(ae),p()}}function w(){A&&(A=!1,V&&D.width(me),ae.detach(),D.prepend(N),D.css(pe),Q.css(pe),D.css("minWidth",ge),D.css("minWidth",n(D,le)))}function R(e){fe!=e&&(fe=e,D.triggerHandler("floatThead",[e,te]))}function E(e){V!=e&&(V=e,te.css({position:V?"absolute":"fixed"}))}function x(e,t,r,a){return m?r:a?y.getSizingRow(e,t,r):t}function I(){var e,t=v();return function(){ne=Y.find("col");var r=x(D,ne,le,c);if(r.length==t&&t>0){if(!X)for(e=0;t>e;e++)ne.eq(e).css("width","");w();var o=[];for(e=0;t>e;e++)o[e]=a(r.get(e));for(e=0;t>e;e++)se.eq(e).width(o[e]),ne.eq(e).width(o[e]);Z()}else Q.append(N),D.css(pe),Q.css(pe),p();D.triggerHandler("reflowed",[te])}}function C(e){var t=U.css("border-"+e+"-width"),r=0;return t&&~t.indexOf("px")&&(r=parseInt(t,10)),r}function j(){var e,t=U.scrollTop(),r=0,a=q?K.outerHeight(!0):0,o=B?a:-a,i=te.height(),n=D.offset(),s=0,l=0;if(F){var c=U.offset();r=n.top-c.top+t,q&&B&&(r+=a),s=C("left"),l=C("top"),r-=l}else e=n.top-L-i+_+P.horizontal;var d=g.scrollTop(),p=g.scrollLeft(),m=U.scrollLeft();return function(c){var f=D[0].offsetWidth<=0&&D[0].offsetHeight<=0;if(!f&&re)return re=!1,setTimeout(function(){D.triggerHandler("reflow")},1),null;if(f&&(re=!0,!V))return null;if("windowScroll"==c?(d=g.scrollTop(),p=g.scrollLeft()):"containerScroll"==c?(t=U.scrollTop(),m=U.scrollLeft()):"init"!=c&&(d=g.scrollTop(),p=g.scrollLeft(),t=U.scrollTop(),m=U.scrollLeft()),!u||!(0>d||0>p)){if(H)E("windowScrollDone"==c?!0:!1);else if("windowScrollDone"==c)return null;n=D.offset(),q&&B&&(n.top+=a);var h,b,y=D.outerHeight();if(F&&V){if(r>=t){var v=r-t+l;h=v>0?v:0,R(!1)}else h=W?l:t,R(!0);b=s}else!F&&V?(d>e+y+o?h=y-i+o:n.top>=d+L?(h=0,w(),R(!1)):(h=L+d-n.top+r+(B?a:0),Z(),R(!0)),b=0):F&&!V?(r>t||t-r>y?(h=n.top-d,w(),R(!1)):(h=n.top+t-d-r,Z(),R(!0)),b=n.left+m-p):F||V||(d>e+y+o?h=y+L-d+e+o:n.top>d+L?(h=n.top-d,Z(),R(!1)):(h=L,R(!0)),b=n.left-p);return{top:h,left:b}}}}function S(){var e=null,t=null,r=null;return function(a,o,i){null==a||e==a.top&&t==a.left||(te.css({top:a.top,left:a.left}),e=a.top,t=a.left),o&&h(),i&&p();var n=U.scrollLeft();V&&r==n||(te.scrollLeft(n),r=n)}}function k(){if(U.length)if(U.data().perfectScrollbar)P={horizontal:0,vertical:0};else{var e=U.width(),t=U.height(),r=D.height(),a=n(D,le),o=a>e?M:0,i=r>t?M:0;P.horizontal=a>e-i?M:0,P.vertical=r>t-o?M:0}}var T=s.uniqueId(),D=e(this);if(D.data("floatThead-attached"))return!0;if(!D.is("table"))throw new Error('jQuery.floatThead must be run on a table element. ex: $("table").floatThead();');l=y.autoReflow&&l;var N=D.children("thead:first"),O=D.children("tbody:first");if(0==N.length||0==O.length)return D.data("floatThead-lazy",y),void D.unbind("reflow").one("reflow",function(){D.floatThead(y)});D.data("floatThead-lazy")&&D.unbind("reflow"),D.data("floatThead-lazy",!1);var L,_,A=!0,P={vertical:0,horizontal:0},M=o(),J=0,U=y.scrollContainer(D)||e([]),F=U.length>0,V=null;"undefined"!=typeof y.useAbsolutePositioning&&(y.position="auto",y.useAbsolutePositioning&&(y.position=y.useAbsolutePositioning?"absolute":"fixed"),r("option 'useAbsolutePositioning' has been removed in v1.3.0, use `position:'"+y.position+"'` instead. See docs for more info: http://mkoryak.github.io/floatThead/#options")),"undefined"!=typeof y.scrollingTop&&(y.top=y.scrollingTop,r("option 'scrollingTop' has been renamed to 'top' in v1.3.0. See docs for more info: http://mkoryak.github.io/floatThead/#options")),"undefined"!=typeof y.scrollingBottom&&(y.bottom=y.scrollingBottom,r("option 'scrollingBottom' has been renamed to 'bottom' in v1.3.0. See docs for more info: http://mkoryak.github.io/floatThead/#options")),"auto"==y.position?V=null:"fixed"==y.position?V=!1:"absolute"==y.position?V=!0:y.debug&&r('Invalid value given to "position" option, valid is "fixed", "absolute" and "auto". You passed: ',y.position),null==V&&(V=F);var K=D.find("caption"),q=1==K.length;if(q)var B="top"===(K.css("caption-side")||K.attr("align")||"top");var z=e('<fthfoot style="display:table-footer-group;border-spacing:0;height:0;border-collapse:collapse;visibility:hidden"/>'),W=!1,G=e([]),H=9>=c&&!F&&V,Q=e("<table/>"),$=e("<colgroup/>"),Y=D.children("colgroup:first"),X=!0;0==Y.length&&(Y=e("<colgroup/>"),X=!1);var ee=e('<fthtr style="display:table-row;border-spacing:0;height:0;border-collapse:collapse"/>'),te=e('<div style="overflow: hidden;" aria-hidden="true"></div>'),re=!1,ae=e("<thead/>"),oe=e('<tr class="size-row"/>'),ie=e([]),ne=e([]),se=e([]),le=e([]);ae.append(oe),D.prepend(Y),m&&(z.append(ee),D.append(z)),Q.append($),te.append(Q),y.copyTableClass&&Q.attr("class",D.attr("class")),Q.attr({cellpadding:D.attr("cellpadding"),cellspacing:D.attr("cellspacing"),border:D.attr("border")});var ce=D.css("display");if(Q.css({borderCollapse:D.css("borderCollapse"),border:D.css("border"),display:ce}),"none"==ce&&(re=!0),Q.addClass(y.floatTableClass).css({margin:0,"border-bottom-width":0}),V){var de=function(e,t){var r=e.css("position"),a="relative"==r||"absolute"==r,o=e;if(!a||t){var i={paddingLeft:e.css("paddingLeft"),paddingRight:e.css("paddingRight")};te.css(i),o=e.data("floatThead-containerWrap")||e.wrap("<div class='"+y.floatWrapperClass+"' style='position: relative; clear:both;'></div>").parent(),e.data("floatThead-containerWrap",o),W=!0}return o};F?(G=de(U,!0),G.prepend(te)):(G=de(D),D.before(te))}else D.before(te);te.css({position:V?"absolute":"fixed",marginTop:0,top:V?0:"auto",zIndex:y.zIndex}),te.addClass(y.floatContainerClass),b();var ue={"table-layout":"fixed"},pe={"table-layout":D.css("tableLayout")||"auto"},me=D[0].style.width||"",ge=D.css("minWidth")||"",fe=!1;k();var he,be=function(){(he=I())()};be();var ye=j(),ve=S();ve(ye("init"),!0);var Ze=s.debounce(function(){ve(ye("windowScrollDone"),!1)},1),we=function(){ve(ye("windowScroll"),!1),H&&Ze()},Re=function(){ve(ye("containerScroll"),!1)},Ee=function(){D.is(":hidden")||(b(),k(),be(),ye=j(),(ve=S())(ye("resize"),!0,!0))},xe=s.debounce(function(){D.is(":hidden")||(k(),b(),be(),ye=j(),ve(ye("reflow"),!0))},1);if(F?V?U.on(d("scroll"),Re):(U.on(d("scroll"),Re),g.on(d("scroll"),we)):g.on(d("scroll"),we),g.on(d("load"),xe),t(d("resize"),Ee),D.on("reflow",xe),i(D)&&D.on("filter",xe).on("sort",xe).on("page",xe),g.on(d("shown.bs.tab"),xe),g.on(d("tabsactivate"),xe),l){var Ie=null;s.isFunction(y.autoReflow)&&(Ie=y.autoReflow(D,U)),Ie||(Ie=U.length?U[0]:D[0]),f=new MutationObserver(function(e){for(var t=function(e){return e&&e[0]&&("THEAD"==e[0].nodeName||"TD"==e[0].nodeName||"TH"==e[0].nodeName)},r=0;r<e.length;r++)if(!t(e[r].addedNodes)&&!t(e[r].removedNodes)){xe();break}}),f.observe(Ie,{childList:!0,subtree:!0})}D.data("floatThead-attached",{destroy:function(){var e=".fth-"+T;w(),D.css(pe),Y.remove(),m&&z.remove(),ae.parent().length&&ae.replaceWith(N),l&&(f.disconnect(),f=null),D.off("reflow reflowed"),U.off(e),W&&(U.length?U.unwrap():D.unwrap()),F?U.data("floatThead-containerWrap",!1):D.data("floatThead-containerWrap",!1),D.css("minWidth",ge),te.remove(),D.data("floatThead-attached",!1),g.off(e)},reflow:function(){xe()},setHeaderHeight:function(){p()},getFloatContainer:function(){return te},getRowGroups:function(){return A?te.find(">table>thead").add(D.children("tbody,tfoot")):D.children("thead,tbody,tfoot")}})}),this}}(jQuery),function(e){e.floatThead=e.floatThead||{},e.floatThead._=window._||function(){var t={},r=Object.prototype.hasOwnProperty,a=["Arguments","Function","String","Number","Date","RegExp"];t.has=function(e,t){return r.call(e,t)},t.keys=function(e){if(e!==Object(e))throw new TypeError("Invalid object");var r=[];for(var a in e)t.has(e,a)&&r.push(a);return r};var o=0;return t.uniqueId=function(e){var t=++o+"";return e?e+t:t},e.each(a,function(){var e=this;t["is"+e]=function(t){return Object.prototype.toString.call(t)=="[object "+e+"]"}}),t.debounce=function(e,t,r){var a,o,i,n,s;return function(){i=this,o=arguments,n=new Date;var l=function d(){var l=new Date-n;t>l?a=setTimeout(d,t-l):(a=null,r||(s=e.apply(i,o)))},c=r&&!a;return a||(a=setTimeout(l,t)),c&&(s=e.apply(i,o)),s}},t}()}(jQuery),Zotero.ui.widgets.reactaddToCollectionDialog={},Zotero.ui.widgets.reactaddToCollectionDialog.init=function(e){Z.debug("addtocollectionsdialog widget init",3);var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(AddToCollectionDialog,{library:t}),document.getElementById("add-to-collection-dialog"))};var AddToCollectionDialog=React.createClass({displayName:"AddToCollectionDialog",componentWillMount:function(){var e=this,t=this.props.library;t.listen("addToCollectionDialog",function(){e.setState({}),e.openDialog()},{})},getInitialState:function(){return{collectionKey:null}},handleCollectionChange:function(e){this.setState({collectionKey:e.target.value})},openDialog:function(){this.refs.modal.open()},closeDialog:function(e){this.refs.modal.close()},addToCollection:function(e){Z.debug("add-to-collection clicked",3);var t=this,r=this.props.library,a=Zotero.state.getSelectedItemKeys(),o=this.state.collectionKey;return o?0===a.length?(Zotero.ui.jsNotificationMessage("No items selected","notice"),!1):(r.collections.getCollection(o).addItems(a).then(function(e){r.dirty=!0,Zotero.ui.jsNotificationMessage("Items added to collection","success"),t.closeDialog()})["catch"](Zotero.catchPromiseError),!1):(Zotero.ui.jsNotificationMessage("No collection selected","error"),!1)},render:function(){var e=this.props.library,t=e.collections.nestedOrderingArray(),r=t.map(function(e,t){return React.createElement("option",{key:e.get("key"),value:e.get("key")},"-".repeat(e.nestingDepth)," ",e.get("name"))});return React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"add-to-collection-dialog",className:"add-to-collection-dialog",role:"dialog",title:"Add to Collection","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",null,"Add To Collection")),React.createElement("div",{className:"add-to-collection-div modal-body","data-role":"content"},React.createElement("form",{method:"POST"},React.createElement("div",{"data-role":"fieldcontain"},React.createElement("label",{htmlFor:"new-collection-parent"},"Collection"),React.createElement("select",{onChange:this.handleCollectionChange,className:"collectionKey-select target-collection form-control"},r)))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{onClick:this.closeDialog,className:"btn","data-dismiss":"modal","aria-hidden":"true"},"Close"),React.createElement("button",{onClick:this.addToCollection,className:"btn btn-primary addButton"},"Add"))))))}}),BootstrapModalWrapper=React.createClass({displayName:"BootstrapModalWrapper",componentDidMount:function(){Z.debug("BootstrapModalWrapper componentDidMount"),J(this.refs.root).modal({backdrop:"static",keyboard:!1,show:!1})},componentWillUnmount:function(){Z.debug("BootstrapModalWrapper componentWillUnmount"),J(this.refs.root).off("hidden",this.handleHidden)},close:function(){Z.debug("BootstrapModalWrapper close"),J(this.refs.root).modal("hide")},open:function(){Z.debug("BootstrapModalWrapper open"),J(this.refs.root).modal("show")},render:function(){return React.createElement("div",{className:"modal",ref:"root"},this.props.children)}});Zotero.ui.widgets.reactbreadcrumbs={},Zotero.ui.widgets.reactbreadcrumbs.init=function(e){var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(BreadCrumbs,{library:t}),document.getElementById("breadcrumbs"))};var BreadCrumb=React.createClass({displayName:"BreadCrumb",getInitialProps:function(){return{label:"",path:""}},render:function(){return""!=this.props.path?React.createElement("a",{href:this.props.path},this.props.label):this.props.label}}),BreadCrumbs=React.createClass({displayName:"BreadCrumbs",componentWillMount:function(){var e=this,t=this.props.library;t.listen("displayedItemsChanged displayedItemChanged selectedCollectionChanged",function(){e.forceUpdate()})},getInitialProps:function(){return{library:null}},render:function(){var e=this.props.library;if(null===e)return null;var t=[],r=Zotero.state.getUrlVars();if(Zotero.config.breadcrumbsBase?Zotero.config.breadcrumbsBase.forEach(function(e){t.push(e)}):t="user"==e.libraryType?[{label:"Home",path:"/"},{label:"People",path:"/people"},{label:e.libraryLabel||e.libraryUrlIdentifier,path:"/"+e.libraryUrlIdentifier},{label:"Library",path:"/"+e.libraryUrlIdentifier+"/items"}]:[{label:"Home",path:"/"},{label:"Groups",path:"/groups"},{label:e.libraryLabel||e.libraryUrlIdentifier,path:"/groups/"+e.libraryUrlIdentifier},{label:"Library",path:"/groups/"+e.libraryUrlIdentifier+"/items"}],r.collectionKey){Z.debug("have collectionKey",4);var a=e.collections.getCollection(r.collectionKey);a&&t.push({label:a.get("name"),path:Zotero.state.buildUrl({collectionKey:r.collectionKey})})}r.itemKey&&(Z.debug("have itemKey",4),t.push({label:e.items.getItem(r.itemKey).title,path:Zotero.state.buildUrl({collectionKey:r.collectionKey,itemKey:r.itemKey})}));var o=[],i="";return t.forEach(function(e,r){o.push(React.createElement(BreadCrumb,{label:e.label,path:e.path})),i+="Home"==e.label?"Zotero | ":e.label,r<t.length&&(o.push(" > "),i+=" > ")}),""!=i&&Zotero.state.updateStateTitle(i),React.createElement("span",null,o)}});Zotero.ui.widgets.library={},Zotero.ui.widgets.library.init=function(e){Z.debug("Zotero.ui.widgets.library.init");var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(ReactZoteroLibrary,{library:t}),document.getElementById("library-widget"))};var ReactZoteroLibrary=React.createClass({displayName:"ReactZoteroLibrary",componentWillMount:function(){Z.debug("ReactZoteroLibrary componentWillMount",3);var e=this;Zotero.reactLibraryInstance=e;var t=this.props.library;t.loadSettings(),t.listen("deleteIdb",function(){t.idbLibrary.deleteDB()}),t.listen("indexedDBError",function(){Zotero.ui.jsNotificationMessage("There was an error initializing your library. Some data may not load properly.","notice")}),t.listen("cachedDataLoaded",function(){}),J(window).on("resize",function(){window.matchMedia("(min-width: 768px)").matches?0!=e.state.narrow&&e.setState({narrow:!1}):1!=e.state.narrow&&e.setState({narrow:!0})})},componentDidMount:function(){var e=this,t=this.props.library;t.listen("displayedItemsChanged",function(){Z.debug("ReactZoteroLibrary displayedItemsChanged"),e.refs.itemsWidget.loadItems()},{}),t.listen("tagsChanged libraryTagsUpdated selectedTagsChanged",function(){Z.debug("setting tags on tagsWidget from Library"),e.refs.tagsWidget.setState({tags:t.tags})}),J(e.refs.itemsPanel).on("scroll",function(){var t=J(e.refs.itemsPanel);t.scrollTop()+t.innerHeight()>=t[0].scrollHeight&&e.refs.itemsWidget.loadMoreItems()})},getInitialState:function(){var e;return window.matchMedia("(min-width: 768px)").matches?e=!1:(Z.debug("Library set to narrow",3),e=!0),{narrow:e,activePanel:"items",deviceSize:"xs"}},showFiltersPanel:function(e){e.preventDefault(),this.setState({activePanel:"filters"})},showItemsPanel:function(e){e.preventDefault(),this.setState({activePanel:"items"})},reflowPanelContainer:function(){},render:function(){Z.debug("react library render");var e,t=this,r=this.props.library,a=Zotero.config.loggedInUser,o=a?a.displayName:null,i=Zotero.config.baseWebsiteUrl,n=i+"/settings",s=i+"/messages/inbox",l=i+"/download",c=i+"/support",d=Zotero.config.baseForumsUrl,u=i+"/user/logout",p=i+"/user/login",m=i,g=function(e){return i+"/static"+e},f=a.unreadMessages>0?React.createElement("strong",null,"Inbox (",a.unreadMessages,")"):"Inbox";e=a?[React.createElement("button",{key:"button",type:"button",href:"#",className:"btn btn-default navbar-btn dropdown-toggle","data-toggle":"dropdown",role:"button","aria-expanded":"false"},o,React.createElement("span",{className:"caret"}),React.createElement("span",{className:"sr-only"},"Toggle Dropdown")),React.createElement("ul",{key:"listEntries",className:"dropdown-menu",role:"menu"},React.createElement("li",null,React.createElement("a",{href:n},"Settings")),React.createElement("li",null,React.createElement("a",{href:s},f)),React.createElement("li",null,React.createElement("a",{href:l},"Download")),React.createElement("li",{className:"divider"}),React.createElement("li",null,React.createElement("a",{href:c,className:"documentation"},"Documentation")),React.createElement("li",null,React.createElement("a",{href:d,className:"forums"},"Forums")),React.createElement("li",{className:"divider"}),React.createElement("li",null,React.createElement("a",{href:u},"Log Out")))]:React.createElement("div",{className:"btn-group"},React.createElement("a",{href:p,className:"btn btn-default navbar-btn",role:"button"},"Log In"),React.createElement("button",{type:"button",href:"#",className:"btn btn-default navbar-btn dropdown-toggle","data-toggle":"dropdown",role:"button","aria-haspopup":"true","aria-expanded":"false"},React.createElement("span",{className:"caret"}),React.createElement("span",{className:"sr-only"},"Toggle Dropdown")),React.createElement("ul",{className:"dropdown-menu",role:"menu"},React.createElement("li",null,React.createElement("a",{href:l},"Download")),React.createElement("li",null,React.createElement("a",{href:c,className:"documentation"},"Documentation")),React.createElement("li",null,React.createElement("a",{href:d,className:"forums"},"Forums"))));var h=t.state.narrow,b=!h,y=!h,v=!h,w=!h,R=!h,E=!h;if(h)switch(t.state.activePanel){case"items":y=!0,v=!0;break;case"item":y=!0,w=!0;break;case"tags":b=!0,R=!0;break;case"collections":b=!0,E=!0;break;case"filters":b=!0}return React.createElement("div",null,React.createElement("nav",{id:"primarynav",className:"navbar navbar-default",role:"navigation"},React.createElement("div",{className:"container-fluid"},React.createElement("div",{className:"navbar-header"},React.createElement("button",{type:"button",className:"navbar-toggle collapsed","data-toggle":"collapse","data-target":"#primary-nav-linklist"},o,React.createElement("span",{className:"sr-only"},"Toggle navigation"),React.createElement("span",{className:"glyphicons fonticon glyphicons-menu-hamburger"})),React.createElement("a",{className:"navbar-brand hidden-sm hidden-xs",href:m},React.createElement("img",{src:g("/images/theme/zotero.png"),alt:"Zotero",height:"20px"})),React.createElement("a",{className:"navbar-brand visible-sm-block visible-xs-block",href:m},React.createElement("img",{src:g("/images/theme/zotero_theme/zotero_48.png"),alt:"Zotero",height:"24px"}))),React.createElement("div",{className:"collapse navbar-collapse",id:"primary-nav-linklist"},React.createElement(ControlPanel,{library:r,ref:"controlPanel"}),React.createElement("ul",{className:"nav navbar-nav navbar-right"},e),React.createElement("div",{className:"eventfulwidget btn-toolbar hidden-xs navbar-right"},React.createElement(LibrarySearchBox,{library:r}))))),React.createElement("div",{id:"js-message"},React.createElement("ul",{id:"js-message-list"})),React.createElement("div",{id:"library",className:"row"},React.createElement("div",{id:"panel-container"},React.createElement("div",{id:"left-panel",hidden:!b,className:"panelcontainer-panelcontainer col-xs-12 col-sm-4 col-md-3"},React.createElement(FilterGuide,{ref:"filterGuide",library:r}),React.createElement("div",{role:"tabpanel"},React.createElement("ul",{className:"nav nav-tabs",role:"tablist"},React.createElement("li",{role:"presentation",className:"active"},React.createElement("a",{href:"#collections-panel","aria-controls":"collections-panel",role:"tab","data-toggle":"tab"},"Collections")),React.createElement("li",{role:"presentation"},React.createElement("a",{href:"#tags-panel","aria-controls":"tags-panel",role:"tab","data-toggle":"tab"},"Tags"))),React.createElement("div",{className:"tab-content"},React.createElement("div",{id:"collections-panel",role:"tabpanel",className:"tab-pane active"},React.createElement(Collections,{ref:"collectionsWidget",library:r})),React.createElement("div",{id:"tags-panel",role:"tabpanel",className:"tab-pane"},React.createElement(Tags,{ref:"tagsWidget",library:r}),React.createElement(FeedLink,{ref:"feedLinkWidget",library:r}))))),React.createElement("div",{id:"right-panel",hidden:!y,className:"panelcontainer-panelcontainer col-xs-12 col-sm-8 col-md-9"},React.createElement("div",{hidden:!v,ref:"itemsPanel",id:"items-panel",className:"panelcontainer-panel col-sm-12 col-md-7"},React.createElement(LibrarySearchBox,{library:r}),React.createElement(Items,{ref:"itemsWidget",library:r,narrow:h}),React.createElement("div",{id:"load-more-items-div",className:"row"},React.createElement("button",{onClick:function(){r.trigger("loadMoreItems")},type:"button",id:"load-more-items-button",className:"btn btn-default"},"Load More Items"))),React.createElement("div",{hidden:!w,id:"item-panel",className:"panelcontainer-panel col-sm-12 col-md-5"},React.createElement("div",{id:"item-widget-div",className:"item-details-div"},React.createElement(ItemDetails,{ref:"itemWidget",library:r})))),React.createElement("nav",{id:"panelcontainer-nav",className:"navbar navbar-default navbar-fixed-bottom visible-xs-block",role:"navigation"},React.createElement("div",{className:"container-fluid"},React.createElement("ul",{className:"nav navbar-nav"},React.createElement("li",{onClick:t.showFiltersPanel,className:"filters-nav"},React.createElement("a",{href:"#"},"Filters")),React.createElement("li",{onClick:t.showItemsPanel,className:"items-nav"},React.createElement("a",{href:"#"},"Items"))))),React.createElement(CiteItemDialog,{library:r}),React.createElement(ExportItemsDialog,{library:r}),React.createElement(LibrarySettingsDialog,{library:r}),React.createElement(ChooseSortingDialog,{library:r}))))}});Zotero.ui.widgets.reactchooseSortingDialog={},Zotero.ui.widgets.reactchooseSortingDialog.init=function(e){Z.debug("chooseSortingDialog widget init",3);var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(ChooseSortingDialog,{library:t}),document.getElementById("choose-sorting-dialog"))};var ChooseSortingDialog=React.createClass({displayName:"ChooseSortingDialog",componentWillMount:function(){var e=this,t=this.props.library,r=Zotero.ui.getPrioritizedVariable("order","title"),a=Zotero.ui.getPrioritizedVariable("sort","asc");e.setState({sortField:r,sortOrder:a}),t.listen("chooseSortingDialog",e.openDialog,{})},getInitialState:function(){return{sortField:"",sortOrder:"asc"}},handleFieldChange:function(e){this.setState({sortField:e.target.value})},handleOrderChange:function(e){this.setState({sortOrder:e.target.value})},saveSorting:function(){var e=this.props.library;e.trigger("changeItemSorting",{newSortField:this.state.sortField,newSortOrder:this.state.sortOrder}),this.closeDialog()},openDialog:function(){this.refs.modal.open()},closeDialog:function(e){this.refs.modal.close()},render:function(){var e=this.props.library,t=e.sortableColumns.map(function(e){return React.createElement("option",{key:e,label:Zotero.localizations.fieldMap[e],value:e},Zotero.localizations.fieldMap[e])});return React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"choose-sorting-dialog",className:"choose-sorting-dialog",role:"dialog",title:"Sort Order","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",null,"Sort Items By")),React.createElement("div",{className:"choose-sorting-div modal-body","data-role":"content"},React.createElement("form",{className:"form-horizontal",role:"form"},React.createElement("select",{defaultValue:this.state.sortField,onChange:this.handleFieldChange,id:"sort-column-select",className:"sort-column-select form-control",name:"sort-column-select"},t),React.createElement("select",{defaultValue:this.state.sortOrder,onChange:this.handleOrderChange,id:"sort-order-select",className:"sort-order-select form-control",name:"sort-order-select"},React.createElement("option",{label:"Ascending",value:"asc"},"Ascending"),React.createElement("option",{label:"Descending",value:"desc"},"Descending")))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{className:"btn","data-dismiss":"modal","aria-hidden":"true"},"Cancel"),React.createElement("button",{onClick:this.saveSorting,className:"btn btn-primary saveSortButton"},"Save"))))))}});Zotero.ui.widgets.reactciteItemDialog={},Zotero.ui.widgets.reactciteItemDialog.init=function(e){Z.debug("citeItemDialog widget init",3);var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(CiteItemDialog,{library:t}),document.getElementById("cite-item-dialog"))};var CiteItemDialog=React.createClass({displayName:"CiteItemDialog",componentWillMount:function(){var e=this,t=this.props.library;e.getAvailableStyles(),t.listen("citeItems",e.openDialog,{})},getDefaultProps:function(){return{freeStyleInput:!1}},getInitialState:function(){return{styles:[],currentStyle:"",citationString:""}},handleStyleChange:function(e){this.setState({collectionKey:e.target.value})},openDialog:function(){this.refs.modal.open()},closeDialog:function(e){this.refs.modal.close()},cite:function(e){Z.debug("citeFunction",3);var t=this,r=this.props.library,a=this.state.currentStyle,o=Zotero.state.getSelectedItemKeys();r.loadFullBib(o,a).then(function(e){t.setState({citationString:e})})["catch"](Zotero.catchPromiseError)},getAvailableStyles:function(){Zotero.styleList||(Zotero.styleList=[],J.getJSON(Zotero.config.styleListUrl,function(e){Zotero.styleList=e}))},directCite:function(e,t){var r={};r.items=e;var a=Zotero.config.citationEndpoint+"?linkwrap=1&style="+t;return J.post(a,JSON.stringify(r))},buildBibString:function(e){for(var t=e.bibliography[0],r=e.bibliography[1],a=t.bibstart,o=0;o<r.length;o++)a+=r[o];return a+=t.bibend},render:function(){var e=(this.props.library,null);this.props.freeStyleInput&&(e=React.createElement("input",{type:"text",className:"free-text-style-input form-control",placeholder:"style"}));var t={__html:this.state.citationString};return React.createElement(BootstrapModalWrapper,{
ref:"modal"},React.createElement("div",{id:"cite-item-dialog",className:"cite-item-dialog",role:"dialog",title:"Cite","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",null,"Cite Items")),React.createElement("div",{className:"cite-item-div modal-body","data-role":"content"},React.createElement("form",null,React.createElement("select",{onChange:this.cite,className:"cite-item-select form-control",id:"cite-item-select"},React.createElement("option",{value:""},"Select Style"),React.createElement("option",{value:"apsa"},"American Political Science Association"),React.createElement("option",{value:"apa"},"American Psychological Association"),React.createElement("option",{value:"asa"},"American Sociological Association"),React.createElement("option",{value:"chicago-author-date"},"Chicago Manual of Style (Author-Date format)"),React.createElement("option",{value:"chicago-fullnote-bibliography"},"Chicago Manual of Style (Full Note with Bibliography)"),React.createElement("option",{value:"chicago-note-bibliography"},"Chicago Manual of Style (Note with Bibliography)"),React.createElement("option",{value:"harvard1"},"Harvard Reference format 1"),React.createElement("option",{value:"ieee"},"IEEE"),React.createElement("option",{value:"mhra"},"Modern Humanities Research Association"),React.createElement("option",{value:"mla"},"Modern Language Association"),React.createElement("option",{value:"nlm"},"National Library of Medicine"),React.createElement("option",{value:"nature"},"Nature"),React.createElement("option",{value:"vancouver"},"Vancouver")),e),React.createElement("div",{id:"cite-box-div",className:"cite-box-div",dangerouslySetInnerHTML:t})),React.createElement("div",{className:"modal-footer"},React.createElement("button",{className:"btn btn-default","data-dismiss":"modal","aria-hidden":"true"},"Close"))))))}});Zotero.ui.widgets.reactcollections={},Zotero.ui.widgets.reactcollections.init=function(e){var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(Collections,{library:t}),document.getElementById("collection-list-div"))};var CollectionRow=React.createClass({displayName:"CollectionRow",getDefaultProps:function(){return{collection:null,selectedCollection:"",depth:0,expandedCollections:{}}},handleCollectionClick:function(e){e.preventDefault();var t=this.props.collection.get("collectionKey");Zotero.state.clearUrlVars(),Zotero.state.pathVars.collectionKey=t,Zotero.state.pushState()},handleTwistyClick:function(e){Z.debug("handleTwistyClick"),e.preventDefault();var t=this.props.collection.get("collectionKey"),r=this.props.expandedCollections;r[t]?delete r[t]:r[t]=!0,this.props.parentCollectionsInstance.setState({expandedCollections:r})},render:function(){if(null==this.props.collection)return null;var e=this.props.collection,t=e.get("key"),r=this.props.selectedCollection,a=this.props.expandedCollections,o=a[t]===!0,i=this.props.selectedCollection==t,n=[];e.children.forEach(function(e){n.push(React.createElement(CollectionRow,{key:e.get("key"),collection:e,selectedCollection:r,expandedCollections:a}))});var s=null;e.hasChildren&&(s=React.createElement("ul",{hidden:!o},n));var l="placeholder small-icon light-icon pull-left";return a[t]===!0?l+=" glyphicon glyphicon-chevron-down clickable":n.length>0&&(l+=" glyphicon glyphicon-chevron-right clickable"),React.createElement("li",{className:"collection-row"},React.createElement("div",{className:"folder-toggle"},React.createElement("span",{className:l,onClick:this.handleTwistyClick}),React.createElement("span",{className:"fonticon glyphicons glyphicons-folder-open barefonticon"})),React.createElement("a",{href:e.websiteCollectionLink,className:i?"current-collection":"",onClick:this.handleCollectionClick},e.get("name")),s)}}),TrashRow=React.createClass({displayName:"TrashRow",getDefaultProps:function(){return{collectionKey:"trash",selectedCollection:""}},handleClick:function(){Zotero.state.clearUrlVars(),Zotero.state.pathVars.collectionKey=this.props.collectionKey,Zotero.state.pushState()},render:function(){Z.debug("TrashRow render");var e=this.props.selectedCollection==this.props.collectionKey?"collection-row current-collection":"collection-row";return React.createElement("li",{className:e},React.createElement("div",{className:"folder-toggle"},React.createElement("span",{className:"sprite-placeholder sprite-icon-16 pull-left dui-icon"}),React.createElement("span",{className:"glyphicons fonticon glyphicons-bin barefonticon"})),"Trash")}}),Collections=React.createClass({displayName:"Collections",getDefaultProps:function(){},getInitialState:function(){var e=Zotero.state.getUrlVar("collectionKey");return{collections:null,currentCollectionKey:e,expandedCollections:{},loading:!1}},componentWillMount:function(){var e=this,t=this.props.library;t.listen("collectionsDirty",e.syncCollections,{}),t.listen("libraryCollectionsUpdated",function(){e.setState({collections:t.collections})},{}),t.listen("selectedCollectionChanged",function(){var t=Zotero.state.getUrlVar("collectionKey");e.setState({currentCollectionKey:t})},{}),t.listen("cachedDataLoaded",e.syncCollections,{})},returnToLibrary:function(e){e.preventDefault(),this.setState({currentCollectionKey:null}),Zotero.state.clearUrlVars(),Zotero.state.pushState()},syncCollections:function(e){Zotero.debug("react collections syncCollections",3);var t=this;if(!this.state.loading){var r=this.props.library;return this.setState({collections:r.collections,loading:!0}),r.loadUpdatedCollections().then(function(){t.setState({collections:r.collections,loading:!1}),r.trigger("libraryCollectionsUpdated")},function(e){Z.error("Error syncing collections"),Z.error(e),t.setState({collections:r.collections,loading:!1}),r.trigger("libraryCollectionsUpdated"),Zotero.ui.jsNotificationMessage("Error loading collections. Collections list may not be up to date","error")})}},render:function(){Z.debug("Collections render");var e=this,t=this.props.library,r=this.state.collections;if(null==r)return null;var a=this.state.collections.collectionsArray,o=this.state.currentCollectionKey,i=this.state.expandedCollections,n=[];if(null!==o)for(var s=r.getCollection(o),l=s;;){if(!l||l.topLevel)break;var c=l.get("parentCollection");l=r.getCollection(c),n.push(c),i[c]=!0}var d=[];a.forEach(function(t){t.topLevel&&d.push(React.createElement(CollectionRow,{key:t.get("key"),collection:t,selectedCollection:o,expandedCollections:i,parentCollectionsInstance:e}))});var u="my-library "+(null==o?"current-collection":"");return React.createElement("div",{id:"collection-list-div",className:"collection-list-container"},React.createElement("ul",{id:"collection-list"},React.createElement("li",null,React.createElement("span",{className:"glyphicons fonticon glyphicons-inbox barefonticon"}),React.createElement("a",{onClick:this.returnToLibrary,className:u,href:t.libraryBaseWebsiteUrl},"Library")),d))}});Zotero.ui.widgets.reactcontrolPanel={},Zotero.ui.widgets.reactcontrolPanel.init=function(e){Z.debug("Zotero.eventful.init.controlPanel",3);var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(ControlPanel,{library:t}),document.getElementById("control-panel"))};var GroupsButton=React.createClass({displayName:"GroupsButton",render:function(){var e="/groups";return React.createElement("a",{className:"btn btn-default navbar-btn navbar-left",href:e,title:"Groups"},React.createElement("span",{className:"glyphicons fonticon glyphicons-group"}))}}),LibraryDropdown=React.createClass({displayName:"LibraryDropdown",getDefaultProps:function(){return{library:null,user:!1}},getInitialState:function(){return{accessibleLibraries:[],loading:!1,loaded:!1}},populateDropdown:function(){Z.debug("populateDropdown");var e=this;if(!this.state.loading&&!this.state.loaded){var t=this.props.library;if(null!=t){if(!Zotero.config.loggedIn)throw new Error("no logged in userID. Required for libraryDropdown widget");var r=Zotero.config.loggedInUser,a="u"+r.userID,o=Zotero.url.userWebLibrary(r.slug);Zotero.config.librarySettings.name;this.setState({loading:!0});t.groups.fetchUserGroups(r.userID).then(function(t){Z.debug("got member groups",3);var i=t.fetchedGroups,n=[];("user"!=Zotero.config.librarySettings.libraryType||Zotero.config.librarySettings.libraryID!=r.userID)&&n.push({name:"My Library",libraryString:a,webUrl:o});for(var s=0;s<i.length;s++)if("group"!=Zotero.config.librarySettings.libraryType||i[s].get("id")!=Zotero.config.librarySettings.libraryID){var l="g"+i[s].get("id");n.push({name:i[s].get("name"),libraryString:l,webUrl:Zotero.url.groupWebLibrary(i[s])})}e.setState({accessibleLibraries:n,loading:!1,loaded:!0})})["catch"](function(e){Z.error(e),Z.error(e.message)})}}},render:function(){if(0==this.props.user)return null;var e=Zotero.config.librarySettings.name,t=this.state.accessibleLibraries,r=t.map(function(e){return React.createElement("li",{key:e.libraryString},React.createElement("a",{role:"menuitem",href:e.webUrl},e.name))});return React.createElement("div",{id:"library-dropdown",className:"btn-group","data-widget":"libraryDropdown","data-library":this.props.library.libraryString},React.createElement("button",{className:"btn btn-default navbar-btn dropdown-toggle",onClick:this.populateDropdown,"data-toggle":"dropdown",href:"#",title:"Libraries"},React.createElement("span",{className:"glyphicons fonticon glyphicons-inbox"}),React.createElement("span",{className:"current-library-name"},e),React.createElement("span",{className:"caret"})),React.createElement("ul",{className:"library-dropdown-list dropdown-menu actions-menu"},React.createElement("li",{hidden:!this.state.loading},React.createElement("a",{role:"menuitem",className:"clickable"},"Loading...")),r))}}),ActionsDropdown=React.createClass({displayName:"ActionsDropdown",getDefaultProps:function(){return{itemSelected:!1,selectedCollection:null,library:null,editable:!1}},trashOrDeleteItems:function(e){e.preventDefault(),Z.debug("move-to-trash clicked",3);var t,r=this.props.library,a=Zotero.state.getSelectedItemKeys(),o=r.items.getItems(a),i=[];if("trash"==Zotero.state.getUrlVar("collectionKey")){var n;for(n=0;n<o.length;n++){var s=o[n];s.get("deleted")&&i.push(s)}t=r.items.deleteItems(i)}else t=r.items.trashItems(o);return r.dirty=!0,t["catch"](function(){Z.error("Error trashing items")}).then(function(){Zotero.state.clearUrlVars(["collectionKey","tag","q"]),Zotero.state.pushState(!0),r.trigger("displayedItemsChanged")})["catch"](Zotero.catchPromiseError),!1},removeFromTrash:function(e){Z.debug("remove-from-trash clicked",3);var t=this.props.library,r=Zotero.state.getSelectedItemKeys(),a=t.items.getItems(r),o=t.items.untrashItems(a);return t.dirty=!0,o["catch"](function(){}).then(function(){Z.debug("post-removeFromTrash always execute: clearUrlVars",3),Zotero.state.clearUrlVars(["collectionKey","tag","q"]),Zotero.state.pushState(),t.trigger("displayedItemsChanged")})["catch"](Zotero.catchPromiseError),!1},removeFromCollection:function(e){Z.debug("remove-from-collection clicked",3);var t=this.props.library,r=Zotero.state.getSelectedItemKeys(),a=Zotero.state.getUrlVar("collectionKey"),o=[];return r.forEach(function(e,r){var i=t.items.getItem(e);i.removeFromCollection(a),o.push(i)}),t.dirty=!0,t.items.writeItems(o).then(function(){Z.debug("removal responses finished. forcing reload",3),Zotero.state.clearUrlVars(["collectionKey","tag"]),Zotero.state.pushState(!0),t.trigger("displayedItemsChanged")})["catch"](Zotero.catchPromiseError),!1},triggerLibraryEvent:function(e){var t=J(e.target).data("triggers");this.props.library.trigger(t)},triggerSync:function(){this.props.library.trigger("syncLibary")},triggerDeleteIdb:function(){this.props.library.trigger("deleteIdb")},render:function(){var e=(this.props.library,this.props.editable),t=this.props.itemSelected,r=this.props.selectedCollection,a=null!=r,o=e&&t&&"trash"==r,i=e&&t&&"trash"!=r,n=e&&t,s=e&&a;return React.createElement("div",{className:"btn-group"},React.createElement("button",{className:"btn btn-default navbar-btn dropdown-toggle","data-toggle":"dropdown",href:"#",title:"Actions"},"Actions",React.createElement("span",{className:"caret"})),React.createElement("ul",{className:"dropdown-menu actions-menu"},React.createElement("li",{hidden:!n},React.createElement("a",{href:"#",role:"menuitem",className:"add-to-collection-button",onClick:this.triggerLibraryEvent,"data-triggers":"addToCollectionDialog",title:"Add to Collection"},"Add to Collection")),React.createElement("li",{hidden:!(n&&s)},React.createElement("a",{onClick:this.removeFromCollection,href:"#",className:"remove-from-collection-button",title:"Remove from Collection"},"Remove from Collection")),React.createElement("li",{hidden:!i},React.createElement("a",{onClick:this.trashOrDeleteItems,href:"#",className:"move-to-trash-button",title:"Move to Trash"},"Move to Trash")),React.createElement("li",{hidden:!o},React.createElement("a",{onClick:this.trashOrDeleteItems,href:"#",className:"permanently-delete-button",title:"Move to Trash"},"Permanently Delete")),React.createElement("li",{hidden:!o},React.createElement("a",{onClick:this.removeFromTrash,href:"#",className:"remove-from-trash-button",title:"Remove from Trash"},"Remove from Trash")),React.createElement("li",{className:"divider",hidden:!n}),React.createElement("li",null,React.createElement("a",{className:"create-collection-button",href:"#",onClick:this.triggerLibraryEvent,"data-triggers":"createCollectionDialog",title:"New Collection"},"Create Collection")),React.createElement("li",{hidden:!s},React.createElement("a",{href:"#",className:"update-collection-button",onClick:this.triggerLibraryEvent,"data-triggers":"updateCollectionDialog",title:"Change Collection"},"Rename Collection")),React.createElement("li",{hidden:!s},React.createElement("a",{href:"#",className:"delete-collection-button",onClick:this.triggerLibraryEvent,"data-triggers":"deleteCollectionDialog",title:"Delete Collection"},"Delete Collection")),React.createElement("li",{className:"divider"}),React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.triggerLibraryEvent,"data-triggers":"librarySettingsDialog"},"Library Settings")),React.createElement("li",null,React.createElement("a",{href:"#",className:"cite-button",onClick:this.triggerLibraryEvent,"data-triggers":"citeItems"},"Cite")),React.createElement("li",null,React.createElement("a",{href:"#",className:"export-button",onClick:this.triggerLibraryEvent,"data-triggers":"exportItemsDialog"},"Export")),React.createElement("li",{className:"divider selected-item-action"}),React.createElement("li",{className:"selected-item-action",hidden:!n},React.createElement("a",{href:"#",className:"send-to-library-button",onClick:this.triggerLibraryEvent,"data-triggers":"sendToLibraryDialog",title:"Copy to Library"},"Copy to Library")),React.createElement("li",{className:"divider",hidden:!n}),React.createElement("li",null,React.createElement("a",{href:"#","data-triggers":"syncLibrary",onClick:this.triggerLibraryEvent},"Sync")),React.createElement("li",null,React.createElement("a",{href:"#","data-triggers":"deleteIdb",onClick:this.triggerLibraryEvent},"Delete IDB"))))}}),CreateItemDropdown=React.createClass({displayName:"CreateItemDropdown",getDefaultProps:function(){return{editable:!1}},createItem:function(e){Z.debug("create-item-Link clicked",3),e.preventDefault();var t=this.props.library,r=J(e.target).data("itemtype");return t.trigger("createItem",{itemType:r}),!1},render:function(){var e=this,t=Object.keys(Zotero.Item.prototype.typeMap);t=t.sort();var r=t.map(function(t,r){return React.createElement("li",{key:t},React.createElement("a",{onClick:e.createItem,href:"#","data-itemtype":t},Zotero.Item.prototype.typeMap[t]))}),a="create-item-button btn btn-default navbar-btn dropdown-toggle";return"trash"==Zotero.state.getUrlVar("collectionKey")&&(a+=" disabled"),React.createElement("div",{className:"btn-group create-item-dropdown",hidden:!this.props.editable},React.createElement("button",{type:"button",className:a,"data-toggle":"dropdown",title:"New Item"},React.createElement("span",{className:"glyphicons fonticon glyphicons-plus"})),React.createElement("ul",{className:"dropdown-menu",role:"menu",style:{maxHeight:"300px",overflow:"auto"}},r))}}),ControlPanel=React.createClass({displayName:"ControlPanel",componentWillMount:function(){var e=this,t=this.props.library;e.setState({user:Zotero.config.loggedInUser}),t.listen("selectedItemsChanged",function(t){Z.debug("got selectedItemsChanged event in ControlPanel - setting selectedItems"),Z.debug(t);var r=t.data.selectedItemKeys;e.setState({selectedItems:r})},{}),t.listen("selectedCollectionChanged",function(t){var r=Zotero.state.getUrlVar("collectionKey"),a=Zotero.state.getSelectedItemKeys();e.setState({selectedCollection:r,selectedItems:a})},{})},getDefaultProps:function(){return{editable:!1}},getInitialState:function(){var e=Zotero.state.getSelectedItemKeys();return{user:!1,selectedItems:e,selectedCollection:null}},render:function(){return React.createElement("div",{id:"control-panel",className:"nav navbar-nav",role:"navigation"},React.createElement("div",{className:"btn-toolbar navbar-left"},React.createElement(GroupsButton,{library:this.props.library}),React.createElement(LibraryDropdown,{user:this.state.user,library:this.props.library}),React.createElement(ActionsDropdown,{library:this.props.library,itemSelected:this.state.selectedItems.length>0,selectedCollection:this.state.selectedCollection,editable:this.props.editable}),React.createElement(CreateItemDropdown,{library:this.props.library,editable:this.props.editable})))}});Zotero.ui.widgets.reactcreateCollectionDialog={},Zotero.ui.widgets.reactcreateCollectionDialog.init=function(e){Z.debug("createcollectionsdialog widget init",3);var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(CreateCollectionDialog,{library:t}),document.getElementById("create-collection-dialog"))};var CreateCollectionDialog=React.createClass({displayName:"CreateCollectionDialog",componentWillMount:function(){var e=this,t=this.props.library;t.listen("createCollectionDialog",function(){e.forceUpdate(),e.openDialog()},{})},getInitialState:function(){return{collectionName:"",parentCollection:null}},handleCollectionChange:function(e){Z.debug(e),Z.debug(e.target.value),this.setState({parentCollection:e.target.value})},handleNameChange:function(e){this.setState({collectionName:e.target.value})},openDialog:function(){this.refs.modal.open()},closeDialog:function(e){this.refs.modal.close()},createCollection:function(){Z.debug("react createCollection");var e=this,t=this.props.library,r=this.state.parentCollection,a=this.state.collectionName;""==a&&(a="Untitled"),t.addCollection(a,r).then(function(r){t.collections.initSecondaryData(),t.trigger("libraryCollectionsUpdated"),Zotero.state.pushState(),e.closeDialog(),Zotero.ui.jsNotificationMessage("Collection Created","success")})["catch"](function(t){Zotero.ui.jsNotificationMessage("There was an error creating the collection.","error"),e.closeDialog()})},render:function(){var e=this.props.library,t=e.collections.nestedOrderingArray(),r=t.map(function(e,t){return React.createElement("option",{key:e.get("key"),value:e.get("key")},"-".repeat(e.nestingDepth)," ",e.get("name"))});return r.unshift(React.createElement("option",{key:"emptyvalue",value:""},"None")),React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"create-collection-dialog",className:"create-collection-dialog",role:"dialog",title:"Create Collection","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",null,"Create Collection")),React.createElement("div",{className:"new-collection-div modal-body","data-role":"content"},React.createElement("form",{method:"POST"},React.createElement("div",{"data-role":"fieldcontain"},React.createElement("label",{htmlFor:"new-collection-title-input"},"Collection Name"),React.createElement("input",{onChange:this.handleNameChange,className:"new-collection-title-input form-control",type:"text"})),React.createElement("div",{"data-role":"fieldcontain"},React.createElement("label",{htmlFor:"new-collection-parent"},"Parent Collection"),React.createElement("select",{onChange:this.handleCollectionChange,className:"collectionKey-select new-collection-parent form-control",defaultValue:""},r)))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{onClick:this.closeDialog,className:"btn","data-dismiss":"modal","aria-hidden":"true"},"Close"),React.createElement("button",{onClick:this.createCollection,className:"btn btn-primary createButton"},"Create"))))))}});Zotero.ui.widgets.reactcreateItemDialog={},Zotero.ui.widgets.reactcreateItemDialog.init=function(e){Z.debug("createItemDialog widget init",3);var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(CreateItemDialog,{library:t}),document.getElementById("create-item-dialog"))};var CreateItemDialog=React.createClass({displayName:"CreateItemDialog",componentWillMount:function(){var e=this,t=this.props.library;t.listen("createItem",function(t){var r=t.data.itemType;e.setState({itemType:r}),e.openDialog()},{})},getInitialState:function(){return{title:"",itemType:"document"}},handleTitleChange:function(e){this.setState({title:e.target.value})},createItem:function(e){e.preventDefault();var t=this,r=this.props.library,a=this.state.itemType,o=Zotero.state.getUrlVar("collectionKey"),i=t.state.title;""==i&&(i="Untitled");var n=new Zotero.Item;n.initEmpty(a).then(function(){return n.associateWithLibrary(r),n.set("title",i),o&&n.addToCollection(o),Zotero.ui.saveItem(n)}).then(function(e){var a=n.get("key");Zotero.state.setUrlVar("itemKey",a),Zotero.state.pushState(),r.trigger("displayedItemsChanged"),t.closeDialog()})["catch"](function(e){Zotero.error(e),Zotero.ui.jsNotificationMessage("There was an error creating the item.","error"),t.closeDialog()})},openDialog:function(){this.refs.modal.open()},closeDialog:function(e){this.refs.modal.close()},render:function(){return React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"create-item-dialog",className:"create-item-dialog",role:"dialog",title:"Create Item","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",null,"Create Item")),React.createElement("div",{className:"new-item-div modal-body","data-role":"content"},React.createElement("form",{onSubmit:this.createItem,method:"POST"},React.createElement("div",{"data-role":"fieldcontain"},React.createElement("label",{htmlFor:"new-item-title-input"},"Title"),React.createElement("input",{onChange:this.handleTitleChange,id:"new-item-title-input",className:"new-item-title-input form-control",type:"text"})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{className:"btn","data-dismiss":"modal","aria-hidden":"true"},"Close"),React.createElement("button",{onClick:this.createItem,className:"btn btn-primary createButton"},"Create"))))))}});Zotero.ui.widgets.reactdeleteCollectionDialog={},Zotero.ui.widgets.reactdeleteCollectionDialog.init=function(e){Z.debug("deletecollectionsdialog widget init",3);var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(DeleteCollectionDialog,{library:t}),document.getElementById("delete-collection-dialog"))};var DeleteCollectionDialog=React.createClass({displayName:"DeleteCollectionDialog",componentWillMount:function(){var e=this,t=this.props.library;t.listen("deleteCollectionDialog",function(){e.setState({collectionKey:Zotero.state.getUrlVar("collectionKey")}),e.openDialog()})},getInitialState:function(){return{collectionKey:null}},handleCollectionChange:function(e){this.setState({parentCollection:e.target.value})},deleteCollection:function(){Z.debug("DeleteCollectionDialog.deleteCollection",3);var e=this,t=this.props.library,r=t.collections.getCollection(this.state.collectionKey);return r?(r.remove().then(function(){delete Zotero.state.pathVars.collectionKey,t.collections.dirty=!0,t.collections.initSecondaryData(),Zotero.state.pushState(),Zotero.ui.jsNotificationMessage(r.get("title")+" removed","confirm"),e.closeDialog()})["catch"](Zotero.catchPromiseError),!1):(Zotero.ui.jsNotificationMessage("Selected collection not found","error"),!1)},openDialog:function(){this.state.collectionKey||Z.error("DeleteCollectionDialog opened with no collectionKey"),this.refs.modal.open()},closeDialog:function(e){this.refs.modal.close()},render:function(){var e=this.props.library,t=e.collections.getCollection(this.state.collectionKey);return t?React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"delete-collection-dialog",className:"delete-collection-dialog",role:"dialog",title:"Delete Collection","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",null,"Delete Collection")),React.createElement("div",{className:"delete-collection-div modal-body"},React.createElement("p",null,'Really delete collection "',t.get("title"),'"?')),React.createElement("div",{className:"modal-footer"},React.createElement("button",{className:"btn","data-dismiss":"modal","aria-hidden":"true"},"Close"),React.createElement("button",{onClick:this.deleteCollection,className:"btn btn-primary deleteButton"},"Delete")))))):null}});Zotero.ui.widgets.reactexportItemsDialog={},Zotero.ui.widgets.reactexportItemsDialog.init=function(e){Z.debug("exportItemDialog widget init",3);var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(ExportItemsDialog,{library:t}),document.getElementById("export-dialog"))};var ExportItemsDialog=React.createClass({displayName:"ExportItemsDialog",componentWillMount:function(){var e=this,t=this.props.library;t.listen("exportItemsDialog",function(){Z.debug("opening export dialog"),e.openDialog()},{}),t.listen("displayedItemsChanged",function(){e.forceUpdate()},{})},getInitialState:function(){return{}},openDialog:function(){this.refs.modal.open()},closeDialog:function(e){this.refs.modal.close()},render:function(){var e=this.props.library,t=Zotero.ui.getItemsConfig(e),r=Zotero.url.exportUrls(t),a=Object.keys(r).map(function(e){var t=r[e];return React.createElement("li",{key:e},React.createElement("a",{href:t,target:"_blank",className:"export-link",title:e,"data-exportformat":e},Zotero.config.exportFormatsMap[e]))});return React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"export-items-dialog",className:"export-items-dialog",role:"dialog",title:"Export","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",null,"Export")),React.createElement("div",{className:"modal-body","data-role":"content"},React.createElement("div",{className:"export-list"},React.createElement("ul",{id:"export-formats-ul"},a))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{className:"btn btn-default","data-dismiss":"modal","aria-hidden":"true"},"Close"))))))}}),FeedLink=React.createClass({displayName:"FeedLink",render:function(){var e,t=this.props.library,r=Zotero.ui.getItemsConfig(t),a=Zotero.ajax.apiRequestUrl(r)+Zotero.ajax.apiQueryString(r,!1),o=a.replace(Zotero.config.baseApiUrl,Zotero.config.baseFeedUrl),i=Zotero.url.requestReadApiKeyUrl(t.libraryType,t.libraryID,o);return e=Zotero.config.librarySettings.publish?o:i,React.createElement("p",null,React.createElement("a",{href:e,type:"application/atom+xml",rel:"alternate",className:"feed-link"},React.createElement("span",{className:"sprite-icon sprite-feed"}),"Subscribe to this feed"))}});Zotero.ui.widgets.reactfilterGuide={},Zotero.ui.widgets.reactfilterGuide.init=function(e){Z.debug("widgets.filterGuide.init",3);var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(FilterGuide,{library:t}),document.getElementById("filter-guide"))};var FilterGuide=React.createClass({displayName:"FilterGuide",componentWillMount:function(){var e=this,t=this.props.library;t.listen("displayedItemsChanged",e.refreshFilters,{}),t.listen("displayedItemChanged",e.refreshFilters,{}),t.listen("updateFilterGuide",e.refreshFilters,{}),t.listen("selectedCollectionChanged",e.refreshFilters,{}),t.listen("cachedDataLoaded",e.refreshFilters,{}),t.listen("libraryCollectionsUpdated",e.refreshFilters,{})},getInitialState:function(){return{collectionKey:"",tags:[],query:""}},refreshFilters:function(e){var t=this.props.library,r=Zotero.ui.getItemsConfig(t);this.setState({collectionKey:r.collectionKey,tags:r.tag,query:r.q})},clearFilter:function(e){e.preventDefault(),Z.debug("widgets.filterGuide.clearFilter",3);var t=this.props.library,r=J(e.currentTarget),a=r.data("collectionkey"),o=r.data("tag"),i=r.data("query");return a&&(Zotero.state.unsetUrlVar("collectionKey"),this.setState({collectionKey:""})),o&&(Zotero.state.toggleTag(o),this.setState({tags:Zotero.state.getUrlVar("tag")})),i?(t.trigger("clearLibraryQuery"),void this.setState({query:""})):void Zotero.state.pushState()},render:function(){var e=this,t=this.props.library,r=null,a=null,o=null;if(""!=this.state.collectionKey){var i=t.collections.getCollection(this.state.collectionKey);i&&(r=React.createElement("li",{key:"collection_"+e.state.collectionKey,className:"filterguide-entry"},React.createElement("a",{onClick:e.clearFilter,href:"#","data-collectionkey":e.state.collectionKey},React.createElement("span",{className:"glyphicons fonticon glyphicons-folder-open"}),React.createElement("span",{className:"filterguide-label"},i.get("name")),React.createElement("span",{className:"glyphicons fonticon glyphicons-remove"}))))}var n=this.state.tags;return"string"==typeof n&&(n=[n]),n&&(a=n.map(function(t){return React.createElement("li",{key:"tag_"+t,className:"filterguide-entry"},React.createElement("a",{onClick:e.clearFilter,href:"#","data-tag":t},React.createElement("span",{className:"glyphicons fonticon glyphicons-tag"}),React.createElement("span",{className:"filterguide-label"},t),React.createElement("span",{className:"glyphicons fonticon glyphicons-remove"})))})),this.state.query&&(o=React.createElement("li",{key:"query_"+e.state.query,className:"filterguide-entry"},React.createElement("a",{onClick:e.clearFilter,href:"#","data-query":e.state.query},React.createElement("span",{className:"glyphicons fonticon glyphicons-search"}),React.createElement("span",{className:"filterguide-label"},e.state.query),React.createElement("span",{className:"glyphicons fonticon glyphicons-remove"})))),React.createElement("div",{id:"filter-guide",className:"filter-guide col-12"},React.createElement("ul",{className:"filterguide-list"},r,a,o))}});Zotero.ui.widgets.inviteToGroup={},Zotero.ui.widgets.inviteToGroup.init=function(e){Z.debug("Zotero.ui.widgets.inviteToGroup");ReactDOM.render(React.createElement(InviteButton,null),document.getElementById("invite-to-group-div"));
};var InviteButton=React.createClass({displayName:"InviteButton",handleClick:function(e){var t=ReactDOM.render(React.createElement(InviteDialog,null),document.getElementById("invite-to-group-dialog"));t.openDialog()},render:function(){var e=this;return Zotero.config.loggedIn?zoteroData.profileUserID==Zotero.config.loggedInUserID?null:React.createElement("button",{className:"btn btn-primary",onClick:e.handleClick},"Invite to group"):null}}),InviteDialog=React.createClass({displayName:"InviteDialog",componentWillMount:function(){var e=this,t=new Zotero.Groups;if(Zotero.config.loggedIn&&Zotero.config.loggedInUserID&&zoteroData.profileUserID!=Zotero.config.loggedInUserID){e.setState({loading:!0});t.fetchUserGroups(Zotero.config.loggedInUserID).then(function(t){var r=t.fetchedGroups;e.setState({groups:r,loading:!1})})["catch"](Zotero.catchPromiseError)}},getInitialState:function(){return{groups:[],loading:!1}},openDialog:function(){this.refs.modal.open()},closeDialog:function(e){this.refs.modal.close()},inviteToGroup:function(e){Z.debug(e);var t=J(e.currentTarget).data("groupid");J.ajax({type:"POST",url:"/groups/inviteuser",data:{groupID:t,userID:zoteroData.profileUserID},processData:!0}).then(function(e){Z.debug("got response from inviteuser"),"true"==e&&Zotero.ui.jsNotificationMessage("User has been invited","success")})},render:function(){var e=this,t=zoteroData.invitedGroupIDs,r=e.state.groups.map(function(r){return-1!=t.indexOf(r.get("id").toString())?React.createElement("li",{key:r.get("id")},"Invitation pending to '",r.get("name"),"'"):React.createElement("li",{key:r.get("id")},React.createElement("button",{className:"btn btn-default",onClick:e.inviteToGroup,"data-groupid":r.get("id")},r.get("name")))});return React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"invite-user-dialog",className:"invite-user-dialog",role:"dialog",title:"Invite User","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",null,"Invite User")),React.createElement("div",{className:"modal-body","data-role":"content"},React.createElement("ul",null,r))))))}}),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};Zotero.ui.widgets.reactitem={},Zotero.ui.widgets.reactitem.init=function(e){var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(ItemDetails,{library:t}),document.getElementById("item-widget-div"))},Zotero.ui.editMatches=function(e,t){return null===e||null===t?!1:t.field!=e.field?!1:t.creatorIndex!=e.creatorIndex?!1:e.tagIndex!=t.tagIndex?!1:!0},Zotero.ui.genericDisplayedFields=function(e){var t=Object.keys(e.apiObj.data).filter(function(t){return-1!=e.hideFields.indexOf(t)?!1:e.fieldMap.hasOwnProperty(t)?"title"==t||"creators"==t||"itemType"==t?!1:!0:!1});return t},Zotero.ui.widgets.reactitem.editFields=function(e){var t=[{field:"itemType"},{field:"title"}],r=e.get("creators");r.forEach(function(e,r){t.push({field:"creatorType",creatorIndex:r}),e.name?t.push({field:"name",creatorIndex:r}):(t.push({field:"lastName",creatorIndex:r}),t.push({field:"firstName",creatorIndex:r}))});var a=Zotero.ui.genericDisplayedFields(e);return a.forEach(function(e){t.push({field:e})}),t},Zotero.ui.widgets.reactitem.nextEditField=function(e,t){if(!t||!t.field)return null;for(var r,a=Zotero.ui.widgets.reactitem.editFields(e),o=0;o<a.length;o++)a[o].field==t.field&&a[o].creatorIndex==t.creatorIndex&&(r=o);return r==a.length?a[0]:a[o+1]};var CreatorRow=React.createClass({displayName:"CreatorRow",getDefaultProps:function(){return{item:null,library:null,creatorIndex:0,edit:null}},render:function(){if(null==this.props.item)return null;var e=this.props.item,t=e.get("creators")[this.props.creatorIndex],r=null;return r=t.name&&""!=t.name?React.createElement(ItemField,_extends({},this.props,{key:"name",field:"name"})):[React.createElement(ItemField,_extends({},this.props,{key:"lastName",field:"lastName"})),", ",React.createElement(ItemField,_extends({},this.props,{key:"firstName",field:"firstName"}))],React.createElement("tr",{className:"creator-row"},React.createElement("th",null,React.createElement(ItemField,_extends({},this.props,{field:"creatorType"}))),React.createElement("td",null,r,React.createElement("div",{className:"btn-toolbar",role:"toolbar"},React.createElement(ToggleCreatorFieldButton,this.props),React.createElement(AddRemoveCreatorFieldButtons,this.props))))}}),ToggleCreatorFieldButton=React.createClass({displayName:"ToggleCreatorFieldButton",render:function(){return React.createElement("div",{className:"btn-group"},React.createElement("button",{type:"button",className:"switch-two-field-creator-link btn btn-default",title:"Toggle single field creator","data-itemkey":this.props.item.get("key"),"data-creatorindex":this.props.creatorIndex,onClick:this.switchCreatorFields},React.createElement("span",{className:"fonticon glyphicons glyphicons-unchecked"})))},switchCreatorFields:function(e){var t=this.props.creatorIndex,r=this.props.item,a=r.get("creators"),o=a[t];if(void 0!==o.name){var i=o.name.split(" ");i.length>1?(o.lastName=i.splice(-1,1)[0],o.firstName=i.join(" ")):(o.lastName=o.name,o.firstName=""),delete o.name}else""===o.firstName&&""===o.lastName?o.name="":o.name=o.firstName+" "+o.lastName,delete o.firstName,delete o.lastName;a[t]=o,Zotero.ui.saveItem(r),this.props.parentItemDetailsInstance.setState({item:r})}}),AddRemoveCreatorFieldButtons=React.createClass({displayName:"AddRemoveCreatorFieldButtons",render:function(){return React.createElement("div",{className:"btn-group"},React.createElement("button",{type:"button",className:"btn btn-default","data-creatorindex":this.props.creatorIndex,onClick:this.removeCreator},React.createElement("span",{className:"fonticon glyphicons glyphicons-minus"})),React.createElement("button",{type:"button",className:"btn btn-default","data-creatorindex":this.props.creatorIndex,onClick:this.addCreator},React.createElement("span",{className:"fonticon glyphicons glyphicons-plus"})))},addCreator:function(e){Z.debug("addCreator");var t=this.props.item,r=this.props.creatorIndex,a=t.get("creators"),o={creatorType:"author",firstName:"",lastName:""};a.splice(r+1,0,o),this.props.parentItemDetailsInstance.setState({item:t,edit:{field:"lastName",creatorIndex:r+1}})},removeCreator:function(e){Z.debug("removeCreator");var t=this.props.creatorIndex,r=this.props.item,a=r.get("creators");a.splice(t,1),Zotero.ui.saveItem(r),this.props.parentItemDetailsInstance.setState({item:r})}}),ItemNavTabs=React.createClass({displayName:"ItemNavTabs",getDefaultProps:function(){return{item:null}},render:function(){return Z.debug("ItemNavTabs render"),null==this.props.item?null:this.props.item.isSupplementaryItem()?null:React.createElement("ul",{className:"nav nav-tabs",role:"tablist"},React.createElement("li",{role:"presentation",className:"active"},React.createElement("a",{href:"#item-info-panel","aria-controls":"item-info-panel",role:"tab","data-toggle":"tab"},"Info")),React.createElement("li",{role:"presentation"},React.createElement("a",{href:"#item-children-panel","aria-controls":"item-children-panel",role:"tab","data-toggle":"tab"},"Children")),React.createElement("li",{role:"presentation"},React.createElement("a",{href:"#item-tags-panel","aria-controls":"item-tags-panel",role:"tab","data-toggle":"tab"},"Tags")))}}),ItemFieldRow=React.createClass({displayName:"ItemFieldRow",getDefaultProps:function(){return{item:null,edit:null}},render:function(){var e=this.props.item,t=this.props.field,r=React.createElement(ItemField,{item:e,field:t,edit:this.props.edit,parentItemDetailsInstance:this.props.parentItemDetailsInstance});if("url"==t){var a=e.get("url");return React.createElement("tr",null,React.createElement("th",null,React.createElement("a",{rel:"nofollow",href:a},e.fieldMap[t])),React.createElement("td",{className:t},r))}if("DOI"==t){var o=e.get("DOI");return React.createElement("tr",null,React.createElement("th",null,React.createElement("a",{rel:"nofollow",href:"http://dx.doi.org/"+o},e.fieldMap[t])),React.createElement("td",{className:t},r))}return Zotero.config.richTextFields[t]?React.createElement("tr",null,React.createElement("th",null,e.fieldMap[t],"}"),React.createElement("td",{className:t},r)):React.createElement("tr",null,React.createElement("th",null,e.fieldMap[t]||t),React.createElement("td",{className:t},r))}}),ItemField=React.createClass({displayName:"ItemField",getDefaultProps:function(){return{item:null,field:null,edit:null,creatorIndex:null,tagIndex:null}},handleChange:function(e){Z.debug("change on ItemField"),Z.debug(e);var t=this.props.item;switch(this.props.field){case"creatorType":case"name":case"firstName":case"lastName":var r=t.get("creators"),a=r[this.props.creatorIndex];a[this.props.field]=e.target.value;break;case"tag":var o=t.get("tags"),i=o[this.props.tagIndex];i.tag=e.target.value;break;default:t.set(this.props.field,e.target.value)}this.props.parentItemDetailsInstance.setState({item:t})},handleBlur:function(e){Z.debug("blur on ItemField"),Z.debug("handleBlur"),this.handleChange(e),this.props.parentItemDetailsInstance.setState({edit:null}),Zotero.ui.saveItem(this.props.item)},handleFocus:function(e){Z.debug("focus on ItemField");var t=J(e.currentTarget).data("field"),r=J(e.target).data("creatorindex"),a=J(e.target).data("tagindex"),o={field:t,creatorIndex:r,tagIndex:a};Z.debug(o),this.props.parentItemDetailsInstance.setState({edit:o})},checkKey:function(e){Z.debug("ItemField checkKey"),e.stopPropagation(),e.keyCode===Zotero.ui.keyCode.ENTER&&J(e.target).blur()},render:function(){var e,t=this.props.item,r=this.props.field,a=!1,o=!1;switch(r){case"creatorType":case"name":case"firstName":case"lastName":a=!0;var i=this.props.creatorIndex,n=t.get("creators")[i];e=n[r];var s={name:"(name)",lastName:"(Last Name)",firstName:"(First Name)"};break;case"tag":o=!0;var l=this.props.tagIndex,c=t.get("tags")[l];e=c.tag;break;default:e=t.get(r)}var d=Zotero.ui.editMatches(this.props,this.props.edit);if(!d){var u={className:"editable-item-field",tabIndex:0,"data-field":r,onFocus:this.handleFocus},p=null;return a?(u.className+=" creator-field",u["data-creatorindex"]=this.props.creatorIndex,p=""==e?s[r]:e):o?(u.className+=" tag-field",u["data-tagindex"]=this.props.tagIndex,p=e):p=""==e?React.createElement("div",{className:"empty-field-placeholder"}):Zotero.ui.formatItemField(r,t),React.createElement("span",u,p)}var m=function(e){null!=e&&e.focus()},g={className:"form-control item-field-control "+this.props.field,name:r,defaultValue:e,onKeyDown:this.checkKey,onBlur:this.handleBlur,creatorindex:this.props.creatorIndex,tagindex:this.props.tagIndex,ref:m};switch(a&&(g.placeholder=s[r]),this.props.field){case null:return null;case"itemType":var f=t.itemTypes.map(function(e){return React.createElement("option",{key:e.itemType,label:e.localized,value:e.itemType},e.localized)});return React.createElement("select",g,f);case"creatorType":var h=t.creatorTypes[t.get("itemType")].map(function(e){return React.createElement("option",{key:e.creatorType,label:e.localized,value:e.creatorType},e.localized)});return React.createElement("select",_extends({id:"creatorType"},g,{"data-creatorindex":this.props.creatorIndex}),h);default:return Zotero.config.largeFields[this.props.field]?React.createElement("textarea",g):Zotero.config.richTextFields[this.props.field]?React.createElement("textarea",_extends({},g,{className:"rte default"})):React.createElement("input",_extends({type:"text"},g))}}}),ItemInfoPanel=React.createClass({displayName:"ItemInfoPanel",getDefaultProps:function(){return{item:null,loading:!1,edit:null}},render:function(){Z.debug("ItemInfoPanel render");var e=this,t=this.props.library,r=this.props.item;Z.debug("ItemInfoPanel render: items.totalResults: "+t.items.totalResults);var a=React.createElement("p",{className:"item-count",hidden:!this.props.libraryItemsLoaded},t.items.totalResults+" items in this view"),o=this.props.edit;if(null==r)return React.createElement("div",{id:"item-info-panel",role:"tabpanel",className:"item-details-div tab-pane active"},React.createElement(LoadingSpinner,{loading:this.props.loading}),a);var i=r.get("key"),n=r.owningLibrary.libraryType,s=!1;r.get("parentItem")&&(s=t.websiteUrl({itemKey:r.get("parentItem")}));var l,c=s?React.createElement("a",{href:s,className:"item-select-link","data-itemkey":r.get("parentItem")},"Parent Item"):null;l="user"==n?React.createElement("span",{id:"libraryUserID",title:r.apiObj.library.id}):React.createElement("span",{id:"libraryGroupID",title:r.apiObj.library.id});var d=null;"group"==n&&(d=React.createElement("tr",null,React.createElement("th",null,"Added by"),React.createElement("td",{className:"user-creator"},React.createElement("a",{href:r.apiObj.meta.createdByUser.links.alternate.href,className:"user-link"},r.apiObj.meta.createdByUser.name))));var u=[],p=r.get("creators");0==p.length&&p.push({lastName:"",firstName:""}),u=r.isSupplementaryItem()?null:r.get("creators").map(function(a,i){return React.createElement(CreatorRow,{key:i,library:t,creatorIndex:i,item:r,edit:o,parentItemDetailsInstance:e.props.parentItemDetailsInstance})});var m=[],g=Zotero.ui.genericDisplayedFields(r);g.forEach(function(t){m.push(React.createElement(ItemFieldRow,_extends({key:t},e.props,{field:t})))});var f=["itemType","title"].map(function(t){return React.createElement(ItemFieldRow,_extends({key:t},e.props,{field:t}))});return React.createElement("div",{id:"item-info-panel",role:"tabpanel",className:"item-details-div tab-pane active"},React.createElement(LoadingSpinner,{loading:this.props.loading}),c,l,React.createElement("table",{className:"item-info-table table","data-itemkey":i},React.createElement("tbody",null,d,f,u,m)))}}),TagListRow=React.createClass({displayName:"TagListRow",getDefaultProps:function(){return{tagIndex:0,tag:{tag:""},item:null,library:null,edit:null}},removeTag:function(e){var t=(this.props.tag.tag,this.props.item),r=this.props.tagIndex,a=t.get("tags");a.splice(r,1),Zotero.ui.saveItem(t),this.props.parentItemDetailsInstance.setState({item:t})},render:function(){return React.createElement("div",{className:"row item-tag-row"},React.createElement("div",{className:"col-xs-1"},React.createElement("span",{className:"glyphicons fonticon glyphicons-tag"})),React.createElement("div",{className:"col-xs-9"},React.createElement(ItemField,_extends({},this.props,{field:"tag"}))),React.createElement("div",{className:"col-xs-2"},React.createElement("button",{type:"button",className:"remove-tag-link btn btn-default",onClick:this.removeTag},React.createElement("span",{className:"glyphicons fonticon glyphicons-minus"}))))}}),ItemTagsPanel=React.createClass({displayName:"ItemTagsPanel",getInitialState:function(){return{newTagString:""}},newTagChange:function(e){this.setState({newTagString:e.target.value})},checkKey:function(e){if(Z.debug("New tag checkKey"),e.stopPropagation(),e.keyCode===Zotero.ui.keyCode.ENTER){Z.debug(e);var t=this.props.item,r=t.get("tags");r.push({tag:e.target.value}),Zotero.ui.saveItem(t),this.setState({newTagString:""}),this.props.parentItemDetailsInstance.setState({item:t})}},render:function(){Z.debug("ItemTagsPanel render");var e=this,t=this.props.item;this.props.library;if(null==t)return React.createElement("div",{id:"item-tags-panel",role:"tabpanel",className:"item-tags-div tab-pane"});var r=t.apiObj.data.tags.map(function(t,r){return React.createElement(TagListRow,_extends({key:t.tag},e.props,{tag:t,tagIndex:r}))});return React.createElement("div",{id:"item-tags-panel",role:"tabpanel",className:"item-tags-div tab-pane"},React.createElement("p",null,React.createElement("span",{className:"tag-count"},t.get("tags").length)," tags"),React.createElement("button",{className:"add-tag-button btn btn-default"},"Add Tag"),React.createElement("div",{className:"item-tags-list"},r),React.createElement("div",{className:"add-tag-form form-horizontal"},React.createElement("div",{className:"form-group"},React.createElement("div",{className:"col-xs-1"},React.createElement("label",{htmlFor:"add-tag-input"},React.createElement("span",{className:"glyphicons fonticon glyphicons-tag"}))),React.createElement("div",{className:"col-xs-11"},React.createElement("input",{type:"text",onKeyDown:this.checkKey,onChange:this.newTagChange,value:this.state.newTagString,id:"add-tag-input",className:"add-tag-input form-control"})))))}}),ItemChildrenPanel=React.createClass({displayName:"ItemChildrenPanel",getDefaultProps:function(){return{childItems:[]}},triggerUpload:function(){this.props.library.trigger("uploadAttachment")},render:function(){Z.debug("ItemChildrenPanel render");var e=this.props.childItems.map(function(e){var t=e.get("title"),r=Zotero.url.itemHref(e),a=e.itemTypeIconClass(),o=e.get("key");if("note"==e.itemType)return React.createElement("li",{key:o},React.createElement("span",{className:"fonticon barefonticon "+a}),React.createElement("a",{className:"item-select-link","data-itemkey":e.get("key"),href:r,title:t},t));if(0==e.attachmentDownloadUrl)return React.createElement("li",{key:o},React.createElement("span",{className:"fonticon barefonticon "+a}),t,"(",React.createElement("a",{className:"item-select-link","data-itemkey":e.get("key"),href:r,title:t},"Attachment Details"),")");var i=Zotero.url.attachmentDownloadUrl(e);return React.createElement("li",{key:o},React.createElement("span",{className:"fonticon barefonticon "+a}),React.createElement("a",{className:"itemdownloadlink",href:i},t," ",Zotero.url.attachmentFileDetails(e)),"(",React.createElement("a",{className:"item-select-link","data-itemkey":e.get("key"),href:r,title:t},"Attachment Details"),")")});return React.createElement("div",{id:"item-children-panel",role:"tabpanel",className:"item-children-div tab-pane"},React.createElement("ul",{id:"notes-and-attachments"},e),React.createElement("button",{type:"button",onClick:this.triggerUpload,id:"upload-attachment-link",className:"btn btn-primary upload-attachment-button",hidden:!Zotero.config.librarySettings.allowUpload},"Upload File"))}}),ItemDetails=React.createClass({displayName:"ItemDetails",getInitialState:function(){return{item:null,childItems:[],itemLoading:!1,childrenLoading:!1,libraryItemsLoaded:!1,edit:null}},componentWillMount:function(){var e=this,t=this.props.library;t.listen("displayedItemChanged",e.loadItem,{}),t.listen("uploadSuccessful",e.refreshChildren,{}),t.listen("tagsChanged",e.updateTypeahead,{}),t.listen("showChildren",e.refreshChildren,{}),t.trigger("displayedItemChanged")},componentDidMount:function(){return},loadItem:function(){Z.debug("Zotero eventful loadItem",3);var e=this,t=this.props.library,r=Zotero.state.getUrlVar("itemKey");if(!r)return Z.debug("No itemKey - "+r,3),e.setState({item:null}),Promise.reject(new Error("No itemkey - "+r));var a,o=t.items.getItem(r);return o?(Z.debug("have item locally, loading details into ui",3),a=Promise.resolve(o)):(Z.debug("must fetch item from server",3),e.setState({itemLoading:!0}),a=t.loadItem(r)),a.then(function(e){o=e}).then(function(){return o.getCreatorTypes(o.get("itemType"))}).then(function(r){Z.debug("done loading necessary data; displaying item"),e.setState({item:o,itemLoading:!1}),t.trigger("showChildren");try{var a=document.createEvent("HTMLEvents");a.initEvent("ZoteroItemUpdated",!0,!0),document.dispatchEvent(a)}catch(i){Zotero.error("Error triggering ZoteroItemUpdated event")}}),a["catch"](function(e){Z.error("loadItem promise failed"),Z.error(e)}).then(function(){e.setState({itemLoading:!1})})["catch"](Zotero.catchPromiseError),a},refreshChildren:function(){Z.debug("reactitem.refreshChildren",3);var e=this,t=this.props.library,r=Zotero.state.getUrlVar("itemKey");if(!r)return Z.debug("No itemKey - "+r,3),Promise.reject(new Error("No itemkey - "+r));var a=t.items.getItem(r);e.setState({loadingChildren:!0});var o=a.getChildren(t).then(function(t){e.setState({childItems:t,loadingChildren:!1})})["catch"](Zotero.catchPromiseError);return o},updateTypeahead:function(){return void Z.debug("updateTypeahead",3)},addTagTypeahead:function(){Z.debug("adding typeahead",3);var e=this.props.library,t=e.tags.plainList;t||(t=[]);var r=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,local:J.map(t,function(e){return{value:e}})});r.initialize(),widgetEl.find("input.taginput").typeahead("destroy"),widgetEl.find("input.taginput").typeahead({hint:!0,highlight:!0,minLength:1},{name:"tags",displayKey:"value",source:r.ttAdapter()})},addTagTypeaheadToInput:function(){Z.debug("adding typeahead",3);var e=this.props.library,t=e.tags.plainList;t||(t=[]);var r=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,local:J.map(t,function(e){return{value:e}})});r.initialize(),J(element).typeahead("destroy"),J(element).typeahead({hint:!0,highlight:!0,minLength:1},{name:"tags",displayKey:"value",source:r.ttAdapter()})},render:function(){Z.debug("ItemDetails render");var e=this,t=this.props.library,r=this.state.item,a=this.state.childItems;return React.createElement("div",{role:"tabpanel"},React.createElement(ItemNavTabs,{library:t,item:r}),React.createElement("div",{className:"tab-content"},React.createElement(ItemInfoPanel,{library:t,item:r,loading:this.state.itemLoading,libraryItemsLoaded:this.state.libraryItemsLoaded,edit:this.state.edit,parentItemDetailsInstance:e}),React.createElement(ItemChildrenPanel,{parentItemDetailsInstance:e,library:t,childItems:a,loading:this.state.childrenLoading}),React.createElement(ItemTagsPanel,{parentItemDetailsInstance:e,library:t,item:r,edit:this.state.edit})))}});Zotero.ui.widgets.reactitems={},Zotero.ui.widgets.reactitems.init=function(e){Z.debug("widgets.items.init",3);var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(Items,{library:t}),document.getElementById("library-items-div"))},Zotero.ui.getItemsConfig=function(e){var t=["tag","collectionKey","order","sort","q","qmode"],r={};J.each(t,function(e,t){var a=Zotero.state.getUrlVar(t);a&&(r[t]=a)});var a={libraryID:e.libraryID,libraryType:e.libraryType,target:"items",targetModifier:"top",limit:e.preferences.getPref("itemsPerPage")},o={order:Zotero.preferences.getPref("order"),sort:Zotero.preferences.getPref("sort"),limit:e.preferences.getPref("itemsPerPage")},i=J.extend({},a,o,r);return"user"==e.libraryType&&-1!=Zotero.Library.prototype.groupOnlyColumns.indexOf(i.order)&&(i.order="title"),i.sort||(i.sort=Zotero.config.sortOrdering[i.order]),(i.tag||i.q)&&delete i.targetModifier,i};var Items=React.createClass({displayName:"Items",componentWillMount:function(){var e=this,t=this.props.library;t.listen("changeItemSorting",e.resortTriggered),t.listen("displayedItemsChanged",e.loadItems,{}),t.listen("displayedItemChanged",e.selectDisplayed),Zotero.listen("selectedItemsChanged",function(){e.setState({selectedItemKeys:Zotero.state.getSelectedItemKeys()})}),t.listen("selectedItemsChanged",function(){e.setState({selectedItemKeys:Zotero.state.getSelectedItemKeys()})}),t.listen("selectedCollectionChanged",function(){Zotero.state.selectedItemKeys=[],t.trigger("selectedItemsChanged",{selectedItemKeys:[]})}),t.listen("loadMoreItems",e.loadMoreItems,{}),t.trigger("displayedItemsChanged")},getDefaultProps:function(){return{narrow:!1}},getInitialState:function(){return{moreloading:!1,allItemsLoaded:!1,errorLoading:!1,items:[],selectedItemKeys:[],allSelected:!1,displayFields:["title","creator","dateModified"],order:"title",sort:"asc"}},loadItems:function(){Z.debug("Items.loadItems",3);var e=this,t=this.props.library,r=Zotero.ui.getItemsConfig(t);this.setState({items:[],moreloading:!0});var a=t.loadItems(r).then(function(a){if(!a.loadedItems)throw Zotero.error("expected loadedItems on response not present"),"Expected response to have loadedItems";t.items.totalResults=a.totalResults;var o=a.totalResults==a.loadedItems.length;e.setState({items:a.loadedItems,moreloading:!1,sort:r.sort,order:r.order,allItemsLoaded:o})})["catch"](function(t){Z.error(t),e.setState({errorLoading:!0,moreloading:!1,sort:r.sort,order:r.order})});return a},loadMoreItems:function(){Z.debug("Items.loadMoreItems",3);var e=this,t=this.props.library;if(!e.state.moreloading&&!e.state.allItemsLoaded){e.setState({moreloading:!0});var t=e.props.library,r=Zotero.ui.getItemsConfig(t),a=e.state.items.length;r.start=a;t.loadItems(r).then(function(t){if(!t.loadedItems)throw Zotero.error("expected loadedItems on response not present"),"Expected response to have loadedItems";var r=e.state.items.concat(t.loadedItems);e.setState({items:r,moreloading:!1});var a=r.length;t.totalResults==a&&e.setState({allItemsLoaded:!0})})["catch"](function(t){Z.error(t),e.setState({errorLoading:!0,moreloading:!1})})}},resortItems:function(e){Z.debug(".field-table-header clicked",3),e.preventDefault();var t,r=this.props.library,a=this.state.order,o=this.state.sort,i=J(e.target).data("columnfield");return t=i!=a?Zotero.config.sortOrdering[i]:"asc"==o?"desc":"asc",-1==r.sortableColumns.indexOf(i)?!1:i?(Zotero.state.pathVars.order=i,Zotero.state.pathVars.sort=t,Zotero.state.pushState(),r.preferences.setPref("sortField",i),r.preferences.setPref("sortOrder",t),r.preferences.setPref("order",i),r.preferences.setPref("sort",t),Zotero.preferences.setPref("order",i),void Zotero.preferences.setPref("sort",t)):(Zotero.ui.jsNotificationMessage("no order field mapped to column"),!1)},resortTriggered:function(e){Z.debug("resortTriggered"),Z.debug(e);var t=this.props.library,r=(this.state.order,this.state.sort,e.data.newSortField),a=e.data.newSortOrder;return-1==t.sortableColumns.indexOf(r)?!1:r?(Zotero.state.pathVars.order=r,Zotero.state.pathVars.sort=a,Zotero.state.pushState(),t.preferences.setPref("sortField",r),t.preferences.setPref("sortOrder",a),t.preferences.setPref("order",r),t.preferences.setPref("sort",a),Zotero.preferences.setPref("order",r),void Zotero.preferences.setPref("sort",a)):(Zotero.ui.jsNotificationMessage("no order field mapped to column"),!1)},selectDisplayed:function(){Z.debug("widgets.items.selectDisplayed",3),Zotero.state.selectedItemKeys=[],this.setState({selectedItemKeys:Zotero.state.getSelectedItemKeys(),allSelected:!1})},fixTableHeaders:function(){if(J("body").hasClass("lib-body")){var e=J(this.refs.itemsTable);e.floatThead({top:function(){var e=J(".library-search-box-container:visible"),t=J("#primarynav");return e.height()?t.height()+e.height()+"px":0}})}},handleSelectAllChange:function(e){var t=this.props.library,r=[],a=!1;if(e.target.checked)a=!0,this.state.items.forEach(function(e){r.push(e.get("key"))});else{var o=Zotero.state.getUrlVar("itemKey");o&&r.push(o)}Zotero.state.selectedItemKeys=r,this.setState({selectedItemKeys:r,allSelected:a}),t.trigger("selectedItemsChanged",{selectedItemKeys:r}),0===r.length&&t.trigger("displayedItemChanged")},openSortingDialog:function(e){var t=this.props.library;t.trigger("chooseSortingDialog")},nonreactBind:function(){this.fixTableHeaders()},componentDidMount:function(){var e=this;e.nonreactBind()},componentDidUpdate:function(){this.nonreactBind()},render:function(){var e=this,t=this.props.library,r=this.props.narrow,a=this.state.order,o=this.state.sort,i=this.state.selectedItemKeys,n={};i.forEach(function(e){n[e]=!0});var s;s="desc"==o?React.createElement("span",{className:"glyphicon fonticon glyphicon-chevron-down pull-right"}):React.createElement("span",{className:"glyphicon fonticon glyphicon-chevron-up pull-right"});var l=[React.createElement("th",{key:"checkbox-header"},React.createElement("input",{type:"checkbox",className:"itemlist-editmode-checkbox all-checkbox",name:"selectall",checked:this.state.allSelected,onChange:this.handleSelectAllChange}))];if(r)l.push(React.createElement("th",{key:"single-cell-header",onClick:e.openSortingDialog,className:"clickable"},Zotero.Item.prototype.fieldMap[a],s));else{var c=this.state.displayFields.map(function(t,r){var i=-1!=Zotero.Library.prototype.sortableColumns.indexOf(t),n=t==a?"selected-order sort-"+o+" ":"",l=null;return t==a&&(l=s),React.createElement("th",{key:t,onClick:e.resortItems,className:"field-table-header "+n+(i?"clickable ":""),"data-columnfield":t},Zotero.Item.prototype.fieldMap[t]?Zotero.Item.prototype.fieldMap[t]:t,l)});l=l.concat(c)}var d=this.state.items.map(function(a){var o=n.hasOwnProperty(a.get("key"))?!0:!1,i={itemsReactInstance:e,library:t,key:a.get("key"),item:a,selected:o,narrow:r};return React.createElement(ItemRow,i)});if(0==d.length){var u=this.state.displayFields.map(function(e){return React.createElement("td",{key:e})});u=[React.createElement("td",{key:"check"})].concat(u),d=React.createElement("tr",null,u)}return React.createElement("div",{id:"library-items-div",className:"library-items-div row",ref:"topdiv"},React.createElement("form",{className:"item-select-form",method:"POST"},React.createElement("table",{id:"field-table",ref:"itemsTable",className:"wide-items-table table table-striped"},React.createElement("thead",null,React.createElement("tr",null,l)),React.createElement("tbody",null,d)),React.createElement(LoadingError,{errorLoading:this.state.errorLoading}),React.createElement(LoadingSpinner,{loading:this.state.moreloading}),React.createElement("div",{hidden:this.state.allItemsLoaded,id:"load-more-items-div",className:"row"},React.createElement("button",{onClick:this.loadMoreItems,type:"button",id:"load-more-items-button",className:"btn btn-default"},"Load More Items"))))}}),ItemRow=React.createClass({displayName:"ItemRow",getDefaultProps:function(){return{displayFields:["title","creatorSummary","dateModified"],selected:!1,item:{},narrow:!1}},handleSelectChange:function(e){var t=this.props.library,r=this.props.item.get("key");Zotero.state.toggleItemSelected(r);var a=Zotero.state.getSelectedItemKeys();t.trigger("selectedItemsChanged",{selectedItemKeys:a})},handleItemLinkClick:function(e){e.preventDefault();var t=J(e.target).data("itemkey");Zotero.state.pathVars.itemKey=t,Zotero.state.pushState()},render:function(){var e=this,t=this.props.item,r=this.props.selected;if(this.props.narrow)return React.createElement("tr",{className:r?"highlighed":"","data-itemkey":t.get("key")},React.createElement("td",{className:"edit-checkbox-td","data-itemkey":t.get("key")},React.createElement("input",{type:"checkbox",className:"itemlist-editmode-checkbox itemKey-checkbox",name:"selectitem-"+t.get("key"),"data-itemkey":t.get("key")})),React.createElement(SingleCellItemField,{onClick:e.handleItemLinkClick,item:t,displayFields:this.props.displayFields}));var a=this.props.displayFields.map(function(r){var a=null;return"title"==r&&(a=React.createElement(ColoredTags,{item:t})),React.createElement("td",{onClick:e.handleItemLinkClick,key:r,className:r,"data-itemkey":t.get("key")},a,React.createElement("a",{onClick:e.handleItemLinkClick,className:"item-select-link","data-itemkey":t.get("key"),href:Zotero.url.itemHref(t),title:t.get(r)},Zotero.ui.formatItemField(r,t,!0)))});return React.createElement("tr",{className:r?"highlighed":""},React.createElement("td",{className:"edit-checkbox-td","data-itemkey":t.get("key")},React.createElement("input",{type:"checkbox",onChange:this.handleSelectChange,checked:r,className:"itemlist-editmode-checkbox itemKey-checkbox",name:"selectitem-"+t.get("key"),"data-itemkey":t.get("key")})),a)}}),SingleCellItemField=React.createClass({displayName:"SingleCellItemField",render:function(){var e=this.props.item,t=(this.props.field,[]);return this.props.displayFields.forEach(function(r){var a=Zotero.Item.prototype.fieldMap[r]?Zotero.Item.prototype.fieldMap[r]+":":"";"title"==r?(t.push(React.createElement("span",{key:"itemTypeIcon",className:"sprite-icon pull-left sprite-treeitem-"+e.itemTypeImageClass()
})),t.push(React.createElement(ColoredTags,{key:"coloredTags",item:e})),t.push(React.createElement("b",{key:"title"},Zotero.ui.formatItemField(r,e,!0)))):"dateAdded"===r||"dateModified"===r?t.push(React.createElement("p",{key:r,title:e.get(r),dangerouslySetInnerHtml:{__html:a+Zotero.ui.formatItemDateField(r,e,!0)}})):t.push(React.createElement("p",{key:r,title:e.get(r)},a,Zotero.ui.formatItemField(r,e,!0)))}),React.createElement("td",{onClick:this.props.onClick,className:"single-cell-item","data-itemkey":e.get("key")},React.createElement("a",{className:"item-select-link","data-itemkey":e.get("key"),href:Zotero.url.itemHref(e)},t))}}),ColoredTags=React.createClass({displayName:"ColoredTags",render:function(){var e=this.props.item,t=e.owningLibrary,r=t.matchColoredTags(e.apiObj._supplement.tagstrings);Z.debug("coloredTags:"+JSON.stringify(r));var a=r.map(function(e){return React.createElement(ColoredTag,{key:e,color:e})});return React.createElement("span",{className:"coloredTags"},a)}}),ColoredTag=React.createClass({displayName:"ColoredTag",render:function(){var e={color:this.props.color};return React.createElement("span",{style:e},React.createElement("span",{style:e,className:"glyphicons fonticon glyphicons-tag"}))}});Zotero.ui.widgets.library={},Zotero.ui.widgets.library.init=function(e){Z.debug("Zotero.ui.widgets.library.init");var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(ReactZoteroLibrary,{library:t}),document.getElementById("library-widget"))};var ReactZoteroLibrary=React.createClass({displayName:"ReactZoteroLibrary",componentWillMount:function(){Z.debug("ReactZoteroLibrary componentWillMount",3);var e=this;Zotero.reactLibraryInstance=e;var t=this.props.library;t.loadSettings(),t.listen("deleteIdb",function(){t.idbLibrary.deleteDB()}),t.listen("indexedDBError",function(){Zotero.ui.jsNotificationMessage("There was an error initializing your library. Some data may not load properly.","notice")}),t.listen("cachedDataLoaded",function(){}),J(window).on("resize",function(){window.matchMedia("(min-width: 768px)").matches?0!=e.state.narrow&&e.setState({narrow:!1}):1!=e.state.narrow&&e.setState({narrow:!0})})},componentDidMount:function(){var e=this,t=this.props.library;t.listen("displayedItemsChanged",function(){Z.debug("ReactZoteroLibrary displayedItemsChanged"),e.refs.itemsWidget.loadItems()},{}),t.listen("tagsChanged libraryTagsUpdated selectedTagsChanged",function(){Z.debug("setting tags on tagsWidget from Library"),e.refs.tagsWidget.setState({tags:t.tags})}),J(e.refs.itemsPanel).on("scroll",function(){var t=J(e.refs.itemsPanel);t.scrollTop()+t.innerHeight()>=t[0].scrollHeight&&e.refs.itemsWidget.loadMoreItems()})},getInitialState:function(){var e;return window.matchMedia("(min-width: 768px)").matches?e=!1:(Z.debug("Library set to narrow",3),e=!0),{narrow:e,activePanel:"items",deviceSize:"xs"}},showFiltersPanel:function(e){e.preventDefault(),this.setState({activePanel:"filters"})},showItemsPanel:function(e){e.preventDefault(),this.setState({activePanel:"items"})},reflowPanelContainer:function(){},render:function(){Z.debug("react library render");var e,t=this,r=this.props.library,a=Zotero.config.loggedInUser,o=a?a.displayName:null,i=Zotero.config.baseWebsiteUrl,n=i+"/settings",s=i+"/messages/inbox",l=i+"/download",c=i+"/support",d=Zotero.config.baseForumsUrl,u=i+"/user/logout",p=i+"/user/login",m=i,g=function(e){return i+"/static"+e},f=a.unreadMessages>0?React.createElement("strong",null,"Inbox (",a.unreadMessages,")"):"Inbox";e=a?[React.createElement("button",{key:"button",type:"button",href:"#",className:"btn btn-default navbar-btn dropdown-toggle","data-toggle":"dropdown",role:"button","aria-expanded":"false"},o,React.createElement("span",{className:"caret"}),React.createElement("span",{className:"sr-only"},"Toggle Dropdown")),React.createElement("ul",{key:"listEntries",className:"dropdown-menu",role:"menu"},React.createElement("li",null,React.createElement("a",{href:n},"Settings")),React.createElement("li",null,React.createElement("a",{href:s},f)),React.createElement("li",null,React.createElement("a",{href:l},"Download")),React.createElement("li",{className:"divider"}),React.createElement("li",null,React.createElement("a",{href:c,className:"documentation"},"Documentation")),React.createElement("li",null,React.createElement("a",{href:d,className:"forums"},"Forums")),React.createElement("li",{className:"divider"}),React.createElement("li",null,React.createElement("a",{href:u},"Log Out")))]:React.createElement("div",{className:"btn-group"},React.createElement("a",{href:p,className:"btn btn-default navbar-btn",role:"button"},"Log In"),React.createElement("button",{type:"button",href:"#",className:"btn btn-default navbar-btn dropdown-toggle","data-toggle":"dropdown",role:"button","aria-haspopup":"true","aria-expanded":"false"},React.createElement("span",{className:"caret"}),React.createElement("span",{className:"sr-only"},"Toggle Dropdown")),React.createElement("ul",{className:"dropdown-menu",role:"menu"},React.createElement("li",null,React.createElement("a",{href:l},"Download")),React.createElement("li",null,React.createElement("a",{href:c,className:"documentation"},"Documentation")),React.createElement("li",null,React.createElement("a",{href:d,className:"forums"},"Forums"))));var h=t.state.narrow,b=!h,y=!h,v=!h,w=!h,R=!h,E=!h;if(h)switch(t.state.activePanel){case"items":y=!0,v=!0;break;case"item":y=!0,w=!0;break;case"tags":b=!0,R=!0;break;case"collections":b=!0,E=!0;break;case"filters":b=!0}return React.createElement("div",null,React.createElement("nav",{id:"primarynav",className:"navbar navbar-default",role:"navigation"},React.createElement("div",{className:"container-fluid"},React.createElement("div",{className:"navbar-header"},React.createElement("button",{type:"button",className:"navbar-toggle collapsed","data-toggle":"collapse","data-target":"#primary-nav-linklist"},o,React.createElement("span",{className:"sr-only"},"Toggle navigation"),React.createElement("span",{className:"glyphicons fonticon glyphicons-menu-hamburger"})),React.createElement("a",{className:"navbar-brand hidden-sm hidden-xs",href:m},React.createElement("img",{src:g("/images/theme/zotero.png"),alt:"Zotero",height:"20px"})),React.createElement("a",{className:"navbar-brand visible-sm-block visible-xs-block",href:m},React.createElement("img",{src:g("/images/theme/zotero_theme/zotero_48.png"),alt:"Zotero",height:"24px"}))),React.createElement("div",{className:"collapse navbar-collapse",id:"primary-nav-linklist"},React.createElement(ControlPanel,{library:r,editable:Zotero.config.librarySettings.allowEdit,ref:"controlPanel"}),React.createElement("ul",{className:"nav navbar-nav navbar-right"},e),React.createElement("div",{className:"btn-toolbar hidden-xs navbar-right"},React.createElement(LibrarySearchBox,{library:r}))))),React.createElement("div",{id:"js-message"},React.createElement("ul",{id:"js-message-list"})),React.createElement("div",{id:"library",className:"row"},React.createElement("div",{id:"panel-container"},React.createElement("div",{id:"left-panel",hidden:!b,className:"panelcontainer-panelcontainer col-xs-12 col-sm-4 col-md-3"},React.createElement(FilterGuide,{ref:"filterGuide",library:r}),React.createElement("div",{role:"tabpanel"},React.createElement("ul",{className:"nav nav-tabs",role:"tablist"},React.createElement("li",{role:"presentation",className:"active"},React.createElement("a",{href:"#collections-panel","aria-controls":"collections-panel",role:"tab","data-toggle":"tab"},"Collections")),React.createElement("li",{role:"presentation"},React.createElement("a",{href:"#tags-panel","aria-controls":"tags-panel",role:"tab","data-toggle":"tab"},"Tags"))),React.createElement("div",{className:"tab-content"},React.createElement("div",{id:"collections-panel",role:"tabpanel",className:"tab-pane active"},React.createElement(Collections,{ref:"collectionsWidget",library:r})),React.createElement("div",{id:"tags-panel",role:"tabpanel",className:"tab-pane"},React.createElement(Tags,{ref:"tagsWidget",library:r}),React.createElement(FeedLink,{ref:"feedLinkWidget",library:r}))))),React.createElement("div",{id:"right-panel",hidden:!y,className:"panelcontainer-panelcontainer col-xs-12 col-sm-8 col-md-9"},React.createElement("div",{hidden:!v,ref:"itemsPanel",id:"items-panel",className:"panelcontainer-panel col-sm-12 col-md-7"},React.createElement("div",{className:"visible-xs library-search-box-container"},React.createElement(LibrarySearchBox,{library:r})),React.createElement(Items,{ref:"itemsWidget",library:r,narrow:h})),React.createElement("div",{hidden:!w,id:"item-panel",className:"panelcontainer-panel col-sm-12 col-md-5"},React.createElement("div",{id:"item-widget-div",className:"item-details-div"},React.createElement(ItemDetails,{ref:"itemWidget",library:r})))),React.createElement("nav",{id:"panelcontainer-nav",className:"navbar navbar-default navbar-fixed-bottom visible-xs-block",role:"navigation"},React.createElement("div",{className:"container-fluid"},React.createElement("ul",{className:"nav navbar-nav"},React.createElement("li",{onClick:t.showFiltersPanel,className:"filters-nav"},React.createElement("a",{href:"#"},"Filters")),React.createElement("li",{onClick:t.showItemsPanel,className:"items-nav"},React.createElement("a",{href:"#"},"Items"))))),React.createElement(SendToLibraryDialog,{ref:"sendToLibraryDialogWidget",library:r}),React.createElement(CreateCollectionDialog,{ref:"createCollectionDialogWidget",library:r}),React.createElement(UpdateCollectionDialog,{library:r}),React.createElement(DeleteCollectionDialog,{library:r}),React.createElement(AddToCollectionDialog,{library:r}),React.createElement(CreateItemDialog,{library:r}),React.createElement(CiteItemDialog,{library:r}),React.createElement(UploadAttachmentDialog,{library:r}),React.createElement(ExportItemsDialog,{library:r}),React.createElement(LibrarySettingsDialog,{library:r}),React.createElement(ChooseSortingDialog,{library:r}))))}});Zotero.ui.widgets.reactlibrarysettingsdialog={},Zotero.ui.widgets.reactlibrarysettingsdialog.init=function(e){Z.debug("librarysettingsdialog widget init",3);var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(LibrarySettingsDialog,{library:t}),document.getElementById("library-settings-dialog"))};var LibrarySettingsDialog=React.createClass({displayName:"LibrarySettingsDialog",componentWillMount:function(){var e=this,t=this.props.library;t.listen("settingsLoaded",e.updateStateFromLibrary,{}),t.listen("librarySettingsDialog",e.openDialog,{})},getInitialState:function(){return{listDisplayedFields:[],itemsPerPage:25,showAutomaticTags:!0}},openDialog:function(){this.refs.modal.open()},closeDialog:function(e){this.refs.modal.close()},updateShowFields:function(e){Z.debug("updateShowFields");var t=this.props.library,r=this.state.listDisplayedFields,a=e.target.value,o=e.target.checked;o?(Z.debug("adding field "+a+" to listDisplayedFields"),r.push(a)):(Z.debug("filtering field "+a+" from listDisplayedFields"),r=r.filter(function(e){return e==a?!1:!0})),this.setState({listDisplayedFields:r}),t.preferences.setPref("listDisplayedFields",r),t.preferences.persist(),t.trigger("displayedItemsChanged")},updateShowAutomaticTags:function(e){var t=this.props.library,r=e.target.checked;this.setState({showAutomaticTags:r}),t.preferences.setPref("showAutomaticTags",r),t.preferences.persist(),t.trigger("tagsChanged")},updateStateFromLibrary:function(){var e=this.props.library;this.setState({listDisplayedFields:e.preferences.getPref("listDisplayedFields"),itemsPerPage:e.preferences.getPref("itemsPerPage"),showAutomaticTags:e.preferences.getPref("showAutomaticTags")})},render:function(){var e=this,t=(this.props.library,this.state.listDisplayedFields),r=(this.state.itemsPerPage,this.state.showAutomaticTags,Zotero.localizations.fieldMap),a=Zotero.Library.prototype.displayableColumns.map(function(a,o){var i=-1!=t.indexOf(a);return React.createElement("div",{key:a,className:"checkbox"},React.createElement("label",{htmlFor:"display-column-field-"+a},React.createElement("input",{onChange:e.updateShowFields,type:"checkbox",checked:i,name:"display-column-field",value:a,id:"display-column-field-"+a,className:"display-column-field"}),r[a]||a))});return React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"library-settings-dialog",className:"library-settings-dialog",role:"dialog","aria-hidden":"true","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",{className:"modal-title"},"Library Settings")),React.createElement("div",{className:"modal-body"},React.createElement("form",{id:"library-settings-form",className:"library-settings-form",role:"form"},React.createElement("fieldset",null,React.createElement("legend",null,"Display Columns"),a),React.createElement("div",{className:"checkbox"},React.createElement("label",{htmlFor:"show-automatic-tags"},React.createElement("input",{onChange:this.updateShowAutomaticTags,type:"checkbox",id:"show-automatic-tags",name:"show-automatic-tags"}),"Show Automatic Tags"),React.createElement("p",{className:"help-block"},"Automatic tags are tags added automatically when a reference was imported, rather than by a user.")))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{className:"btn btn-default","data-dismiss":"modal","aria-hidden":"true"},"Close"))))))}}),LoadingError=React.createClass({displayName:"LoadingError",render:function(){return React.createElement("p",{hidden:!this.props.errorLoading},"There was an error loading your items. Please try again in a few minutes.")}}),LoadingSpinner=React.createClass({displayName:"LoadingSpinner",render:function(){var e=Zotero.config.baseWebsiteUrl+"/static/images/theme/broken-circle-spinner.gif";return React.createElement("div",{className:"items-spinner",hidden:!this.props.loading},React.createElement("img",{className:"spinner",src:e}))}});Zotero.ui.widgets.profileGroupsList={},Zotero.ui.widgets.profileGroupsList.init=function(e){Z.debug("Zotero.ui.widgets.profileGroupsList");var t=zoteroData.profileUserID;ReactDOM.render(React.createElement(ProfileGroupsList,{userID:t}),document.getElementById("profile-groups-div"))};var ProfileGroupsList=React.createClass({displayName:"ProfileGroupsList",componentWillMount:function(){var e=this,t=new Zotero.Groups;e.setState({loading:!0}),t.fetchUserGroups(e.props.userID).then(function(t){var r=t.fetchedGroups;e.setState({groups:r,loading:!1})})["catch"](Zotero.catchPromiseError)},getInitialState:function(){return{groups:[],loading:!1}},render:function(){var e=this;Z.debug(e.state.groups);var t=e.state.groups.map(function(e){return React.createElement("li",{key:e.get("id")},React.createElement("a",{href:Zotero.url.groupViewUrl(e)},e.get("name")))});return React.createElement("div",{className:"profile-groups-list"},React.createElement("h2",null,"Groups"),React.createElement(LoadingSpinner,{loading:e.state.loading}),React.createElement("ul",null,t))}});Zotero.ui.widgets.recentItems={},Zotero.ui.widgets.recentItems.init=function(e){Z.debug("widgets.recentItems.init");var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(RecentItems,{library:t}),e)};var RecentItems=React.createClass({displayName:"RecentItems",componentWillMount:function(){var e=this,t=e.props.library;e.setState({loading:!0}),t.loadItems({limit:10,order:"dateModified"}).then(function(t){e.setState({loading:!1,items:t.loadedItems})})},getDefaultProps:function(){return{displayFields:["title","creatorSummary","dateModified"],item:{}}},getInitialState:function(){return{loading:!1,items:[]}},render:function(){var e=this.state.items.map(function(e){return React.createElement(RecentItemRow,{key:e.get("key"),item:e})}),t=this.props.displayFields.map(function(e){return React.createElement("th",{key:e,className:"field-table-header"},Zotero.Item.prototype.fieldMap[e]?Zotero.Item.prototype.fieldMap[e]:e)});return React.createElement("table",{id:"field-table",ref:"itemsTable",className:"wide-items-table table table-striped"},React.createElement("thead",null,React.createElement("tr",null,t)),React.createElement("tbody",null,e))}}),RecentItemRow=React.createClass({displayName:"RecentItemRow",getDefaultProps:function(){return{displayFields:["title","creatorSummary","dateModified"],item:{}}},render:function(){var e=this.props.item,t=this.props.displayFields.map(function(t){return React.createElement("td",{key:t,className:t,"data-itemkey":e.get("key")},React.createElement("a",{"data-itemkey":e.get("key"),href:Zotero.url.itemHref(e),title:e.get(t)},Zotero.ui.formatItemField(t,e,!0)))});return React.createElement("tr",null,t)}});Zotero.ui.widgets.reactsearchbox={},Zotero.ui.widgets.reactsearchbox.init=function(e){Z.debug("Zotero.eventful.init.searchbox",3);var t=Zotero.ui.getAssociatedLibrary(e);J(e),ReactDOM.render(React.createElement(LibrarySearchBox,{library:t}),document.getElementById("search-box"))};var LibrarySearchBox=React.createClass({displayName:"LibrarySearchBox",getInitialState:function(){return{searchType:"simple"}},search:function(e){e.preventDefault(),Z.debug("library-search form submitted",3),Zotero.state.clearUrlVars(["collectionKey","tag","q","qmode"]);var t=J(e.target),r=t.find("input.search-query").val(),a=t.find("input.search-query").data("searchtype");return(""!==r||Zotero.state.getUrlVar("q"))&&(Zotero.state.pathVars.q=r,"simple"!=a&&(Zotero.state.pathVars.qmode=a),Zotero.state.pushState()),!1},clearLibraryQuery:function(e){Zotero.state.unsetUrlVar("q"),Zotero.state.unsetUrlVar("qmode"),J(".search-query").val(""),Zotero.state.pushState()},changeSearchType:function(e){e.preventDefault();var t=J(e.target),r=t.data("searchtype");this.setState({searchType:r})},render:function(){var e="";"simple"==this.state.searchType?e="Search Title, Creator, Year":"everything"==this.state.searchType&&(e="Search Full Text");var t=Zotero.state.getUrlVar("q");return React.createElement("div",{className:"btn-toolbar row",id:"search-box",style:{maxWidth:"350px"}},React.createElement("form",{action:"/search/",onSubmit:this.search,className:"navbar-form zsearch library-search",role:"search"},React.createElement("div",{className:"input-group"},React.createElement("div",{className:"input-group-btn"},React.createElement("button",{type:"button",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown"},React.createElement("span",{className:"caret"})),React.createElement("ul",{className:"dropdown-menu"},React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.changeSearchType,"data-searchtype":"simple"},"Title, Creator, Year")),React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.changeSearchType,"data-searchtype":"everything"},"Full Text")))),React.createElement("input",{defaultValue:t,type:"text",name:"q",id:"header-search-query",className:"search-query form-control",placeholder:e}),React.createElement("span",{className:"input-group-btn"},React.createElement("button",{onClick:this.clearLibraryQuery,className:"btn btn-default clear-field-button",type:"button"},React.createElement("span",{className:"glyphicons fonticon glyphicons-remove-2"}))))))}});Zotero.ui.widgets.reactsendToLibraryDialog={},Zotero.ui.widgets.reactsendToLibraryDialog.init=function(e){Z.debug("sendToLibraryDialog widget init",3);var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(SendToLibraryDialog,{library:t}),document.getElementById("send-to-library-dialog"))};var SendToLibraryDialog=React.createClass({displayName:"SendToLibraryDialog",componentWillMount:function(){var e=this,t=this.props.library;t.listen("sendToLibraryDialog",e.openDialog,{})},getInitialState:function(){return{writableLibraries:[],loading:!1,loaded:!1}},handleLibraryChange:function(e){this.setState({targetLibrary:e.target.value})},openDialog:function(){this.refs.modal.open(),this.state.loaded||this.loadForeignLibraries()},closeDialog:function(e){this.refs.modal.close()},loadForeignLibraries:function(){var e=this,t=this.props.library,r=Zotero.config.loggedInUserID,a="u"+r;this.setState({loading:!0});t.groups.fetchUserGroups(r).then(function(t){Z.debug("got member groups",3);for(var o=t.fetchedGroups,i=[{name:"My Library",libraryString:a}],n=0;n<o.length;n++)if(o[n].isWritable(r)){var s="g"+o[n].get("id");i.push({name:o[n].get("name"),libraryString:s})}e.setState({writableLibraries:i,loading:!1,loaded:!0})})["catch"](function(e){Zotero.ui.jsNotificationMessage("There was an error loading group libraries","error"),Z.error(e),Z.error(e.message)})},sendItem:function(e){Z.debug("sendToLibrary callback",3);var t=this.props.library,r=this.state.targetLibrary,a=Zotero.utils.parseLibString(r),o=new Zotero.Library(a.libraryType,a.libraryID);Zotero.libraries[r]=o;var i=Zotero.state.getSelectedItemKeys();if(0===i.length)return Zotero.ui.jsNotificationMessage("No items selected","notice"),this.closeDialog(),!1;var n=t.items.getItems(i);return t.sendToLibrary(n,o).then(function(e){Zotero.ui.jsNotificationMessage("Items sent to other library","notice")})["catch"](function(e){Z.debug(e),Zotero.ui.jsNotificationMessage("Error sending items to other library","notice")}),this.closeDialog(),!1},render:function(){var e=this.state.writableLibraries,t=e.map(function(e){return React.createElement("option",{key:e.libraryString,value:e.libraryString},e.name)});return React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"send-to-library-dialog",className:"send-to-library-dialog",role:"dialog","aria-hidden":"true",title:"Send to Library","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",null,"Send To Library")),React.createElement("div",{className:"send-to-library-div modal-body","data-role":"content"},React.createElement("form",null,React.createElement("div",{"data-role":"fieldcontain"},React.createElement("label",{htmlFor:"destination-library"},"Library"),React.createElement("select",{onChange:this.handleLibraryChange,className:"destination-library-select form-control",name:"desination-library"},t)))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{onClick:this.closeDialog,className:"btn","data-dismiss":"modal","aria-hidden":"true"},"Close"),React.createElement("button",{onClick:this.sendItem,className:"btn btn-primary sendButton"},"Send"))))))}});Zotero.ui.widgets.reacttags={},Zotero.ui.widgets.reacttags.init=function(e){Z.debug("tags widget init",3);var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(Tags,{library:t}),document.getElementById("tags-list-div"))};var TagRow=React.createClass({displayName:"TagRow",getDefaultProps:function(){return{showAutomatic:!1}},handleClick:function(e){e.stopPropagation(),e.preventDefault();var t=this.props.tag;Z.state.toggleTag(t.apiObj.tag),Z.state.clearUrlVars(["tag","collectionKey"]),Z.state.pushState()},render:function(){var e=this.props.tag,t=e.apiObj.tag;e.apiObj.meta.numItems&&(t+=" ("+e.apiObj.meta.numItems+")");var r="",a={};return e.color&&(a={color:e.color,fontWeight:"bold"}),0==this.props.showAutomatic&&0!=e.apiObj.meta.type?null:React.createElement("li",{className:"tag-row"},React.createElement("a",{onClick:this.handleClick,className:"tag-link",title:t,style:a,href:r},Zotero.ui.trimString(e.apiObj.tag,12)))}}),TagList=React.createClass({displayName:"TagList",getDefaultProps:function(){return{tags:[],showAutomatic:!1,id:""}},render:function(){var e=this.props.showAutomatic,t=this.props.tags.map(function(t,r){return React.createElement(TagRow,{key:t.apiObj.tag,tag:t,showAutomatic:e})});return React.createElement("ul",{id:this.props.id},t)}}),Tags=React.createClass({displayName:"Tags",getDefaultProps:function(){return{}},getInitialState:function(){return{tags:new Zotero.Tags,tagColors:null,selectedTags:[],tagFilter:"",showAutomatic:!1,loading:!1}},componentWillMount:function(e){var t=this,r=this.props.library,a=r.preferences.getPref("tagColors");t.setState({tagColors:a}),r.listen("tagsDirty",t.syncTags,{}),r.listen("cachedDataLoaded",t.syncTags,{}),r.listen("tagsChanged libraryTagsUpdated selectedTagsChanged",function(e){t.setState({tags:r.tags})},{})},handleFilterChanged:function(e){this.setState({tagFilter:e.target.value})},getSelectedTagsArray:function(){var e=Zotero.state.getUrlVar("tag");return J.isArray(e)||(e=e?[e]:[]),e},syncTags:function(e){Z.debug("Tags.syncTags");var t=this;if(!this.state.loading){var r=this.props.library;e.data&&e.data.checkCached===!1&&r.tags.clear(),t.setState({tags:r.tags,loading:!0});r.loadUpdatedTags().then(function(){Z.debug("syncTags done. clearing loading div"),t.setState({tags:r.tags,loading:!1})},function(e){Z.error("syncTags failed. showing local data and clearing loading div"),t.setState({tags:r.tags,loading:!1}),Zotero.ui.jsNotificationMessage("There was an error loading tags. Some tags may not have been updated.","notice")})}},render:function(){var e=this,t=this.state.tags,r=e.getSelectedTagsArray(),a=this.state.tagColors;null===a&&(a=[]);var o=this.state.tagFilter,i=t.plainTagsList(t.tagsArray),n=Z.utils.matchAnyAutocomplete(o,i),s=[],l=[];a.forEach(function(e,r){Z.debug("tagColor processing "+r),s.push(e.name.toLowerCase());var a=t.getTag(e.name);a&&(a.color=e.color,l.push(a))});var c=[],d=[];return r.forEach(function(e){var r=t.getTag(e);r&&d.push(r)}),n.forEach(function(e){var a=t.getTag(e);null!==a&&a.apiObj.meta.numItems>0&&-1==r.indexOf(e)&&-1==s.indexOf(e)&&c.push(a)}),React.createElement("div",{id:"tags-list-div",className:"tags-list-div"},React.createElement("div",null,React.createElement("input",{type:"text",id:"tag-filter-input",className:"tag-filter-input form-control",placeholder:"Filter Tags",onChange:this.handleFilterChanged}),React.createElement(LoadingSpinner,{loading:this.state.loading}),React.createElement(TagList,{tags:d,id:"selected-tags-list"}),React.createElement(TagList,{tags:l,id:"colored-tags-list"}),React.createElement(TagList,{tags:c,id:"tags-list"})))}});Zotero.ui.widgets.reactupdateCollectionDialog={},Zotero.ui.widgets.reactupdateCollectionDialog.init=function(e){Z.debug("updatecollectionsdialog widget init",3);var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(UpdateCollectionDialog,{library:t}),document.getElementById("update-collection-dialog"))};var UpdateCollectionDialog=React.createClass({displayName:"UpdateCollectionDialog",componentWillMount:function(){var e=this,t=this.props.library;t.listen("updateCollectionDialog",function(){var r=Zotero.state.getUrlVar("collectionKey"),a=t.collections.getCollection(r),o="",i="";a&&(o=a.get("parentCollection"),i=a.get("name")),e.setState({collectionName:i,parentCollection:o}),e.openDialog()},{})},getInitialState:function(){return{collectionName:"",parentCollection:null}},handleCollectionChange:function(e){this.setState({parentCollection:e.target.value})},handleNameChange:function(e){this.setState({collectionName:e.target.value})},openDialog:function(){this.refs.modal.open()},closeDialog:function(e){this.refs.modal.close()},saveCollection:function(e){var t=this,r=this.props.library,a=this.state.parentCollection,o=this.state.collectionName;""==o&&(o="Untitled");var i=Zotero.state.getUrlVar("collectionKey"),n=r.collections.getCollection(i);return n?(Z.debug("updating collection: "+a+": "+o),void n.update(o,a).then(function(e){Zotero.ui.jsNotificationMessage("Collection Saved","confirm"),r.collections.dirty=!0,r.collections.initSecondaryData(),r.trigger("libraryCollectionsUpdated"),Zotero.state.pushState(!0),t.closeDialog()})["catch"](Zotero.catchPromiseError)):(Zotero.ui.jsNotificationMessage("Selected collection not found","error"),!1)},render:function(){var e=this.props.library,t=e.collections.nestedOrderingArray(),r=t.map(function(e,t){return React.createElement("option",{key:e.get("key"),value:e.get("key")},"-".repeat(e.nestingDepth)," ",e.get("name"))});return r.unshift(React.createElement("option",{key:"emptyvalue",value:""},"None")),React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"update-collection-dialog",className:"update-collection-dialog",role:"dialog",title:"Update Collection","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",null,"Update Collection")),React.createElement("div",{className:"update-collection-div modal-body"},React.createElement("form",{method:"POST",className:"zform"},React.createElement("ol",null,React.createElement("li",null,React.createElement("label",{htmlFor:"updated-collection-title-input"},"Rename Collection"),React.createElement("input",{value:this.state.collectionName,onChange:this.handleNameChange,id:"updated-collection-title-input",className:"updated-collection-title-input form-control"})),React.createElement("li",null,React.createElement("label",{htmlFor:"update-collection-parent-select"},"Parent Collection"),React.createElement("select",{value:this.state.parentCollection,onChange:this.handleCollectionChange,className:"collectionKey-select update-collection-parent form-control"},r))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{className:"btn","data-dismiss":"modal","aria-hidden":"true"},"Close"),React.createElement("button",{onClick:this.saveCollection,className:"btn btn-primary updateButton"},"Update"))))))}});Zotero.ui.widgets.reactuploadDialog={},Zotero.ui.widgets.reactuploadDialog.init=function(e){Z.debug("uploaddialog widget init",3);var t=Zotero.ui.getAssociatedLibrary(e);ReactDOM.render(React.createElement(UploadAttachmentDialog,{library:t}),document.getElementById("upload-dialog"))};var UploadAttachmentDialog=React.createClass({displayName:"UploadAttachmentDialog",componentWillMount:function(){var e=this,t=this.props.library;t.listen("uploadAttachment",function(){Z.debug("got uploadAttachment event; opening upload dialog"),e.setState({itemKey:Zotero.state.getUrlVar("itemKey")}),e.openDialog()},{})},getInitialState:function(){return{title:"",fileInfo:null,filename:"",filesize:0,contentType:null,percentLoaded:0,uploading:!1}},upload:function(){Z.debug("uploadFunction",3);var e=this,t=this.props.library,r=this.state.fileInfo,a=this.state.title,o=function(t){Z.debug("fullUpload.upload.onprogress",3);var r=Math.round(t.loaded/t.total*100);e.setState({percentLoaded:r})};this.setState({uploading:!0});var i,n=Zotero.state.getUrlVar("itemKey"),s=t.items.getItem(n);if(s.get("parentItem"))"attachment"==s.get("itemType")&&"imported_file"==s.get("linkMode")&&(Z.debug("imported_file attachment",3),i=s.uploadFile(r,o));else{Z.debug("no parentItem",3);var l=new Zotero.Item;l.associateWithLibrary(t),i=l.initEmpty("attachment","imported_file").then(function(e){return Z.debug("templateItemDeferred callback",3),e.set("title",a),s.uploadChildAttachment(e,r,o)})}i.then(function(){Z.debug("uploadSuccess",3),t.trigger("uploadSuccessful"),e.closeDialog()})["catch"](e.failureHandler).then(function(){e.closeDialog()})},handleUploadFailure:function(e){switch(Z.debug("Upload failed",3),Z.debug(e,3),Zotero.ui.jsNotificationMessage("There was a problem uploading your file.","error"),e.code){case 400:Zotero.ui.jsNotificationMessage("Bad Input. 400","error");break;case 403:Zotero.ui.jsNotificationMessage("You do not have permission to edit files","error");
break;case 409:Zotero.ui.jsNotificationMessage("The library is currently locked. Please try again in a few minutes.","error");break;case 412:Zotero.ui.jsNotificationMessage("File conflict. Remote file has changed","error");break;case 413:Zotero.ui.jsNotificationMessage("Requested upload would exceed storage quota.","error");break;case 428:Zotero.ui.jsNotificationMessage("Precondition required error","error");break;case 429:Zotero.ui.jsNotificationMessage("Too many uploads pending. Please try again in a few minutes","error");break;default:Zotero.ui.jsNotificationMessage("Unknown error uploading file. "+e.code,"error")}},handleFiles:function(e){Z.debug("attachmentUpload handleFiles",3);var t=this;if("undefined"==typeof e||0===e.length)return!1;var r=e[0];Zotero.file.getFileInfo(r).then(function(e){Z.debug(e),t.setState({fileInfo:e,filename:e.filename,filesize:e.filesize,contentType:e.contentType})})},handleDrop:function(e){Z.debug("fileuploaddroptarget drop callback",3),e.stopPropagation(),e.preventDefault();var t=e.originalEvent,r=t.dataTransfer,a=r.files;this.handleFiles(a)},handleFileInputChange:function(e){Z.debug("fileuploaddroptarget callback 1",3),e.stopPropagation(),e.preventDefault();var t=J(this.refs.fileInput).get(0).files;this.handleFiles(t)},handleTitleChange:function(e){this.setState({title:e.target.value})},openDialog:function(){this.refs.modal.open()},closeDialog:function(e){this.refs.modal.close()},render:function(){this.props.library;return React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"upload-attachment-dialog",className:"upload-attachment-dialog",role:"dialog",title:"Upload Attachment","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",{className:"modal-title"},"Upload Attachment")),React.createElement("div",{className:"upload-attachment-div modal-body","data-role":"content"},React.createElement("form",{className:"attachmentuploadForm zform"},React.createElement("h3",null,"Select a file for upload or drag and drop below"),React.createElement("span",{className:"btn btn-primary btn-file"},"Choose File",React.createElement("input",{onChange:this.handleFileInputChange,ref:"fileInput",type:"file",id:"fileuploadinput",className:"fileuploadinput",multiple:!0})),React.createElement("div",{onDrop:this.handleDrop,id:"fileuploaddroptarget",className:"fileuploaddroptarget"},React.createElement("h3",null,"Drop your file here"),React.createElement("h3",{id:"droppedfilename",className:"droppedfilename"}),React.createElement(LoadingSpinner,{loading:this.state.uploading})),React.createElement("div",{id:"attachmentuploadfileinfo",className:"attachmentuploadfileinfo"},React.createElement("table",{className:"table table-striped"},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("th",null,"Title"),React.createElement("td",null,React.createElement("input",{onChange:this.handleTitleChange,id:"upload-file-title-input",className:"upload-file-title-input form-control",type:"text"}))),React.createElement("tr",null,React.createElement("th",null,"Size"),React.createElement("td",{className:"uploadfilesize"},this.state.filesize)),React.createElement("tr",null,React.createElement("th",null,"Type"),React.createElement("td",{className:"uploadfiletype"},this.state.contentType)),React.createElement("tr",null,React.createElement("th",null,"Upload"),React.createElement("td",{className:"uploadprogress"},React.createElement("meter",{min:"0",max:"100",id:"uploadprogressmeter",value:this.state.percentLoaded})))))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-default","data-dismiss":"modal","aria-hidden":"true"},"Close"),React.createElement("button",{onClick:this.upload,type:"button",className:"btn btn-primary uploadButton"},"Upload"))))))}});Zotero.ui.widgets.reactGroups={},Zotero.ui.widgets.reactGroups.init=function(e){Z.debug("Zotero.ui.widgets.reactGroups");ReactDOM.render(React.createElement(UserGroups,null),document.getElementById("user-groups-div"))};var GroupNugget=React.createClass({displayName:"GroupNugget",render:function(){var e=this.props.group,t=Zotero.config.loggedInUserID,r=!1,a=1;e.apiObj.data.members&&(a+=e.apiObj.data.members.length),e.apiObj.data.admins&&(a+=e.apiObj.data.admins.length),!t||t!=e.apiObj.data.owner&&-1==J.inArray(t,e.apiObj.data.admins)||(r=!0);var o=null;e.hasImage&&(o=React.createElement("a",{href:Zotero.url.groupViewUrl(e),className:"group-image"},React.createElement("img",{src:Zotero.url.groupImageUrl(e),alt:""})));var i=null;r&&(i=React.createElement("nav",{className:"action-links"},React.createElement("li",null,React.createElement("a",{href:Zotero.url.groupSettingsUrl(e)},"Manage Profile")),React.createElement("li",null,React.createElement("a",{href:Zotero.url.groupMemberSettingsUrl(e)},"Manage Members")),React.createElement("li",null,React.createElement("a",{href:Zotero.url.groupLibrarySettingsUrl(e)},"Manage Library"))));var n=null;if(e.apiObj.data.description){var s={__html:e.apiObj.data.description};n=React.createElement("tr",null,React.createElement("th",{scope:"row"},"Description"),React.createElement("td",{dangerouslySetInnerHTML:s}))}var l=Zotero.Group.prototype.accessMap[e.apiObj.data.libraryReading][e.apiObj.data.libraryEditing];return"Private"==e.apiObj.data.type&&"all"==e.apiObj.data.libraryReading&&(l=Zotero.Group.prototype.accessMap.members[e.apiObj.data.libraryEditing]),React.createElement("div",{key:e.groupID,className:"nugget-group"},React.createElement("div",{className:"nugget-full"},o,React.createElement("div",{className:"nugget-name"},React.createElement("a",{href:Zotero.url.groupViewUrl(e)},e.apiObj.data.name)),React.createElement("nav",{id:"group-library-link-nav",className:"action-links"},React.createElement("ul",null,React.createElement("li",null,React.createElement("a",{href:Zotero.url.groupLibraryUrl(e)},"Group Library")))),i,React.createElement("table",{className:"nugget-profile table"},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("th",{scope:"row"},"Members"),React.createElement("td",null,a)),n,React.createElement("tr",null,React.createElement("th",{scope:"row"},"Group Type"),React.createElement("td",null,Zotero.Group.prototype.typeMap[e.apiObj.data.type])),React.createElement("tr",null,React.createElement("th",{scope:"row"},"Group Library"),React.createElement("td",null,l))))))}}),UserGroups=React.createClass({displayName:"UserGroups",componentWillMount:function(){var e=this,t=new Zotero.Groups;if(Zotero.config.loggedIn&&Zotero.config.loggedInUserID){e.setState({loading:!0});t.fetchUserGroups(Zotero.config.loggedInUserID).then(function(t){var r=t.fetchedGroups;e.setState({groups:r,loading:!1})})["catch"](Zotero.catchPromiseError)}},getInitialState:function(){return{groups:[],loading:!1}},render:function(){var e=this,t=this.state.groups,r=t.map(function(e){return React.createElement(GroupNugget,{key:e.get("id"),group:e})});return React.createElement("div",{id:"user-groups-div",className:"user-groups"},r,React.createElement(LoadingSpinner,{loading:e.state.loading}))}});Zotero.url.requestReadApiKeyUrl=function(e,t,r){var a=Zotero.config.baseWebsiteUrl+"/settings/keys/new";a.replace("http","https");var o={name:"Private Feed"};"group"==e?(o.library_access=0,o["group_"+t]="read",o.redirect=r):"user"==e&&(o.library_access=1,o.notes_access=1,o.redirect=r);var i=[];J.each(o,function(e,t){i.push(encodeURIComponent(e)+"="+encodeURIComponent(t))});var n="?"+i.join("&");return a+n},Zotero.url.groupViewUrl=function(e){return"Private"==e.get("type")?Zotero.config.baseWebsiteUrl+"/groups/"+e.get("id"):Zotero.config.baseWebsiteUrl+"/groups/"+Zotero.utils.slugify(e.get("name"))},Zotero.url.groupLibraryUrl=function(e){return"Private"==e.get("type")?Zotero.config.baseWebsiteUrl+"/groups/"+e.get("id")+"/items":Zotero.config.baseWebsiteUrl+"/groups/"+Zotero.utils.slugify(e.get("name"))+"/items"},Zotero.url.groupSettingsUrl=function(e){return Zotero.config.baseWebsiteUrl+"/groups/"+e.get("id")+"/settings"},Zotero.url.groupMemberSettingsUrl=function(e){return Zotero.config.baseWebsiteUrl+"/groups/"+e.get("id")+"/settings/members"},Zotero.url.groupLibrarySettingsUrl=function(e){return Zotero.config.baseWebsiteUrl+"/groups/"+e.get("id")+"/settings/library"},Zotero.pages={base:{init:function(){this.tagline(),this.setupSearch(),this.setupNav(),J("#sitenav .toggle").click(this.navMenu),J(".support-menu-expand-section").hide(),J(".support-menu-section").on("click","h2",function(){J(this).siblings(".support-menu-expand-section").slideToggle()})},tagline:function(){var e=["See it. Save it. Sort it. Search it. Cite it.","Leveraging the long tail of scholarship.","A personal research assistant. Inside your browser.","Goodbye 3x5 cards, hello Zotero.","Citation management is only the beginning.","The next-generation research tool.","Research, not re-search","The web now has a wrangler."],t=Math.floor(Math.random()*e.length);J("#tagline").text(e[t])},setupSearch:function(){var e="support",t="";switch(void 0!==window.zoterojsSearchContext&&(e=zoterojsSearchContext),e){case"people":t="Search for people";break;case"group":t="Search for groups";break;case"documentation":t="Search documentation";break;case"library":t="Search Library";break;case"grouplibrary":t="Search Library";break;case"support":t="Search support";break;case"forums":t="Search forums";break;default:t="Search support"}("documentation"==e||"support"==e)&&J("#simple-search").on("submit",function(e){e.preventDefault();var t=J(this).find("input[type='text']").val();Z.pages.base.supportSearchRedirect(t)}),("people"==e||"group"==e)&&J("#simple-search").on("submit",function(r){r.preventDefault();var a=Zotero.config.baseZoteroWebsiteUrl+"/search/#type/"+e,o=J(this).find("input[type='text']").val();return""!==o&&o!=t&&(a=a+"/q/"+encodeURIComponent(o)),location.href=a,!1})},supportSearchRedirect:function(e){var t=encodeURIComponent(e+" site:www.zotero.org/support");return void Z.debug(t)},forumSearchRedirect:function(e){var t=encodeURIComponent(e+" site:forums.zotero.org"),r="https://duckduckgo.com/?q="+t;window.location=r},setupNav:function(){var e="";void 0!==window.zoterojsSearchContext&&(e=zoterojsSearchContext,"support"==e&&(e="")),"/"==location.pathname&&location.href.search("forums.")<0&&(e="home"),""!==e&&J(".primarynav").find("a."+e).closest("li").addClass("active")}},settings_cv:{init:function(){J("#cv-sections").on("click",".cv-delete",function(e){return confirm("Are you sure you want to delete this section?")?(Zotero.ui.cleanUpRte(J("#cv-sections")),J(this).closest("div.cv-section").remove(),Zotero.ui.init.rte("default",!1,J("#cv-sections")),!1):void 0}),J(".cv-insert-freetext").on("click",function(e){var t=J("#cv-sections div.cv-section").length,r=t+1;return J("#cv-sections").append(J("#cvsectionTemplate").render({cvSectionIndex:r,cvSectionType:"text",cvEntry:{}})),Zotero.ui.init.rte("default",!1,J("div.cv-section").last()),J("input.cv-heading").last().focus(),!1}),J(".cv-insert-collection").on("click",function(e){var t=J("#cv-sections div.cv-section").length,r=t+1;return Z.debug(zoteroData.collectionOptions),J("#cv-sections").append(J("#cvsectionTemplate").render({cvSectionIndex:r,cvSectionType:"collection",collectionOptions:zoteroData.collectionOptions,cvEntry:{}})),J("input.cv-heading").last().focus(),!1}),J("#cv-sections").on("click",".cv-move-down",function(e){return J(this).closest("div.cv-section").find("textarea").length>0?(Zotero.ui.cleanUpRte(J("#cv-sections")),J(this).closest("div.cv-section").next().after(J(this).closest("div.cv-section")),Zotero.ui.init.rte("default",!1)):J(this).closest("div.cv-section").next().after(J(this).closest("div.cv-section")),!1}),J("#cv-sections").on("click",".cv-move-up",function(e){return J(this).closest("div.cv-section").find("textarea").length>0?(Zotero.ui.cleanUpRte(J("#cv-sections")),J(this).closest("div.cv-section").prev().before(J(this).closest("div.cv-section")),Zotero.ui.init.rte("default",!1)):J(this).closest("div.cv-section").prev().before(J(this).closest("div.cv-section")),!1}),J("#cv-submit").click(function(e){J("#cv-sections div.cv-section").each(function(e){var t;J(this).hasClass("cv-text")?(t=J(this).find(".cv-heading").attr("name","cv_"+(e+1)+"_heading"),"Enter a section name"==t.val()&&t.val(""),J(this).find(".cv-text").attr("name","cv_"+(e+1)+"_text")):J(this).hasClass("cv-collection")&&(t=J(this).find(".cv-heading").attr("name","cv_"+(e+1)+"_heading"),"Enter a section name"==t.val()&&t.val(""),J(this).find("select.cv-collection").attr("name","cv_"+(e+1)+"_collection"))})}),Zotero.ui.init.rte("nolinks",!1,J("#cv-sections"))}},settings_account:{},settings_profile:{init:function(){Zotero.ui.init.rte("nolinks")}},settings_privacy:{init:function(){J("input#privacy_publishLibrary").prop("checked")||J("input#privacy_publishNotes").prop("disabled",!0),J("input#privacy_publishLibrary").bind("change",function(){J("input#privacy_publishLibrary").prop("checked")?J("input#privacy_publishNotes").prop("disabled",!1):J("input#privacy_publishNotes").prop("checked",!1).prop("disabled",!0)})}},settings_apikeys:{init:function(){}},settings_newkey:{init:function(){Z.debug("zoteroPages settings_newkey",3),Zotero.pages.settings_editkey.init()}},settings_newoauthkey:{init:function(){Zotero.pages.settings_newkey.init(),J("button[name='edit']").closest("div.form-group").nextAll().hide(),J("button[name='edit']").click(function(e){e.preventDefault(),J("button[name='edit']").closest("div.form-group").nextAll().show()})},updatePermissionsSummary:function(){J("#permissions-summary").empty().append(Z.pages.settings_newoauthkey.permissionsSummary())},permissionsSummary:function(){var e="",t=J("input#library_access").prop("checked"),r=J("input#notes_access").prop("checked"),a=J("input#write_access").prop("checked");t&&(e+="Access to read your personal library.<br />"),r&&(e+="Access to read notes in your personal library.<br />"),a&&(e+="Access to read and modify your personal library.<br />");var o=J("input[name='groups_all']:checked").val();switch(o){case"read":e+="Access to read any of your group libraries<br />";break;case"write":e+="Access to read and modify any of your group libraries<br />"}var i=J("input#individual_groups").prop("checked");return i&&J("input.individual_group_permission:checked").each(function(t,r){var a=J(r).data("groupname"),o=(J(r).data("groupid"),J(r).val());switch(o){case"read":e+="Access to read library for group '"+a+"'<br />";break;case"write":e+="Access to read and modify library for group '"+a+"'<br />"}}),e}},settings_editkey:{init:function(){Z.debug("zoteroPages settings_editkey",3),J("input[type='checkbox'][name='library_access']").prop("checked")||J("input[name='notes_access']").prop("disabled","disabled"),J("input#library_access").bind("change",function(){J("input[type='checkbox'][name='library_access']").prop("checked")?(J("input[name='notes_access']").prop("disabled",!1),J("input[name='write_access']").prop("disabled",!1)):(J("input[name='notes_access']").prop("checked",!1).prop("disabled",!0),J("input[name='write_access']").prop("checked",!1).prop("disabled",!0))}),J("input[name='name']").focus(),J("input[type='checkbox'][name='individual_groups']").prop("checked")||J(".individual_group_permission").closest("div.form-group").hide(),J("input[name='individual_groups']").bind("change",function(){Z.debug("individual groups checkbox changed"),J("input[type='checkbox'][name='individual_groups']").prop("checked")?J(".individual_group_permission").closest("div.form-group").show():J(".individual_group_permission").closest("div.form-group").hide()}),J("input").bind("change",Zotero.pages.settings_newoauthkey.updatePermissionsSummary),Zotero.pages.settings_newoauthkey.updatePermissionsSummary()}},settings_storage:{init:function(){var e=J("input[name=storageLevel]:checked").val();Zotero.pages.settings_storage.showSelectedResults(e),J("input[name=storageLevel]").change(function(){Zotero.pages.settings_storage.showSelectedResults(J("input[name=storageLevel]:checked").val())}),J("#purge-button").click(function(){return confirm("You are about to remove all uploaded files associated with your personal library.")?(J("#confirm_delete").val("confirmed"),!0):!1})},showSelectedResults:function(e){2==e?J("#order-result-div").html(zoteroData.orderResult2):3==e?J("#order-result-div").html(zoteroData.orderResult3):4==e?J("#order-result-div").html(zoteroData.orderResult4):5==e?J("#order-result-div").html(zoteroData.orderResult5):6==e&&J("#order-result-div").html(zoteroData.orderResult6)}},settings_deleteaccount:{init:function(){J("button#deleteaccount").click(function(){return confirm("Are you sure you want to permanently delete your account? You will not be able to recover the account or the user name.")?void 0:!1})}},group_new:{init:function(){var e;J("input#name").keyup(function(t){clearTimeout(e),e=setTimeout(Zotero.pages.group_new.nameChange,300)}),J("input[name=group_type]").change(Zotero.pages.group_new.nameChange),J("input#name").after("<label id='slugpreview'>Group URL: "+Zotero.config.baseZoteroWebsiteUrl+"/groups/"+Zotero.utils.slugify(J("input#name").val())+"</label>")},nameChange:function(){J("#slugpreview").css("color","black");var e=J("input[name=group_type]:checked").val();if("Private"==e?J("#slugpreview").text("Group URL: "+Zotero.config.baseZoteroWebsiteUrl+"/groups/<number>"):J("#slugpreview").text("Group URL: "+Zotero.config.baseZoteroWebsiteUrl+"/groups/"+Zotero.utils.slugify(J("input#name").val())),"Private"!=e){var t=J("input#name").val();J.getJSON(baseURL+"/group/checkname/",{input:t},function(e){J("#namePreview span").text(e.slug),e.valid?J("#slugpreview").css({color:"green"}):J("#slugpreview").css({color:"red"}),J("#namePreview img").remove()})}}},group_settings:{init:function(){Zotero.debug("initializing group delete form"),Zotero.ui.init.rte("nolinks"),J("#deleteForm").submit(function(){return confirm("This will permanently delete this group, including any items in the group library")?(J("#confirm_delete").val("confirmed"),!0):!1}),J("#type-PublicOpen").click(function(){return confirm("Changing a group to Public Open will remove all files from Zotero Storage")?!0:!1})}},group_library_settings:{init:function(){J("#type-PublicOpen").prop("checked")&&(J("#fileEditing-admins").prop("disabled","1"),J("#fileEditing-members").prop("disabled","1")),J("#type-Private").prop("checked")&&J("#libraryReading-all").prop("disabled","1"),J("#type-PublicOpen").click(function(){return confirm("Changing a group to Public Open will remove all files from Zotero Storage")?(J("input[name='fileEditing']").val(["none"]),J("#fileEditing-admins").prop("disabled","1"),J("#fileEditing-members").prop("disabled","1"),J("#libraryReading-all").prop("disabled",""),!0):!1}),J("#type-Private").click(function(){J("input[name='libraryReading']").val(["members"]),J("#libraryReading-all").prop("disabled","1"),J("#fileEditing-admins").prop("disabled",""),J("#fileEditing-members").prop("disabled","")}),J("#type-PublicClosed").click(function(){J("#fileEditing-admins").prop("disabled",""),J("#fileEditing-members").prop("disabled",""),J("#libraryReading-all").prop("disabled","")})}},group_view:{init:function(){J("#join-group-button").click(Zotero.pages.group_view.joinGroup),J("#leave-group-button").click(Zotero.pages.group_view.leaveGroup),Zotero.ui.init.rte("nolinks")},joinGroup:function(){Zotero.ui.showSpinner(J(".join-group-div")),J.post("/groups/"+zoteroData.groupID+"/join",{ajax:!0},function(e){e.pending===!0?J(".join-group-div").empty().append("Membership Pending"):e.success===!0?Zotero.ui.jsNotificationMessage("You are now a member of this group","success"):(J(".join-group-div").empty(),Zotero.ui.jsNotificationMessage("There was a problem joining this group.","error"))},"json")},leaveGroup:function(){confirm("Leave group?")&&(Zotero.ui.showSpinner(J(".leave-group-div")),J.post("/groups/"+zoteroData.groupID+"/leave",{ajax:!0},function(e){e.success===!0?(J("leave-group-div").empty(),Zotero.ui.jsNotificationMessage("You are no longer a member of this group","success")):(J("leave-group-div").empty(),Zotero.ui.jsNotificationMessage("There was a problem leaving this group. Please try again in a few minutes.","error"))},"json"))}},group_index:{init:function(){}},groupdiscussion_view:{init:function(){}},user_register:{init:function(){J("input[name='username']").after("<label id='slugpreview'>Profile URL: "+Zotero.config.baseZoteroWebsiteUrl+"/"+Zotero.utils.slugify(J("input[name='username']").val())+"</label>"),J("input[name='username']").bind("keyup change",Zotero.pages.user_register.nameChange)},nameChange:function(){J("#slugpreview").css("color","black"),parent.slug=Zotero.utils.slugify(J("input[name='username']").val()),J("#slugpreview").text("Profile URL: "+Zotero.config.baseZoteroWebsiteUrl+"/"+parent.slug),clearTimeout(parent.checkUserSlugTimeout),parent.checkUserSlugTimeout=setTimeout(Zotero.pages.user_register.checkSlug,500)},checkSlug:function(){J.getJSON(baseURL+"/user/checkslug",{slug:slug},function(e){e.valid?J("#slugpreview").css("color","green"):J("#slugpreview").css("color","red")})}},user_profile:{init:function(){J("#invite-button").click(function(){var e=J("#invite_group").val();J.post("/groups/inviteuser",{ajax:!0,groupID:e,userID:zoteroData.profileUserID},function(e){"true"==e&&(Zotero.ui.jsNotificationMessage("User has been invited to join your group.","success"),J("#invited-user-list").append("<li>"+J("#invite_group > option:selected").html()+"</li>"),J("#invite_group > option:selected").remove(),0===J("#invite_group > option").length&&(J("#invite_group").remove(),J("#invite-button").remove()))},"text")})}},group_compose:{init:function(){Zotero.ui.init.rte("nolinks")}},index_index:{},search_index:{init:function(){}},search_items:{init:function(){try{var e=new Zotero.Library}catch(t){Z.debug("Error initializing library")}J("#item-submit").bind("click submit",J.proxy(function(t){Z.debug("item search submitted",3),t.preventDefault(),t.stopImmediatePropagation();var r=J("#itemQuery").val(),a=e.fetchGlobalItems({q:r});return a.then(function(e){Z.debug("globalItemSearch callback",3),Z.debug(e),J("#search-result-count").empty().append(e.totalResults);var t=J("#search-results");t.empty(),J.each(e.objects,function(e,r){J("#globalitemdetailsTemplate").tmpl({globalItem:r}).appendTo(t)})}),!1},this))}},index_start:{init:function(){Zotero.pages.index_start.sizeIframe(),J(window).resize(Zotero.pages.index_start.sizeIframe),J(".start-select").click(function(){return J("iframe").attr("src",J(this).attr("href")),!1}),J(".start-show-overlay").click(function(){return J("#start-overlay").show(),!1}),J(".start-hide-overlay").click(function(){return J("#start-overlay").hide(),!1}),Zotero.pages.user_register.init()},sizeIframe:function(){J("iframe").css("height",J(window).height()-144)}},index_startstandalone:{init:function(){var e=BrowserDetect.browser;switch(e){case"Chrome":J("#chrome-connector-download-button").closest("li").detach().prependTo("#recommended-download > ul");break;case"Safari":J("#safari-connector-download-button").closest("li").detach().prependTo("#recommended-download > ul");break;case"Firefox":J("#firefox-connector-message").closest("li").detach().prependTo("#recommended-download > ul");break;default:J("#connector-download-button").closest("li").detach().prependTo("#recommended-download > ul"),J("#other-connectors-p").hide()}J("#recommended-download > ul").prepend("<li><p>Zotero Connectors allow you to save to Zotero directly from your web browser.</p></li>"),Zotero.pages.user_register.init()}},index_download:{init:function(){var e=BrowserDetect.browser,t=BrowserDetect.OS,r=-1!=navigator.userAgent.indexOf("x86_64")?"x86_64":"x86";switch("Windows"==t?J("#standalone-windows-download-button").closest("li").clone().prependTo("#recommended-client-download ul"):"Mac"==t?J("#standalone-mac-download-button").closest("li").clone().prependTo("#recommended-client-download ul"):"Linux"==t&&("x86_64"==r?J("#standalone-linux64-download-button").closest("li").clone().prependTo("#recommended-client-download ul"):J("#standalone-linux32-download-button").closest("li").clone().prependTo("#recommended-client-download ul")),J("#recommended-connector-download").show(),e){case"Chrome":J("#chrome-connector-download-button").addClass("recommended-download").closest("li").detach().prependTo("#recommended-connector-download ul");break;case"Safari":J("#safari-connector-download-button").addClass("recommended-download").closest("li").detach().prependTo("#recommended-connector-download ul");break;case"Firefox":J("#firefox-connector-download-button").addClass("recommended-download").closest("li").detach().prependTo("#recommended-connector-download ul");break;default:J("#connector-download-button").closest("li").clone().prependTo("#recommended-connector-download ul"),J("#other-connectors-p").hide()}J("#recommended-download ul").prepend("<li><p>Zotero Connectors allow you to save to Zotero directly from your web browser.</p></li>")}},index_bookmarklet:{init:function(){J(".bookmarklet-instructions").hide();var e=J("#bookmarklet-tabs li.selected").data("section");J("#"+e+"-bookmarklet-div").show(),J("#bookmarklet-tabs li").on("click",function(e){Z.debug("bookmarklet tab clicked"),J("#bookmarklet-tabs li.selected").removeClass("selected"),J(this).addClass("selected");var t=J(this).data("section");Z.debug(t),J(".bookmarklet-instructions").hide(),J("#"+t+"-bookmarklet-div").show()})}}};