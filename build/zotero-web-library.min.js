/*! zotero-web-library 2015-12-08 */
"use strict";function _typeof2(a){return a&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a}function _typeof(a){return a&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":"undefined"==typeof a?"undefined":_typeof2(a)}var _extends=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a};!function(){var a,b,c,d;!function(){var e={},f={};a=function(a,b,c){e[a]={deps:b,callback:c}},d=c=b=function(a){function c(b){if("."!==b.charAt(0))return b;for(var c=b.split("/"),d=a.split("/").slice(0,-1),e=0,f=c.length;f>e;e++){var g=c[e];if(".."===g)d.pop();else{if("."===g)continue;d.push(g)}}return d.join("/")}if(d._eak_seen=e,f[a])return f[a];if(f[a]={},!e[a])throw new Error("Could not find module "+a);for(var g,h=e[a],i=h.deps,j=h.callback,k=[],l=0,m=i.length;m>l;l++)"exports"===i[l]?k.push(g={}):k.push(b(c(i[l])));var n=j.apply(this,k);return f[a]=g||n}}(),a("promise/all",["./utils","exports"],function(a,b){function c(a){var b=this;if(!d(a))throw new TypeError("You must pass an array to all.");return new b(function(b,c){function d(a){return function(b){f(a,b)}}function f(a,c){h[a]=c,0===--i&&b(h)}var g,h=[],i=a.length;0===i&&b([]);for(var j=0;j<a.length;j++)g=a[j],g&&e(g.then)?g.then(d(j),c):f(j,g)})}var d=a.isArray,e=a.isFunction;b.all=c}),a("promise/asap",["exports"],function(a){function b(){return function(){process.nextTick(e)}}function c(){var a=0,b=new i(e),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function d(){return function(){j.setTimeout(e,1)}}function e(){for(var a=0;a<k.length;a++){var b=k[a],c=b[0],d=b[1];c(d)}k=[]}function f(a,b){var c=k.push([a,b]);1===c&&g()}var g,h="undefined"!=typeof window?window:{},i=h.MutationObserver||h.WebKitMutationObserver,j="undefined"!=typeof global?global:this,k=[];g="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?b():i?c():d(),a.asap=f}),a("promise/cast",["exports"],function(a){function b(a){if(a&&"object"==("undefined"==typeof a?"undefined":_typeof(a))&&a.constructor===this)return a;var b=this;return new b(function(b){b(a)})}a.cast=b}),a("promise/config",["exports"],function(a){function b(a,b){return 2!==arguments.length?c[a]:void(c[a]=b)}var c={instrument:!1};a.config=c,a.configure=b}),a("promise/polyfill",["./promise","./utils","exports"],function(a,b,c){function d(){var a="Promise"in window&&"cast"in window.Promise&&"resolve"in window.Promise&&"reject"in window.Promise&&"all"in window.Promise&&"race"in window.Promise&&function(){var a;return new window.Promise(function(b){a=b}),f(a)}();a||(window.Promise=e)}var e=a.Promise,f=b.isFunction;c.polyfill=d}),a("promise/promise",["./config","./utils","./cast","./all","./race","./resolve","./reject","./asap","exports"],function(a,b,c,d,e,f,g,h,i){function j(a){if(!w(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof j))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],k(a,this)}function k(a,b){function c(a){p(b,a)}function d(a){r(b,a)}try{a(c,d)}catch(e){d(e)}}function l(a,b,c,d){var e,f,g,h,i=w(c);if(i)try{e=c(d),g=!0}catch(j){h=!0,f=j}else e=d,g=!0;o(b,e)||(i&&g?p(b,e):h?r(b,f):a===F?p(b,e):a===G&&r(b,e))}function m(a,b,c,d){var e=a._subscribers,f=e.length;e[f]=b,e[f+F]=c,e[f+G]=d}function n(a,b){for(var c,d,e=a._subscribers,f=a._detail,g=0;g<e.length;g+=3)c=e[g],d=e[g+b],l(b,c,d,f);a._subscribers=null}function o(a,b){var c,d=null;try{if(a===b)throw new TypeError("A promises callback cannot return that same promise.");if(v(b)&&(d=b.then,w(d)))return d.call(b,function(d){return c?!0:(c=!0,void(b!==d?p(a,d):q(a,d)))},function(b){return c?!0:(c=!0,void r(a,b))}),!0}catch(e){return c?!0:(r(a,e),!0)}return!1}function p(a,b){a===b?q(a,b):o(a,b)||q(a,b)}function q(a,b){a._state===D&&(a._state=E,a._detail=b,u.async(s,a))}function r(a,b){a._state===D&&(a._state=E,a._detail=b,u.async(t,a))}function s(a){n(a,a._state=F)}function t(a){n(a,a._state=G)}var u=a.config,v=(a.configure,b.objectOrFunction),w=b.isFunction,x=(b.now,c.cast),y=d.all,z=e.race,A=f.resolve,B=g.reject,C=h.asap;u.async=C;var D=void 0,E=0,F=1,G=2;j.prototype={constructor:j,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(a,b){var c=this,d=new this.constructor(function(){});if(this._state){var e=arguments;u.async(function(){l(c._state,d,e[c._state-1],c._detail)})}else m(this,d,a,b);return d},"catch":function(a){return this.then(null,a)}},j.all=y,j.cast=x,j.race=z,j.resolve=A,j.reject=B,i.Promise=j}),a("promise/race",["./utils","exports"],function(a,b){function c(a){var b=this;if(!d(a))throw new TypeError("You must pass an array to race.");return new b(function(b,c){for(var d,e=0;e<a.length;e++)d=a[e],d&&"function"==typeof d.then?d.then(b,c):b(d)})}var d=a.isArray;b.race=c}),a("promise/reject",["exports"],function(a){function b(a){var b=this;return new b(function(b,c){c(a)})}a.reject=b}),a("promise/resolve",["exports"],function(a){function b(a){var b=this;return new b(function(b){b(a)})}a.resolve=b}),a("promise/utils",["exports"],function(a){function b(a){return c(a)||"object"==("undefined"==typeof a?"undefined":_typeof(a))&&null!==a}function c(a){return"function"==typeof a}function d(a){return"[object Array]"===Object.prototype.toString.call(a)}var e=Date.now||function(){return(new Date).getTime()};a.objectOrFunction=b,a.isFunction=c,a.isArray=d,a.now=e}),b("promise/polyfill").polyfill()}(),function(a){if("object"===("undefined"==typeof exports?"undefined":_typeof(exports)))module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;try{b=window}catch(c){b=self}b.SparkMD5=a()}}(function(a){var b=function(a,b){return a+b&4294967295},c=function(a,c,d,e,f,g){return c=b(b(c,a),b(e,g)),b(c<<f|c>>>32-f,d)},d=function(a,b,d,e,f,g,h){return c(b&d|~b&e,a,b,f,g,h)},e=function(a,b,d,e,f,g,h){return c(b&e|d&~e,a,b,f,g,h)},f=function(a,b,d,e,f,g,h){return c(b^d^e,a,b,f,g,h)},g=function(a,b,d,e,f,g,h){return c(d^(b|~e),a,b,f,g,h)},h=function(a,c){var h=a[0],i=a[1],j=a[2],k=a[3];h=d(h,i,j,k,c[0],7,-680876936),k=d(k,h,i,j,c[1],12,-389564586),j=d(j,k,h,i,c[2],17,606105819),i=d(i,j,k,h,c[3],22,-1044525330),h=d(h,i,j,k,c[4],7,-176418897),k=d(k,h,i,j,c[5],12,1200080426),j=d(j,k,h,i,c[6],17,-1473231341),i=d(i,j,k,h,c[7],22,-45705983),h=d(h,i,j,k,c[8],7,1770035416),k=d(k,h,i,j,c[9],12,-1958414417),j=d(j,k,h,i,c[10],17,-42063),i=d(i,j,k,h,c[11],22,-1990404162),h=d(h,i,j,k,c[12],7,1804603682),k=d(k,h,i,j,c[13],12,-40341101),j=d(j,k,h,i,c[14],17,-1502002290),i=d(i,j,k,h,c[15],22,1236535329),h=e(h,i,j,k,c[1],5,-165796510),k=e(k,h,i,j,c[6],9,-1069501632),j=e(j,k,h,i,c[11],14,643717713),i=e(i,j,k,h,c[0],20,-373897302),h=e(h,i,j,k,c[5],5,-701558691),k=e(k,h,i,j,c[10],9,38016083),j=e(j,k,h,i,c[15],14,-660478335),i=e(i,j,k,h,c[4],20,-405537848),h=e(h,i,j,k,c[9],5,568446438),k=e(k,h,i,j,c[14],9,-1019803690),j=e(j,k,h,i,c[3],14,-187363961),i=e(i,j,k,h,c[8],20,1163531501),h=e(h,i,j,k,c[13],5,-1444681467),k=e(k,h,i,j,c[2],9,-51403784),j=e(j,k,h,i,c[7],14,1735328473),i=e(i,j,k,h,c[12],20,-1926607734),h=f(h,i,j,k,c[5],4,-378558),k=f(k,h,i,j,c[8],11,-2022574463),j=f(j,k,h,i,c[11],16,1839030562),i=f(i,j,k,h,c[14],23,-35309556),h=f(h,i,j,k,c[1],4,-1530992060),k=f(k,h,i,j,c[4],11,1272893353),j=f(j,k,h,i,c[7],16,-155497632),i=f(i,j,k,h,c[10],23,-1094730640),h=f(h,i,j,k,c[13],4,681279174),k=f(k,h,i,j,c[0],11,-358537222),j=f(j,k,h,i,c[3],16,-722521979),i=f(i,j,k,h,c[6],23,76029189),h=f(h,i,j,k,c[9],4,-640364487),k=f(k,h,i,j,c[12],11,-421815835),j=f(j,k,h,i,c[15],16,530742520),i=f(i,j,k,h,c[2],23,-995338651),h=g(h,i,j,k,c[0],6,-198630844),k=g(k,h,i,j,c[7],10,1126891415),j=g(j,k,h,i,c[14],15,-1416354905),i=g(i,j,k,h,c[5],21,-57434055),h=g(h,i,j,k,c[12],6,1700485571),k=g(k,h,i,j,c[3],10,-1894986606),j=g(j,k,h,i,c[10],15,-1051523),i=g(i,j,k,h,c[1],21,-2054922799),h=g(h,i,j,k,c[8],6,1873313359),k=g(k,h,i,j,c[15],10,-30611744),j=g(j,k,h,i,c[6],15,-1560198380),i=g(i,j,k,h,c[13],21,1309151649),h=g(h,i,j,k,c[4],6,-145523070),k=g(k,h,i,j,c[11],10,-1120210379),j=g(j,k,h,i,c[2],15,718787259),i=g(i,j,k,h,c[9],21,-343485551),a[0]=b(h,a[0]),a[1]=b(i,a[1]),a[2]=b(j,a[2]),a[3]=b(k,a[3])},i=function(a){var b,c=[];for(b=0;64>b;b+=4)c[b>>2]=a.charCodeAt(b)+(a.charCodeAt(b+1)<<8)+(a.charCodeAt(b+2)<<16)+(a.charCodeAt(b+3)<<24);return c},j=function(a){var b,c=[];for(b=0;64>b;b+=4)c[b>>2]=a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24);return c},k=function(a){var b,c,d,e,f,g,j=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(b=64;j>=b;b+=64)h(k,i(a.substring(b-64,b)));for(a=a.substring(b-64),c=a.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;c>b;b+=1)d[b>>2]|=a.charCodeAt(b)<<(b%4<<3);if(d[b>>2]|=128<<(b%4<<3),b>55)for(h(k,d),b=0;16>b;b+=1)d[b]=0;return e=8*j,e=e.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(e[2],16),g=parseInt(e[1],16)||0,d[14]=f,d[15]=g,h(k,d),k},l=function(a){var b,c,d,e,f,g,i=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(b=64;i>=b;b+=64)h(k,j(a.subarray(b-64,b)));for(a=i>b-64?a.subarray(b-64):new Uint8Array(0),c=a.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;c>b;b+=1)d[b>>2]|=a[b]<<(b%4<<3);if(d[b>>2]|=128<<(b%4<<3),b>55)for(h(k,d),b=0;16>b;b+=1)d[b]=0;return e=8*i,e=e.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(e[2],16),g=parseInt(e[1],16)||0,d[14]=f,d[15]=g,h(k,d),k},m=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],n=function(a){var b,c="";for(b=0;4>b;b+=1)c+=m[a>>8*b+4&15]+m[a>>8*b&15];return c},o=function(a){var b;for(b=0;b<a.length;b+=1)a[b]=n(a[b]);return a.join("")},p=function(a){return o(k(a))},q=function(){this.reset()};return"5d41402abc4b2a76b9719d911017c592"!==p("hello")&&(b=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}),q.prototype.append=function(a){return/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a))),this.appendBinary(a),this},q.prototype.appendBinary=function(a){this._buff+=a,this._length+=a.length;var b,c=this._buff.length;for(b=64;c>=b;b+=64)h(this._state,i(this._buff.substring(b-64,b)));return this._buff=this._buff.substr(b-64),this},q.prototype.end=function(a){var b,c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;e>b;b+=1)f[b>>2]|=d.charCodeAt(b)<<(b%4<<3);return this._finish(f,e),c=a?this._state:o(this._state),this.reset(),c},q.prototype._finish=function(a,b){var c,d,e,f=b;if(a[f>>2]|=128<<(f%4<<3),f>55)for(h(this._state,a),f=0;16>f;f+=1)a[f]=0;c=8*this._length,c=c.toString(16).match(/(.*?)(.{0,8})$/),d=parseInt(c[2],16),e=parseInt(c[1],16)||0,a[14]=d,a[15]=e,h(this._state,a)},q.prototype.reset=function(){return this._buff="",this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},q.prototype.destroy=function(){delete this._state,delete this._buff,delete this._length},q.hash=function(a,b){/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a)));var c=k(a);return b?c:o(c)},q.hashBinary=function(a,b){var c=k(a);return b?c:o(c)},q.ArrayBuffer=function(){this.reset()},q.ArrayBuffer.prototype.append=function(a){var b,c=this._concatArrayBuffer(this._buff,a),d=c.length;for(this._length+=a.byteLength,b=64;d>=b;b+=64)h(this._state,j(c.subarray(b-64,b)));return this._buff=d>b-64?c.subarray(b-64):new Uint8Array(0),this},q.ArrayBuffer.prototype.end=function(a){var b,c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;e>b;b+=1)f[b>>2]|=d[b]<<(b%4<<3);return this._finish(f,e),c=a?this._state:o(this._state),this.reset(),c},q.ArrayBuffer.prototype._finish=q.prototype._finish,q.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},q.ArrayBuffer.prototype.destroy=q.prototype.destroy,q.ArrayBuffer.prototype._concatArrayBuffer=function(a,b){var c=a.length,d=new Uint8Array(c+b.byteLength);return d.set(a),d.set(new Uint8Array(b),c),d},q.ArrayBuffer.hash=function(a,b){var c=l(new Uint8Array(a));return b?c:o(c)},q});var J=jQuery.noConflict(),Zotero={ajax:{},callbacks:{},ui:{callbacks:{},keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}},url:{},utils:{},offline:{},temp:{},localizations:{},config:{librarySettings:{},baseApiUrl:"https://api.zotero.org",baseWebsiteUrl:"https://zotero.org",baseFeedUrl:"https://api.zotero.org",baseZoteroWebsiteUrl:"https://www.zotero.org",baseDownloadUrl:"https://www.zotero.org",debugLogEndpoint:"",storeDebug:!0,directDownloads:!0,proxyPath:"/proxyrequest",ignoreLoggedInStatus:!1,storePrefsRemote:!0,preferUrlItem:!0,sessionAuth:!1,proxy:!1,apiKey:"",apiVersion:3,locale:"en-US",cacheStoreType:"localStorage",preloadCachedLibrary:!0,sortOrdering:{dateAdded:"desc",dateModified:"desc",date:"desc",year:"desc",accessDate:"desc",title:"asc",creator:"asc"},defaultSortColumn:"title",defaultSortOrder:"asc",largeFields:{title:1,abstractNote:1,extra:1},richTextFields:{note:1},maxFieldSummaryLength:{title:60},exportFormats:["bibtex","bookmarks","mods","refer","rdf_bibliontology","rdf_dc","rdf_zotero","ris","wikipedia"],exportFormatsMap:{bibtex:"BibTeX",bookmarks:"Bookmarks",mods:"MODS",refer:"Refer/BibIX",rdf_bibliontology:"Bibliontology RDF",rdf_dc:"Unqualified Dublin Core RDF",rdf_zotero:"Zotero RDF",ris:"RIS",wikipedia:"Wikipedia Citation Templates"},defaultApiArgs:{order:"title",sort:"asc",limit:50,start:0}},debug:function(a,b){var c=3;Zotero.config.storeDebug&&c>=b&&(Zotero.debugstring+="DEBUG:"+a+"\n"),"undefined"!=typeof console&&("number"!=typeof b&&(b=1),void 0!==Zotero.preferences&&(c=Zotero.preferences.getPref("debug_level")),c>=b&&console.log(a))},warn:function(a){Zotero.config.storeDebug&&(Zotero.debugstring+="WARN:"+a+"\n"),"undefined"==typeof console||"undefined"==typeof console.warn?this.debug(a):console.warn(a)},error:function(a){Zotero.config.storeDebug&&(Zotero.debugstring+="ERROR:"+a+"\n"),"undefined"==typeof console||"undefined"==typeof console.error?this.debug(a):console.error(a)},submitDebugLog:function(){Zotero.net.ajax({url:Zotero.config.debugLogEndpoint,data:{debug_string:Zotero.debugstring}}).then(function(a){var b=JSON.parse(a.responseText);b.logID?alert("ZoteroWWW debug logID:"+b.logID):b.error&&alert("Error submitting ZoteroWWW debug log:"+b.error)})},catchPromiseError:function(a){Zotero.error(a)},libraries:{},validator:{patterns:{itemKey:/^.+$/,collectionKey:/^([A-Z0-9]{8,})|trash$/,libraryID:/^[0-9]+$/,libraryType:/^(user|group|)$/,target:/^(items?|collections?|tags|children|deleted|userGroups|key|settings|publications)$/,targetModifier:/^(top|file|file\/view)$/,sort:/^(asc|desc)$/,start:/^[0-9]*$/,limit:/^[0-9]*$/,order:/^\S*$/,content:/^((html|json|data|bib|none|bibtex|bookmarks|coins|csljson|mods|refer|rdf_bibliontology|rdf_dc|ris|tei|wikipedia),?)+$/,include:/^((html|json|data|bib|none|bibtex|bookmarks|coins|csljson|mods|refer|rdf_bibliontology|rdf_dc|ris|tei|wikipedia),?)+$/,q:/^.*$/,fq:/^\S*$/,itemType:/^\S*$/,locale:/^\S*$/,tag:/^.*$/,tagType:/^(0|1)$/,key:/^\S*/,format:/^(json|atom|bib|keys|versions|bibtex|bookmarks|mods|refer|rdf_bibliontology|rdf_dc|rdf_zotero|ris|wikipedia)$/,style:/^\S*$/,linkwrap:/^(0|1)*$/},validate:function(a,b){if(Z.debug("Zotero.validate",4),""===a)return null;if(null===a)return!0;Z.debug(a+" "+b,4);var c=this.patterns;return c.hasOwnProperty(b)?c[b].test(a):null}},_logEnabled:0,enableLogging:function(){Zotero._logEnabled++,Zotero._logEnabled>0},disableLogging:function(){Zotero._logEnabled--,Zotero._logEnabled<=0&&(Zotero._logEnabled=0)},init:function(){var a;a="localStorage"==Zotero.config.cacheStoreType&&"undefined"!=typeof localStorage?localStorage:"sessionStorage"==Zotero.config.cacheStoreType&&"undefined"!=typeof sessionStorage?sessionStorage:{},Zotero.store=a,Zotero.cache=new Zotero.Cache(a),Zotero.preferences=new Zotero.Preferences(Zotero.store,"global");var b="en-US";Zotero.config.locale&&(b=Zotero.config.locale),b="en-US"}};Zotero.Cache=function(a){this.store=a;var b=this.store._registry;(null===b||"undefined"==typeof b)&&(b={},this.store._registry=JSON.stringify(b))},Zotero.Cache.prototype.objectCacheString=function(a){var b=[];Object.keys(a).forEach(function(c){var d=a[c];d&&(Array.isArray(d)?d.forEach(function(a){b.push(c+"/"+encodeURIComponent(a))}):b.push(c+"/"+encodeURIComponent(d)))}),b.sort(),Z.debug(b,4);var c=b.join("/");return c},Zotero.Cache.prototype.save=function(a,b,c){Array.isArray(c)||(c=[]);var d=JSON.parse(this.store._registry);d||(d={});var e=this.objectCacheString(a);this.store[e]=JSON.stringify(b);var f={id:e,saved:Date.now(),cachetags:c};d[e]=f,this.store._registry=JSON.stringify(d)},Zotero.Cache.prototype.load=function(a){Z.debug("Zotero.Cache.load",3);var b=this.objectCacheString(a);Z.debug(b,4);try{var c=this.store[b];return c?JSON.parse(c):(Z.warn("No value found in cache store - "+b,3),null)}catch(d){return Z.error("Error parsing retrieved cache data: "+b+" : "+c),null}},Zotero.Cache.prototype.expireCacheTag=function(a){Z.debug("Zotero.Cache.expireCacheTag",3);var b=JSON.parse(this.store._registry),c=this.store;Object.keys(b).forEach(function(d){var e=b[d];-1!=e.cachetags.indexOf(a)&&(Z.debug("tag "+a+" found for item "+e.id+" : expiring",4),delete c[e.id],delete b[e.id])})},Zotero.Cache.prototype.clear=function(){"function"==typeof this.store.clear?this.store.clear():this.store={}},Zotero.ajaxRequest=function(a,b,c){Z.debug("Zotero.ajaxRequest ==== "+a,3),b||(b="GET"),c||(c={});var d={url:a,type:b};return d=Z.extend({},d,c),Z.debug(d,3),Zotero.net.queueRequest(d)},Zotero.eventmanager={callbacks:{}},Zotero.trigger=function(a){var b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],c=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];c&&(Z.debug("filter is not false",3),a+="_"+c),Zotero.debug("Triggering eventful "+a,3),Z.debug(b),b.zeventful=!0,(null===b.triggeringElement||void 0===b.triggeringElement)&&(b.triggeringElement=J("#eventful"));try{if(Zotero.eventmanager.callbacks.hasOwnProperty(a)){var d=Zotero.eventmanager.callbacks[a];d.forEach(function(a){var c=Z.extend({},b,a.data),d={data:c};a.f(d)})}}catch(e){Z.error("failed triggering:"+a),Z.error(e)}},Zotero.listen=function(a,b,c,d){Z.debug("Zotero.listen: "+a);var e=a.split(" ");if(e.length>0&&d)for(var f=0;f<e.length;f++)e[f]+="_"+d;e.forEach(function(a){Zotero.eventmanager.callbacks.hasOwnProperty(a)?Zotero.eventmanager.callbacks[a].push({data:c,f:b}):Zotero.eventmanager.callbacks[a]=[{data:c,f:b}]})};var Z=Zotero;Zotero.ajax.errorCallback=function(a){Z.error(a),Z.debug("ajax error callback",2),Z.debug("textStatus: "+a.textStatus,2),Z.debug("errorThrown: ",2),Z.debug(a.errorThrown,2),Z.debug(a.jqxhr,2)},Zotero.ajax.error=Zotero.ajax.errorCallback,Zotero.ajax.activeRequests=[],Zotero.ajax.apiRequestUrl=function(a){if(Z.debug("Zotero.ajax.apiRequestUrl",4),Z.debug(a,4),Object.keys(a).forEach(function(b){var c=a[b];"string"==typeof c&&(c=c.split("#",1),a[b]=c[0]),Zotero.validator.validate(c,b)===!1&&(Zotero.warn("API argument failed validation: "+b+" cannot be "+c),Zotero.warn(a),delete a[b])}),!a.target)throw new Error("No target defined for api request");if("user"!=a.libraryType&&"group"!=a.libraryType&&""!==a.libraryType)throw new Error("Unexpected libraryType for api request "+JSON.stringify(a));if(a.libraryType&&!a.libraryID)throw new Error("No libraryID defined for api request");if("publications"==a.target&&"user"!=a.libraryType)throw new Error("publications is only valid for user libraries");var b,c=Zotero.config.baseApiUrl;if(""!==a.libraryType){if(b=c+"/"+a.libraryType+"s/"+a.libraryID,a.collectionKey){if("trash"==a.collectionKey)return b+="/items/trash";-1!==a.collectionKey.indexOf(",")||"collections"!=a.target&&(b+="/collections/"+a.collectionKey)}}else b=c;switch(a.target){case"items":b+="/items";break;case"item":b+=a.itemKey?"/items/"+a.itemKey:"/items";break;case"collections":b+="/collections";break;case"childCollections":b+="/collections";break;case"collection":break;case"tags":b+="/tags";break;case"children":b+="/items/"+a.itemKey+"/children";break;case"key":b=c+"/users/"+a.libraryID+"/keys/"+a.apiKey;break;case"deleted":b+="/deleted";break;case"userGroups":b=c+"/users/"+a.libraryID+"/groups";break;case"settings":b+="/settings/"+(a.settingsKey||"");break;case"publications":b+="/publications/items";break;default:return!1}switch(a.targetModifier){case"top":b+="/top";break;case"file":b+="/file";break;case"viewsnapshot":b+="/file/view"}return b},Zotero.ajax.apiQueryString=function(a,b){if(Z.debug("Zotero.ajax.apiQueryString",4),Z.debug(a,4),(null===b||"undefined"==typeof b)&&(b=!0),Object.keys(a).forEach(function(b){var c=a[b];"string"==typeof c&&(c=c.split("#",1),a[b]=c[0])}),a.hasOwnProperty("order")&&"creatorSummary"==a.order&&(a.order="creator"),a.hasOwnProperty("order")&&"year"==a.order&&(a.order="date"),b&&Zotero.config.sessionAuth){var c=Zotero.utils.readCookie(Zotero.config.sessionCookieName);a.session=c}else b&&Zotero.config.apiKey&&(a.key=Zotero.config.apiKey);a.hasOwnProperty("sort")&&"undefined"==a.sort&&(a.sort="asc"),Z.debug(a,4);var d="?",e=[],f=["start","limit","order","sort","content","include","format","q","fq","itemType","itemKey","collectionKey","searchKey","locale","tag","tagType","key","style","linkMode","linkwrap","session","newer","since"];f.sort();var g={};return f.forEach(function(b){a.hasOwnProperty(b)&&""!==a[b]&&(g[b]=a[b])}),a.hasOwnProperty("target")&&"items"!==a.target&&g.hasOwnProperty("itemKey")&&-1==g.itemKey.indexOf(",")&&delete g.itemKey,a.hasOwnProperty("target")&&"collections"!==a.target&&g.hasOwnProperty("collectionKey")&&-1===g.collectionKey.indexOf(",")&&delete g.collectionKey,Object.keys(g).forEach(function(a){var b=g[a];Array.isArray(b)?b.forEach(function(b){"tag"==a&&"-"==b[0]&&(b="\\"+b),e.push(encodeURIComponent(a)+"="+encodeURIComponent(b))}):("tag"==a&&"-"==b[0]&&(b="\\"+b),e.push(encodeURIComponent(a)+"="+encodeURIComponent(b)))}),d+=e.join("&")},Zotero.ajax.apiRequestString=function(a){return Zotero.ajax.apiRequestUrl(a)+Zotero.ajax.apiQueryString(a)},Zotero.ajax.proxyWrapper=function(a,b){return Zotero.config.proxy?(b||(b="GET"),Zotero.config.proxyPath+"?requestMethod="+b+"&requestUrl="+encodeURIComponent(a)):a},Zotero.ajax.parseQueryString=function(a){},Zotero.ajax.webUrl=function(a){},Zotero.ajax.downloadBlob=function(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open("GET",a,!0),d.responseType="blob",d.addEventListener("load",function(){200===d.status?(Z.debug("downloadBlob Image retrieved. resolving",3),b(d.response)):c(d.response)}),d.send()})},Zotero.ApiObject=function(){this.instance="Zotero.ApiObject",this.version=0},Zotero.ApiObject.prototype.associateWithLibrary=function(a){var b=this;return b.owningLibrary=a,"object"==_typeof(this.apiObj.library)&&(this.apiObj.library.type=a.type,this.apiObj.library.id=a.libraryID),b},Zotero.ApiObject.prototype.fieldComparer=function(a){if(window.Intl){var b=new window.Intl.Collator;return function(c,d){return b.compare(c.apiObj.data[a],d.apiObj.data[a])}}return function(b,c){return b.apiObj.data[a].toLowerCase()==c.apiObj.data[a].toLowerCase()?0:b.apiObj.data[a].toLowerCase()<c.apiObj.data[a].toLowerCase()?-1:1}},Zotero.ApiResponse=function(a){Z.debug("Zotero.ApiResponse",3),this.totalResults=0,this.apiVersion=null,this.lastModifiedVersion=0,this.linkHeader="",this.links={},a&&(a.isError?this.isError=!0:this.isError=!1,this.data=a.data,this.parseResponse(a))},Zotero.ApiResponse.prototype.parseResponse=function(a){Z.debug("parseResponse");var b=this;if(b.jqxhr=a.jqxhr,b.status=a.jqxhr.status,b.lastModifiedVersion=a.jqxhr.getResponseHeader("Last-Modified-Version"),b.apiVersion=a.jqxhr.getResponseHeader("Zotero-API-Version"),b.backoff=a.jqxhr.getResponseHeader("Backoff"),b.retryAfter=a.jqxhr.getResponseHeader("Retry-After"),b.contentType=a.jqxhr.getResponseHeader("Content-Type"),b.linkHeader=a.jqxhr.getResponseHeader("Link"),b.totalResults=a.jqxhr.getResponseHeader("Total-Results"),b.backoff&&(b.backoff=parseInt(b.backoff,10)),b.retryAfter&&(b.retryAfter=parseInt(b.retryAfter,10)),Z.debug("parse link header"),Z.debug(b.linkHeader),b.linkHeader){for(var c=b.linkHeader.split(","),d={},e=/^<([^>]+)>; rel="([^\"]*)"$/,f=0;f<c.length;f++){var g=e.exec(c[f].trim());g[2]&&(d[g[2]]=g[1])}b.parsedLinks=d}Z.debug("done parsing response")},Zotero.Net=function(){this.deferredQueue=[],this.numRunning=0,this.numConcurrent=3,this.backingOff=!1},Zotero.Net.prototype.queueDeferred=function(){var a=this,b=new J.Deferred;return a.deferredQueue.push(b),Promise.resolve(b)},Zotero.Net.prototype.queueRequest=function(a){Z.debug("Zotero.Net.queueRequest",3);var b,c=this;return b=Array.isArray(a)?c.queueDeferred().then(function(){return Z.debug("running sequential after queued deferred resolved",4),c.runSequential(a)}).then(function(a){return Z.debug("runSequential done",3),c.queuedRequestDone(),a}):c.queueDeferred().then(function(){return Z.debug("running concurrent after queued deferred resolved",4),c.runConcurrent(a)}).then(function(a){return Z.debug("done with queuedRequest"),c.queuedRequestDone(),a}),c.runNext(),b["catch"](function(a){Z.error("Error before leaving Zotero.Net"),Z.error(a)})},Zotero.Net.prototype.runConcurrent=function(a){return Z.debug("Zotero.Net.runConcurrent",3),this.ajaxRequest(a).then(function(a){return Z.debug("done with runConcurrent request"),a})},Zotero.Net.prototype.runSequential=function(a){Z.debug("Zotero.Net.runSequential",3);for(var b=this,c=[],d=Promise.resolve(),e=0;e<a.length;e++){var f=a[e];d=d.then(function(){var a=b.ajaxRequest(f).then(function(a){Z.debug("pushing sequential response into result array"),c.push(a)});return a})}return d.then(function(){return Z.debug("done with sequential aggregator promise - returning responses"),c})},Zotero.Net.prototype.individualRequestDone=function(a){Z.debug("Zotero.Net.individualRequestDone",3);var b=this,c=b.checkDelay(a);if(c>0){var d=1e3*c;b.backingOff=!0;var e=Date.now()+d;e>b.waitingExpires&&(b.waitingExpires=e),window.setTimeout(b.runNext,d)}return a},Zotero.Net.prototype.queuedRequestDone=function(a){Z.debug("queuedRequestDone",3);var b=this;return b.numRunning--,b.runNext(),a},Zotero.Net.prototype.runNext=function(){Z.debug("Zotero.Net.runNext",3);var a=this,b=Date.now();if(a.backingOff&&a.waitingExpires>b-100){Z.debug("currently backing off",3);var c=a.waitingExpires-b;return void window.setTimeout(a.runNext,c)}for(a.backingOff&&a.waitingExpires<=b-100&&(a.backingOff=!1),Z.debug(a.numRunning+"/"+a.numConcurrent+" Running. "+a.deferredQueue.length+" queued.",3);a.deferredQueue.length>0&&a.numRunning<a.numConcurrent;){a.numRunning++;var d=a.deferredQueue.shift();d.resolve(),Z.debug(a.numRunning+"/"+a.numConcurrent+" Running. "+a.deferredQueue.length+" queued.",3)}},Zotero.Net.prototype.checkDelay=function(a){Z.debug("Zotero.Net.checkDelay"),Z.debug(a);var b=this,c=0;if(Array.isArray(a))for(var d=0;d<a.length;d++){var e=b.checkDelay(a[d]);e>c&&(c=e)}else 429==a.status?c=a.retryAfter:a.backoff&&(c=a.backoff);return c},Zotero.Net.prototype.ajaxRequest=function(a){Z.debug("Zotero.Net.ajaxRequest",3);var b=this,c={type:"GET",headers:{"Zotero-API-Version":Zotero.config.apiVersion,"Content-Type":"application/json"},success:function(a){return a},error:function(a){return Z.error("ajaxRequest rejected:"+a.jqxhr.statusCode()+" - "+a.jqxhr.responseText),a}},d=Z.extend({},c.headers,a.headers),e=Z.extend({},c,a);if(e.headers=d,"object"==_typeof(e.url)&&(e.url=Zotero.ajax.apiRequestString(e.url)),e.url=Zotero.ajax.proxyWrapper(e.url,e.type),!e.url)throw"No url specified in Zotero.Net.ajaxRequest";e.zsuccess=e.success,e.zerror=e.error,delete e.success,delete e.error,Z.debug("AJAX config"),Z.debug(e);var f=new Promise(function(a,c){b.ajax(e).then(function(b){var c;switch(b.responseType){case"json":case"":try{c=JSON.parse(b.response)}catch(d){c=b.response}break;case"text":default:c=b.response}var e=new Zotero.ApiResponse({jqxhr:b,data:c,textStatus:b.responseText});a(e)},function(a){var b=new Zotero.ApiResponse({jqxhr:a,textStatus:a.responseText,isError:!0});c(b)})}).then(b.individualRequestDone.bind(b)).then(function(a){if(a.isError)throw Z.error("re-throwing ApiResponse that was a rejection"),a;return a}).then(e.zsuccess,e.zerror);return f},Zotero.Net.prototype.ajax=function(a){var b=new Promise(function(b,c){var d=new XMLHttpRequest,e=a.url;d.open(a.type,e),a.headers&&Object.keys(a.headers).forEach(function(b){var c=a.headers[b];d.setRequestHeader(b,c)}),d.send(a.data),d.onload=function(){Z.debug("XMLHttpRequest done"),Z.debug(d),d.status>=200&&d.status<300?(Z.debug("200-300 response: resolving Net.ajax promise"),b(d)):(Z.debug("not 200-300 response: rejecting Net.ajax promise"),c(d))},d.onerror=function(){c(d)}});return b},Zotero.net=new Zotero.Net,Zotero.Library=function(a,b,c,d){Z.debug("Zotero.Library constructor",3),Z.debug("Library Constructor: "+a+" "+b+" ",3);var e=this;if(Z.debug(c,4),e.instance="Zotero.Library",e.libraryVersion=0,e.syncState={earliestVersion:null,latestVersion:null},e._apiKey=d||"",Zotero.config.librarySettings?e.libraryBaseWebsiteUrl=Zotero.config.librarySettings.libraryPathString:(e.libraryBaseWebsiteUrl=Zotero.config.baseWebsiteUrl,"group"==a&&(e.libraryBaseWebsiteUrl+="groups/"),c?this.libraryBaseWebsiteUrl+=c+"/items":Z.warn("no libraryUrlIdentifier specified")),e.items=new Zotero.Items,e.items.owningLibrary=e,e.itemKeys=[],e.collections=new Zotero.Collections,e.collections.libraryUrlIdentifier=e.libraryUrlIdentifier,e.collections.owningLibrary=e,e.tags=new Zotero.Tags,e.searches=new Zotero.Searches,e.searches.owningLibrary=e,e.groups=new Zotero.Groups,e.groups.owningLibrary=e,e.deleted=new Zotero.Deleted,e.deleted.owningLibrary=e,!a)return void Z.warn("No type specified for library");e.type=a,e.libraryType=a,e.libraryID=b,e.libraryString=Zotero.utils.libraryString(e.libraryType,e.libraryID),e.libraryUrlIdentifier=c,e.preferences=new Zotero.Preferences(Zotero.store,e.libraryString);var f=navigator.userAgent.indexOf("Chrome")>-1,g=(navigator.userAgent.indexOf("MSIE")>-1,navigator.userAgent.indexOf("Firefox")>-1,navigator.userAgent.indexOf("Safari")>-1),h=navigator.userAgent.toLowerCase().indexOf("op")>-1;if(f&&g&&(g=!1),f&&h&&(f=!1),g&&(Zotero.config.useIndexedDB=!1,Zotero.warn("Safari detected; disabling indexedDB")),Zotero.config.useIndexedDB===!0){Z.debug("Library Constructor: indexedDB init",3);var i=new Zotero.Idb.Library(e.libraryString);i.owningLibrary=this,e.idbLibrary=i,i.init().then(function(){if(Z.debug("Library Constructor: idbInitD Done",3),Zotero.config.preloadCachedLibrary===!0){Z.debug("Library Constructor: preloading cached library",3);var a=e.loadIndexedDBCache();a.then(function(){Z.debug("Library Constructor: Library.items.itemsVersion: "+e.items.itemsVersion,3),Z.debug("Library Constructor: Library.collections.collectionsVersion: "+e.collections.collectionsVersion,3),Z.debug("Library Constructor: Library.tags.tagsVersion: "+e.tags.tagsVersion,3),Z.debug("Library Constructor: Triggering cachedDataLoaded",3),e.trigger("cachedDataLoaded")},function(a){throw Z.error("Error loading cached library"),Z.error(a),new Error("Error loading cached library")})}else e.trigger("cachedDataLoaded")},function(){Zotero.config.useIndexedDB=!1,e.trigger("indexedDBError"),e.trigger("cachedDataLoaded"),Z.error("Error initializing indexedDB. Promise rejected.")})}e.dirty=!1,e.tagsChanged=function(){},e.collectionsChanged=function(){},e.itemsChanged=function(){}},Zotero.Library.prototype.sortableColumns=["title","creator","itemType","date","year","publisher","publicationTitle","journalAbbreviation","language","accessDate","libraryCatalog","callNumber","rights","dateAdded","dateModified","addedBy"],Zotero.Library.prototype.displayableColumns=["title","creator","itemType","date","year","publisher","publicationTitle","journalAbbreviation","language","accessDate","libraryCatalog","callNumber","rights","dateAdded","dateModified","numChildren","addedBy"],
Zotero.Library.prototype.groupOnlyColumns=["addedBy"],Zotero.Library.prototype.comparer=function(){return window.Intl?(new window.Intl.Collator).compare:function(a,b){return a.toLocaleLowerCase()==b.toLocaleLowerCase()?0:a.toLocaleLowerCase()<b.toLocaleLowerCase()?-1:1}},Zotero.Library.prototype.ajaxRequest=function(a,b,c){Z.debug("Library.ajaxRequest",3),b||(b="GET"),c||(c={});var d={url:a,type:b};return d=Z.extend({},d,c),Z.debug(d,3),Zotero.net.queueRequest(d)},Zotero.Library.prototype.sequentialRequests=function(a){Z.debug("Zotero.Library.sequentialRequests",3);return Zotero.net.queueRequest(a)},Zotero.Library.prototype.websiteUrl=function(a){Z.debug("Zotero.library.websiteUrl",3),Z.debug(a,4);var b=this,c=[];Object.keys(a).forEach(function(b){var d=a[b];""!==d&&c.push(b+"/"+d)}),c.sort(),Z.debug(c,4);var d=c.join("/");return b.libraryBaseWebsiteUrl+"/"+d},Zotero.Library.prototype.synchronize=function(){},Zotero.Library.prototype.loadUpdatedItems=function(){Z.debug("Zotero.Library.loadUpdatedItems",3);var a=this,b=a.libraryVersion?a.libraryVersion:a.items.itemsVersion;return Promise.resolve(a.updatedVersions("items",b)).then(function(b){Z.debug("itemVersions resolved",3),Z.debug("items Last-Modified-Version: "+b.lastModifiedVersion,3),a.items.updateSyncState(b.lastModifiedVersion);var c=b.data;a.itemVersions=c;var d=[];return Object.keys(c).forEach(function(b){var e=c[b],f=a.items.getItem(b);f&&f.apiObj.key==e||d.push(b)}),a.loadItemsFromKeys(d)}).then(function(b){Z.debug("loadItemsFromKeys resolved",3),a.items.updateSyncedVersion();var c=Zotero.state.getUrlVars();if(a.buildItemDisplayView(c),Zotero.config.useIndexedDB){a.idbLibrary.updateItems(a.items.objectArray)}})},Zotero.Library.prototype.loadUpdatedCollections=function(){Z.debug("Zotero.Library.loadUpdatedCollections",3);var a=this;Z.debug("library.collections.collectionsVersion:"+a.collections.collectionsVersion);var b=a.libraryVersion?a.libraryVersion:a.collections.collectionsVersion;return a.updatedVersions("collections",b).then(function(b){Z.debug("collectionVersions finished",3),Z.debug("Collections Last-Modified-Version: "+b.lastModifiedVersion,3),a.collections.updateSyncState(b.lastModifiedVersion);var c=b.data;a.collectionVersions=c;var d=[];return Object.keys(c).forEach(function(b){var e=c[b],f=a.collections.getCollection(b);f&&f.apiObj.version==e||d.push(b)}),0===d.length?(Z.debug("No collectionKeys need updating. resolving",3),b):(Z.debug("fetching collections by key",3),a.loadCollectionsFromKeys(d).then(function(){var b=a.collections;b.initSecondaryData(),Z.debug("All updated collections loaded",3),a.collections.updateSyncedVersion();Zotero.state.getUrlVars();return Z.debug("loadUpdatedCollections complete - saving collections to cache before resolving",3),Z.debug("collectionsVersion: "+a.collections.collectionsVersion,3),Zotero.config.useIndexedDB?a.idbLibrary.updateCollections(b.collectionsArray):void 0}))}).then(function(){return Z.debug("done getting collection data. requesting deleted data",3),a.getDeleted(a.libraryVersion)}).then(function(b){Z.debug("got deleted collections data: removing local copies",3),Z.debug(a.deleted),a.deleted.deletedData.collections&&a.deleted.deletedData.collections.length>0&&a.collections.removeLocalCollections(a.deleted.deletedData.collections)})},Zotero.Library.prototype.loadUpdatedTags=function(){Z.debug("Zotero.Library.loadUpdatedTags",3);var a=this;return Z.debug("tagsVersion: "+a.tags.tagsVersion,3),Promise.resolve(a.loadAllTags({since:a.tags.tagsVersion})).then(function(){return Z.debug("done getting tags, request deleted tags data",3),a.getDeleted(a.libraryVersion)}).then(function(b){if(Z.debug("got deleted tags data"),a.deleted.deletedData.tags&&a.deleted.deletedData.tags.length>0&&a.tags.removeTags(a.deleted.deletedData.tags),Zotero.config.useIndexedDB){Z.debug("saving updated tags to IDB",3);a.idbLibrary.updateTags(a.tags.tagsArray)}})},Zotero.Library.prototype.getDeleted=function(a){Z.debug("Zotero.Library.getDeleted",3);var b=this,c={target:"deleted",libraryType:b.libraryType,libraryID:b.libraryID,since:a};return b.deleted.pending?(Z.debug("getDeleted resolving with previously pending promise"),Promise.resolve(b.deleted.pendingPromise)):(Z.debug("version:"+a),Z.debug("sinceVersion:"+b.deleted.sinceVersion),Z.debug("untilVersion:"+b.deleted.untilVersion),b.deleted.untilVersion&&a>=b.deleted.sinceVersion?(Z.debug("deletedVersion matches requested: immediately resolving"),Promise.resolve(b.deleted.deletedData)):(b.deleted.pending=!0,b.deleted.pendingPromise=b.ajaxRequest(c).then(function(c){Z.debug("got deleted response"),b.deleted.deletedData=c.data,Z.debug("Deleted Last-Modified-Version:"+c.lastModifiedVersion,3),b.deleted.untilVersion=c.lastModifiedVersion,b.deleted.sinceVersion=a}).then(function(a){Z.debug("cleaning up deleted pending"),b.deleted.pending=!1,b.deleted.pendingPromise=!1}),b.deleted.pendingPromise))},Zotero.Library.prototype.processDeletions=function(a){var b=this;b.collections.processDeletions(a.collections),b.items.processDeletions(a.items)},Zotero.Library.prototype.loadFullBib=function(a,b){var c=this,d=a.join(","),e={target:"items",libraryType:c.libraryType,libraryID:c.libraryID,itemKey:d,format:"bib",linkwrap:"1"};1==a.length&&(e.target="item"),b&&(e.style=b);var f=c.ajaxRequest(e).then(function(a){return a.data});return f},Zotero.Library.prototype.loadItemBib=function(a,b){Z.debug("Zotero.Library.loadItemBib",3);var c=this,d={target:"item",libraryType:c.libraryType,libraryID:c.libraryID,itemKey:a,content:"bib"};b&&(d.style=b);var e=c.ajaxRequest(d).then(function(a){var b=new Zotero.Item(a.data),c=b.apiObj.bib;return c});return e},Zotero.Library.prototype.loadSettings=function(){Z.debug("Zotero.Library.loadSettings",3);var a=this,b={target:"settings",libraryType:a.libraryType,libraryID:a.libraryID};return a.ajaxRequest(b).then(function(b){var c;if(c="string"==typeof b.data?JSON.parse(b.data):b.data,a.preferences.setPref("settings",c),c.tagColors){var d=c.tagColors.value;a.preferences.setPref("tagColors",d)}return a.trigger("settingsLoaded"),a.preferences})},Zotero.Library.prototype.matchColoredTags=function(a){var b,c=this,d=c.preferences.getPref("tagColors");if(!d)return[];var e={};for(b=0;b<d.length;b++)e[d[b].name.toLowerCase()]=d[b].color;var f=[];for(b=0;b<a.length;b++)e.hasOwnProperty(a[b])&&f.push(e[a[b]]);return f},Zotero.Library.prototype.sendToLibrary=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],f=e.emptyJsonItem();f.data=Z.extend({},a[d].apiObj.data),f.data.key="",f.data.version=0,f.data.collections=[],delete f.data.dateModified,delete f.data.dateAdded;var g=new Zotero.Item(f);g.pristine=Z.extend({},g.apiObj),g.initSecondaryData(),g.apiObj.data.relations||(g.apiObj.data.relations={}),g.apiObj.data.relations["owl:sameAs"]=Zotero.url.relationUrl(e.owningLibrary.libraryType,e.owningLibrary.libraryID,e.key),c.push(g)}return b.items.writeItems(c)},Zotero.Library.prototype.updatedVersions=function(){var a=arguments.length<=0||void 0===arguments[0]?"items":arguments[0],b=arguments.length<=1||void 0===arguments[1]?this.libraryVersion:arguments[1];Z.debug("Library.updatedVersions",3);var c=this,d={target:a,format:"versions",libraryType:c.libraryType,libraryID:c.libraryID,since:b};return c.ajaxRequest(d)},Zotero.Library.prototype.loadItemsFromKeys=function(a){Zotero.debug("Zotero.Library.loadItemsFromKeys",3);var b=this;return b.loadFromKeys(a,"items")},Zotero.Library.prototype.loadCollectionsFromKeys=function(a){Zotero.debug("Zotero.Library.loadCollectionsFromKeys",3);var b=this;return b.loadFromKeys(a,"collections")},Zotero.Library.prototype.loadSeachesFromKeys=function(a){Zotero.debug("Zotero.Library.loadSearchesFromKeys",3);var b=this;return b.loadFromKeys(a,"searches")},Zotero.Library.prototype.loadFromKeys=function(a,b){Zotero.debug("Zotero.Library.loadFromKeys",3),b||(b="items");for(var c=this,d=[];a.length>0;)d.push(a.splice(0,50));var e=[];d.forEach(function(a){var d=a.join(",");switch(b){case"items":e.push({url:{target:"items",targetModifier:null,itemKey:d,limit:50,libraryType:c.libraryType,libraryID:c.libraryID},type:"GET",success:c.processLoadedItems.bind(c)});break;case"collections":e.push({url:{target:"collections",targetModifier:null,collectionKey:d,limit:50,libraryType:c.libraryType,libraryID:c.libraryID},type:"GET",success:c.processLoadedCollections.bind(c)});break;case"searches":e.push({url:{target:"searches",targetModifier:null,searchKey:d,limit:50,libraryType:c.libraryType,libraryID:c.libraryID},type:"GET"})}});for(var f=[],g=0;g<e.length;g++)f.push(Zotero.net.queueRequest(e[g]));return Promise.all(f)},Zotero.Library.prototype.buildItemDisplayView=function(a){Z.debug("Zotero.Library.buildItemDisplayView",3),Z.debug(a,4);var b=this;if(!b.idbLibrary.db)return Promise.resolve([]);var c=[];a.collectionKey?"trash"==a.collectionKey?c.push(b.idbLibrary.filterItems("deleted",1)):c.push(b.idbLibrary.filterItems("collectionKeys",a.collectionKey)):c.push(b.idbLibrary.getOrderedItemKeys("title"));var d=a.tag||[];"string"==typeof d&&(d=[d]);for(var e=0;e<d.length;e++)Z.debug("adding selected tag filter",3),c.push(b.idbLibrary.filterItems("itemTagStrings",d[e]));return Promise.all(c).then(function(c){var d;for(d=0;d<c.length;d++)Z.debug("result from filterPromise: "+c[d].length,3),Z.debug(c[d],3);var e=b.idbLibrary.intersectAll(c),f=b.items.getItems(e);Z.debug("All filters applied - Down to "+f.length+" items displayed",3),Z.debug("remove child items and, if not viewing trash, deleted items",3);var g=[];for(d=0;d<f.length;d++)f[d].apiObj.data.parentItem||"trash"!=a.collectionKey&&f[d].apiObj.deleted||g.push(f[d]);var h=a.order||"title",i=a.sort||"asc";Z.debug("Sorting by "+h+" - "+i,3);var j=Zotero.Library.prototype.comparer();return g.sort(function(a,b){var c=a.get(h),d=b.get(h);return j(c,d)}),"desc"==i&&(Z.debug("sort is desc - reversing array",4),g.reverse()),Z.debug("triggering publishing displayedItemsUpdated",3),b.trigger("displayedItemsUpdated"),g})},Zotero.Library.prototype.trigger=function(a,b){var c=this;Zotero.trigger(a,b,c.libraryString)},Zotero.Library.prototype.listen=function(a,b,c){var d=this,e=d.libraryString;Zotero.listen(a,b,c,e)},Zotero.Container=function(){},Zotero.Container.prototype.initSecondaryData=function(){},Zotero.Container.prototype.addObject=function(a){Zotero.debug("Zotero.Container.addObject",4);var b=this;return b.objectArray.push(a),b.objectMap[a.key]=a,b.owningLibrary&&a.associateWithLibrary(b.owningLibrary),b},Zotero.Container.prototype.fieldComparer=function(a){if(window.Intl){var b=new window.Intl.Collator;return function(c,d){return b.compare(c.apiObj.data[a],d.apiObj.data[a])}}return function(b,c){return b.apiObj.data[a].toLowerCase()==c.apiObj.data[a].toLowerCase()?0:b.apiObj.data[a].toLowerCase()<c.apiObj.data[a].toLowerCase()?-1:1}},Zotero.Container.prototype.getObject=function(a){var b=this;return b.objectMap.hasOwnProperty(a)?b.objectMap[a]:!1},Zotero.Container.prototype.getObjects=function(a){for(var b,c=this,d=[],e=0;e<a.length;e++)b=c.getObject(a[e]),b&&d.push(b);return d},Zotero.Container.prototype.removeObject=function(a){var b=this;b.objectMap.hasOwnProperty(a)&&(delete b.objectmap[a],b.initSecondaryData())},Zotero.Container.prototype.removeObjects=function(a){for(var b=this,c=0;c<a.length;c++)delete b.objectMap[a[c]];b.initSecondaryData()},Zotero.Container.prototype.writeObjects=function(a){},Zotero.Container.prototype.assignKeys=function(a){for(var b,c=0;c<a.length;c++){b=a[c];var d=b.get("key");if(!d){var e=Zotero.utils.getKey();b.set("key",e),b.set("version",0)}}return a},Zotero.Container.prototype.chunkObjectsArray=function(a){for(var b=50,c=[],d=0;d<a.length;d+=b)c.push(a.slice(d,d+b));return c},Zotero.Container.prototype.rawChunks=function(a){for(var b=[],c=0;c<a.length;c++){b[c]=[];for(var d=0;d<a[c].length;d++)b[c].push(a[c][d].writeApiObj())}return b},Zotero.Container.prototype.updateSyncState=function(a){var b=this;if(Z.debug("updateSyncState: "+a,3),!b.hasOwnProperty("syncState"))throw Z.debug("no syncState property"),new Error("Attempt to update sync state of object with no syncState property");null===b.syncState.earliestVersion&&(b.syncState.earliestVersion=a),null===b.syncState.latestVersion&&(b.syncState.latestVersion=a),a<b.syncState.earliestVersion&&(b.syncState.earliestVersion=a),a>b.syncState.latestVersion&&(b.syncState.latestVersion=a),Z.debug("done updating sync state",3)},Zotero.Container.prototype.updateSyncedVersion=function(a){var b=this;null!==b.syncState.earliestVersion&&b.syncState.earliestVersion==b.syncState.latestVersion?(b.version=b.syncState.latestVersion,b.synced=!0):null!==b.syncState.earliestVersion&&(b.version=b.syncState.earliestVersion)},Zotero.Container.prototype.processDeletions=function(a){for(var b=this,c=0;c<a.length;c++){var d=b.get(a[c]);d!==!1&&d.synced===!0&&b.removeObjects([a[c]])}},Zotero.Container.prototype.updateObjectsFromWriteResponse=function(a,b){Z.debug("Zotero.Container.updateObjectsFromWriteResponse",3),Z.debug("statusCode: "+b.status,3);var c=b.data;200==b.status?(Z.debug("newLastModifiedVersion: "+b.lastModifiedVersion,3),c.hasOwnProperty("success")&&Object.keys(c.success).forEach(function(d){var e=parseInt(d,10),f=c.success[d],g=a[e];if(""!==g.key&&g.key!==f)throw new Error("object key mismatch in multi-write response");""===g.key&&g.updateObjectKey(f),g.set("version",b.lastModifiedVersion),g.synced=!0,g.writeFailure=!1}),c.hasOwnProperty("failed")&&(Z.debug("updating objects with failed writes",3),Object.keys(c.failed).forEach(function(b){var d=c.failed[b];Z.error("failed write "+b+" - "+d);var e=parseInt(b,10),f=a[e];f.writeFailure=d}))):204==b.status&&(a[0].synced=!0)},Zotero.Container.prototype.extractKey=function(a){return"string"==typeof a?a:a.get("key")},Zotero.Collections=function(a){this.instance="Zotero.Collections",this.version=0,this.syncState={earliestVersion:null,latestVersion:null},this.collectionObjects={},this.collectionsArray=[],this.objectMap=this.collectionObjects,this.objectArray=this.collectionsArray,this.dirty=!1,this.loaded=!1,a&&(this.addCollectionsFromJson(a),this.initSecondaryData())},Zotero.Collections.prototype=new Zotero.Container,Zotero.Collections.prototype.initSecondaryData=function(){Z.debug("Zotero.Collections.initSecondaryData",3);var a=this;a.collectionsArray=[],Object.keys(a.collectionObjects).forEach(function(b){var c=a.collectionObjects[b];a.collectionsArray.push(c)}),a.collectionsArray.sort(Zotero.ApiObject.prototype.fieldComparer("name")),a.nestCollections(),a.assignDepths(0,a.collectionsArray)},Zotero.Collections.prototype.addCollection=function(a){return this.addObject(a),this},Zotero.Collections.prototype.addCollectionsFromJson=function(a){Z.debug("addCollectionsFromJson"),Z.debug(a);var b=this,c=[];return a.forEach(function(a){var d=new Zotero.Collection(a);b.addObject(d),c.push(d)}),c},Zotero.Collections.prototype.assignDepths=function(a,b){Z.debug("Zotero.Collections.assignDepths",3);var c=this,d=function e(a,b){b.forEach(function(b){b.nestingDepth=a,b.hasChildren&&e(a+1,b.children)})};c.collectionsArray.forEach(function(a){a.topLevel&&(a.nestingDepth=1,a.hasChildren&&d(2,a.children))})},Zotero.Collections.prototype.nestedOrderingArray=function(){Z.debug("Zotero.Collections.nestedOrderingArray",3);var a=this,b=[],c=function d(a,b){b.forEach(function(b){a.push(b),b.hasChildren&&d(a,b.children)})};return a.collectionsArray.forEach(function(a){a.topLevel&&(b.push(a),a.hasChildren&&c(b,a.children))}),Z.debug("Done with nestedOrderingArray",3),b},Zotero.Collections.prototype.getCollection=function(a){return this.getObject(a)},Zotero.Collections.prototype.remoteDeleteCollection=function(a){var b=this;return b.removeLocalCollection(a)},Zotero.Collections.prototype.removeLocalCollection=function(a){var b=this;return b.removeLocalCollections([a])},Zotero.Collections.prototype.removeLocalCollections=function(a){for(var b=this,c=0;c<a.length;c++)delete b.collectionObjects[a[c]];b.initSecondaryData()},Zotero.Collections.prototype.nestCollections=function(){var a=this;a.collectionsArray.forEach(function(a){a.children=[]}),a.collectionsArray.sort(Zotero.ApiObject.prototype.fieldComparer("name")),a.collectionsArray.forEach(function(b){b.nestCollection(a.collectionObjects)})},Zotero.Collections.prototype.writeCollections=function(a){Z.debug("Zotero.Collections.writeCollections",3);var b,c=this,d=c.owningLibrary,e={target:"collections",libraryType:c.owningLibrary.libraryType,libraryID:c.owningLibrary.libraryID},f=Zotero.ajax.apiRequestString(e);for(b=0;b<a.length;b++){var g=a[b],h=g.get("key");if(""===h||null===h){var i=Zotero.utils.getKey();g.set("key",i),g.set("version",0)}}var j=c.chunkObjectsArray(a),k=c.rawChunks(j),l=function(a){Z.debug("writeCollections successCallback",3);var b=this.library,c=this.writeChunk;b.collections.updateObjectsFromWriteResponse(this.writeChunk,a);for(var d=0;d<c.length;d++){var e=c[d];e.synced&&!e.writeFailure&&(b.collections.addCollection(e),Zotero.config.useIndexedDB&&(Z.debug("updating indexedDB collections"),b.idbLibrary.updateCollections(c)))}return a.returnCollections=c,a};Z.debug("collections.version: "+c.version,3),Z.debug("collections.libraryVersion: "+c.libraryVersion,3);var m=[];for(b=0;b<j.length;b++){var n={writeChunk:j[b],library:d},o=JSON.stringify(k[b]);m.push({url:f,type:"POST",data:o,processData:!1,headers:{},success:l.bind(n)})}return d.sequentialRequests(m).then(function(a){return Z.debug("Done with writeCollections sequentialRequests promise",3),c.initSecondaryData(),a.forEach(function(a){if(a.isError||a.data.hasOwnProperty("failed")&&Object.keys(a.data.failed).length>0)throw new Error("failure when writing collections")}),a})["catch"](function(a){throw Z.error(a),a})},Zotero.Items=function(a){this.instance="Zotero.Items",this.itemsVersion=0,this.syncState={earliestVersion:null,latestVersion:null},this.itemObjects={},this.objectMap=this.itemObjects,this.objectArray=[],this.unsyncedItemKeys=[],a&&this.addItemsFromJson(a)},Zotero.Items.prototype=new Zotero.Container,Zotero.Items.prototype.getItem=function(a){return this.getObject(a)},Zotero.Items.prototype.getItems=function(a){return this.getObjects(a)},Zotero.Items.prototype.addItem=function(a){return this.addObject(a),this},Zotero.Items.prototype.addItemsFromJson=function(a){Z.debug("addItemsFromJson",3);var b=this,c=a,d=[];return Z.debug("looping"),c.forEach(function(a){Z.debug("creating new Item");var c=new Zotero.Item(a);b.addItem(c),d.push(c)}),d},Zotero.Items.prototype.removeLocalItem=function(a){return this.removeObject(a)},Zotero.Items.prototype.removeLocalItems=function(a){return this.removeObjects(a)},Zotero.Items.prototype.deleteItem=function(a){Z.debug("Zotero.Items.deleteItem",3);var b,c=this;if(!a)return!1;a=c.extractKey(a),b=c.getItem(a);var d={target:"item",libraryType:c.owningLibrary.libraryType,libraryID:c.owningLibrary.libraryID,itemKey:b.key},e={url:Zotero.ajax.apiRequestString(d),type:"DELETE",headers:{"If-Unmodified-Since-Version":b.get("version")}};return Zotero.net.ajaxRequest(e)},Zotero.Items.prototype.deleteItems=function(a,b){Z.debug("Zotero.Items.deleteItems",3);var c,d=this,e=[];b||0===d.itemsVersion||(b=d.itemsVersion);var f;for(c=0;c<a.length;c++)a[c]&&(f=d.extractKey(a[c]),f&&e.push(f));var g=d.chunkObjectsArray(e),h=[];for(c=0;c<g.length;c++){var i=g[c].join(","),j={target:"items",libraryType:d.owningLibrary.libraryType,libraryID:d.owningLibrary.libraryID,itemKey:i},k={url:j,type:"DELETE"};h.push(k)}return Zotero.net.queueRequest(h)},Zotero.Items.prototype.trashItems=function(a){var b,c=this;for(b=0;b<a.length;b++){var d=a[b];d.set("deleted",1)}return c.writeItems(a)},Zotero.Items.prototype.untrashItems=function(a){var b,c=this;for(b=0;b<a.length;b++){var d=a[b];d.set("deleted",0)}return c.writeItems(a)},Zotero.Items.prototype.findItems=function(a){var b=this,c=[];return Object.keys(b.itemObjects).forEach(function(d){var e=e.itemObjects[d];a.collectionKey&&-1===e.apiObj.collections.indexOf(a.collectionKey)||c.push(b.itemObjects[d])}),c},Zotero.Items.prototype.atomizeItems=function(a){for(var b,c=[],d=0;d<a.length;d++){b=a[d];var e=b.get("key");if(""===e||null===e){var f=Zotero.utils.getKey();b.set("key",f),b.set("version",0)}if(c.push(b),b.hasOwnProperty("notes")&&b.notes.length>0){for(var g=0;g<b.notes.length;g++)b.notes[g].set("parentItem",b.get("key"));c=c.concat(b.notes)}if(b.hasOwnProperty("attachments")&&b.attachments.length>0){for(var h=0;h<b.attachments.length;h++)b.attachments[h].set("parentItem",b.get("key"));c=c.concat(b.attachments)}}return c},Zotero.Items.prototype.writeItems=function(a){var b,c=this,d=c.owningLibrary,e=c.atomizeItems(a),f={target:"items",libraryType:c.owningLibrary.libraryType,libraryID:c.owningLibrary.libraryID},g=Zotero.ajax.apiRequestString(f),h=c.chunkObjectsArray(e),i=c.rawChunks(h),j=function(a){return Z.debug("writeItem successCallback",3),c.updateObjectsFromWriteResponse(this.writeChunk,a),Zotero.config.useIndexedDB&&this.library.idbLibrary.updateItems(this.writeChunk),Zotero.trigger("itemsChanged",{library:this.library}),a.returnItems=this.writeChunk,a};Z.debug("items.itemsVersion: "+c.itemsVersion,3),Z.debug("items.libraryVersion: "+c.libraryVersion,3);var k=[];for(b=0;b<h.length;b++){var l={writeChunk:h[b],library:d},m=JSON.stringify(i[b]);k.push({url:g,type:"POST",data:m,processData:!1,success:j.bind(l)})}return d.sequentialRequests(k).then(function(a){return Z.debug("Done with writeItems sequentialRequests promise",3),a})},Zotero.Tags=function(a){this.instance="Zotero.Tags",this.tagsVersion=0,this.syncState={earliestVersion:null,latestVersion:null},this.displayTagsArray=[],this.displayTagsUrl="",this.tagObjects={},this.tagsArray=[],this.loaded=!1,a&&this.addTagsFromJson(a)},Zotero.Tags.prototype=new Zotero.Container,Zotero.Tags.prototype.addTag=function(a){var b=this;b.tagObjects[a.apiObj.tag]=a,b.tagsArray.push(a),b.owningLibrary&&a.associateWithLibrary(b.owningLibrary)},Zotero.Tags.prototype.getTag=function(a){var b=this;return b.tagObjects.hasOwnProperty(a)?this.tagObjects[a]:null},Zotero.Tags.prototype.removeTag=function(a){var b=this;delete b.tagObjects[a],b.updateSecondaryData()},Zotero.Tags.prototype.removeTags=function(a){var b=this;a.forEach(function(a){delete b.tagObjects[a]}),b.updateSecondaryData()},Zotero.Tags.prototype.plainTagsList=function(a){Z.debug("Zotero.Tags.plainTagsList",3);var b=[];return a.forEach(function(a){b.push(a.apiObj.tag)}),b},Zotero.Tags.prototype.clear=function(){Z.debug("Zotero.Tags.clear",3),this.tagsVersion=0,this.syncState.earliestVersion=null,this.syncState.latestVersion=null,this.displayTagsArray=[],this.displayTagsUrl="",this.tagObjects={},this.tagsArray=[]},Zotero.Tags.prototype.updateSecondaryData=function(){Z.debug("Zotero.Tags.updateSecondaryData",3);var a=this;a.tagsArray=[],Object.keys(a.tagObjects).forEach(function(b){var c=a.tagObjects[b];a.tagsArray.push(c)}),a.tagsArray.sort(Zotero.Tag.prototype.tagComparer());var b=a.plainTagsList(a.tagsArray);b.sort(Zotero.Library.prototype.comparer()),a.plainList=b},Zotero.Tags.prototype.updateTagsVersion=function(a){var b=this;Object.keys(b.tagObjects).forEach(function(c){var d=b.tagObjects[c];d.set("version",a)})},Zotero.Tags.prototype.rebuildTagsArray=function(){var a=this;a.tagsArray=[],Object.keys(a.tagObjects).forEach(function(b){var c=a.tagObjects[b];a.tagsArray.push(c)})},Zotero.Tags.prototype.addTagsFromJson=function(a){Z.debug("Zotero.Tags.addTagsFromJson",3);var b=this,c=[];return a.forEach(function(a){var d=new Zotero.Tag(a);b.addTag(d),c.push(d)}),c},Zotero.Groups=function(){this.instance="Zotero.Groups",this.groupsArray=[]},Zotero.Groups.prototype.addGroupsFromJson=function(a){var b=this,c=[];return a.forEach(function(a){Z.debug(a,3);var d=new Zotero.Group(a);b.groupsArray.push(d),c.push(d)}),c},Zotero.Groups.prototype.fetchUserGroups=function(a,b){var c=this,d={target:"userGroups",libraryType:"user",libraryID:a,order:"title"};return b?d.key=b:c.owningLibrary&&(d.key=c.owningLibrary._apiKey),Zotero.ajaxRequest(d).then(function(a){Z.debug("fetchUserGroups proxied callback",3);var b=c.addGroupsFromJson(a.data);return a.fetchedGroups=b,a})},Zotero.Searches=function(){this.instance="Zotero.Searches",this.searchObjects={},this.syncState={earliestVersion:null,latestVersion:null}},Zotero.Deleted=function(a){this.instance="Zotero.Deleted","string"==typeof a?this.deletedData=JSON.parse(a):this.deletedData=a,this.untilVersion=null,this.sinceVersion=null,this.waitingPromises=[],this.pending=!1},Zotero.Deleted.prototype.addWaiter=function(){},Zotero.Collection=function(a){this.instance="Zotero.Collection",this.libraryUrlIdentifier="",this.itemKeys=!1,this.key="",this.version=0,this.synced=!1,this.pristineData=null,this.apiObj={key:"",version:0,library:{},links:{},meta:{},data:{key:"",version:0,name:"",parentCollection:!1,relations:{}}},this.children=[],this.topLevel=!0,a&&this.parseJsonCollection(a)},Zotero.Collection.prototype=new Zotero.ApiObject,Zotero.Collection.prototype.instance="Zotero.Collection",Zotero.Collection.prototype.updateObjectKey=function(a){this.updateCollectionKey(a)},Zotero.Collection.prototype.updateCollectionKey=function(a){var b=this;return b.key=a,b.apiObj.key=a,b.apiObj.data.key=a,b},Zotero.Collection.prototype.parseJsonCollection=function(a){Z.debug("parseJsonCollection",4);var b=this;b.key=a.key,b.version=a.version,b.apiObj=Z.extend({},a),b.pristineData=Z.extend({},a.data),b.parentCollection=!1,b.topLevel=!0,b.synced=!0,b.initSecondaryData()},Zotero.Collection.prototype.initSecondaryData=function(){var a=this;a.apiObj.data.parentCollection?a.topLevel=!1:a.topLevel=!0,Zotero.config.librarySettings.libraryPathString?a.websiteCollectionLink=Zotero.config.librarySettings.libraryPathString+"/collectionKey/"+a.apiObj.key:a.websiteCollectionLink="",a.hasChildren=a.apiObj.meta.numCollections?!0:!1},Zotero.Collection.prototype.nestCollection=function(a){Z.debug("Zotero.Collection.nestCollection",4);var b=this,c=b.get("parentCollection");if(c!==!1&&a.hasOwnProperty(c)){var d=a[c];return d.children.push(b),d.hasChildren=!0,b.topLevel=!1,!0}return!1},Zotero.Collection.prototype.addItems=function(a){Z.debug("Zotero.Collection.addItems",3);var b=this,c={target:"items",libraryType:b.apiObj.library.type,libraryID:b.apiObj.library.id,collectionKey:b.key},d=a.join(" ");return Zotero.ajaxRequest(c,"POST",{data:d})},Zotero.Collection.prototype.getMemberItemKeys=function(){Z.debug("Zotero.Collection.getMemberItemKeys",3);var a=this,b={target:"items",libraryType:a.apiObj.library.type,libraryID:a.apiObj.library.id,collectionKey:a.key,format:"keys"};return Zotero.ajaxRequest(b,"GET",{processData:!1}).then(function(b){Z.debug("getMemberItemKeys proxied callback",3);var c=b.data,d=c.trim().split(/[\s]+/);return a.itemKeys=d,d})},Zotero.Collection.prototype.removeItem=function(a){var b=this,c={target:"item",libraryType:b.apiObj.library.type,libraryID:b.apiObj.library.id,collectionKey:b.key,itemKey:a};return Zotero.ajaxRequest(c,"DELETE",{processData:!1,cache:!1})},Zotero.Collection.prototype.update=function(a,b){var c=this;b||(b=!1);var d={target:"collection",libraryType:c.apiObj.library.type,libraryID:c.apiObj.library.id,collectionKey:c.key};c.set("name",a),c.set("parentCollection",b);var e=c.writeApiObj(),f=JSON.stringify(e);return Zotero.ajaxRequest(d,"PUT",{data:f,processData:!1,headers:{"If-Unmodified-Since-Version":c.version},cache:!1})},Zotero.Collection.prototype.writeApiObj=function(){var a=this,b=Z.extend({},a.pristineData,a.apiObj.data);return b},Zotero.Collection.prototype.remove=function(){Z.debug("Zotero.Collection.delete",3);var a=this,b=a.owningLibrary,c={target:"collection",libraryType:a.apiObj.library.type,libraryID:a.apiObj.library.id,collectionKey:a.key};return Zotero.ajaxRequest(c,"DELETE",{processData:!1,headers:{"If-Unmodified-Since-Version":a.version},cache:!1}).then(function(){Z.debug("done deleting collection. remove local copy.",3),b.collections.removeLocalCollection(a.key),b.trigger("libraryCollectionsUpdated")})},Zotero.Collection.prototype.get=function(a){var b=this;switch(a){case"title":case"name":return b.apiObj.data.name;case"collectionKey":case"key":return b.apiObj.key||b.key;case"collectionVersion":case"version":return b.apiObj.version;case"parentCollection":return b.apiObj.data.parentCollection}return a in b.apiObj.data?b.apiObj.data[a]:b.apiObj.meta.hasOwnProperty(a)?b.apiObj.meta[a]:b.hasOwnProperty(a)?b[a]:null},Zotero.Collection.prototype.set=function(a,b){var c=this;switch(a in c.apiObj.data&&(c.apiObj.data[a]=b),a){case"title":case"name":c.apiObj.data.name=b;break;case"collectionKey":case"key":c.key=b,c.apiObj.key=b,c.apiObj.data.key=b;break;case"parentCollection":c.apiObj.data.parentCollection=b;break;case"collectionVersion":case"version":c.version=b,c.apiObj.version=b,c.apiObj.data.version=b}c.hasOwnProperty(a)&&(c[a]=b)},Zotero.Item=function(a){this.instance="Zotero.Item",this.version=0,this.key="",this.synced=!1,this.apiObj={},this.pristineData=null,this.childItemKeys=[],this.writeErrors=[],this.notes=[],a?this.parseJsonItem(a):this.parseJsonItem(this.emptyJsonItem()),this.initSecondaryData()},Zotero.Item.prototype=new Zotero.ApiObject,Zotero.Item.prototype.parseJsonItem=function(a){Z.debug("parseJsonItem",3);var b=this;b.version=a.version,b.key=a.key,b.apiObj=Z.extend({},a),b.pristineData=Z.extend({},a.data),b.apiObj._supplement||(b.apiObj._supplement={})},Zotero.Item.prototype.emptyJsonItem=function(){return{key:"",version:0,library:{},links:{},data:{key:"",version:0,title:"",creators:[],collections:[],tags:[],relations:{}},meta:{},_supplement:{}}},Zotero.Item.prototype.initSecondaryData=function(){Z.debug("initSecondaryData",3);var a=this;a.version=a.apiObj.version,"attachment"==a.apiObj.data.itemType&&(a.mimeType=a.apiObj.data.contentType,a.translatedMimeType=Zotero.utils.translateMimeType(a.mimeType)),"linkMode"in a.apiObj&&(a.linkMode=a.apiObj.data.linkMode),a.attachmentDownloadUrl=Zotero.url.attachmentDownloadUrl(a),a.apiObj.meta.parsedDate?a.parsedDate=new Date(a.apiObj.meta.parsedDate):a.parsedDate=!1,a.synced=!1,a.updateTagStrings(),Z.debug("done with initSecondaryData",3)},Zotero.Item.prototype.updateTagStrings=function(){for(var a=this,b=[],c=0;c<a.apiObj.data.tags.length;c++)b.push(a.apiObj.data.tags[c].tag);a.apiObj._supplement.tagstrings=b},Zotero.Item.prototype.initEmpty=function(a,b){var c=this;return c.getItemTemplate(a,b).then(function(a){return c.initEmptyFromTemplate(a),c})},Zotero.Item.prototype.initEmptyNote=function(){var a=this;a.version=0;var b={itemType:"note",note:"",tags:[],collections:[],relations:{}};return a.initEmptyFromTemplate(b),a},Zotero.Item.prototype.initEmptyFromTemplate=function(a){var b=this;return b.version=0,b.key="",b.pristineData=Z.extend({},a),b.apiObj={key:"",version:0,library:{},links:{},data:a,meta:{},_supplement:{}},b.initSecondaryData(),b},Zotero.Item.prototype.isSupplementaryItem=function(){var a=this,b=a.get("itemType");return"attachment"==b||"note"==b?!0:!1},Zotero.Item.prototype.isSnapshot=function(){var a=this;if(a.apiObj.links.enclosure){var b=a.apiObj.links.enclosure.type;if(!a.apiObj.links.enclosure.length&&"text/html"==b)return!0}return!1},Zotero.Item.prototype.updateObjectKey=function(a){return this.updateItemKey(a)},Zotero.Item.prototype.updateItemKey=function(a){var b=this;return b.key=a,b.apiObj.key=a,b.apiObj.data.key=a,b.pristineData.key=a,b},Zotero.Item.prototype.writeItem=function(){var a=this;if(!a.owningLibrary)throw new Error("Item must be associated with a library");return a.owningLibrary.items.writeItems([a])},Zotero.Item.prototype.writeApiObj=function(){var a=this;if(a.apiObj.data.creators){var b=a.apiObj.data.creators.filter(function(a){return a.name||a.firstName||a.lastName?!0:!1});a.apiObj.data.creators=b}var c=Z.extend({},a.pristineData,a.apiObj.data);return c},Zotero.Item.prototype.createChildNotes=function(a){var b=this,c=[],d=[];return a.forEach(function(a){var e=new Zotero.Item,f=e.initEmpty("note").then(function(d){
d.set("note",a.note),d.set("parentItem",b.key),c.push(d)});d.push(f)}),Promise.all(d).then(function(){return b.owningLibrary.writeItems(c)})},Zotero.Item.prototype.writePatch=function(){},Zotero.Item.prototype.getChildren=function(a){Z.debug("Zotero.Item.getChildren");var b=this;return Promise.resolve().then(function(){if(!b.apiObj.meta.numChildren)return[];var c={url:{target:"children",libraryType:b.apiObj.library.type,libraryID:b.apiObj.library.id,itemKey:b.key}};return Zotero.net.queueRequest(c).then(function(b){Z.debug("getChildren proxied callback",4);for(var c=a.items,d=c.addItemsFromJson(b.data),e=d.length-1;e>=0;e--)d[e].associateWithLibrary(a);return d})})},Zotero.Item.prototype.getItemTypes=function(a){Z.debug("Zotero.Item.prototype.getItemTypes",3),a||(a="en-US"),a="en-US";var b=Zotero.cache.load({locale:a,target:"itemTypes"});if(b)return Z.debug("have itemTypes in localStorage",3),void(Zotero.Item.prototype.itemTypes=b);var c=Zotero.ajax.apiQueryString({locale:a}),d=Zotero.config.baseApiUrl+"/itemTypes"+c;Zotero.net.ajax({url:Zotero.ajax.proxyWrapper(d,"GET"),type:"GET"}).then(function(b){Z.debug("got itemTypes response",3),Z.debug(b.response,4),Zotero.Item.prototype.itemTypes=JSON.parse(b.responseText),Zotero.cache.save({locale:a,target:"itemTypes"},Zotero.Item.prototype.itemTypes)})},Zotero.Item.prototype.getItemFields=function(a){Z.debug("Zotero.Item.prototype.getItemFields",3),a||(a="en-US"),a="en-US";var b=Zotero.cache.load({locale:a,target:"itemFields"});if(b)return Z.debug("have itemFields in localStorage",3),Zotero.Item.prototype.itemFields=b,void Object.keys(Zotero.Item.prototype.itemFields).forEach(function(a){var b=Zotero.Item.prototype.itemFields[a];Zotero.localizations.fieldMap[b.field]=b.localized});var c=Zotero.ajax.apiQueryString({locale:a}),d=Zotero.config.baseApiUrl+"/itemFields"+c;Zotero.net.ajax({url:Zotero.ajax.proxyWrapper(d),type:"GET"}).then(function(b){Z.debug("got itemTypes response",4);var c=JSON.parse(b.responseText);Zotero.Item.prototype.itemFields=c,Zotero.cache.save({locale:a,target:"itemFields"},c),Object.keys(Zotero.Item.prototype.itemFields).forEach(function(a){var b=Zotero.Item.prototype.itemFields[a];Zotero.localizations.fieldMap[b.field]=b.localized})})},Zotero.Item.prototype.getItemTemplate=function(){var a=arguments.length<=0||void 0===arguments[0]?"document":arguments[0],b=arguments.length<=1||void 0===arguments[1]?"":arguments[1];if(Z.debug("Zotero.Item.prototype.getItemTemplate",3),"attachment"==a&&""==b)throw new Error("attachment template requested with no linkMode");var c=Zotero.ajax.apiQueryString({itemType:a,linkMode:b}),d=Zotero.config.baseApiUrl+"/items/new"+c,e={itemType:a,target:"itemTemplate"},f=Zotero.cache.load(e);if(f){Z.debug("have itemTemplate in localStorage",3);var g=f;return Promise.resolve(g)}return Zotero.ajaxRequest(d,"GET",{dataType:"json"}).then(function(a){return Z.debug("got itemTemplate response",3),Zotero.cache.save(e,a.data),a.data})},Zotero.Item.prototype.getUploadAuthorization=function(a){Z.debug("Zotero.Item.getUploadAuthorization",3);var b=this,c={target:"item",targetModifier:"file",libraryType:b.owningLibrary.type,libraryID:b.owningLibrary.libraryID,itemKey:b.key},d={"Content-Type":"application/x-www-form-urlencoded"},e=b.get("md5");return e?d["If-Match"]=e:d["If-None-Match"]="*",Zotero.ajaxRequest(c,"POST",{processData:!0,data:a,headers:d})},Zotero.Item.prototype.registerUpload=function(a){Z.debug("Zotero.Item.registerUpload",3);var b=this,c={target:"item",targetModifier:"file",libraryType:b.owningLibrary.type,libraryID:b.owningLibrary.libraryID,itemKey:b.key},d={"Content-Type":"application/x-www-form-urlencoded"},e=b.get("md5");return e?d["If-Match"]=e:d["If-None-Match"]="*",Zotero.ajaxRequest(c,"POST",{processData:!0,data:{upload:a},headers:d})},Zotero.Item.prototype.fullUpload=function(a){},Zotero.Item.prototype.creatorTypes={},Zotero.Item.prototype.getCreatorTypes=function(a){Z.debug("Zotero.Item.prototype.getCreatorTypes: "+a,3),a||(a="document");var b=Zotero.cache.load({target:"creatorTypes"});if(b&&(Z.debug("have creatorTypes in localStorage",3),Zotero.Item.prototype.creatorTypes=b),Zotero.Item.prototype.creatorTypes[a])return Z.debug("creatorTypes of requested itemType available in localStorage",3),Z.debug(Zotero.Item.prototype.creatorTypes,4),Promise.resolve(Zotero.Item.prototype.creatorTypes[a]);Z.debug("sending request for creatorTypes",3);var c=Zotero.ajax.apiQueryString({itemType:a}),d=Zotero.config.baseApiUrl+"/itemTypeCreatorTypes"+c;return Zotero.ajaxRequest(d,"GET",{dataType:"json"}).then(function(b){return Z.debug("got creatorTypes response",4),Zotero.Item.prototype.creatorTypes[a]=b.data,Zotero.cache.save({target:"creatorTypes"},Zotero.Item.prototype.creatorTypes),Zotero.Item.prototype.creatorTypes[a]})},Zotero.Item.prototype.getCreatorFields=function(a){Z.debug("Zotero.Item.prototype.getCreatorFields",3);var b=Zotero.cache.load({target:"creatorFields"});if(b)return Z.debug("have creatorFields in localStorage",3),Zotero.Item.prototype.creatorFields=b,Promise.resolve(b);var c=Zotero.config.baseApiUrl+"/creatorFields";return Zotero.ajaxRequest(c,"GET",{dataType:"json"}).then(function(a){Z.debug("got itemTypes response",4),Zotero.Item.prototype.creatorFields=a.data,Zotero.cache.save({target:"creatorFields"},a.data)})},Zotero.Item.prototype.addItemTypes=function(a,b){},Zotero.Item.prototype.addItemFields=function(a,b){},Zotero.Item.prototype.addCreatorTypes=function(a,b){},Zotero.Item.prototype.addCreatorFields=function(a,b){},Zotero.Item.prototype.addItemTemplates=function(a){},Zotero.Item.prototype.itemTypeImageClass=function(){var a=this;if("attachment"!=a.apiObj.data.itemType)return a.apiObj.data.itemType;switch(a.apiObj.data.linkMode){case"imported_file":return"pdf"==a.translatedMimeType?a.itemTypeImageSrc.attachmentPdf:a.itemTypeImageSrc.attachmentFile;case"imported_url":return"pdf"==a.translatedMimeType?a.itemTypeImageSrc.attachmentPdf:a.itemTypeImageSrc.attachmentSnapshot;case"linked_file":return a.itemTypeImageSrc.attachmentLink;case"linked_url":return a.itemTypeImageSrc.attachmentWeblink;default:return a.itemTypeImageSrc.attachment}},Zotero.Item.prototype.itemTypeIconClass=function(){var a=this,b="fa fa-file-text-o";switch(a.apiObj.data.itemType){case"attachment":switch(a.apiObj.data.linkMode){case"imported_file":return"pdf"==a.translatedMimeType?"fa fa-file-pdf-o":"glyphicons glyphicons-file";case"imported_url":return"pdf"==a.translatedMimeType?"fa fa-file-pdf-o":"glyphicons glyphicons-file";case"linked_file":return"glyphicons glyphicons-link";case"linked_url":return"glyphicons glyphicons-link";default:return"glyphicons glyphicons-paperclip"}return"glyphicons file";case"artwork":return"glyphicons glyphicons-picture";case"audioRecording":return"glyphicons glyphicons-microphone";case"bill":return b;case"blogPost":return"glyphicons glyphicons-blog";case"book":return"glyphicons glyphicons-book";case"bookSection":return"glyphicons glyphicons-book-open";case"case":return b;case"computerProgram":return"glyphicons glyphicons-floppy-disk";case"conferencePaper":return b;case"dictionaryEntry":return"glyphicons glyphicons-translate";case"document":return"glyphicons glyphicons-file";case"email":return"glyphicons glyphicons-envelope";case"encyclopediaArticle":return"glyphicons glyphicons-bookmark";case"film":return"glyphicons glyphicons-film";case"forumPost":return"glyphicons glyphicons-bullhorn";case"hearing":return"fa fa-gavel";case"instantMessage":return"fa fa-comment-o";case"interview":return"fa fa-comments-o";case"journalArticle":return"fa fa-file-text-o";case"letter":return"glyphicons glyphicons-message-full";case"magazineArticle":return b;case"manuscript":return"glyphicons glyphicons-pen";case"map":return"glyphicons glyphicons-google-maps";case"newspaperArticle":return"fa fa-newspaper-o";case"note":return"glyphicons glyphicons-notes noteyellow";case"patent":return"glyphicons glyphicons-lightbulb";case"podcast":return"glyphicons glyphicons-ipod";case"presentation":return"glyphicons glyphicons-keynote";case"radioBroadcast":return"glyphicons glyphicons-wifi-alt";case"report":return"glyphicons glyphicons-notes-2";case"statue":return"glyphicons glyphicons-bank";case"thesis":return"fa fa-graduation-cap";case"tvBroadcast":return"glyphicons glyphicons-display";case"videoRecording":return"glyphicons glyphicons-facetime-video";case"webpage":return"glyphicons glyphicons-embed-close";default:return"glyphicons file"}},Zotero.Item.prototype.get=function(a){var b=this;switch(a){case"title":;return"note"==b.apiObj.data.itemType?b.noteTitle(b.apiObj.data.note):b.apiObj.data.title;case"creatorSummary":case"creator":return"undefined"!=typeof b.apiObj.meta.creatorSummary?b.apiObj.meta.creatorSummary:"";case"year":return b.parsedDate?b.parsedDate.getFullYear():""}return a in b.apiObj.data?b.apiObj.data[a]:a in b.apiObj.meta?b.apiObj.meta[a]:b.hasOwnProperty(a)?b[a]:null},Zotero.Item.prototype.set=function(a,b){var c=this;switch(a in c.apiObj&&(c.apiObj[a]=b),a in c.apiObj.data&&(c.apiObj.data[a]=b),a in c.apiObj.meta&&(c.apiObj.meta[a]=b),a){case"itemKey":case"key":c.key=b,c.apiObj.data.key=b;break;case"itemVersion":case"version":c.version=b,c.apiObj.data.version=b;break;case"itemType":c.itemType=b;break;case"linkMode":break;case"deleted":c.apiObj.data.deleted=b;break;case"parentItem":""===b&&(b=!1),c.apiObj.data.parentItem=b}return c},Zotero.Item.prototype.noteTitle=function(a){var b=120,c=J(a).text(),d=c.indexOf("\n");return-1!=d&&b>d?c.substr(0,d):c.substr(0,b)},Zotero.Item.prototype.setParent=function(a){var b=this;return"string"!=typeof a&&a.hasOwnProperty("instance")&&"Zotero.Item"==a.instance&&(a=a.key),b.set("parentItem",a),b},Zotero.Item.prototype.addToCollection=function(a){var b=this;"string"!=typeof a&&"Zotero.Collection"==a.instance&&(a=a.key),-1===b.apiObj.data.collections.indexOf(a)&&b.apiObj.data.collections.push(a)},Zotero.Item.prototype.removeFromCollection=function(a){var b=this;"string"!=typeof a&&"Zotero.Collection"==a.instance&&(a=a.key);var c=b.apiObj.data.collections.indexOf(a);-1!=c&&b.apiObj.data.collections.splice(c,1)},Zotero.Item.prototype.uploadChildAttachment=function(a,b,c){var d=this;return Z.debug("uploadChildAttachment",3),d.owningLibrary?(a.set("parentItem",d.key),a.associateWithLibrary(d.owningLibrary),a.writeItem().then(function(e){return d.numChildren++,a.uploadFile(b,c)},function(a){throw{message:"Failure during attachmentItem write.",code:a.status,serverMessage:a.jqxhr.responseText,response:a}})):Promise.reject(new Error("Item must be associated with a library"))},Zotero.Item.prototype.uploadFile=function(a,b){var c=this;Z.debug("Zotero.Item.uploadFile",3);var d={md5:a.md5,filename:c.get("title"),filesize:a.filesize,mtime:a.mtime,contentType:a.contentType,params:1};return""===a.contentType&&(d.contentType="application/octet-stream"),c.getUploadAuthorization(d).then(function(b){Z.debug("uploadAuth callback",3);var d;return d="string"==typeof b.data?JSON.parse(b.data):b.data,1==d.exists?{message:"File Exists"}:Zotero.file.uploadFile(d,a).then(function(){return c.registerUpload(d.uploadKey).then(function(a){if(a.isError){var b={message:"Failed to register uploaded file.",code:a.status,serverMessage:a.jqxhr.responseText,response:a};throw Z.error(b),b}return{message:"Upload Successful"}})})})["catch"](function(a){throw Z.debug("Failure caught during upload",3),Z.debug(a,3),{message:"Failure during upload.",code:a.status,serverMessage:a.jqxhr.responseText,response:a}})},Zotero.Item.prototype.cslItem=function(){var a=this,b=a.get("itemType"),c=a.cslTypeMap.hasOwnProperty(b)?a.cslTypeMap[b]:!1;c||(c="article");var d=(a.get("accessDate")||a.get("url"))&&b in{journalArticle:1,newspaperArticle:1,magazineArticle:1}&&a.get("pages")&&a.citePaperJournalArticleURL,e={type:c};a.owningLibrary?e.id=a.apiObj.library.id+"/"+a.get("key"):e.id=Zotero.utils.getKey(),Object.keys(a.cslFieldMap).forEach(function(b){var c=a.cslFieldMap[b];"URL"==b&&d||c.forEach(function(c){var d=a.get(c);d&&(e[b]=d)})});var f=a.get("creators");return f.forEach(function(a){var b=a.creatorType;if(b){var c;c=a.hasOwnProperty("name")?{literal:a.name}:{family:a.lastName,given:a.firstName},e.hasOwnProperty(b)?e[b].push(c):e[b]=[c]}}),Object.keys(a.cslDateMap).forEach(function(b){var c=a.cslDateMap[b],d=a.get(c);d&&(e[b]={raw:d})}),e},Zotero.Item.prototype.fieldMap={itemType:"Item Type",title:"Title",dateAdded:"Date Added",dateModified:"Date Modified",source:"Source",notes:"Notes",tags:"Tags",attachments:"Attachments",related:"Related",url:"URL",rights:"Rights",series:"Series",volume:"Volume",issue:"Issue",edition:"Edition",place:"Place",publisher:"Publisher",pages:"Pages",ISBN:"ISBN",publicationTitle:"Publication",ISSN:"ISSN",date:"Date",year:"Year",section:"Section",callNumber:"Call Number",archive:"Archive",archiveLocation:"Loc. in Archive",libraryCatalog:"Library Catalog",distributor:"Distributor",extra:"Extra",journalAbbreviation:"Journal Abbr",DOI:"DOI",accessDate:"Accessed",seriesTitle:"Series Title",seriesText:"Series Text",seriesNumber:"Series Number",institution:"Institution",reportType:"Report Type",code:"Code",session:"Session",legislativeBody:"Legislative Body",history:"History",reporter:"Reporter",court:"Court",numberOfVolumes:"# of Volumes",committee:"Committee",assignee:"Assignee",patentNumber:"Patent Number",priorityNumbers:"Priority Numbers",issueDate:"Issue Date",references:"References",legalStatus:"Legal Status",codeNumber:"Code Number",artworkMedium:"Medium",number:"Number",artworkSize:"Artwork Size",repository:"Repository",videoRecordingType:"Recording Type",interviewMedium:"Medium",letterType:"Type",manuscriptType:"Type",mapType:"Type",scale:"Scale",thesisType:"Type",websiteType:"Website Type",audioRecordingType:"Recording Type",label:"Label",presentationType:"Type",meetingName:"Meeting Name",studio:"Studio",runningTime:"Running Time",network:"Network",postType:"Post Type",audioFileType:"File Type",versionNumber:"Version Number",system:"System",company:"Company",conferenceName:"Conference Name",encyclopediaTitle:"Encyclopedia Title",dictionaryTitle:"Dictionary Title",language:"Language",programmingLanguage:"Language",university:"University",abstractNote:"Abstract",websiteTitle:"Website Title",reportNumber:"Report Number",billNumber:"Bill Number",codeVolume:"Code Volume",codePages:"Code Pages",dateDecided:"Date Decided",reporterVolume:"Reporter Volume",firstPage:"First Page",documentNumber:"Document Number",dateEnacted:"Date Enacted",publicLawNumber:"Public Law Number",country:"Country",applicationNumber:"Application Number",forumTitle:"Forum/Listserv Title",episodeNumber:"Episode Number",blogTitle:"Blog Title",caseName:"Case Name",nameOfAct:"Name of Act",subject:"Subject",proceedingsTitle:"Proceedings Title",bookTitle:"Book Title",shortTitle:"Short Title",docketNumber:"Docket Number",numPages:"# of Pages",note:"Note",numChildren:"# of Children",addedBy:"Added By",creator:"Creator"},Zotero.localizations.fieldMap=Zotero.Item.prototype.fieldMap,Zotero.Item.prototype.typeMap={note:"Note",attachment:"Attachment",book:"Book",bookSection:"Book Section",journalArticle:"Journal Article",magazineArticle:"Magazine Article",newspaperArticle:"Newspaper Article",thesis:"Thesis",letter:"Letter",manuscript:"Manuscript",interview:"Interview",film:"Film",artwork:"Artwork",webpage:"Web Page",report:"Report",bill:"Bill","case":"Case",hearing:"Hearing",patent:"Patent",statute:"Statute",email:"E-mail",map:"Map",blogPost:"Blog Post",instantMessage:"Instant Message",forumPost:"Forum Post",audioRecording:"Audio Recording",presentation:"Presentation",videoRecording:"Video Recording",tvBroadcast:"TV Broadcast",radioBroadcast:"Radio Broadcast",podcast:"Podcast",computerProgram:"Computer Program",conferencePaper:"Conference Paper",document:"Document",encyclopediaArticle:"Encyclopedia Article",dictionaryEntry:"Dictionary Entry"},Zotero.localizations.typeMap=Zotero.Item.prototype.typeMap,Zotero.Item.prototype.creatorMap={author:"Author",contributor:"Contributor",editor:"Editor",translator:"Translator",seriesEditor:"Series Editor",interviewee:"Interview With",interviewer:"Interviewer",director:"Director",scriptwriter:"Scriptwriter",producer:"Producer",castMember:"Cast Member",sponsor:"Sponsor",counsel:"Counsel",inventor:"Inventor",attorneyAgent:"Attorney/Agent",recipient:"Recipient",performer:"Performer",composer:"Composer",wordsBy:"Words By",cartographer:"Cartographer",programmer:"Programmer",reviewedAuthor:"Reviewed Author",artist:"Artist",commenter:"Commenter",presenter:"Presenter",guest:"Guest",podcaster:"Podcaster"},Zotero.Item.prototype.hideFields=["mimeType","linkMode","charset","md5","mtime","version","key","collections","relations","parentItem","contentType","filename","tags"],Zotero.Item.prototype.noEditFields=["accessDate","modified","filename","dateAdded","dateModified"],Zotero.localizations.creatorMap=Zotero.Item.prototype.creatorMap,Zotero.Item.prototype.itemTypeImageSrc={note:"note",attachment:"attachment-pdf",attachmentPdf:"attachment-pdf",attachmentWeblink:"attachment-web-link",attachmentSnapshot:"attachment-snapshot",attachmentFile:"attachment-file",attachmentLink:"attachment-link",book:"book",bookSection:"book_open",journalArticle:"page_white_text",magazineArticle:"layout",newspaperArticle:"newspaper",thesis:"report",letter:"email_open",manuscript:"script",interview:"comments",film:"film",artwork:"picture",webpage:"page",report:"report",bill:"page_white","case":"page_white",hearing:"page_white",patent:"page_white",statute:"page_white",email:"email",map:"map",blogPost:"layout",instantMessage:"page_white",forumPost:"page",audioRecording:"ipod",presentation:"page_white",videoRecording:"film",tvBroadcast:"television",radioBroadcast:"transmit",podcast:"ipod_cast",computerProgram:"page_white_code",conferencePaper:"treeitem-conferencePaper",document:"page_white",encyclopediaArticle:"page_white",dictionaryEntry:"page_white"},Zotero.Item.prototype.cslNameMap={author:"author",editor:"editor",bookAuthor:"container-author",composer:"composer",interviewer:"interviewer",recipient:"recipient",seriesEditor:"collection-editor",translator:"translator"},Zotero.Item.prototype.cslFieldMap={title:["title"],"container-title":["publicationTitle","reporter","code"],"collection-title":["seriesTitle","series"],"collection-number":["seriesNumber"],publisher:["publisher","distributor"],"publisher-place":["place"],authority:["court"],page:["pages"],volume:["volume"],issue:["issue"],"number-of-volumes":["numberOfVolumes"],"number-of-pages":["numPages"],edition:["edition"],versionNumber:["version"],section:["section"],genre:["type","artworkSize"],medium:["medium","system"],archive:["archive"],archive_location:["archiveLocation"],event:["meetingName","conferenceName"],"event-place":["place"],"abstract":["abstractNote"],URL:["url"],DOI:["DOI"],ISBN:["ISBN"],"call-number":["callNumber"],note:["extra"],number:["number"],references:["history"],shortTitle:["shortTitle"],journalAbbreviation:["journalAbbreviation"],language:["language"]},Zotero.Item.prototype.cslDateMap={issued:"date",accessed:"accessDate"},Zotero.Item.prototype.cslTypeMap={book:"book",bookSection:"chapter",journalArticle:"article-journal",magazineArticle:"article-magazine",newspaperArticle:"article-newspaper",thesis:"thesis",encyclopediaArticle:"entry-encyclopedia",dictionaryEntry:"entry-dictionary",conferencePaper:"paper-conference",letter:"personal_communication",manuscript:"manuscript",interview:"interview",film:"motion_picture",artwork:"graphic",webpage:"webpage",report:"report",bill:"bill","case":"legal_case",hearing:"bill",patent:"patent",statute:"bill",email:"personal_communication",map:"map",blogPost:"webpage",instantMessage:"personal_communication",forumPost:"webpage",audioRecording:"song",presentation:"speech",videoRecording:"motion_picture",tvBroadcast:"broadcast",radioBroadcast:"broadcast",podcast:"song",computerProgram:"book"},Zotero.Item.prototype.citePaperJournalArticleURL=!1,Zotero.Tag=function(a){this.instance="Zotero.Tag",this.color=null,this.version=0,"object"==("undefined"==typeof a?"undefined":_typeof(a))?this.parseJsonTag(a):"string"==typeof a?this.parseJsonTag(this.templateApiObj(a)):this.parseJsonTag(this.tamplateApiObj(""))},Zotero.Tag.prototype=new Zotero.ApiObject,Zotero.Tag.prototype.parseJsonTag=function(a){var b=this;b.apiObj=Z.extend({},a),b.urlencodedtag=encodeURIComponent(b.apiObj.tag),b.version=b.apiObj.version},Zotero.Tag.prototype.templateApiObj=function(a){return{tag:a,links:{},meta:{type:0,numItems:1}}},Zotero.Tag.prototype.tagComparer=function(){if(window.Intl){var a=new window.Intl.Collator;return function(b,c){return a.compare(b.apiObj.tag,c.apiObj.tag)}}return function(a,b){return a.apiObj.tag.toLocaleLowerCase()==b.apiObj.tag.toLocaleLowerCase()?0:a.apiObj.tag.toLocaleLowerCase()<b.apiObj.tag.toLocaleLowerCase()?-1:1}},Zotero.Tag.prototype.set=function(a,b){var c=this;switch(a in c.apiObj&&(c.apiObj[a]=b),a in c.apiObj.meta&&(c.apiObj.meta[a]=b),a){case"tagVersion":case"version":c.version=b,c.apiObj.version=b}return c},Zotero.Search=function(){this.instance="Zotero.Search",this.searchObject={}},Zotero.Group=function(a){var b=this;b.instance="Zotero.Group",a&&this.parseJsonGroup(a)},Zotero.Group.prototype=new Zotero.ApiObject,Zotero.Group.prototype.parseJsonGroup=function(a){var b=this;b.apiObj=a},Zotero.Group.prototype.get=function(a){var b=this;switch(a){case"title":case"name":return b.apiObj.data.name}return a in b.apiObj?b.apiObj[a]:a in b.apiObj.data?b.apiObj.data[a]:a in b.apiObj.meta?b.apiObj.meta[a]:b.hasOwnProperty(a)?b[a]:null},Zotero.Group.prototype.isWritable=function(a){var b=this;switch(!0){case b.get("owner")==a:return!0;case b.apiObj.data.admins&&-1!=b.apiObj.data.admins.indexOf(a):return!0;case"members"==b.apiObj.data.libraryEditing&&b.apiObj.data.members&&-1!=b.apiObj.data.members.indexOf(a):return!0;default:return!1}},Zotero.Group.prototype.typeMap={Private:"Private",PublicOpen:"Public, Open Membership",PublicClosed:"Public, Closed Membership"},Zotero.Group.prototype.accessMap={all:{members:"Anyone can view, only members can edit",admins:"Anyone can view, only admins can edit"},members:{members:"Only members can view and edit",admins:"Only members can view, only admins can edit"},admins:{members:"Only admins can view, only members can edit",admins:"Only admins can view and edit"}},Zotero.User=function(){this.instance="Zotero.User"},Zotero.User.prototype=new Zotero.ApiObject,Zotero.User.prototype.loadObject=function(a){this.title=a.title,this.author=a.author,this.tagID=a.tagID,this.published=a.published,this.updated=a.updated,this.links=a.links,this.numItems=a.numItems,this.items=a.items,this.tagType=a.tagType,this.modified=a.modified,this.added=a.added,this.key=a.key},Zotero.User.prototype.parseXmlUser=function(a){this.parseXmlEntry(a);var b=a.find("content>tag");0!==b.length&&(this.tagKey=b.attr("key"),this.libraryID=b.attr("libraryID"),this.tagName=b.attr("name"),this.dateAdded=b.attr("dateAdded"),this.dateModified=b.attr("dateModified"))},Zotero.utils={randomString:function(a,b){b||(b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"),a||(a=8);for(var c="",d=0;a>d;d++){var e=Math.floor(Math.random()*b.length);c+=b.substring(e,e+1)}return c},getKey:function(){var a="23456789ABCDEFGHIJKMNPQRSTUVWXZ";return Zotero.utils.randomString(8,a)},slugify:function(a){var b=a.trim();return b=b.toLowerCase(),b=b.replace(/[^a-z0-9 ._-]/g,""),b=b.replace(/\s/g,"_")},prependAutocomplete:function(a,b){Z.debug("Zotero.utils.prependAutocomplete",3),Z.debug("prepend match: "+a);var c;if(b||Z.debug("source is not defined"),""===a)return c=b.slice(0);var d=a.length,e=a.toLowerCase();return c=b.map(function(a){return a.substr(0,d).toLowerCase()==e?a:null})},matchAnyAutocomplete:function(a,b){Z.debug("Zotero.utils.matchAnyAutocomplete",3),Z.debug("matchAny match: "+a);var c;if(b||Z.debug("source is not defined"),""===a)return c=b.slice(0);var d=(a.length,a.toLowerCase());return c=b.map(function(a){return-1!=a.toLowerCase().indexOf(d)?a:null})},libraryString:function(a,b){var c="";return"user"==a?c="u":"group"==a&&(c="g"),c+=b},parseLibString:function(a){var b,c;if("u"==a.charAt(0))b="user";else{if("g"!=a.charAt(0))throw new Error("unexpected type character in libraryString");b="group"}return c=parseInt(a.substring(1)),{libraryType:b,libraryID:c}},stale:function(a,b){var c=Date.now(),d=c.getTime()-a.getTime();return d/6e4>b?!0:!1},entityify:function(a){var b={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"};return a.replace(/[<>&"]/g,function(a){return b[a]})},parseApiDate:function(a,b){var c=/([0-9]+)-([0-9]+)-([0-9]+)T([0-9]+):([0-9]+):([0-9]+)Z/,d=c.exec(a);return null===d?(Z.error("error parsing api date: "+a),null):b=new Date(Date.UTC(d[1],d[2]-1,d[3],d[4],d[5],d[6]))},readCookie:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null},translateMimeType:function(a){switch(a){case"text/html":return"html";case"application/pdf":case"application/x-pdf":case"application/acrobat":case"applications/vnd.pdf":case"text/pdf":case"text/x-pdf":return"pdf";case"image/jpg":case"image/jpeg":return"jpg";case"image/gif":return"gif";case"application/msword":case"application/doc":case"application/vnd.msword":case"application/vnd.ms-word":case"application/winword":case"application/word":case"application/x-msw6":case"application/x-msword":return"doc";case"application/vnd.oasis.opendocument.text":case"application/x-vnd.oasis.opendocument.text":return"odt";case"video/flv":case"video/x-flv":return"flv";case"image/tif":case"image/tiff":case"image/x-tif":case"image/x-tiff":case"application/tif":case"application/x-tif":case"application/tiff":case"application/x-tiff":return"tiff";case"application/zip":case"application/x-zip":case"application/x-zip-compressed":case"application/x-compress":case"application/x-compressed":case"multipart/x-zip":return"zip";case"video/quicktime":case"video/x-quicktime":return"mov";case"video/avi":case"video/msvideo":case"video/x-msvideo":return"avi";case"audio/wav":case"audio/x-wav":case"audio/wave":return"wav";case"audio/aiff":case"audio/x-aiff":case"sound/aiff":return"aiff";case"text/plain":return"plain text";case"application/rtf":return"rtf";default:return a}},getKeyPermissions:function(a,b){if(!a)return!1;if(!b)return!1;var c={target:"key",libraryType:"user",libraryID:a,apiKey:b},d=Zotero.ajax.apiRequestString(c);return Zotero.ajaxRequest(d).then(function(a){var b=JSON.parse(a.data);return b})},parseQuery:function(a){for(var b,c={},d=/\+/g,e=/([^&=]+)=?([^&]*)/g,f=function(a){return decodeURIComponent(a.replace(d," "))};b=e.exec(a);)c[f(b[1])]=f(b[2]);return c},querystring:function(a){var b=-1!=a.indexOf("#")?a.indexOf("#"):void 0,c=a.substring(a.indexOf("?")+1,b);return c}},Zotero.extend=function(){for(var a={},b=0;b<arguments.length;b++){var c=arguments[b];"object"==("undefined"==typeof c?"undefined":_typeof(c))&&Object.keys(c).forEach(function(b){a[b]=c[b]})}return a},Zotero.url.itemHref=function(a){var b="";return b+=Zotero.config.librarySettings.libraryPathString+"/itemKey/"+a.get("key")},Zotero.url.attachmentDownloadLink=function(a){var b="",c=a.attachmentDownloadUrl;a.get("contentType");if(a.apiObj.links&&a.apiObj.links.enclosure){if(a.apiObj.links.enclosure.length||!a.isSnapshot()){var d=Zotero.utils.translateMimeType(a.apiObj.links.enclosure.type),e=a.apiObj.links.enclosure,f=parseInt(e.length,10),g=""+f+" B";return f>1073741824?g=""+(f/1073741824).toFixed(1)+" GB":f>1048576?g=""+(f/1048576).toFixed(1)+" MB":f>1024&&(g=""+(f/1024).toFixed(1)+" KB"),Z.debug(d,3),b+='<a href="'+c+'">',b+="undefined"==d||""===d||"undefined"==typeof d?g+"</a>":d+", "+g+"</a>"}b+='<a href="'+c+'">View Snapshot</a>'}return b},Zotero.url.attachmentDownloadUrl=function(a){return a.apiObj.links&&a.apiObj.links.enclosure?Zotero.config.proxyDownloads?Zotero.url.wwwDownloadUrl(a):Zotero.url.apiDownloadUrl(a):!1},Zotero.url.apiDownloadUrl=function(a){return a.apiObj.links.enclosure?a.apiObj.links.enclosure.href:!1},Zotero.url.proxyDownloadUrl=function(a){return a.apiObj.links.enclosure?Zotero.config.proxyDownloads?Zotero.config.baseDownloadUrl+"?itemkey="+a.get("key"):Zotero.url.apiDownloadUrl(a):!1},Zotero.url.wwwDownloadUrl=function(a){return a.apiObj.links.enclosure?Zotero.config.baseZoteroWebsiteUrl+Zotero.config.librarySettings.libraryPathString+"/"+a.get("key")+"/file/view":!1},Zotero.url.publicationsDownloadUrl=function(a){return a.apiObj.links.enclosure?a.apiObj.links.enclosure.href:!1},Zotero.url.attachmentFileDetails=function(a){if(!a.apiObj.links.enclosure)return"";var b=Zotero.utils.translateMimeType(a.apiObj.links.enclosure.type),c=a.apiObj.links.enclosure,d="";if(c.length){var e=parseInt(c.length,10);return d=""+e+" B",e>1073741824?d=""+(e/1073741824).toFixed(1)+" GB":e>1048576?d=""+(e/1048576).toFixed(1)+" MB":e>1024&&(d=""+(e/1024).toFixed(1)+" KB"),"("+b+", "+d+")"}return"("+b+")"},Zotero.url.userWebLibrary=function(a){return[Zotero.config.baseWebsiteUrl,a,"items"].join("/")},Zotero.url.groupWebLibrary=function(a){return"Private"==a.type?[Zotero.config.baseWebsiteUrl,"groups",a.get("id"),"items"].join("/"):[Zotero.config.baseWebsiteUrl,"groups",Zotero.utils.slugify(a.get("name")),"items"].join("/")},Zotero.url.exportUrls=function(a){Z.debug("Zotero.url.exportUrls",3);var b={},c={};return Zotero.config.exportFormats.forEach(function(d){c=Z.extend(a,{format:d}),b[d]=Zotero.ajax.apiRequestUrl(c)+Zotero.ajax.apiQueryString({format:d,limit:"25"})}),b},Zotero.url.relationUrl=function(a,b,c){return"http://zotero.org/"+a+"s/"+b+"/items/"+c},Zotero.file={},Zotero.file.getFileInfo=function(a){return"function"!=typeof FileReader?Promise.reject(new Error("FileReader not supported")):new Promise(function(b,c){var d={},e=new FileReader;e.onload=function(c){Z.debug("Zotero.file.getFileInfo onloadFunc",3);var e=c.target.result;Zotero.debug(e,3),d.md5=SparkMD5.ArrayBuffer.hash(e),d.filename=a.name,d.filesize=a.size,d.mtime=Date.now(),d.contentType=a.type,d.filedata=e,b(d)},e.readAsArrayBuffer(a)})},Zotero.file.uploadFile=function(a,b){Z.debug("Zotero.file.uploadFile",3),Z.debug(a,4);var c=new FormData;Object.keys(a.params).forEach(function(b){var d=a.params[b];c.append(b,d)});var d=new Blob([b.filedata],{type:b.contentType});c.append("file",d);var e=new XMLHttpRequest;return e.open("POST",a.url,!0),new Promise(function(a,b){e.onload=function(c){Z.debug("uploadFile onload event",3),201==this.status?(Z.debug("successful upload - 201",3),a()):(Z.error("uploadFile failed - "+e.status),b({message:"Failure uploading file.",code:e.status,serverMessage:e.responseText}))},e.onprogress=function(a){Z.debug("progress event"),Z.debug(a)},e.send(c)})},Zotero.Idb={},Zotero.Idb.Library=function(a){Z.debug("Zotero.Idb.Library",3),Z.debug("Initializing Zotero IDB",3),this.libraryString=a,this.owningLibrary=null,this.initialized=!1},Zotero.Idb.Library.prototype.init=function(){var a=this;return new Promise(function(b,c){var d=window.indexedDB;a.indexedDB=d,Z.debug("requesting indexedDb from browser",3);var e=d.open("Zotero_"+a.libraryString,4);e.onerror=function(a){Zotero.error("ERROR OPENING INDEXED DB"),c()};var f=function(b){Z.debug("Zotero.Idb onupgradeneeded or onsuccess",3);var c=b.oldVersion;Z.debug("oldVersion: "+b.oldVersion,3);var d=b.target.result;if(a.db=d,4>c){Z.debug("Existing object store names:",3),Z.debug(JSON.stringify(d.objectStoreNames),3),Z.debug("Deleting old object stores",3),d.objectStoreNames.items&&d.deleteObjectStore("items"),d.objectStoreNames.tags&&d.deleteObjectStore("tags"),d.objectStoreNames.collections&&d.deleteObjectStore("collections"),d.objectStoreNames.files&&d.deleteObjectStore("files"),d.objectStoreNames.versions&&d.deleteObjectStore("versions"),Z.debug("Existing object store names:",3),Z.debug(JSON.stringify(d.objectStoreNames),3);var e=d.createObjectStore("items",{
keyPath:"key"}),f=d.createObjectStore("collections",{keyPath:"key"}),g=d.createObjectStore("tags",{keyPath:"tag"});d.createObjectStore("files"),d.createObjectStore("versions");Z.debug("itemStore index names:",3),Z.debug(JSON.stringify(e.indexNames),3),Z.debug("collectionStore index names:",3),Z.debug(JSON.stringify(f.indexNames),3),Z.debug("tagStore index names:",3),Z.debug(JSON.stringify(g.indexNames),3),Object.keys(Zotero.Item.prototype.fieldMap).forEach(function(a){Z.debug("Creating index on "+a,3),e.createIndex(a,"data."+a,{unique:!1})}),e.createIndex("collectionKeys","data.collections",{unique:!1,multiEntry:!0}),e.createIndex("itemTagStrings","_supplement.tagstrings",{unique:!1,multiEntry:!0}),e.createIndex("parentItemKey","data.parentItem",{unique:!1}),e.createIndex("libraryKey","libraryKey",{unique:!1}),e.createIndex("deleted","data.deleted",{unique:!1}),f.createIndex("name","data.name",{unique:!1}),f.createIndex("key","key",{unique:!1}),f.createIndex("parentCollection","data.parentCollection",{unique:!1}),g.createIndex("tag","tag",{unique:!1})}};e.onupgradeneeded=f,e.onsuccess=function(){Z.debug("IDB success",3),a.db=e.result,a.initialized=!0,b(a)}})},Zotero.Idb.Library.prototype.deleteDB=function(){var a=this;return a.db.close(),new Promise(function(b,c){var d=a.indexedDB.deleteDatabase("Zotero_"+a.libraryString);d.onerror=function(){Z.error("Error deleting indexedDB"),c()},d.onsuccess=function(){Z.debug("Successfully deleted indexedDB",2),b()}})},Zotero.Idb.Library.prototype.getObjectStore=function(a,b){var c=this,d=c.db.transaction(a,b);return d.objectStore(a)},Zotero.Idb.Library.prototype.clearObjectStore=function(a){var b=this,c=b.getObjectStore(a,"readwrite");return new Promise(function(a,b){var d=c.clear();d.onsuccess=function(b){Z.debug("Store cleared",3),a()},d.onerror=function(a){Z.error("clearObjectStore:",a.target.errorCode),b()}})},Zotero.Idb.Library.prototype.addItems=function(a){return this.addObjects(a,"item")},Zotero.Idb.Library.prototype.updateItems=function(a){return this.updateObjects(a,"item")},Zotero.Idb.Library.prototype.removeItems=function(a){return this.removeObjects(a,"item")},Zotero.Idb.Library.prototype.getItem=function(a){var b=this;return new Promise(function(c,d){var e=function(a){c(a.target.result)};b.db.transaction("items").objectStore(["items"],"readonly").get(a).onsuccess=e})},Zotero.Idb.Library.prototype.getAllItems=function(){return this.getAllObjects("item")},Zotero.Idb.Library.prototype.getOrderedItemKeys=function(a,b){var c=this;return Z.debug("Zotero.Idb.getOrderedItemKeys",3),Z.debug(""+a+" "+b,3),new Promise(function(d,e){var f=c.db.transaction(["items"],"readonly").objectStore("items"),g=f.index(a);if(!g)throw new Error("Index for requested field '"+a+"'' not found");var h="next";"desc"==b&&(h="prev");var i=g.openKeyCursor(null,h),j=[];i.onsuccess=function(a){var b=a.target.result;b?(j.push(b.primaryKey),b["continue"]()):(Z.debug("No more cursor: done. Resolving deferred.",3),d(j))}.bind(this),i.onfailure=function(a){e()}.bind(this)})},Zotero.Idb.Library.prototype.filterItems=function(a,b){var c=this;return Z.debug("Zotero.Idb.filterItems "+a+" - "+b,3),new Promise(function(d,e){var f=[],g=c.db.transaction(["items"],"readonly").objectStore("items"),h=g.index(a);if(!h)throw new Error("Index for requested field '"+a+"'' not found");var i="next",j=IDBKeyRange.only(b),k=h.openKeyCursor(j,i);k.onsuccess=function(a){var b=a.target.result;b?(f.push(b.primaryKey),b["continue"]()):(Z.debug("No more cursor: done. Resolving deferred.",3),d(f))}.bind(this),k.onfailure=function(a){e()}.bind(this)})},Zotero.Idb.Library.prototype.inferType=function(a){if(!a)return!1;if(!a.instance)return!1;switch(a.instance){case"Zotero.Item":return"item";case"Zotero.Collection":return"collection";case"Zotero.Tag":return"tag";default:return!1}},Zotero.Idb.Library.prototype.getTransactionAndStore=function(a,b){var c,d,e=this;switch(a){case"item":c=e.db.transaction(["items"],b),d=c.objectStore("items");break;case"collection":c=e.db.transaction(["collections"],b),d=c.objectStore("collections");break;case"tag":c=e.db.transaction(["tags"],b),d=c.objectStore("tags");break;default:return Promise.reject()}return[c,d]},Zotero.Idb.Library.prototype.addObjects=function(a,b){Z.debug("Zotero.Idb.Library.addObjects",3);var c=this;b||(b=c.inferType(a[0]));var d=c.getTransactionAndStore(b,"readwrite"),e=d[0],f=d[1];return new Promise(function(b,c){e.oncomplete=function(a){Zotero.debug("Add Objects transaction completed.",3),b()},e.onerror=function(a){Zotero.error("Add Objects transaction failed."),c()};var d=function(a){Zotero.debug("Added Object "+a.target.result,4)};for(var g in a){var h=f.add(a[g].apiObj);h.onsuccess=d}})},Zotero.Idb.Library.prototype.updateObjects=function(a,b){Z.debug("Zotero.Idb.Library.updateObjects",3);var c=this;b||(b=c.inferType(a[0]));var d=c.getTransactionAndStore(b,"readwrite"),e=d[0],f=d[1];return new Promise(function(b,c){e.oncomplete=function(a){Zotero.debug("Update Objects transaction completed.",3),b()},e.onerror=function(a){Zotero.error("Update Objects transaction failed."),c()};var d=function(a){Zotero.debug("Updated Object "+a.target.result,4)};for(var g in a){var h=f.put(a[g].apiObj);h.onsuccess=d}})},Zotero.Idb.Library.prototype.removeObjects=function(a,b){var c=this;b||(b=c.inferType(a[0]));var d=c.getTransactionAndStore(b,"readwrite"),e=d[0],f=d[1];return new Promise(function(b,c){e.oncomplete=function(a){Zotero.debug("Remove Objects transaction completed.",3),b()},e.onerror=function(a){Zotero.error("Remove Objects transaction failed."),c()};var d=function(a){Zotero.debug("Removed Object "+a.target.result,4)};for(var g in a){var h=f["delete"](a[g].key);h.onsuccess=d}})},Zotero.Idb.Library.prototype.getAllObjects=function(a){var b=this;return new Promise(function(c,d){var e=[],f=b.db.transaction(a+"s").objectStore(a+"s");f.openCursor().onsuccess=function(a){var b=a.target.result;b?(e.push(b.value),b["continue"]()):c(e)}})},Zotero.Idb.Library.prototype.addCollections=function(a){return this.addObjects(a,"collection")},Zotero.Idb.Library.prototype.updateCollections=function(a){return Z.debug("Zotero.Idb.Library.updateCollections",3),this.updateObjects(a,"collection")},Zotero.Idb.Library.prototype.getCollection=function(a){var b=this;return new Promise(function(c,d){var e=function(a){c(a.target.result)};b.db.transaction("collections").objectStore(["collections"],"readonly").get(a).onsuccess=e})},Zotero.Idb.Library.prototype.removeCollections=function(a){return Z.debug("Zotero.Idb.Library.removeCollections",3),this.removeObjects(a,"collection")},Zotero.Idb.Library.prototype.getAllCollections=function(){return Z.debug("Zotero.Idb.Library.getAllCollections",3),this.getAllObjects("collection")},Zotero.Idb.Library.prototype.addTags=function(a){return this.addObjects(a,"tag")},Zotero.Idb.Library.prototype.updateTags=function(a){return Z.debug("Zotero.Idb.Library.updateTags",3),this.updateObjects(a,"tag")},Zotero.Idb.Library.prototype.getAllTags=function(){return Z.debug("getAllTags",3),this.getAllObjects("tag")},Zotero.Idb.Library.prototype.setVersion=function(a,b){Z.debug("Zotero.Idb.Library.setVersion",3);var c=this;return new Promise(function(d,e){var f=c.db.transaction(["versions"],"readwrite");f.oncomplete=function(a){Zotero.debug("set version transaction completed.",3),d()},f.onerror=function(a){Zotero.error("set version transaction failed."),e()};var g=f.objectStore("versions"),h=function(a){Zotero.debug("Set Version"+a.target.result,3)},i=g.put(b,a);i.onsuccess=h})},Zotero.Idb.Library.prototype.getVersion=function(a){Z.debug("Zotero.Idb.Library.getVersion",3);var b=this;return new Promise(function(c,d){var e=function(a){Z.debug("done getting version"),c(a.target.result)};b.db.transaction(["versions"],"readonly").objectStore("versions").get(a).onsuccess=e})},Zotero.Idb.Library.prototype.setFile=function(a,b){Z.debug("Zotero.Idb.Library.setFile",3);var c=this;return new Promise(function(d,e){var f=c.db.transaction(["files"],"readwrite");f.oncomplete=function(a){Zotero.debug("set file transaction completed.",3),d()},f.onerror=function(a){Zotero.error("set file transaction failed."),e()};var g=f.objectStore("files"),h=function(a){Zotero.debug("Set File"+a.target.result,3)},i=g.put(b,a);i.onsuccess=h})},Zotero.Idb.Library.prototype.getFile=function(a){Z.debug("Zotero.Idb.Library.getFile",3);var b=this;return new Promise(function(c,d){var e=function(a){Z.debug("done getting file"),c(a.target.result)};b.db.transaction(["files"],"readonly").objectStore("files").get(a).onsuccess=e})},Zotero.Idb.Library.prototype.deleteFile=function(a){Z.debug("Zotero.Idb.Library.deleteFile",3);var b=this;return new Promise(function(c,d){var e=b.db.transaction(["files"],"readwrite");e.oncomplete=function(a){Zotero.debug("delete file transaction completed.",3),c()},e.onerror=function(a){Zotero.error("delete file transaction failed."),d()};var f=e.objectStore("files"),g=function(a){Zotero.debug("Deleted File"+a.target.result,4)},h=f["delete"](a);h.onsuccess=g})},Zotero.Idb.Library.prototype.intersect=function(a,b){for(var c=[],d=0;d<a.length;d++)-1!==b.indexOf(a[d])&&c.push(a[d]);return c},Zotero.Idb.Library.prototype.intersectAll=function(a){for(var b=this,c=a[0],d=0;d<a.length-1;d++)c=b.intersect(c,a[d+1]);return c},Zotero.Library.prototype.processLoadedCollections=function(a){Z.debug("processLoadedCollections",3);var b=this;Z.debug("adding collections to library.collections");for(var c=b.collections.addCollectionsFromJson(a.data),d=0;d<c.length;d++)c[d].associateWithLibrary(b);return b.collections.updateSyncState(a.lastModifiedVersion),Zotero.trigger("loadedCollectionsProcessed",{library:b,collectionsAdded:c}),a},Zotero.Library.prototype.addCollection=function(a,b){Z.debug("Zotero.Library.addCollection",3);var c=this,d=new Zotero.Collection;return d.associateWithLibrary(c),d.set("name",a),d.set("parentCollection",b),c.collections.writeCollections([d])},Zotero.Library.prototype.fetchItemKeys=function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];Z.debug("Zotero.Library.fetchItemKeys",3);var b=this,c=Z.extend(!0,{target:"items",libraryType:this.libraryType,libraryID:this.libraryID,format:"keys"},a);return b.ajaxRequest(c)},Zotero.Library.prototype.getTrashKeys=function(){Z.debug("Zotero.Library.getTrashKeys",3);var a=this,b={target:"items",libraryType:a.libraryType,libraryID:a.libraryID,format:"keys",collectionKey:"trash"};return a.ajaxRequest(b)},Zotero.Library.prototype.emptyTrash=function(){Z.debug("Zotero.Library.emptyTrash",3);var a=this;return a.getTrashKeys().then(function(b){var c=b.data.split("\n");return a.items.deleteItems(c,b.lastModifiedVersion)})},Zotero.Library.prototype.loadItemKeys=function(a){Z.debug("Zotero.Library.loadItemKeys",3);var b=this;return this.fetchItemKeys(a).then(function(a){Z.debug("loadItemKeys proxied callback",3);var c=a.data.split(/[\s]+/);b.itemKeys=c})},Zotero.Library.prototype.loadItems=function(a){Z.debug("Zotero.Library.loadItems",3);var b=this;a||(a={});var c={target:"items",targetModifier:"top",start:0,limit:25,order:Zotero.config.defaultSortColumn,sort:Zotero.config.defaultSortOrder},d=Z.extend({},c,a),e=Z.extend({target:"items",libraryType:b.libraryType,libraryID:b.libraryID},d),f=Zotero.ajax.apiRequestString(e);return b.ajaxRequest(f).then(function(a){Z.debug("loadItems proxied callback",3);var c=b.items,d=c.addItemsFromJson(a.data);Z.debug("Looping over loadedItemsArray");for(var e=0;e<d.length;e++)d[e].associateWithLibrary(b);return a.loadedItems=d,Zotero.trigger("itemsChanged",{library:b}),a})},Zotero.Library.prototype.loadPublications=function(a){Z.debug("Zotero.Library.loadPublications",3);var b=this;a||(a={});var c={target:"publications",start:0,limit:50,order:Zotero.config.defaultSortColumn,sort:Zotero.config.defaultSortOrder,include:"bib"},d=Z.extend({},c,a),e=Z.extend({target:"publications",libraryType:b.libraryType,libraryID:b.libraryID},d),f=Zotero.ajax.apiRequestString(e);return b.ajaxRequest(f).then(function(a){Z.debug("loadPublications proxied callback",3);var b=[],c=a.data;return c.forEach(function(a){var c=new Zotero.Item(a);b.push(c)}),a.publicationItems=b,a})},Zotero.Library.prototype.processLoadedItems=function(a){Z.debug("processLoadedItems",3);for(var b=this,c=b.items,d=c.addItemsFromJson(a.data),e=0;e<d.length;e++)d[e].associateWithLibrary(b);return b.items.updateSyncState(a.lastModifiedVersion),Zotero.trigger("itemsChanged",{library:b,loadedItems:d}),a},Zotero.Library.prototype.loadItem=function(a){Z.debug("Zotero.Library.loadItem",3);var b=this;if(!c)var c={};var d={target:"item",libraryType:b.libraryType,libraryID:b.libraryID,itemKey:a};return b.ajaxRequest(d).then(function(a){Z.debug("Got loadItem response");var c=new Zotero.Item(a.data);return c.owningLibrary=b,b.items.itemObjects[c.key]=c,Zotero.trigger("itemsChanged",{library:b}),c},function(a){Z.debug("Error loading Item")})},Zotero.Library.prototype.trashItem=function(a){var b=this;return b.items.trashItems([b.items.getItem(a)])},Zotero.Library.prototype.untrashItem=function(a){if(Z.debug("Zotero.Library.untrashItem",3),!a)return!1;var b=this.items.getItem(a);return b.apiObj.deleted=0,b.writeItem()},Zotero.Library.prototype.deleteItem=function(a){Z.debug("Zotero.Library.deleteItem",3);var b=this;return b.items.deleteItem(a)},Zotero.Library.prototype.deleteItems=function(a){Z.debug("Zotero.Library.deleteItems",3);var b=this;return b.items.deleteItems(a)},Zotero.Library.prototype.addNote=function(a,b){Z.debug("Zotero.Library.prototype.addNote",3);var c=this,d={target:"children",libraryType:c.libraryType,libraryID:c.libraryID,itemKey:a},e=Zotero.ajax.apiRequestString(d);this.items.getItem(a);return c.ajaxRequest(e,"POST",{processData:!1})},Zotero.Library.prototype.fetchGlobalItems=function(a){Z.debug("Zotero.Library.fetchGlobalItems",3);var b=this;a||(a={});var c={target:"items",start:0,limit:25},d=Z.extend({},c,a),e=Z.extend({target:"items",libraryType:""},d),f=Zotero.ajax.apiRequestString(e);return b.ajaxRequest(f,"GET",{dataType:"json"}).then(function(a){return Z.debug("globalItems callback",3),a.data})},Zotero.Library.prototype.fetchGlobalItem=function(a){Z.debug("Zotero.Library.fetchGlobalItem",3),Z.debug(a);var b=this,c={target:"item"},d=Z.extend({},c),e=Z.extend({target:"item",libraryType:"",itemKey:a},d),f=Zotero.ajax.apiRequestString(e);return b.ajaxRequest(f,"GET",{dataType:"json"}).then(function(a){return Z.debug("globalItem callback",3),a.data})},Zotero.Library.prototype.fetchTags=function(a){Z.debug("Zotero.Library.fetchTags",3);var b={target:"tags",order:"title",sort:"asc",limit:100},c=Z.extend({},b,a),d=Z.extend({target:"tags",libraryType:this.libraryType,libraryID:this.libraryID},c);return Zotero.ajaxRequest(d)},Zotero.Library.prototype.loadTags=function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];Z.debug("Zotero.Library.loadTags",3);var b=this;return a.showAutomaticTags&&a.collectionKey&&delete a.collectionKey,b.tags.displayTagsArray=[],b.fetchTags(a).then(function(a){Z.debug("loadTags proxied callback",3);var c=a.lastModifiedVersion;b.tags.updateSyncState(c);b.tags.addTagsFromJson(a.data);return b.tags.updateTagsVersion(c),b.tags.rebuildTagsArray(),a.parsedLinks.hasOwnProperty("next")?(b.tags.hasNextLink=!0,b.tags.nextLink=a.parsedLinks.next):(b.tags.hasNextLink=!1,b.tags.nextLink=null),b.trigger("tagsChanged",{library:b}),b.tags})},Zotero.Library.prototype.loadAllTags=function(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];Z.debug("Zotero.Library.loadAllTags",3);var b=this,c={target:"tags",order:"title",sort:"asc",limit:100,libraryType:b.libraryType,libraryID:b.libraryID},d=Z.extend({},c,a),e=Z.extend({},d),f=Zotero.ajax.apiRequestString(e),g=b.tags,h=(Z.extend({},c,g.loadedConfig),g.loadedRequestUrl);return Z.debug("requestUrl: "+f,4),Z.debug("loadedConfigRequestUrl: "+h,4),new Promise(function(c,d){var g=function h(c){Z.debug("loadAllTags continueLoadingCallback",3);var d=Zotero.Tags.prototype.plainTagsList(c.tagsArray);if(d.sort(Zotero.Library.prototype.comparer()),c.plainList=d,c.hasNextLink){Z.debug("still has next link.",3),c.tagsArray.sort(Zotero.Tag.prototype.tagComparer()),d=Zotero.Tags.prototype.plainTagsList(c.tagsArray),d.sort(Zotero.Library.prototype.comparer()),c.plainList=d;var e=c.nextLink,g=Zotero.utils.parseQuery(Zotero.utils.querystring(e)),i=Z.extend({},a);return i.start=g.start,i.limit=g.limit,b.loadTags(i).then(h)}Z.debug("no next in tags link",3),c.updateSyncedVersion(),c.tagsArray.sort(Zotero.Tag.prototype.tagComparer()),d=Zotero.Tags.prototype.plainTagsList(c.tagsArray),d.sort(Zotero.Library.prototype.comparer()),c.plainList=d,Z.debug("resolving loadTags deferred",3),b.tagsLoaded=!0,b.tags.loaded=!0,c.loadedConfig=a,c.loadedRequestUrl=f;for(var j=0;j<b.tags.tagsArray.length;j++)c.tagsArray[j].apiObj.version=c.tagsVersion;return b.trigger("tagsChanged",{library:b}),c};c(b.loadTags(e).then(g))})},Zotero.Library.prototype.loadIndexedDBCache=function(){Zotero.debug("Zotero.Library.loadIndexedDBCache",3);var a=this,b=a.idbLibrary.getAllItems(),c=a.idbLibrary.getAllCollections(),d=a.idbLibrary.getAllTags();return b.then(function(b){Z.debug("loadIndexedDBCache itemsD done",3);for(var c=0,d=0;d<b.length;d++){var e=new Zotero.Item(b[d]);a.items.addItem(e),e.version>c&&(c=e.version)}a.items.itemsVersion=c,a.items.loaded=!0,Z.debug("Done loading indexedDB items promise into library",3)}),c.then(function(b){Z.debug("loadIndexedDBCache collectionsD done",3);for(var c=0,d=0;d<b.length;d++){var e=new Zotero.Collection(b[d]);a.collections.addCollection(e),e.version>c&&(c=e.version)}a.collections.collectionsVersion=c,a.collections.initSecondaryData(),a.collections.loaded=!0}),d.then(function(b){Z.debug("loadIndexedDBCache tagsD done",3),Z.debug(b);for(var c=0,d=0,e=0;e<b.length;e++){var f=new Zotero.Tag(b[e]);a.tags.addTag(f),b[e].version>c&&(c=b[e].version)}d=c,a.tags.tagsVersion=d,a.tags.loaded=!0}),Promise.all([b,c,d])},Zotero.Library.prototype.saveIndexedDB=function(){var a=this,b=a.idbLibrary.updateItems(a.items.itemsArray),c=a.idbLibrary.updateCollections(a.collections.collectionsArray),d=a.idbLibrary.updateTags(a.tags.tagsArray);return Promise.all([b,c,d])},Zotero.Preferences=function(a,b){this.store=a,this.idString=b,this.preferencesObject={},this.defaults={debug_level:3,debug_log:!0,debug_mock:!1,listDisplayedFields:["title","creator","dateModified"],showAutomaticTags:!1,itemsPerPage:25,order:"title",title:"asc"},this.load()},Zotero.Preferences.prototype.setPref=function(a,b){var c=this;c.preferencesObject[a]=b,c.persist()},Zotero.Preferences.prototype.setPrefs=function(a){var b=this;if("object"!=("undefined"==typeof a?"undefined":_typeof(a)))throw new Error("Preferences must be an object");b.preferencesObject=a,b.persist()},Zotero.Preferences.prototype.getPref=function(a){var b=this;return b.preferencesObject[a]?b.preferencesObject[a]:b.defaults[a]?b.defaults[a]:null},Zotero.Preferences.prototype.getPrefs=function(){var a=this;return a.preferencesObject},Zotero.Preferences.prototype.persist=function(){var a=this,b="preferences_"+a.idString;a.store[b]=JSON.stringify(a.preferencesObject)},Zotero.Preferences.prototype.load=function(){var a=this,b="preferences_"+a.idString,c=a.store[b];c?a.preferencesObject=JSON.parse(c):a.preferencesObject={}},Zotero.Library.prototype.syncLibrary=function(a){var b=this;b.loadUpdatedCollections().then(function(){return b.loadUpdatedItems()})};var J=jQuery.noConflict();jQuery(document).ready(function(){Z.debug("===== DOM READY =====",3),Zotero.state=new Zotero.State,Zotero.init()}),Zotero.defaultPrefs={debug_level:3,debug_log:!0,debug_mock:!1,javascript_enabled:!1},Zotero.init=function(){if(Z.debug("Zotero init",3),window.zoteroConfig&&(Zotero.config=J.extend({},Zotero.config,window.zoteroConfig)),Zotero.state.rewriteAltUrl(),Zotero.pages&&Zotero.pages.base.init(),window.zoterojsClass&&void 0!==Zotero.pages&&Zotero.pages[zoterojsClass])try{Zotero.pages[zoterojsClass].init()}catch(a){Z.error("Error running page specific init for "+zoterojsClass),Z.error(a)}if("undefined"==typeof zoteroData&&(zoteroData={}),window.nonZendPage!==!0){Zotero.state.parseUrlVars(),Zotero.config.startPageTitle=document.title;var b;b="undefined"==typeof sessionStorage?{}:sessionStorage,Zotero.cache=new Zotero.Cache(b),Zotero.store=b,Zotero.preferences=new Zotero.Preferences(Zotero.store,"global"),Zotero.preferences.defaults=J.extend({},Zotero.preferences.defaults,Zotero.config.defaultPrefs);var c="en-US";zoteroData.locale&&(c=zoteroData.locale),"user_library"==Zotero.config.pageClass||"group_library"==Zotero.config.pageClass||"my_library"==Zotero.config.pageClass?(Z.debug("library page - ",3),Zotero.state.libraryString=Zotero.utils.libraryString(Zotero.config.librarySettings.libraryType,Zotero.config.librarySettings.libraryID),Zotero.state.filter=Zotero.state.libraryString,Zotero.Item.prototype.getItemTypes(c),Zotero.Item.prototype.getItemFields(c),Zotero.Item.prototype.getCreatorFields(c),Zotero.Item.prototype.getCreatorTypes()):Z.debug("non-library page",3),Zotero.ui.init.all(),J.ajaxSettings.traditional=!0,"false"==Zotero.state.getUrlVar("proxy")&&(Zotero.config.proxy=!1),window.onpopstate=function(){Z.debug("popstate",3),J(window).trigger("statechange")},J(window).on("statechange",J.proxy(Zotero.state.popstateCallback,Zotero.state)),Zotero.state.popstateCallback()}},Zotero.State=function(){this.q={},this.f={},this.pathVars={},this.startUrl="",this.replacePush=!1,this.curHref="",this.prevHref="",this.curState={},this.prevState={},this.useLocation=!0,this.filter=null,this.selectedItemKeys=[]},Zotero.State.prototype.rewriteAltUrl=function(){Z.debug("rewriteAltUrl");var a=this,b=!1,c=!1,d=!1,e=!1,f=Zotero.config.nonparsedBaseUrl,g=window.location.pathname,h=(new RegExp(".*"+f+"/?"),/^.*\/items\/collections?\/([A-Z0-9]{8})(?:\/[A-Z0-9]{8})?$/),i=/^.*\/items\/([A-Z0-9]{8})$/;switch(!0){case h.test(g):b=h.exec(g),d=b[1],c=b[2],e=!0;break;case i.test(g):b=i.exec(g),c=b[1],e=!0}d&&a.setUrlVar("collectionKey",d),c&&a.setUrlVar("itemKey",c),e&&a.replaceState()},Zotero.State.prototype.updateCurState=function(){var a=this;a.curState=J.extend({},a.q,a.pathVars)},Zotero.State.prototype.savePrevState=function(){var a=this;a.prevState=a.curState},Zotero.State.prototype.getSelectedItemKeys=function(){var a=this,b={},c=[];return J.each(a.selectedItemKeys,function(a,c){b[c]=!0}),J.each(b,function(a,b){c.push(a)}),0===c.length&&a.getUrlVar("itemKey")&&c.push(a.getUrlVar("itemKey")),c},Zotero.State.prototype.toggleItemSelected=function(a){var b=this,c=[],d=!1,e=b.getSelectedItemKeys();J.each(e,function(b,e){e==a?d=!0:c.push(e)}),d||c.push(a),b.selectedItemKeys=c},Zotero.State.prototype.pushTag=function(a){Z.debug("Zotero.State.pushTag",3);var b=this;if(b.pathVars.tag)if(b.pathVars.tag instanceof Array)b.pathVars.tag.push(a);else{var c=b.pathVars.tag;b.pathVars.tag=[c,a]}else b.pathVars.tag=[a]},Zotero.State.prototype.popTag=function(a){Z.debug("Zotero.State.popTag",3);var b=this;if(b.pathVars.tag){if(b.pathVars.tag instanceof Array){var c=b.pathVars.tag.filter(function(b,c,d){return b!=a});return void(b.pathVars.tag=c)}return b.pathVars.tag==a?void(b.pathVars.tag=[]):void 0}},Zotero.State.prototype.toggleTag=function(a){Z.debug("Zotero.State.toggleTag",3);var b=this;if(!b.pathVars.tag)return void(b.pathVars.tag=[a]);if(J.isArray(b.pathVars.tag)){if(-1!=J.inArray(a,b.pathVars.tag)){var c=b.pathVars.tag.filter(function(b,c,d){return b!=a});return void(b.pathVars.tag=c)}return void b.pathVars.tag.push(a)}if(b.pathVars.tag==a)return void(b.pathVars.tag=[]);if("string"==typeof b.pathVars.tag){var d=b.pathVars.tag;return void(b.pathVars.tag=[d,a])}},Zotero.State.prototype.unsetUrlVar=function(a){Z.debug("Zotero.State.unsetUrlVar",3);var b=this;b.pathVars[a]&&delete b.pathVars[a]},Zotero.State.prototype.clearUrlVars=function(a){Z.debug("Zotero.State.clearUrlVars",3);var b=this;a||(a=[]);var c=b.pathVars;J.each(c,function(b,d){-1==J.inArray(b,a)&&delete c[b]})},Zotero.State.prototype.parseUrlVars=function(){Z.debug("Zotero.State.parseUrlVars",3);var a=this;a.useLocation&&(a.q=Zotero.utils.parseQuery(Zotero.utils.querystring(window.location.href)),a.pathVars=a.parsePathVars())},Zotero.State.prototype.parsePathVars=function(a){Z.debug("Zotero.State.parsePathVars",3);window.history;a||(a=window.location.pathname);var b=Zotero.config.nonparsedBaseUrl;b=b.replace(window.location.origin,"");var c=[],d=new RegExp(".*"+b+"/?"),e=a.replace(d,"");c=e.split("/");for(var f={},g=0;g<c.length-1;g+=2){var h=f[c[g]];if(h)if(h instanceof Array)h.push(decodeURIComponent(c[g+1]));else{var i=[h];i.push(decodeURIComponent(c[g+1])),h=i}else h=decodeURIComponent(c[g+1]);f[c[g]]=h}if(f.itemkey){var j=f.itemkey;f.itemKey=j,delete f.itemkey}return f},Zotero.State.prototype.buildUrl=function(a,b){"undefined"==typeof b&&(b=!1);var c=Zotero.config.nonparsedBaseUrl+"/",d=[];J.each(a,function(a,b){b&&(b instanceof Array?J.each(b,function(b,c){d.push(a+"/"+encodeURIComponent(c))}):d.push(a+"/"+encodeURIComponent(b)))}),d.sort();var e=[];J.each(b,function(a,b){b&&(b instanceof Array?J.each(b,function(b,c){e.push(a+"="+encodeURIComponent(c))}):e.push(a+"="+encodeURIComponent(b)))}),e.sort();var f=d.join("/"),g="";e.length&&(g="?"+e.join("&"));var h=c+f+g;return h},Zotero.State.prototype.mutateUrl=function(a,b){var c=this;a||(a={}),b||(b=[]);var d=J.extend({},c.pathVars);J.each(a,function(a,b){d[a]=b}),J.each(b,function(a,b){delete d[b]});var e=c.buildUrl(d,!1);return e},Zotero.State.prototype.pushState=function(){Z.debug("Zotero.State.pushState",3);var a=this,b=window.history;a.prevHref=a.curHref||window.location.href;var c=J.extend({},a.q,a.pathVars),d=a.pathVars,e=a.q,f=a.buildUrl(d,e,!1);a.curHref=f,Z.debug("about to push url: "+f,3),a.useLocation?a.replacePush===!0?(Z.debug("Zotero.State.pushState - replacePush",3),a.replacePush=!1,b.replaceState(c,document.title,f)):(Z.debug("Zotero.State.pushState - pushState",3),b.pushState(c,document.title,f),a.stateChanged()):a.stateChanged(),Zotero.debug("leaving pushstate",3)},Zotero.State.prototype.replaceState=function(){Z.debug("Zotero.State.replaceState",3);var a=this,b=window.history;a.updateCurState();var c=J.extend({},a.curState),d=a.pathVars,e=a.buildUrl(d,!1);a.useLocation?(b.replaceState(c,null,e),a.curHref=e):a.curHref=e},Zotero.State.prototype.updateStateTitle=function(a){Zotero.debug("Zotero.State.updateStateTitle",3);document.title=a},Zotero.State.prototype.getUrlVar=function(a){var b=this;return b.pathVars.hasOwnProperty(a)&&""!==b.pathVars[a]?b.pathVars[a]:b.q.hasOwnProperty(a)?b.q[a]:void 0},Zotero.State.prototype.setUrlVar=function(a,b){var c=this;c.pathVars[a]=b},Zotero.State.prototype.getUrlVars=function(){var a=this,b=Zotero.utils.parseQuery(Zotero.utils.querystring(window.location.href));return J.extend(!0,{},a.pathVars,b)},Zotero.State.prototype.setQueryVar=function(a,b){var c=this;""===b?delete c.q[a]:c.q[a]=b},Zotero.State.prototype.addQueryVar=function(a,b){var c=this;if(c.q.hasOwnProperty(a))if(J.isArray(c.q[a]))c.q[a].push(b);else{var d=[c.q[a],b];c.q[a]=d}else c.q[a]=b;return c.q[a]},Zotero.State.prototype.popstateCallback=function(a){var b=this;Z.debug("===== popstateCallback =====",3);window.history;b.prevHref=b.curHref,Z.debug("new href, updating href and processing urlchange",3),b.curHref=window.location.href,b.parseUrlVars(),b.stateChanged(a)},Zotero.State.prototype.stateChanged=function(a){var b=this;Z.debug("stateChanged",3),b.savePrevState(),b.updateCurState(),Z.debug("Checking changed variables",3);var c=b.diffState(b.prevHref,b.curHref),d={};J.each(c,function(a,c){var e=c+"Changed";Z.debug(e,3),Zotero.eventful.eventMap.hasOwnProperty(e)&&J.each(Zotero.eventful.eventMap[e],function(a,b){d.hasOwnProperty(b)||(d[b]=1)}),Z.debug("State Filter: "+b.filter,3),Zotero.trigger(e,{},b.filter)}),J.each(d,function(a,c){Z.debug("State Filter: "+b.filter,3),Zotero.trigger(a,{},b.filter)}),Z.debug("===== stateChanged Done =====",3)},Zotero.State.prototype.diffState=function(a,b){Z.debug("Zotero.State.diffState",3);var c=this,d=J.extend({},c.parsePathVars(a)),e=J.extend({},c.parsePathVars(b)),f=["start","limit","order","sort","content","format","q","fq","itemType","itemKey","collectionKey","searchKey","locale","tag","tagType","key","style","session","newer","since","itemPage","mode"],g=[];return J.each(f,function(a,b){(d.hasOwnProperty(b)||e.hasOwnProperty(b))&&d[b]!=e[b]&&g.push(b)}),g},Zotero.Delay=function(a){return new Promise(function(b,c){setTimeout(function(){b()},a)})},Zotero.widgets={},Zotero.eventful={},Zotero.eventful.events=["collectionsDirty","tagsChanged","displayedItemsChanged","displayedItemChanged","selectedItemsChanged","showCitations","showSettings","exportItems","libraryTagsUpdated","uploadSuccessful","refreshGroups","clearLibraryQuery","libraryItemsUpdated","citeItems","itemTypeChanged","addTag","showChildren","selectCollection","selectedCollectionChanged","libraryCollectionsUpdated","loadItemsDone","collectionsChanged","tagsChanged","itemsChanged","loadedCollectionsProcessed","deleteProgress","settingsLoaded","cachedDataLoaded","createItem","newItem","addToCollectionDialog","removeFromCollection","moveToTrash","removeFromTrash","toggleEdit","clearLibraryQuery","librarySettingsDialog","citeItems","exportItemsDialog","syncLibrary","createCollectionDialog","updateCollectionDialog","deleteCollectionDialog","showMoreTags","showFewerTags","indexedDBError"],Zotero.eventful.eventMap={orderChanged:["displayedItemsChanged"],sortChanged:["displayedItemsChanged"],collectionKeyChanged:["displayedItemsChanged","selectedCollectionChanged"],qChanged:["displayedItemsChanged"],tagChanged:["displayedItemsChanged","selectedTagsChanged"],itemPageChanged:["displayedItemsChanged"],itemKeyChanged:["displayedItemChanged"]},Zotero.eventful.initWidgets=function(){Zotero.state.parsePathVars(),J(".eventfulwidget").each(function(a,b){var c=J(b).data("widget");c&&Zotero.ui.widgets[c]&&Zotero.ui.widgets[c].init&&(Z.debug("eventfulwidget init: "+c,3),Zotero.ui.widgets[c].init(b))}),Zotero.eventful.initTriggers()},Zotero.eventful.initTriggers=function(a){Zotero.debug("Zotero.eventful.initTriggers",3),a||(a=J("html"));var b=function(a){Z.debug("triggerOnEvent",3),a.preventDefault();var b=J(a.delegateTarget),c=b.data("triggers");Z.debug("eventName: "+c,3);var d=b.data("library")||"";Zotero.trigger(c,{triggeringElement:a.currentTarget},d)};J(a).find(".eventfultrigger").each(function(a,c){if(!J(c).data("triggerbound")){var d=J(c).data("event");d?(Z.debug("binding "+d+" on "+c.tagName,3),J(c).on(d,b)):J(c).on("click",b),J(c).data("triggerbound",!0)}})},Zotero.ui.formatItemField=function(a,b,c){"undefined"==typeof c&&(c=!1);var d,e={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1};if(window.Intl){var f=new window.Intl.DateTimeFormat(void 0,e);d=f.format}else d=function(a){return a.toLocaleString()};var g,h=0,i="";switch(Zotero.config.maxFieldSummaryLength[a]&&(h=Zotero.config.maxFieldSummaryLength[a]),a){case"itemType":i=Zotero.localizations.typeMap[b.apiObj.data.itemType];break;case"dateModified":b.apiObj.data.dateModified||(i=""),g=Zotero.utils.parseApiDate(b.apiObj.data.dateModified),i=g?d(g):b.apiObj.data.dateModified;break;case"dateAdded":b.apiObj.data.dateAdded||(i=""),g=Zotero.utils.parseApiDate(b.apiObj.data.dateAdded),i=g?d(g):b.apiObj.data.dateAdded;break;case"title":i=b.get("title");break;case"creator":case"creatorSummary":i=b.get("creatorSummary");break;case"addedBy":b.apiObj.meta.createdByUser&&(i=""!==b.apiObj.meta.createdByUser.name?b.apiObj.meta.createdByUser.name:b.apiObj.meta.createdByUser.username);break;case"modifiedBy":b.apiObj.meta.lastModifiedByUser&&(i=""!==b.apiObj.meta.lastModifiedByUser.name?b.apiObj.meta.lastModifiedByUser.name:b.apiObj.meta.lastModifiedByUser.username);break;default:var j=_typeof2(b.get(a));"undefined"!=typeof j&&(i=b.get(a))}return"undefined"==typeof i&&(Z.error("formattedString for "+a+" undefined"),
Z.error(b)),c?Zotero.ui.trimString(i,h):i},Zotero.ui.trimString=function(a,b){var c=35,d=a;return"undefined"==typeof a?(Z.error("formattedString passed to trimString was undefined."),""):(b&&(c=b),c>0&&d.length>c?d.slice(0,c)+"…":d)},Zotero.ui.formatItemDateField=function(a,b){var c,d,e,f={hour:"numeric",minute:"numeric",second:"numeric",hour12:!1},g={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1};if(window.Intl){var h=new window.Intl.DateTimeFormat(void 0,g);d=h.format;var i=new window.Intl.DateTimeFormat(void 0,f);e=i.format}else d=function(a){return a.toLocaleDateString()},e=function(a){return a.toLocaleTimeString()};switch(a){case"dateModified":return b.apiObj.data.dateModified?(c=Zotero.utils.parseApiDate(b.apiObj.data.dateModified),c?"<span class='localized-date-span'>"+d(c)+"</span> <span class='localized-date-span'>"+e(c)+"</span>":b.apiObj.data.dateModified):"";case"dateAdded":return b.apiObj.data.dateAdded?(c=Zotero.utils.parseApiDate(b.apiObj.data.dateAdded),c?"<span class='localized-date-span'>"+d(c)+"</span> <span class='localized-date-span'>"+e(c)+"</span>":b.apiObj.data.dateAdded):""}return""},Zotero.ui.formatItemContentRow=function(a){if("date"==a.field){if(!a.fieldValue)return"";var b=Zotero.utils.parseApiDate(a.value);return b?b.toLocaleString():a.fieldValue}return a.fieldValue},Zotero.ui.groupUrl=function(a,b){var c;c="Private"==a.groupType?"/groups/"+a.groupID:"/groups/"+Zotero.utils.slugify(a.groupName);var d="/groups/"+a.groupID;switch(Zotero.debug("groupBase: "+c),b){case"groupView":return c;case"groupLibrary":return c+"/items";case"groupSettings":return d+"/settings";case"groupMembers":return d+"/members";case"groupLibrarySettings":return d+"/settings/library";case"groupMembersSettings":return d+"/settings/members"}},Zotero.ui.init={},Zotero.ui.widgets={},Zotero.ui.init.all=function(){switch(Z.debug("ui init based on page",3),Zotero.config.pageClass){case"my_library":case"user_library":case"group_library":Zotero.ui.init.library();break;case"default":}Zotero.eventful.initWidgets(),Zotero.ui.init.rte()},Zotero.ui.init.library=function(){},Zotero.ui.init.rte=function(a,b,c){return Z.debug("init.rte",3),"ckeditor"==Zotero.config.rte?void Zotero.ui.init.ckeditor(a,b,c):void Zotero.ui.init.tinyMce(a,b,c)},Zotero.ui.init.ckeditor=function(a,b,c){Z.debug("init.ckeditor",3),a||(a="default"),c||(c=J("body"));var d={};d.toolbarGroups=[{name:"clipboard",groups:["clipboard","undo"]},{name:"links"},{name:"insert"},{name:"forms"},{name:"tools"},{name:"document",groups:["mode","document","doctools"]},{name:"others"},"/",{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align"]},{name:"styles"},{name:"colors"},{name:"about"}];var e={};e.toolbarGroups=[{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection"]},{name:"insert"},{name:"forms"},{name:"tools"},{name:"document",groups:["mode","document","doctools"]},{name:"others"},"/",{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align"]},{name:"styles"},{name:"colors"},{name:"about"}];var f={};f.toolbarGroups=[],f.readOnly=!0;var g;if(g="nolinks"==a?J.extend(!0,{},e):"readonly"==a?J.extend(!0,{},f):J.extend(!0,{},d),b&&(g.startupFocus=!0),Z.debug("initializing CK editors",3),J(c).is(".rte")){Z.debug("RTE textarea -  - "+J(c).attr("name"),3);var h=J(c).attr("name");if(!CKEDITOR.instances[h]){CKEDITOR.replace(J(c),g)}}else Z.debug("not a direct rte init"),Z.debug(c),J(c).find("textarea.rte").each(function(a,b){Z.debug("RTE textarea - "+a+" - "+J(b).attr("name"),3);var c=J(b).attr("name");if(!CKEDITOR.instances[c]){CKEDITOR.replace(b,g)}})},Zotero.ui.init.tinyMce=function(a,b,c){Z.debug("init.tinyMce",3),a||(a="default");var d="specific_textareas";c?d="exact":c="";var e={mode:d,elements:c,theme:"advanced",theme_advanced_toolbar_location:"top",theme_advanced_buttons1:"bold,italic,underline,strikethrough,separator,sub,sup,separator,forecolorpicker,backcolorpicker,separator,blockquote,separator,link,unlink",theme_advanced_buttons2:"formatselect,separator,justifyleft,justifycenter,justifyright,separator,bullist,numlist,outdent,indent,separator,removeformat,code,",theme_advanced_buttons3:"",theme_advanced_toolbar_align:"left",theme_advanced_statusbar_location:"bottom",theme_advanced_resizing:!0,relative_urls:!1,editor_selector:"default"};return b&&(e.init_instance_callback=function(a){Z.debug("inited "+a.editorId),a.focus()}),"nolinks"!=a&&(e.theme_advanced_buttons1+=",link"),"nolinks"==a&&(e.editor_selector="nolinks"),"readonly"==a&&(e.readonly=1,e.editor_selector="readonly"),tinymce.init(e),e},Zotero.ui.init.libraryTemplates=function(){},Zotero.ui.saveItem=function(a){Z.debug("pre writeItem debug",4),Z.debug(a,4);var b=a.owningLibrary,c=a.writeItem().then(function(b){if(Z.debug("item write finished",3),a.writeFailure)throw Z.error("Error writing item:"+a.writeFailure.message),Zotero.ui.jsNotificationMessage("Error writing item","error"),new Error("Error writing item:"+a.writeFailure.message)});Z.debug("adding new tags to library tags",3);var d=b.tags,e=a.apiObj.data.tags;return J.each(e,function(a,b){var c=b.tag;if(!d.tagObjects.hasOwnProperty(c)){var e=new Zotero.Tag(b);d.addTag(e)}}),d.updateSecondaryData(),c},Zotero.ui.itemTypeClass=function(a){var b=a.apiObj.data.itemType;if("attachment"==a.apiObj.data.itemType)if("application/pdf"==a.mimeType)b+="-pdf";else switch(a.linkMode){case 0:b+="-file";break;case 1:b+="-file";break;case 2:b+="-snapshot";break;case 3:b+="-web-link"}return"img-"+b},Zotero.ui.getAssociatedLibrary=function(a){Z.debug("Zotero.ui.getAssociatedLibrary",3);var b;if("undefined"==typeof a)b=J(".zotero-library").first();else if(b=J(a),(0===b.length||b.is("#eventful"))&&(b=J(".zotero-library").first(),0===b.length))throw Z.debug("No element passed and no default found for getAssociatedLibrary."),new Error("No element passed and no default found for getAssociatedLibrary.");var c,d=b.data("zoterolibrary");return d||(c=J(a).data("library"),c&&(d=Zotero.ui.libStringLibrary(c)),b.data("zoterolibrary",d)),d||(b=J(".zotero-library").first(),c=b.data("library"),c&&(d=Zotero.ui.libStringLibrary(c))),d||Z.error("No associated library found"),d},Zotero.ui.libStringLibrary=function(a){var b;if(Zotero.libraries.hasOwnProperty(a))b=Zotero.libraries[a];else{var c=Zotero.utils.parseLibString(a);b=new Zotero.Library(c.libraryType,c.libraryID),Zotero.libraries[a]=b}return b},Zotero.ui.getEventLibrary=function(a){var b=J(a.triggeringElement);if(a.library)return a.library;if(a.data&&a.data.library)return a.data.library;Z.debug(a);var c=b.data("library");if(!c)throw"no library on event or libString on triggeringElement";if(Zotero.libraries.hasOwnProperty(c))return Zotero.libraries[c];var d=Zotero.ui.parseLibString(c),e=new Zotero.Library(d.libraryType,d.libraryID,"");Zotero.libraries[Zotero.utils.libraryString(d.libraryType,d.libraryID)]=e},Zotero.ui.getPrioritizedVariable=function(a,b){var c=Zotero.state.getUrlVar(a)||Zotero.preferences.getPref(a)||Zotero.config.defaultApiArgs[a]||b;return c},Zotero.ui.scrollToTop=function(){window.scrollBy(0,-5e3)},Zotero.ui.parentWidgetEl=function(a){var b;if(a.hasOwnProperty("data")&&a.data.hasOwnProperty("widgetEl"))return Z.debug("event had widgetEl associated with it"),J(a.data.widgetEl);if(a.hasOwnProperty("currentTarget")){if(Z.debug("event currentTarget set"),b=J(a.currentTarget).closest(".eventfulwidget"),b.length>0)return b.first();Z.debug("no matching closest to currentTarget"),Z.debug(a.currentTarget),Z.debug(a.currentTarget)}return b=J(a).closest(".eventfulwidget"),b.length>0?(Z.debug("returning first closest widget"),b.first()):null},Zotero.ui.getSelectedItemKeys=function(a){Z.debug("Zotero.ui.getSelectedItemKeys",3),a=J(a?a:"body");var b=[],c=Zotero.state.getUrlVar("itemKey");return c&&Zotero.config.preferUrlItem!==!1?b.push(c):a.find("input.itemKey-checkbox:checked").each(function(a,c){b.push(J(c).data("itemkey"))}),b},Zotero.ui.getAllFormItemKeys=function(a){Z.debug("Zotero.ui.getAllFormItemKeys",3),a=J(a?a:"body");var b=[];Zotero.state.getUrlVar("itemKey");return a.find("input.itemKey-checkbox").each(function(a,c){b.push(J(c).data("itemkey"))}),b},Zotero.ui.getRte=function(a){switch(Z.debug("getRte",3),Z.debug("getRte",3),Z.debug(a),Zotero.config.rte){case"ckeditor":return CKEDITOR.instances[a].getData();default:return tinyMCE.get(a).getContent()}},Zotero.ui.updateRte=function(a){switch(Z.debug("updateRte",3),Zotero.config.rte){case"ckeditor":var b="#"+a,c=CKEDITOR.instances[a].getData();J(b).val(c);break;default:tinyMCE.updateContent(a)}},Zotero.ui.deactivateRte=function(a){switch(Z.debug("deactivateRte",3),Zotero.config.rte){case"ckeditor":if(CKEDITOR.instances[a]){Z.debug("deactivating "+a,3);CKEDITOR.instances[a].destroy()}break;default:tinymce.execCommand("mceRemoveControl",!0,a)}},Zotero.ui.cleanUpRte=function(a){Z.debug("cleanUpRte",3),J(a).find("textarea.rte").each(function(a,b){Zotero.ui.deactivateRte(J(b).attr("name"))})},Zotero.ui.jsNotificationMessage=function(a,b,c){if(Z.debug("notificationMessage: "+b+" : "+a,3),!Zotero.config.suppressErrorNotifications){c||c===!1||(c=5);var d="alert-info";if(b)switch(b){case"error":case"danger":d="alert-danger",c=!1;break;case"success":case"confirm":d="alert-success";break;case"info":d="alert-info";break;case"warning":case"warn":d="alert-warning"}c?J("#js-message").append("<div class='alert alert-dismissable "+d+"'><button type='button' class='close' data-dismiss='alert'><span aria-hidden='true'>&times;</span><span class='sr-only'>Close</span></button>"+a+"</div>").children("div").delay(1e3*parseInt(c,10)).slideUp().delay(300).queue(function(){J(this).remove()}):J("#js-message").append("<div class='alert alert-dismissable "+d+"'><button type='button' class='close' data-dismiss='alert'><span aria-hidden='true'>&times;</span><span class='sr-only'>Close</span></button>"+a+"</div>")}},Zotero.ui.ajaxErrorMessage=function(a){if(Z.debug("Zotero.ui.ajaxErrorMessage",3),"undefined"==typeof a)return Z.debug("ajaxErrorMessage called with undefined argument"),"";switch(Z.debug(a,3),a.status){case 403:return Zotero.config.loggedIn||Zotero.config.ignoreLoggedInStatus?"You do not have permission to view this library.":(Zotero.config.suppressErrorNotifications=!0,window.location="/user/login","");case 404:Zotero.ui.jsNotificationMessage("A requested resource could not be found.","error");break;case 400:Zotero.ui.jsNotificationMessage("Bad Request","error");break;case 405:Zotero.ui.jsNotificationMessage("Method not allowed","error");break;case 412:Zotero.ui.jsNotificationMessage("Precondition failed","error");break;case 500:Zotero.ui.jsNotificationMessage("Something went wrong but we're not sure what.","error");break;case 501:Zotero.ui.jsNotificationMessage("We can't do that yet.","error");break;case 503:Zotero.ui.jsNotificationMessage("We've gone away for a little while. Please try again in a few minutes.","error");break;default:Z.debug("jqxhr status did not match any expected case"),Z.debug(a.status)}return""},Zotero.ui.showSpinner=function(a,b){var c=Zotero.config.baseWebsiteUrl+"/static/images/theme/broken-circle-spinner.gif";b?"horizontal"==b&&J(a).html("<img class='spinner' src='"+c+"'/>"):J(a).html("<img class='spinner' src='"+c+"'/>")},Zotero.ui.appendSpinner=function(a){var b=Zotero.config.baseWebsiteUrl+"static/images/theme/broken-circle-spinner.gif";J(a).append("<img class='spinner' src='"+b+"'/>")},Zotero.ui.fixTableHeaders=function(a){var b=J(a),c=[];b.find("thead th").each(function(a,b){var d=J(b).width();c.push(d),J(b).width(d)}),b.find("tbody>tr:first>td").each(function(a,b){J(b).width(c[a])});var d=b.find("thead").height();b.find("thead").css("position","fixed").css("margin-top",-d).css("background-color","white").css("z-index",10),b.find("tbody").css("margin-top",d),b.css("margin-top",d)},Zotero.ui.zoteroItemUpdated=function(){try{var a=document.createEvent("HTMLEvents");a.initEvent("ZoteroItemUpdated",!0,!0),document.dispatchEvent(a)}catch(b){Zotero.debug("Error triggering ZoteroItemUpdated event")}},Zotero.ui.dialog=function(a,b){Z.debug("Zotero.ui.dialog",3),b.show=!0,b.backdrop=!1,J(a).modal(b),J(a).modal("show"),Z.debug("exiting Zotero.ui.dialog",3)},Zotero.ui.closeDialog=function(a){J(a).modal("hide")},Zotero.ui.widgets.reactaddToCollectionDialog={},Zotero.ui.widgets.reactaddToCollectionDialog.init=function(a){Z.debug("addtocollectionsdialog widget init",3);var b=Zotero.ui.getAssociatedLibrary(a);ReactDOM.render(React.createElement(AddToCollectionDialog,{library:b}),document.getElementById("add-to-collection-dialog"))};var AddToCollectionDialog=React.createClass({displayName:"AddToCollectionDialog",componentWillMount:function(){var a=this,b=this.props.library;b.listen("addToCollectionDialog",function(){a.setState({}),a.openDialog()},{})},getInitialState:function(){return{collectionKey:null}},handleCollectionChange:function(a){this.setState({collectionKey:a.target.value})},openDialog:function(){this.refs.modal.open()},closeDialog:function(a){this.refs.modal.close()},addToCollection:function(a){Z.debug("add-to-collection clicked",3);var b=this,c=this.props.library,d=Zotero.state.getSelectedItemKeys(),e=this.state.collectionKey;return e?0===d.length?(Zotero.ui.jsNotificationMessage("No items selected","notice"),!1):(c.collections.getCollection(e).addItems(d).then(function(a){c.dirty=!0,Zotero.ui.jsNotificationMessage("Items added to collection","success"),b.closeDialog()})["catch"](Zotero.catchPromiseError),!1):(Zotero.ui.jsNotificationMessage("No collection selected","error"),!1)},render:function(){var a=this.props.library,b=a.collections.nestedOrderingArray(),c=b.map(function(a,b){return React.createElement("option",{key:a.get("key"),value:a.get("key")},"-".repeat(a.nestingDepth)," ",a.get("name"))});return React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"add-to-collection-dialog",className:"add-to-collection-dialog",role:"dialog",title:"Add to Collection","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",null,"Add To Collection")),React.createElement("div",{className:"add-to-collection-div modal-body","data-role":"content"},React.createElement("form",{method:"POST"},React.createElement("div",{"data-role":"fieldcontain"},React.createElement("label",{htmlFor:"new-collection-parent"},"Collection"),React.createElement("select",{onChange:this.handleCollectionChange,className:"collectionKey-select target-collection form-control"},c)))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{onClick:this.closeDialog,className:"btn","data-dismiss":"modal","aria-hidden":"true"},"Close"),React.createElement("button",{onClick:this.addToCollection,className:"btn btn-primary addButton"},"Add"))))))}}),BootstrapModalWrapper=React.createClass({displayName:"BootstrapModalWrapper",componentDidMount:function(){Z.debug("BootstrapModalWrapper componentDidMount"),J(this.refs.root).modal({backdrop:"static",keyboard:!1,show:!1})},componentWillUnmount:function(){Z.debug("BootstrapModalWrapper componentWillUnmount"),J(this.refs.root).off("hidden",this.handleHidden)},close:function(){Z.debug("BootstrapModalWrapper close"),J(this.refs.root).modal("hide")},open:function(){Z.debug("BootstrapModalWrapper open"),J(this.refs.root).modal("show")},render:function(){return React.createElement("div",{className:"modal",ref:"root"},this.props.children)}});Zotero.ui.widgets.reactbreadcrumbs={},Zotero.ui.widgets.reactbreadcrumbs.init=function(a){var b=Zotero.ui.getAssociatedLibrary(a);ReactDOM.render(React.createElement(BreadCrumbs,{library:b}),document.getElementById("breadcrumbs"))};var BreadCrumb=React.createClass({displayName:"BreadCrumb",getInitialProps:function(){return{label:"",path:""}},render:function(){return""!=this.props.path?React.createElement("a",{href:this.props.path},this.props.label):this.props.label}}),BreadCrumbs=React.createClass({displayName:"BreadCrumbs",componentWillMount:function(){var a=this,b=this.props.library;b.listen("displayedItemsChanged displayedItemChanged selectedCollectionChanged",function(){a.forceUpdate()})},getInitialProps:function(){return{library:null}},render:function(){var a=this.props.library;if(null===a)return null;var b=[],c=Zotero.state.getUrlVars();if(Zotero.config.breadcrumbsBase?Zotero.config.breadcrumbsBase.forEach(function(a){b.push(a)}):b="user"==a.libraryType?[{label:"Home",path:"/"},{label:"People",path:"/people"},{label:a.libraryLabel||a.libraryUrlIdentifier,path:"/"+a.libraryUrlIdentifier},{label:"Library",path:"/"+a.libraryUrlIdentifier+"/items"}]:[{label:"Home",path:"/"},{label:"Groups",path:"/groups"},{label:a.libraryLabel||a.libraryUrlIdentifier,path:"/groups/"+a.libraryUrlIdentifier},{label:"Library",path:"/groups/"+a.libraryUrlIdentifier+"/items"}],c.collectionKey){Z.debug("have collectionKey",4);var d=a.collections.getCollection(c.collectionKey);d&&b.push({label:d.get("name"),path:Zotero.state.buildUrl({collectionKey:c.collectionKey})})}c.itemKey&&(Z.debug("have itemKey",4),b.push({label:a.items.getItem(c.itemKey).title,path:Zotero.state.buildUrl({collectionKey:c.collectionKey,itemKey:c.itemKey})}));var e=[],f="";return b.forEach(function(a,c){e.push(React.createElement(BreadCrumb,{label:a.label,path:a.path})),f+="Home"==a.label?"Zotero | ":a.label,c<b.length&&(e.push(" > "),f+=" > ")}),""!=f&&Zotero.state.updateStateTitle(f),React.createElement("span",null,e)}});Zotero.ui.widgets.reactchooseSortingDialog={},Zotero.ui.widgets.reactchooseSortingDialog.init=function(a){Z.debug("chooseSortingDialog widget init",3);var b=Zotero.ui.getAssociatedLibrary(a);ReactDOM.render(React.createElement(ChooseSortingDialog,{library:b}),document.getElementById("choose-sorting-dialog"))};var ChooseSortingDialog=React.createClass({displayName:"ChooseSortingDialog",componentWillMount:function(){var a=this,b=this.props.library,c=Zotero.ui.getPrioritizedVariable("order","title"),d=Zotero.ui.getPrioritizedVariable("sort","asc");a.setState({sortField:c,sortOrder:d}),b.listen("chooseSortingDialog",a.openDialog,{})},getInitialState:function(){return{sortField:"",sortOrder:"asc"}},handleFieldChange:function(a){this.setState({sortField:a.target.value})},handleOrderChange:function(a){this.setState({sortOrder:a.target.value})},saveSorting:function(){var a=this.props.library;a.trigger("changeItemSorting",{newSortField:this.state.sortField,newSortOrder:this.state.sortOrder}),this.closeDialog()},openDialog:function(){this.refs.modal.open()},closeDialog:function(a){this.refs.modal.close()},render:function(){var a=this.props.library,b=a.sortableColumns.map(function(a){return React.createElement("option",{key:a,label:Zotero.localizations.fieldMap[a],value:a},Zotero.localizations.fieldMap[a])});return React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"choose-sorting-dialog",className:"choose-sorting-dialog",role:"dialog",title:"Sort Order","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",null,"Sort Items By")),React.createElement("div",{className:"choose-sorting-div modal-body","data-role":"content"},React.createElement("form",{className:"form-horizontal",role:"form"},React.createElement("select",{defaultValue:this.state.sortField,onChange:this.handleFieldChange,id:"sort-column-select",className:"sort-column-select form-control",name:"sort-column-select"},b),React.createElement("select",{defaultValue:this.state.sortOrder,onChange:this.handleOrderChange,id:"sort-order-select",className:"sort-order-select form-control",name:"sort-order-select"},React.createElement("option",{label:"Ascending",value:"asc"},"Ascending"),React.createElement("option",{label:"Descending",value:"desc"},"Descending")))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{className:"btn","data-dismiss":"modal","aria-hidden":"true"},"Cancel"),React.createElement("button",{onClick:this.saveSorting,className:"btn btn-primary saveSortButton"},"Save"))))))}});Zotero.ui.widgets.reactciteItemDialog={},Zotero.ui.widgets.reactciteItemDialog.init=function(a){Z.debug("citeItemDialog widget init",3);var b=Zotero.ui.getAssociatedLibrary(a);ReactDOM.render(React.createElement(CiteItemDialog,{library:b}),document.getElementById("cite-item-dialog"))};var CiteItemDialog=React.createClass({displayName:"CiteItemDialog",componentWillMount:function(){var a=this,b=this.props.library;a.getAvailableStyles(),b.listen("citeItems",a.openDialog,{})},getDefaultProps:function(){return{freeStyleInput:!1}},getInitialState:function(){return{styles:[],currentStyle:"",citationString:""}},handleStyleChange:function(a){this.setState({collectionKey:a.target.value})},openDialog:function(){this.refs.modal.open()},closeDialog:function(a){this.refs.modal.close()},cite:function(a){Z.debug("citeFunction",3);var b=this,c=this.props.library,d=this.state.currentStyle,e=Zotero.state.getSelectedItemKeys();c.loadFullBib(e,d).then(function(a){b.setState({citationString:a})})["catch"](Zotero.catchPromiseError)},getAvailableStyles:function(){Zotero.styleList||(Zotero.styleList=[],J.getJSON(Zotero.config.styleListUrl,function(a){Zotero.styleList=a}))},directCite:function(a,b){var c={};c.items=a;var d=Zotero.config.citationEndpoint+"?linkwrap=1&style="+b;return J.post(d,JSON.stringify(c))},buildBibString:function(a){for(var b=a.bibliography[0],c=a.bibliography[1],d=b.bibstart,e=0;e<c.length;e++)d+=c[e];return d+=b.bibend},render:function(){var a=(this.props.library,null);this.props.freeStyleInput&&(a=React.createElement("input",{type:"text",className:"free-text-style-input form-control",placeholder:"style"}));var b={__html:this.state.citationString};return React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"cite-item-dialog",className:"cite-item-dialog",role:"dialog",title:"Cite","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",null,"Cite Items")),React.createElement("div",{className:"cite-item-div modal-body","data-role":"content"},React.createElement("form",null,React.createElement("select",{onChange:this.cite,className:"cite-item-select form-control",id:"cite-item-select"},React.createElement("option",{value:""},"Select Style"),React.createElement("option",{value:"apsa"},"American Political Science Association"),React.createElement("option",{value:"apa"},"American Psychological Association"),React.createElement("option",{value:"asa"},"American Sociological Association"),React.createElement("option",{value:"chicago-author-date"},"Chicago Manual of Style (Author-Date format)"),React.createElement("option",{value:"chicago-fullnote-bibliography"},"Chicago Manual of Style (Full Note with Bibliography)"),React.createElement("option",{value:"chicago-note-bibliography"},"Chicago Manual of Style (Note with Bibliography)"),React.createElement("option",{value:"harvard1"},"Harvard Reference format 1"),React.createElement("option",{value:"ieee"},"IEEE"),React.createElement("option",{value:"mhra"},"Modern Humanities Research Association"),React.createElement("option",{value:"mla"},"Modern Language Association"),React.createElement("option",{value:"nlm"},"National Library of Medicine"),React.createElement("option",{value:"nature"},"Nature"),React.createElement("option",{value:"vancouver"},"Vancouver")),a),React.createElement("div",{id:"cite-box-div",className:"cite-box-div",dangerouslySetInnerHTML:b})),React.createElement("div",{className:"modal-footer"},React.createElement("button",{className:"btn btn-default","data-dismiss":"modal","aria-hidden":"true"},"Close"))))))}});Zotero.ui.widgets.reactcollections={},Zotero.ui.widgets.reactcollections.init=function(a){var b=Zotero.ui.getAssociatedLibrary(a);ReactDOM.render(React.createElement(Collections,{library:b}),document.getElementById("collection-list-div"))};var CollectionRow=React.createClass({displayName:"CollectionRow",getDefaultProps:function(){return{collection:null,selectedCollection:"",depth:0,expandedCollections:{}}},handleCollectionClick:function(a){a.preventDefault();var b=this.props.collection.get("collectionKey");Zotero.ui.widgets.reactcollections.reactInstance.setState({currentCollectionKey:b}),Zotero.state.clearUrlVars(["mode"]),Zotero.state.pathVars.collectionKey=b,Zotero.state.pushState()},handleTwistyClick:function(a){Z.debug("handleTwistyClick"),a.preventDefault();var b=this.props.collection.get("collectionKey"),c=this.props.expandedCollections;c[b]?delete c[b]:c[b]=!0,Zotero.ui.widgets.reactcollections.reactInstance.setState({expandedCollections:c})},render:function(){if(null==this.props.collection)return null;var a=this.props.collection,b=a.get("key"),c=this.props.selectedCollection,d=this.props.expandedCollections,e=d[b]===!0,f=this.props.selectedCollection==b,g=[];a.children.forEach(function(a){g.push(React.createElement(CollectionRow,{key:a.get("key"),collection:a,selectedCollection:c,expandedCollections:d}))});var h=null;a.hasChildren&&(h=React.createElement("ul",{hidden:!e},g));var i="placeholder small-icon light-icon pull-left";return d[b]===!0?i+=" glyphicon glyphicon-chevron-down clickable":g.length>0&&(i+=" glyphicon glyphicon-chevron-right clickable"),React.createElement("li",{className:"collection-row"},React.createElement("div",{className:"folder-toggle"},React.createElement("span",{className:i,onClick:this.handleTwistyClick}),React.createElement("span",{className:"fonticon glyphicons glyphicons-folder-open barefonticon"})),React.createElement("a",{href:a.websiteCollectionLink,className:f?"current-collection":"",onClick:this.handleCollectionClick},a.get("name")),h)}}),TrashRow=React.createClass({displayName:"TrashRow",getDefaultProps:function(){return{collectionKey:"trash",selectedCollection:""}},handleClick:function(){Zotero.state.clearUrlVars(["mode"]),Zotero.state.pathVars.collectionKey=this.props.collectionKey,Zotero.state.pushState()},render:function(){Z.debug("TrashRow render");var a=this.props.selectedCollection==this.props.collectionKey?"collection-row current-collection":"collection-row";return React.createElement("li",{className:a},React.createElement("div",{className:"folder-toggle"},React.createElement("span",{className:"sprite-placeholder sprite-icon-16 pull-left dui-icon"}),React.createElement("span",{className:"glyphicons fonticon glyphicons-bin barefonticon"})),"Trash")}}),Collections=React.createClass({displayName:"Collections",getDefaultProps:function(){},getInitialState:function(){var a=Zotero.state.getUrlVar("collectionKey");return{collections:null,currentCollectionKey:a,expandedCollections:{},loading:!1}},componentWillMount:function(){var a=this,b=this.props.library;Zotero.ui.widgets.reactcollections.reactInstance=a,b.listen("collectionsDirty",a.syncCollections,{}),b.listen("libraryCollectionsUpdated",function(){a.setState({collections:b.collections})},{}),b.listen("cachedDataLoaded",a.syncCollections,{})},returnToLibrary:function(a){a.preventDefault(),this.setState({currentCollectionKey:null}),Zotero.state.clearUrlVars(),Zotero.state.pushState()},syncCollections:function(a){Zotero.debug("react collections syncCollections",3);var b=this;if(!this.state.loading){var c=this.props.library;return this.setState({collections:c.collections,loading:!0}),c.loadUpdatedCollections().then(function(){b.setState({collections:c.collections,loading:!1}),c.trigger("libraryCollectionsUpdated")},function(a){Z.error("Error syncing collections"),Z.error(a),b.setState({collections:c.collections,loading:!1}),c.trigger("libraryCollectionsUpdated"),Zotero.ui.jsNotificationMessage("Error loading collections. Collections list may not be up to date","error")})}},render:function(){Z.debug("Collections render");var a=this.props.library,b=this.state.collections;if(null==b)return null;var c=this.state.collections.collectionsArray,d=this.state.currentCollectionKey,e=this.state.expandedCollections,f=[];if(null!==d)for(var g=b.getCollection(d),h=g;;){if(!h||h.topLevel)break;var i=h.get("parentCollection");h=b.getCollection(i),f.push(i),e[i]=!0}var j=[];c.forEach(function(a){a.topLevel&&j.push(React.createElement(CollectionRow,{key:a.get("key"),collection:a,selectedCollection:d,expandedCollections:e}))});var k="my-library "+(null==d?"current-collection":"");return React.createElement("div",{id:"collection-list-div",className:"collection-list-container"},React.createElement("ul",{id:"collection-list"},React.createElement("li",null,React.createElement("span",{className:"glyphicons fonticon glyphicons-inbox barefonticon"}),React.createElement("a",{onClick:this.returnToLibrary,className:k,href:a.libraryBaseWebsiteUrl},"Library")),j))}});Zotero.ui.widgets.reactcontrolPanel={},Zotero.ui.widgets.reactcontrolPanel.init=function(a){Z.debug("Zotero.eventful.init.controlPanel",3);var b=Zotero.ui.getAssociatedLibrary(a);ReactDOM.render(React.createElement(ControlPanel,{library:b}),document.getElementById("control-panel"))};var GroupsButton=React.createClass({displayName:"GroupsButton",render:function(){var a="/groups";return React.createElement("a",{className:"btn btn-default navbar-btn navbar-left",href:a,title:"Groups"},React.createElement("span",{className:"glyphicons fonticon glyphicons-group"}))}}),LibraryDropdown=React.createClass({displayName:"LibraryDropdown",getDefaultProps:function(){return{library:null,user:!1}},getInitialState:function(){return{accessibleLibraries:[],loading:!1,loaded:!1}},populateDropdown:function(){Z.debug("populateDropdown");var a=this;if(!this.state.loading&&!this.state.loaded){var b=this.props.library;if(null!=b){if(!Zotero.config.loggedIn)throw new Error("no logged in userID. Required for libraryDropdown widget");var c=Zotero.config.loggedInUser,d="u"+c.userID,e=Zotero.url.userWebLibrary(c.slug);Zotero.config.librarySettings.name;this.setState({loading:!0});b.groups.fetchUserGroups(c.userID).then(function(b){Z.debug("got member groups",3);var f=b.fetchedGroups,g=[];("user"!=Zotero.config.librarySettings.libraryType||Zotero.config.librarySettings.libraryID!=c.userID)&&g.push({name:"My Library",libraryString:d,webUrl:e});for(var h=0;h<f.length;h++)if("group"!=Zotero.config.librarySettings.libraryType||f[h].get("id")!=Zotero.config.librarySettings.libraryID){var i="g"+f[h].get("id");g.push({name:f[h].get("name"),libraryString:i,webUrl:Zotero.url.groupWebLibrary(f[h])})}a.setState({accessibleLibraries:g,loading:!1,loaded:!0})})["catch"](function(a){Z.error(a),Z.error(a.message)})}}},render:function(){if(0==this.props.user)return null;var a=Zotero.config.librarySettings.name,b=this.state.accessibleLibraries,c=b.map(function(a){return React.createElement("li",{key:a.libraryString},React.createElement("a",{role:"menuitem",href:a.webUrl},a.name))});return React.createElement("div",{id:"library-dropdown",className:"btn-group","data-widget":"libraryDropdown","data-library":this.props.library.libraryString},React.createElement("button",{className:"btn btn-default navbar-btn dropdown-toggle",onClick:this.populateDropdown,"data-toggle":"dropdown",href:"#",title:"Libraries"},React.createElement("span",{className:"glyphicons fonticon glyphicons-inbox"}),React.createElement("span",{className:"current-library-name"
},a),React.createElement("span",{className:"caret"})),React.createElement("ul",{className:"library-dropdown-list dropdown-menu actions-menu"},React.createElement("li",{hidden:!this.state.loading},React.createElement("a",{role:"menuitem",className:"clickable"},"Loading...")),c))}}),ActionsDropdown=React.createClass({displayName:"ActionsDropdown",getDefaultProps:function(){return{itemSelected:!1,selectedCollection:null,library:null,editable:!1}},trashOrDeleteItems:function(a){a.preventDefault(),Z.debug("move-to-trash clicked",3);var b,c=this.props.library,d=Zotero.state.getSelectedItemKeys(),e=c.items.getItems(d),f=[];if("trash"==Zotero.state.getUrlVar("collectionKey")){var g;for(g=0;g<e.length;g++){var h=e[g];h.get("deleted")&&f.push(h)}b=c.items.deleteItems(f)}else b=c.items.trashItems(e);return c.dirty=!0,b["catch"](function(){Z.error("Error trashing items")}).then(function(){Zotero.state.clearUrlVars(["collectionKey","tag","q"]),Zotero.state.pushState(!0),c.trigger("displayedItemsChanged")})["catch"](Zotero.catchPromiseError),!1},removeFromTrash:function(a){Z.debug("remove-from-trash clicked",3);var b=this.props.library,c=Zotero.state.getSelectedItemKeys(),d=b.items.getItems(c),e=b.items.untrashItems(d);return b.dirty=!0,e["catch"](function(){}).then(function(){Z.debug("post-removeFromTrash always execute: clearUrlVars",3),Zotero.state.clearUrlVars(["collectionKey","tag","q"]),Zotero.state.pushState(),b.trigger("displayedItemsChanged")})["catch"](Zotero.catchPromiseError),!1},removeFromCollection:function(a){Z.debug("remove-from-collection clicked",3);var b=this.props.library,c=Zotero.state.getSelectedItemKeys(),d=Zotero.state.getUrlVar("collectionKey"),e=[];return c.forEach(function(a,c){var f=b.items.getItem(a);f.removeFromCollection(d),e.push(f)}),b.dirty=!0,b.items.writeItems(e).then(function(){Z.debug("removal responses finished. forcing reload",3),Zotero.state.clearUrlVars(["collectionKey","tag"]),Zotero.state.pushState(!0),b.trigger("displayedItemsChanged")})["catch"](Zotero.catchPromiseError),!1},triggerLibraryEvent:function(a){var b=J(a.target).data("triggers");this.props.library.trigger(b)},triggerSync:function(){this.props.library.trigger("syncLibary")},triggerDeleteIdb:function(){this.props.library.trigger("deleteIdb")},render:function(){var a=(this.props.library,this.props.editable),b=this.props.itemSelected,c=this.props.selectedCollection,d=null!=c,e=a&&b&&"trash"==c,f=a&&b&&"trash"!=c,g=a&&b,h=a&&d;return React.createElement("div",{className:"btn-group"},React.createElement("button",{className:"btn btn-default navbar-btn dropdown-toggle","data-toggle":"dropdown",href:"#",title:"Actions"},"Actions",React.createElement("span",{className:"caret"})),React.createElement("ul",{className:"dropdown-menu actions-menu"},React.createElement("li",{hidden:!g},React.createElement("a",{href:"#",role:"menuitem",className:"add-to-collection-button",onClick:this.triggerLibraryEvent,"data-triggers":"addToCollectionDialog",title:"Add to Collection"},"Add to Collection")),React.createElement("li",{hidden:!(g&&h)},React.createElement("a",{onClick:this.removeFromCollection,href:"#",className:"remove-from-collection-button",title:"Remove from Collection"},"Remove from Collection")),React.createElement("li",{hidden:!f},React.createElement("a",{onClick:this.trashOrDeleteItems,href:"#",className:"move-to-trash-button",title:"Move to Trash"},"Move to Trash")),React.createElement("li",{hidden:!e},React.createElement("a",{onClick:this.trashOrDeleteItems,href:"#",className:"permanently-delete-button",title:"Move to Trash"},"Permanently Delete")),React.createElement("li",{hidden:!e},React.createElement("a",{onClick:this.removeFromTrash,href:"#",className:"remove-from-trash-button",title:"Remove from Trash"},"Remove from Trash")),React.createElement("li",{className:"divider",hidden:!g}),React.createElement("li",null,React.createElement("a",{className:"create-collection-button",href:"#",onClick:this.triggerLibraryEvent,"data-triggers":"createCollectionDialog",title:"New Collection"},"Create Collection")),React.createElement("li",{hidden:!h},React.createElement("a",{href:"#",className:"update-collection-button",onClick:this.triggerLibraryEvent,"data-triggers":"updateCollectionDialog",title:"Change Collection"},"Rename Collection")),React.createElement("li",{hidden:!h},React.createElement("a",{href:"#",className:"delete-collection-button",onClick:this.triggerLibraryEvent,"data-triggers":"deleteCollectionDialog",title:"Delete Collection"},"Delete Collection")),React.createElement("li",{className:"divider"}),React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.triggerLibraryEvent,"data-triggers":"librarySettingsDialog"},"Library Settings")),React.createElement("li",null,React.createElement("a",{href:"#",className:"cite-button",onClick:this.triggerLibraryEvent,"data-triggers":"citeItems"},"Cite")),React.createElement("li",null,React.createElement("a",{href:"#",className:"export-button",onClick:this.triggerLibraryEvent,"data-triggers":"exportItemsDialog"},"Export")),React.createElement("li",{className:"divider selected-item-action"}),React.createElement("li",{className:"selected-item-action",hidden:!g},React.createElement("a",{href:"#",className:"send-to-library-button",onClick:this.triggerLibraryEvent,"data-triggers":"sendToLibraryDialog",title:"Copy to Library"},"Copy to Library")),React.createElement("li",{className:"divider",hidden:!g}),React.createElement("li",null,React.createElement("a",{href:"#","data-triggers":"syncLibrary",onClick:this.triggerLibraryEvent},"Sync")),React.createElement("li",null,React.createElement("a",{href:"#","data-triggers":"deleteIdb",onClick:this.triggerLibraryEvent},"Delete IDB"))))}}),CreateItemDropdown=React.createClass({displayName:"CreateItemDropdown",getDefaultProps:function(){return{editable:!1}},createItem:function(a){Z.debug("create-item-Link clicked",3),a.preventDefault();var b=this.props.library,c=J(a.target).data("itemtype");return b.trigger("createItem",{itemType:c}),!1},render:function(){var a=this,b=Object.keys(Zotero.Item.prototype.typeMap);b=b.sort();var c=b.map(function(b,c){return React.createElement("li",{key:b},React.createElement("a",{onClick:a.createItem,href:"#","data-itemtype":b},Zotero.Item.prototype.typeMap[b]))}),d="create-item-button btn btn-default navbar-btn dropdown-toggle";return"trash"==Zotero.state.getUrlVar("collectionKey")&&(d+=" disabled"),React.createElement("div",{className:"btn-group create-item-dropdown",hidden:!this.props.editable},React.createElement("button",{type:"button",className:d,"data-toggle":"dropdown",title:"New Item"},React.createElement("span",{className:"glyphicons fonticon glyphicons-plus"})),React.createElement("ul",{className:"dropdown-menu",role:"menu",style:{maxHeight:"300px",overflow:"auto"}},c))}}),ControlPanel=React.createClass({displayName:"ControlPanel",componentWillMount:function(){var a=this,b=this.props.library;a.setState({user:Zotero.config.loggedInUser}),b.listen("selectedItemsChanged",function(b){Z.debug("got selectedItemsChanged event in ControlPanel - setting selectedItems"),Z.debug(b);var c=b.data.selectedItemKeys;a.setState({selectedItems:c})},{}),b.listen("selectedCollectionChanged",function(b){var c=Zotero.state.getUrlVar("collectionKey"),d=Zotero.state.getSelectedItemKeys();a.setState({selectedCollection:c,selectedItems:d})},{})},getDefaultProps:function(){return{editable:!1}},getInitialState:function(){var a=Zotero.state.getSelectedItemKeys();return{user:!1,selectedItems:a,selectedCollection:null}},render:function(){return React.createElement("div",{id:"control-panel",className:"nav navbar-nav",role:"navigation"},React.createElement("div",{className:"btn-toolbar navbar-left"},React.createElement(GroupsButton,{library:this.props.library}),React.createElement(LibraryDropdown,{user:this.state.user,library:this.props.library}),React.createElement(ActionsDropdown,{library:this.props.library,itemSelected:this.state.selectedItems.length>0,selectedCollection:this.state.selectedCollection,editable:this.props.editable}),React.createElement(CreateItemDropdown,{library:this.props.library,editable:this.props.editable})))}});Zotero.ui.widgets.reactcreateCollectionDialog={},Zotero.ui.widgets.reactcreateCollectionDialog.init=function(a){Z.debug("createcollectionsdialog widget init",3);var b=Zotero.ui.getAssociatedLibrary(a);ReactDOM.render(React.createElement(CreateCollectionDialog,{library:b}),document.getElementById("create-collection-dialog"))};var CreateCollectionDialog=React.createClass({displayName:"CreateCollectionDialog",componentWillMount:function(){var a=this,b=this.props.library;b.listen("createCollectionDialog",function(){a.forceUpdate(),a.openDialog()},{})},getInitialState:function(){return{collectionName:"",parentCollection:null}},handleCollectionChange:function(a){Z.debug(a),Z.debug(a.target.value),this.setState({parentCollection:a.target.value})},handleNameChange:function(a){this.setState({collectionName:a.target.value})},openDialog:function(){this.refs.modal.open()},closeDialog:function(a){this.refs.modal.close()},createCollection:function(){Z.debug("react createCollection");var a=this,b=this.props.library,c=this.state.parentCollection,d=this.state.collectionName;""==d&&(d="Untitled"),b.addCollection(d,c).then(function(c){b.collections.initSecondaryData(),b.trigger("libraryCollectionsUpdated"),Zotero.state.pushState(),a.closeDialog(),Zotero.ui.jsNotificationMessage("Collection Created","success")})["catch"](function(b){Zotero.ui.jsNotificationMessage("There was an error creating the collection.","error"),a.closeDialog()})},render:function(){var a=this.props.library,b=a.collections.nestedOrderingArray(),c=b.map(function(a,b){return React.createElement("option",{key:a.get("key"),value:a.get("key")},"-".repeat(a.nestingDepth)," ",a.get("name"))});return c.unshift(React.createElement("option",{key:"emptyvalue",value:""},"None")),React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"create-collection-dialog",className:"create-collection-dialog",role:"dialog",title:"Create Collection","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",null,"Create Collection")),React.createElement("div",{className:"new-collection-div modal-body","data-role":"content"},React.createElement("form",{method:"POST"},React.createElement("div",{"data-role":"fieldcontain"},React.createElement("label",{htmlFor:"new-collection-title-input"},"Collection Name"),React.createElement("input",{onChange:this.handleNameChange,className:"new-collection-title-input form-control",type:"text"})),React.createElement("div",{"data-role":"fieldcontain"},React.createElement("label",{htmlFor:"new-collection-parent"},"Parent Collection"),React.createElement("select",{onChange:this.handleCollectionChange,className:"collectionKey-select new-collection-parent form-control",defaultValue:""},c)))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{onClick:this.closeDialog,className:"btn","data-dismiss":"modal","aria-hidden":"true"},"Close"),React.createElement("button",{onClick:this.createCollection,className:"btn btn-primary createButton"},"Create"))))))}});Zotero.ui.widgets.reactcreateItemDialog={},Zotero.ui.widgets.reactcreateItemDialog.init=function(a){Z.debug("createItemDialog widget init",3);var b=Zotero.ui.getAssociatedLibrary(a);ReactDOM.render(React.createElement(CreateItemDialog,{library:b}),document.getElementById("create-item-dialog"))};var CreateItemDialog=React.createClass({displayName:"CreateItemDialog",componentWillMount:function(){var a=this,b=this.props.library;b.listen("createItem",function(b){Z.debug("Opening createItem dialog"),Z.debug(b);var c=b.data.itemType;Z.debug(c),a.setState({itemType:c}),a.openDialog()},{})},getInitialState:function(){return{title:"",itemType:"document"}},handleTitleChange:function(a){this.setState({title:a.target.value})},createItem:function(){var a=this,b=this.props.library,c=this.state.itemType,d=Zotero.state.getUrlVar("collectionKey"),e=a.state.title;""==e&&(e="Untitled");var f=new Zotero.Item;f.initEmpty(c).then(function(){return Z.debug("empty item initialized; associating with library and giving title"),f.associateWithLibrary(b),Z.debug(1),f.set("title",e),Z.debug("2"),d&&f.addToCollection(d),Z.debug("saving item"),Zotero.ui.saveItem(f)}).then(function(b){var c=f.get("key");Zotero.state.setUrlVar("itemKey",c),Zotero.state.pushState(),a.closeDialog()})["catch"](function(b){Zotero.error(b),Zotero.ui.jsNotificationMessage("There was an error creating the item.","error"),a.closeDialog()})},openDialog:function(){this.refs.modal.open()},closeDialog:function(a){this.refs.modal.close()},render:function(){return React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"create-item-dialog",className:"create-item-dialog",role:"dialog",title:"Create Item","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",null,"Create Item")),React.createElement("div",{className:"new-item-div modal-body","data-role":"content"},React.createElement("form",{method:"POST"},React.createElement("div",{"data-role":"fieldcontain"},React.createElement("label",{htmlFor:"new-item-title-input"},"Title"),React.createElement("input",{onChange:this.handleTitleChange,id:"new-item-title-input",className:"new-item-title-input form-control",type:"text"})))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{className:"btn","data-dismiss":"modal","aria-hidden":"true"},"Close"),React.createElement("button",{onClick:this.createItem,className:"btn btn-primary createButton"},"Create"))))))}});Zotero.ui.widgets.reactdeleteCollectionDialog={},Zotero.ui.widgets.reactdeleteCollectionDialog.init=function(a){Z.debug("deletecollectionsdialog widget init",3);var b=Zotero.ui.getAssociatedLibrary(a);ReactDOM.render(React.createElement(DeleteCollectionDialog,{library:b}),document.getElementById("delete-collection-dialog"))};var DeleteCollectionDialog=React.createClass({displayName:"DeleteCollectionDialog",componentWillMount:function(){var a=this,b=this.props.library;b.listen("deleteCollectionDialog",function(){a.setState({collectionKey:Zotero.state.getUrlVar("collectionKey")}),a.openDialog()})},getInitialState:function(){return{collectionKey:null}},handleCollectionChange:function(a){this.setState({parentCollection:a.target.value})},deleteCollection:function(){Z.debug("DeleteCollectionDialog.deleteCollection",3);var a=this,b=this.props.library,c=b.collections.getCollection(this.state.collectionKey);return c?(c.remove().then(function(){delete Zotero.state.pathVars.collectionKey,b.collections.dirty=!0,b.collections.initSecondaryData(),Zotero.state.pushState(),Zotero.ui.jsNotificationMessage(c.get("title")+" removed","confirm"),a.closeDialog()})["catch"](Zotero.catchPromiseError),!1):(Zotero.ui.jsNotificationMessage("Selected collection not found","error"),!1)},openDialog:function(){this.state.collectionKey||Z.error("DeleteCollectionDialog opened with no collectionKey"),this.refs.modal.open()},closeDialog:function(a){this.refs.modal.close()},render:function(){var a=this.props.library,b=a.collections.getCollection(this.state.collectionKey);return b?React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"delete-collection-dialog",className:"delete-collection-dialog",role:"dialog",title:"Delete Collection","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",null,"Delete Collection")),React.createElement("div",{className:"delete-collection-div modal-body"},React.createElement("p",null,'Really delete collection "',b.get("title"),'"?')),React.createElement("div",{className:"modal-footer"},React.createElement("button",{className:"btn","data-dismiss":"modal","aria-hidden":"true"},"Close"),React.createElement("button",{onClick:this.deleteCollection,className:"btn btn-primary deleteButton"},"Delete")))))):null}});Zotero.ui.widgets.reactexportItemsDialog={},Zotero.ui.widgets.reactexportItemsDialog.init=function(a){Z.debug("exportItemDialog widget init",3);var b=Zotero.ui.getAssociatedLibrary(a);ReactDOM.render(React.createElement(ExportItemsDialog,{library:b}),document.getElementById("export-dialog"))};var ExportItemsDialog=React.createClass({displayName:"ExportItemsDialog",componentWillMount:function(){var a=this,b=this.props.library;b.listen("exportItemsDialog",function(){Z.debug("opening export dialog"),a.openDialog()},{}),b.listen("displayedItemsChanged",function(){a.forceUpdate()},{})},getInitialState:function(){return{}},openDialog:function(){this.refs.modal.open()},closeDialog:function(a){this.refs.modal.close()},render:function(){var a=this.props.library,b=Zotero.ui.getItemsConfig(a),c=Zotero.url.exportUrls(b),d=Object.keys(c).map(function(a){var b=c[a];return React.createElement("li",{key:a},React.createElement("a",{href:b,target:"_blank",className:"export-link","data-exportformat":a},Zotero.config.exportFormatsMap[a]))});return React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"export-items-dialog",className:"export-items-dialog",role:"dialog",title:"Library Settings","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",null,"Export")),React.createElement("div",{className:"modal-body","data-role":"content"},React.createElement("div",{className:"export-list"},React.createElement("ul",{id:"export-formats-ul"},d))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{className:"btn btn-default","data-dismiss":"modal","aria-hidden":"true"},"Close"))))))}}),FeedLink=React.createClass({displayName:"FeedLink",render:function(){var a,b=this.props.library,c=Zotero.ui.getItemsConfig(b),d=Zotero.ajax.apiRequestUrl(c)+Zotero.ajax.apiQueryString(c,!1),e=d.replace(Zotero.config.baseApiUrl,Zotero.config.baseFeedUrl),f=Zotero.url.requestReadApiKeyUrl(b.libraryType,b.libraryID,e);return a=Zotero.config.librarySettings.publish?e:f,React.createElement("p",null,React.createElement("a",{href:a,type:"application/atom+xml",rel:"alternate",className:"feed-link"},React.createElement("span",{className:"sprite-icon sprite-feed"}),"Subscribe to this feed"))}});Zotero.ui.widgets.reactfilterGuide={},Zotero.ui.widgets.reactfilterGuide.init=function(a){Z.debug("widgets.filterGuide.init",3);var b=Zotero.ui.getAssociatedLibrary(a);ReactDOM.render(React.createElement(FilterGuide,{library:b}),document.getElementById("filter-guide"))};var FilterGuide=React.createClass({displayName:"FilterGuide",componentWillMount:function(){var a=this,b=this.props.library;b.listen("displayedItemsChanged",a.refreshFilters,{}),b.listen("displayedItemChanged",a.refreshFilters,{}),b.listen("updateFilterGuide",a.refreshFilters,{}),b.listen("selectedCollectionChanged",a.refreshFilters,{}),b.listen("cachedDataLoaded",a.refreshFilters,{}),b.listen("libraryCollectionsUpdated",a.refreshFilters,{})},getInitialState:function(){return{collectionKey:"",tags:[],query:""}},refreshFilters:function(a){var b=this.props.library,c=Zotero.ui.getItemsConfig(b);this.setState({collectionKey:c.collectionKey,tags:c.tag,query:c.q})},clearFilter:function(a){a.preventDefault(),Z.debug("widgets.filterGuide.clearFilter",3);var b=this.props.library,c=J(a.currentTarget),d=c.data("collectionkey"),e=c.data("tag"),f=c.data("query");return d&&(Zotero.state.unsetUrlVar("collectionKey"),this.setState({collectionKey:""})),e&&(Zotero.state.toggleTag(e),this.setState({tags:Zotero.state.getUrlVar("tag")})),f?(b.trigger("clearLibraryQuery"),void this.setState({query:""})):void Zotero.state.pushState()},render:function(){var a=this.props.library,b=null,c=null,d=null;if(""!=this.state.collectionKey){var e=a.collections.getCollection(this.state.collectionKey);e&&(b=React.createElement("li",{className:"filterguide-entry"},React.createElement("a",{onClick:this.clearFilter,href:"#","data-collectionkey":this.state.collectionKey},React.createElement("span",{className:"glyphicons fonticon glyphicons-folder-open"}),React.createElement("span",{className:"filterguide-label"},e.get("name")),React.createElement("span",{className:"glyphicons fonticon glyphicons-remove"}))))}return this.state.tags&&(c=this.state.tags.map(function(a){return React.createElement("li",{className:"filterguide-entry"},React.createElement("a",{onClick:this.clearFilter,href:"#","data-tag":a},React.createElement("span",{className:"glyphicons fonticon glyphicons-tag"}),React.createElement("span",{className:"filterguide-label"},a),React.createElement("span",{className:"glyphicons fonticon glyphicons-remove"})))})),this.state.query&&(d=React.createElement("li",{className:"filterguide-entry"},React.createElement("a",{onClick:this.clearFilter,href:"#","data-query":this.state.query},React.createElement("span",{className:"glyphicons fonticon glyphicons-search"}),React.createElement("span",{className:"filterguide-label"},this.state.query),React.createElement("span",{className:"glyphicons fonticon glyphicons-remove"})))),React.createElement("div",{id:"filter-guide",className:"filter-guide col-12"},React.createElement("ul",{className:"filterguide-list"},b,c,d))}});Zotero.ui.widgets.reactitem={},Zotero.ui.widgets.reactitem.init=function(a){var b=Zotero.ui.getAssociatedLibrary(a);ReactDOM.render(React.createElement(ItemDetails,{library:b}),document.getElementById("item-widget-div"))},Zotero.ui.editMatches=function(a,b){return null===a||null===b?!1:b.field!=a.field?!1:b.creatorIndex!=a.creatorIndex?!1:a.tagIndex!=b.tagIndex?!1:!0},Zotero.ui.genericDisplayedFields=function(a){var b=Object.keys(a.apiObj.data).filter(function(b){return-1!=a.hideFields.indexOf(b)?!1:a.fieldMap.hasOwnProperty(b)?"title"==b||"creators"==b||"itemType"==b?!1:!0:!1});return b},Zotero.ui.widgets.reactitem.editFields=function(a){var b=[{field:"itemType"},{field:"title"}],c=a.get("creators");c.forEach(function(a,c){b.push({field:"creatorType",creatorIndex:c}),a.name?b.push({field:"name",creatorIndex:c}):(b.push({field:"lastName",creatorIndex:c}),b.push({field:"firstName",creatorIndex:c}))});var d=Zotero.ui.genericDisplayedFields(a);return d.forEach(function(a){b.push({field:a})}),b},Zotero.ui.widgets.reactitem.nextEditField=function(a,b){if(!b||!b.field)return null;for(var c,d=Zotero.ui.widgets.reactitem.editFields(a),e=0;e<d.length;e++)d[e].field==b.field&&d[e].creatorIndex==b.creatorIndex&&(c=e);return c==d.length?d[0]:d[e+1]};var CreatorRow=React.createClass({displayName:"CreatorRow",getDefaultProps:function(){return{item:null,library:null,creatorIndex:0,edit:null}},render:function(){if(null==this.props.item)return null;var a=this.props.item,b=a.get("creators")[this.props.creatorIndex],c=null;return c=b.name&&""!=b.name?React.createElement(ItemField,_extends({},this.props,{key:"name",field:"name"})):[React.createElement(ItemField,_extends({},this.props,{key:"lastName",field:"lastName"})),", ",React.createElement(ItemField,_extends({},this.props,{key:"firstName",field:"firstName"}))],React.createElement("tr",{className:"creator-row"},React.createElement("th",null,React.createElement(ItemField,_extends({},this.props,{field:"creatorType"}))),React.createElement("td",null,c,React.createElement("div",{className:"btn-toolbar",role:"toolbar"},React.createElement(ToggleCreatorFieldButton,this.props),React.createElement(AddRemoveCreatorFieldButtons,this.props))))}}),ToggleCreatorFieldButton=React.createClass({displayName:"ToggleCreatorFieldButton",render:function(){return React.createElement("div",{className:"btn-group"},React.createElement("button",{type:"button",className:"switch-two-field-creator-link btn btn-default",title:"Toggle single field creator","data-itemkey":this.props.item.get("key"),"data-creatorindex":this.props.creatorIndex,onClick:this.switchCreatorFields},React.createElement("span",{className:"fonticon glyphicons glyphicons-unchecked"})))},switchCreatorFields:function(a){var b=this.props.creatorIndex,c=this.props.item,d=c.get("creators"),e=d[b];if(void 0!==e.name){var f=e.name.split(" ");f.length>1?(e.lastName=f.splice(-1,1)[0],e.firstName=f.join(" ")):(e.lastName=e.name,e.firstName=""),delete e.name}else""===e.firstName&&""===e.lastName?e.name="":e.name=e.firstName+" "+e.lastName,delete e.firstName,delete e.lastName;d[b]=e,Zotero.ui.saveItem(c),Zotero.ui.widgets.reactitem.reactInstance.setState({item:c})}}),AddRemoveCreatorFieldButtons=React.createClass({displayName:"AddRemoveCreatorFieldButtons",render:function(){return React.createElement("div",{className:"btn-group"},React.createElement("button",{type:"button",className:"btn btn-default","data-creatorindex":this.props.creatorIndex,onClick:this.removeCreator},React.createElement("span",{className:"fonticon glyphicons glyphicons-minus"})),React.createElement("button",{type:"button",className:"btn btn-default","data-creatorindex":this.props.creatorIndex,onClick:this.addCreator},React.createElement("span",{className:"fonticon glyphicons glyphicons-plus"})))},addCreator:function(a){Z.debug("addCreator");var b=this.props.item,c=this.props.creatorIndex,d=b.get("creators"),e={creatorType:"author",firstName:"",lastName:""};d.splice(c+1,0,e),Zotero.ui.widgets.reactitem.reactInstance.setState({item:b,edit:{field:"lastName",creatorIndex:c+1}})},removeCreator:function(a){Z.debug("removeCreator");var b=this.props.creatorIndex,c=this.props.item,d=c.get("creators");d.splice(b,1),Zotero.ui.saveItem(c),Zotero.ui.widgets.reactitem.reactInstance.setState({item:c})}}),ItemNavTabs=React.createClass({displayName:"ItemNavTabs",getDefaultProps:function(){return{item:null}},render:function(){return Z.debug("ItemNavTabs render"),null==this.props.item?null:this.props.item.isSupplementaryItem()?null:React.createElement("ul",{className:"nav nav-tabs",role:"tablist"},React.createElement("li",{role:"presentation",className:"active"},React.createElement("a",{href:"#item-info-panel","aria-controls":"item-info-panel",role:"tab","data-toggle":"tab"},"Info")),React.createElement("li",{role:"presentation"},React.createElement("a",{href:"#item-children-panel","aria-controls":"item-children-panel",role:"tab","data-toggle":"tab"},"Children")),React.createElement("li",{role:"presentation"},React.createElement("a",{href:"#item-tags-panel","aria-controls":"item-tags-panel",role:"tab","data-toggle":"tab"},"Tags")))}}),ItemFieldRow=React.createClass({displayName:"ItemFieldRow",getDefaultProps:function(){return{item:null,edit:null}},render:function(){var a=this.props.item,b=this.props.field,c=React.createElement(ItemField,{item:a,field:b,edit:this.props.edit});if("url"==b){var d=a.get("url");return React.createElement("tr",null,React.createElement("th",null,React.createElement("a",{rel:"nofollow",href:d},a.fieldMap[b])),React.createElement("td",{className:b},c))}if("DOI"==b){var e=a.get("DOI");return React.createElement("tr",null,React.createElement("th",null,React.createElement("a",{rel:"nofollow",href:"http://dx.doi.org/"+e},a.fieldMap[b])),React.createElement("td",{className:b},c))}return Zotero.config.richTextFields[b]?React.createElement("tr",null,React.createElement("th",null,a.fieldMap[b],"}"),React.createElement("td",{className:b},c)):React.createElement("tr",null,React.createElement("th",null,a.fieldMap[b]||b),React.createElement("td",{className:b},c))}}),ItemField=React.createClass({displayName:"ItemField",getDefaultProps:function(){return{item:null,field:null,edit:null,creatorIndex:null,tagIndex:null}},handleChange:function(a){Z.debug("change on ItemField"),Z.debug(a);var b=this.props.item;switch(this.props.field){case"creatorType":case"name":case"firstName":case"lastName":var c=b.get("creators"),d=c[this.props.creatorIndex];d[this.props.field]=a.target.value;break;case"tag":var e=b.get("tags"),f=e[this.props.tagIndex];f.tag=a.target.value;break;default:b.set(this.props.field,a.target.value)}Zotero.ui.widgets.reactitem.reactInstance.setState({item:b})},handleBlur:function(a){Z.debug("blur on ItemField"),Z.debug("handleBlur"),this.handleChange(a),Zotero.ui.widgets.reactitem.reactInstance.setState({edit:null}),Zotero.ui.saveItem(this.props.item)},handleFocus:function(a){Z.debug("focus on ItemField");var b=J(a.target).data("field"),c=J(a.target).data("creatorindex"),d=J(a.target).data("tagindex"),e={field:b,creatorIndex:c,tagIndex:d};Z.debug(e),Zotero.ui.widgets.reactitem.reactInstance.setState({edit:e})},checkKey:function(a){Z.debug("ItemField checkKey"),a.stopPropagation(),a.keyCode===Zotero.ui.keyCode.ENTER&&(Z.debug("ItemField checkKey enter"),Z.debug(a),J(a.target).blur())},render:function(){var a,b=this.props.item,c=this.props.field,d=!1,e=!1;switch(c){case"creatorType":case"name":case"firstName":case"lastName":d=!0;var f=this.props.creatorIndex,g=b.get("creators")[f];a=g[c];var h={name:"(name)",lastName:"(Last Name)",firstName:"(First Name)"};break;case"tag":e=!0;var i=this.props.tagIndex,j=b.get("tags")[i];a=j.tag;break;default:a=b.get(c)}var k=Zotero.ui.editMatches(this.props,this.props.edit);if(!k){var l={className:"editable-item-field",tabIndex:0,"data-field":c,onFocus:this.handleFocus},m=null;return d?(l.className+=" creator-field",l["data-creatorindex"]=this.props.creatorIndex,m=""==a?h[c]:a):e?(l.className+=" tag-field",l["data-tagindex"]=this.props.tagIndex,m=a):m=""==a?React.createElement("div",{className:"empty-field-placeholder"}):Zotero.ui.formatItemField(c,b),React.createElement("span",l,m)}var n=function(a){null!=a&&a.focus()},o={className:"form-control item-field-control "+this.props.field,name:c,defaultValue:a,onKeyDown:this.checkKey,onBlur:this.handleBlur,creatorindex:this.props.creatorIndex,tagindex:this.props.tagIndex,ref:n};switch(d&&(o.placeholder=h[c]),this.props.field){case null:return null;case"itemType":var p=b.itemTypes.map(function(a){return React.createElement("option",{key:a.itemType,label:a.localized,value:a.itemType},a.localized)});return React.createElement("select",o,p);case"creatorType":var q=b.creatorTypes[b.get("itemType")].map(function(a){return React.createElement("option",{key:a.creatorType,label:a.localized,value:a.creatorType},a.localized)});return React.createElement("select",_extends({id:"creatorType"},o,{"data-creatorindex":this.props.creatorIndex}),q);default:return Zotero.config.largeFields[this.props.field]?React.createElement("textarea",o):Zotero.config.richTextFields[this.props.field]?React.createElement("textarea",_extends({},o,{className:"rte default"})):React.createElement("input",_extends({type:"text"},o))}}}),ItemInfoPanel=React.createClass({displayName:"ItemInfoPanel",getDefaultProps:function(){return{item:null,loading:!1,edit:null}},render:function(){Z.debug("ItemInfoPanel render");var a=this,b=this.props.library,c=this.props.item;Z.debug("ItemInfoPanel render: items.totalResults: "+b.items.totalResults);var d=React.createElement("p",{className:"item-count",hidden:!this.props.libraryItemsLoaded},b.items.totalResults+" items in this view"),e=this.props.edit;if(null==c)return React.createElement("div",{id:"item-info-panel",role:"tabpanel",className:"item-details-div tab-pane active"
},React.createElement(LoadingSpinner,{loading:this.props.loading}),d);var f=c.get("key"),g=c.owningLibrary.libraryType,h=!1;c.get("parentItem")&&(h=b.websiteUrl({itemKey:c.get("parentItem")}));var i,j=h?React.createElement("a",{href:h,className:"item-select-link","data-itemkey":c.get("parentItem")},"Parent Item"):null;i="user"==g?React.createElement("span",{id:"libraryUserID",title:c.apiObj.library.id}):React.createElement("span",{id:"libraryGroupID",title:c.apiObj.library.id});var k=null;"group"==g&&(k=React.createElement("tr",null,React.createElement("th",null,"Added by"),React.createElement("td",{className:"user-creator"},React.createElement("a",{href:c.apiObj.meta.createdByUser.links.alternate.href,className:"user-link"},c.apiObj.meta.createdByUser.name))));var l=[],m=c.get("creators");0==m.length&&m.push({lastName:"",firstName:""}),l=c.isSupplementaryItem()?null:c.get("creators").map(function(a,d){return React.createElement(CreatorRow,{key:d,library:b,creatorIndex:d,item:c,edit:e})});var n=[],o=Zotero.ui.genericDisplayedFields(c);o.forEach(function(b){n.push(React.createElement(ItemFieldRow,_extends({key:b},a.props,{field:b})))});var p=["itemType","title"].map(function(b){return React.createElement(ItemFieldRow,_extends({key:b},a.props,{field:b}))});return React.createElement("div",{id:"item-info-panel",role:"tabpanel",className:"item-details-div tab-pane active"},React.createElement(LoadingSpinner,{loading:this.props.loading}),j,i,React.createElement("table",{className:"item-info-table table","data-itemkey":f},React.createElement("tbody",null,k,p,l,n)))}}),TagListRow=React.createClass({displayName:"TagListRow",getDefaultProps:function(){return{tagIndex:0,tag:{tag:""},item:null,library:null,edit:null}},removeTag:function(a){var b=(this.props.tag.tag,this.props.item),c=this.props.tagIndex,d=b.get("tags");d.splice(c,1),Zotero.ui.saveItem(b),Zotero.ui.widgets.reactitem.reactInstance.setState({item:b})},render:function(){return React.createElement("div",{className:"row item-tag-row"},React.createElement("div",{className:"col-xs-1"},React.createElement("span",{className:"glyphicons fonticon glyphicons-tag"})),React.createElement("div",{className:"col-xs-9"},React.createElement(ItemField,_extends({},this.props,{field:"tag"}))),React.createElement("div",{className:"col-xs-2"},React.createElement("button",{type:"button",className:"remove-tag-link btn btn-default",onClick:this.removeTag},React.createElement("span",{className:"glyphicons fonticon glyphicons-minus"}))))}}),ItemTagsPanel=React.createClass({displayName:"ItemTagsPanel",getInitialState:function(){return{newTagString:""}},newTagChange:function(a){this.setState({newTagString:a.target.value})},checkKey:function(a){if(Z.debug("New tag checkKey"),a.stopPropagation(),a.keyCode===Zotero.ui.keyCode.ENTER){Z.debug(a);var b=this.props.item,c=b.get("tags");c.push({tag:a.target.value}),Zotero.ui.saveItem(b),this.setState({newTagString:""}),Zotero.ui.widgets.reactitem.reactInstance.setState({item:b})}},render:function(){Z.debug("ItemTagsPanel render");var a=this,b=this.props.item;this.props.library;if(null==b)return React.createElement("div",{id:"item-tags-panel",role:"tabpanel",className:"item-tags-div tab-pane"});var c=b.apiObj.data.tags.map(function(b,c){return React.createElement(TagListRow,_extends({key:b.tag},a.props,{tag:b,tagIndex:c}))});return React.createElement("div",{id:"item-tags-panel",role:"tabpanel",className:"item-tags-div tab-pane"},React.createElement("p",null,React.createElement("span",{className:"tag-count"},b.get("tags").length)," tags"),React.createElement("button",{className:"add-tag-button btn btn-default"},"Add Tag"),React.createElement("div",{className:"item-tags-list"},c),React.createElement("div",{className:"add-tag-form form-horizontal"},React.createElement("div",{className:"form-group"},React.createElement("div",{className:"col-xs-1"},React.createElement("label",{htmlFor:"add-tag-input"},React.createElement("span",{className:"glyphicons fonticon glyphicons-tag"}))),React.createElement("div",{className:"col-xs-11"},React.createElement("input",{type:"text",onKeyDown:this.checkKey,onChange:this.newTagChange,value:this.state.newTagString,id:"add-tag-input",className:"add-tag-input form-control"})))))}}),ItemChildrenPanel=React.createClass({displayName:"ItemChildrenPanel",getDefaultProps:function(){return{childItems:[]}},triggerUpload:function(){this.props.library.trigger("uploadAttachment")},render:function(){Z.debug("ItemChildrenPanel render");var a=this.props.childItems.map(function(a){var b=a.get("title"),c=Zotero.url.itemHref(a),d=a.itemTypeIconClass(),e=a.get("key");if("note"==a.itemType)return React.createElement("li",{key:e},React.createElement("span",{className:"fonticon barefonticon "+d}),React.createElement("a",{className:"item-select-link","data-itemkey":a.get("key"),href:c,title:b},b));if(0==a.attachmentDownloadUrl)return React.createElement("li",{key:e},React.createElement("span",{className:"fonticon barefonticon "+d}),b,"(",React.createElement("a",{className:"item-select-link","data-itemkey":a.get("key"),href:c,title:b},"Attachment Details"),")");var f=Zotero.url.attachmentDownloadUrl(a);return React.createElement("li",{key:e},React.createElement("span",{className:"fonticon barefonticon "+d}),React.createElement("a",{className:"itemdownloadlink",href:f},b," ",Zotero.url.attachmentFileDetails(a)),"(",React.createElement("a",{className:"item-select-link","data-itemkey":a.get("key"),href:c,title:b},"Attachment Details"),")")});return React.createElement("div",{id:"item-children-panel",role:"tabpanel",className:"item-children-div tab-pane"},React.createElement("ul",{id:"notes-and-attachments"},a),React.createElement("button",{type:"button",onClick:this.triggerUpload,id:"upload-attachment-link",className:"btn btn-primary upload-attachment-button",hidden:!Zotero.config.librarySettings.allowUpload},"Upload File"))}}),ItemDetails=React.createClass({displayName:"ItemDetails",getInitialState:function(){return{item:null,childItems:[],itemLoading:!1,childrenLoading:!1,libraryItemsLoaded:!1,edit:null}},componentWillMount:function(){var a=this,b=this.props.library;Zotero.ui.widgets.reactitem.reactInstance=a,b.listen("displayedItemChanged modeChanged",a.loadItem,{}),b.listen("uploadSuccessful",a.refreshChildren,{}),b.listen("tagsChanged",a.updateTypeahead,{}),b.listen("showChildren",a.refreshChildren,{}),b.trigger("displayedItemChanged")},componentDidMount:function(){return},loadItem:function(){Z.debug("Zotero eventful loadItem",3);var a=this,b=this.props.library,c=Zotero.state.getUrlVar("itemKey");if(!c)return Z.debug("No itemKey - "+c,3),a.setState({item:null}),Promise.reject(new Error("No itemkey - "+c));var d,e=b.items.getItem(c);return e?(Z.debug("have item locally, loading details into ui",3),d=Promise.resolve(e)):(Z.debug("must fetch item from server",3),a.setState({itemLoading:!0}),d=b.loadItem(c)),d.then(function(a){e=a}).then(function(){return e.getCreatorTypes(e.get("itemType"))}).then(function(c){Z.debug("done loading necessary data; displaying item"),a.setState({item:e,itemLoading:!1}),b.trigger("showChildren");try{var d=document.createEvent("HTMLEvents");d.initEvent("ZoteroItemUpdated",!0,!0),document.dispatchEvent(d)}catch(f){Zotero.error("Error triggering ZoteroItemUpdated event")}}),d["catch"](function(a){Z.error("loadItem promise failed"),Z.error(a)}).then(function(){a.setState({itemLoading:!1})})["catch"](Zotero.catchPromiseError),d},refreshChildren:function(){Z.debug("reactitem.refreshChildren",3);var a=this,b=this.props.library,c=Zotero.state.getUrlVar("itemKey");if(!c)return Z.debug("No itemKey - "+c,3),Promise.reject(new Error("No itemkey - "+c));var d=b.items.getItem(c);a.setState({loadingChildren:!0});var e=d.getChildren(b).then(function(b){a.setState({childItems:b,loadingChildren:!1})})["catch"](Zotero.catchPromiseError);return e},updateTypeahead:function(){return void Z.debug("updateTypeahead",3)},addTagTypeahead:function(){Z.debug("adding typeahead",3);var a=this.props.library,b=a.tags.plainList;b||(b=[]);var c=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,local:J.map(b,function(a){return{value:a}})});c.initialize(),widgetEl.find("input.taginput").typeahead("destroy"),widgetEl.find("input.taginput").typeahead({hint:!0,highlight:!0,minLength:1},{name:"tags",displayKey:"value",source:c.ttAdapter()})},addTagTypeaheadToInput:function(){Z.debug("adding typeahead",3);var a=this.props.library,b=a.tags.plainList;b||(b=[]);var c=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,local:J.map(b,function(a){return{value:a}})});c.initialize(),J(element).typeahead("destroy"),J(element).typeahead({hint:!0,highlight:!0,minLength:1},{name:"tags",displayKey:"value",source:c.ttAdapter()})},render:function(){Z.debug("ItemDetails render");var a=this.props.library,b=this.state.item,c=this.state.childItems;return React.createElement("div",{role:"tabpanel"},React.createElement(ItemNavTabs,{library:a,item:b}),React.createElement("div",{className:"tab-content"},React.createElement(ItemInfoPanel,{library:a,item:b,loading:this.state.itemLoading,libraryItemsLoaded:this.state.libraryItemsLoaded,edit:this.state.edit}),React.createElement(ItemChildrenPanel,{library:a,childItems:c,loading:this.state.childrenLoading}),React.createElement(ItemTagsPanel,{library:a,item:b,edit:this.state.edit})))}});Zotero.ui.widgets.reactitems={},Zotero.ui.widgets.reactitems.init=function(a){Z.debug("widgets.items.init",3);var b=Zotero.ui.getAssociatedLibrary(a);ReactDOM.render(React.createElement(Items,{library:b}),document.getElementById("library-items-div"))},Zotero.ui.getItemsConfig=function(a){var b=["tag","collectionKey","order","sort","q","qmode"],c={};J.each(b,function(a,b){var d=Zotero.state.getUrlVar(b);d&&(c[b]=d)});var d={libraryID:a.libraryID,libraryType:a.libraryType,target:"items",targetModifier:"top",limit:a.preferences.getPref("itemsPerPage")},e={order:Zotero.preferences.getPref("order"),sort:Zotero.preferences.getPref("sort"),limit:a.preferences.getPref("itemsPerPage")},f=J.extend({},d,e,c);return"user"==a.libraryType&&-1!=Zotero.Library.prototype.groupOnlyColumns.indexOf(f.order)&&(f.order="title"),f.sort||(f.sort=Zotero.config.sortOrdering[f.order]),(f.tag||f.q)&&delete f.targetModifier,f};var Items=React.createClass({displayName:"Items",componentWillMount:function(){var a=this,b=this.props.library;b.listen("changeItemSorting",a.resortTriggered),b.listen("displayedItemsChanged",a.loadItems,{}),b.listen("displayedItemChanged",a.selectDisplayed),Zotero.listen("selectedItemsChanged",function(){a.setState({selectedItemKeys:Zotero.state.getSelectedItemKeys()})}),b.listen("selectedItemsChanged",function(){a.setState({selectedItemKeys:Zotero.state.getSelectedItemKeys()})}),b.listen("selectedCollectionChanged",function(){Zotero.state.selectedItemKeys=[],b.trigger("selectedItemsChanged",{selectedItemKeys:[]})}),b.listen("loadMoreItems",a.loadMoreItems,{}),b.trigger("displayedItemsChanged"),Zotero.ui.widgets.reactitems.reactInstance=a},getDefaultProps:function(){return{narrow:!1}},getInitialState:function(){return{moreloading:!1,allItemsLoaded:!1,errorLoading:!1,items:[],selectedItemKeys:[],allSelected:!1,displayFields:["title","creator","dateModified"],order:"title",sort:"asc"}},loadItems:function(){Z.debug("Items.loadItems",3);var a=this,b=this.props.library,c=Zotero.ui.getItemsConfig(b);this.setState({items:[],moreloading:!0});var d=b.loadItems(c).then(function(d){if(!d.loadedItems)throw Zotero.error("expected loadedItems on response not present"),"Expected response to have loadedItems";b.items.totalResults=d.totalResults,a.setState({items:d.loadedItems,moreloading:!1,sort:c.sort,order:c.order})})["catch"](function(b){Z.error(b),a.setState({errorLoading:!0,moreloading:!1,sort:c.sort,order:c.order})});return d},loadMoreItems:function(){Z.debug("Items.loadMoreItems",3);var a=this,b=this.props.library;if(!a.state.moreloading&&!a.state.allItemsLoaded){a.setState({moreloading:!0});var b=a.props.library,c=Zotero.ui.getItemsConfig(b),d=a.state.items.length;c.start=d;b.loadItems(c).then(function(b){if(!b.loadedItems)throw Zotero.error("expected loadedItems on response not present"),"Expected response to have loadedItems";var c=a.state.items.concat(b.loadedItems);a.setState({items:c,moreloading:!1});var d=c.length;b.totalResults==d&&a.setState({allItemsLoaded:!0})})["catch"](function(b){Z.error(b),a.setState({errorLoading:!0,moreloading:!1})})}},resortItems:function(a){Z.debug(".field-table-header clicked",3),a.preventDefault();var b,c=this.props.library,d=this.state.order,e=this.state.sort,f=J(a.target).data("columnfield");return b=f!=d?Zotero.config.sortOrdering[f]:"asc"==e?"desc":"asc",-1==c.sortableColumns.indexOf(f)?!1:f?(Zotero.state.pathVars.order=f,Zotero.state.pathVars.sort=b,Zotero.state.pushState(),c.preferences.setPref("sortField",f),c.preferences.setPref("sortOrder",b),c.preferences.setPref("order",f),c.preferences.setPref("sort",b),Zotero.preferences.setPref("order",f),void Zotero.preferences.setPref("sort",b)):(Zotero.ui.jsNotificationMessage("no order field mapped to column"),!1)},resortTriggered:function(a){Z.debug("resortTriggered"),Z.debug(a);var b=this.props.library,c=(this.state.order,this.state.sort,a.data.newSortField),d=a.data.newSortOrder;return-1==b.sortableColumns.indexOf(c)?!1:c?(Zotero.state.pathVars.order=c,Zotero.state.pathVars.sort=d,Zotero.state.pushState(),b.preferences.setPref("sortField",c),b.preferences.setPref("sortOrder",d),b.preferences.setPref("order",c),b.preferences.setPref("sort",d),Zotero.preferences.setPref("order",c),void Zotero.preferences.setPref("sort",d)):(Zotero.ui.jsNotificationMessage("no order field mapped to column"),!1)},selectDisplayed:function(){Z.debug("widgets.items.selectDisplayed",3),Zotero.state.selectedItemKeys=[],this.setState({selectedItemKeys:Zotero.state.getSelectedItemKeys(),allSelected:!1})},fixTableHeaders:function(){var a=this.refs.itemsTable,b=J(a),c=[];b.find("tbody tr").first().find("td").each(function(a,d){var e=J(d).width();c.push(e),b.find("thead th").eq(a).width(e)});var d=b.find("thead").height();b.find("thead").css("position","fixed").css("margin-top",-d).css("background-color","white").css("z-index",10),b.find("tbody").css("margin-top",d),b.css("margin-top",d)},handleSelectAllChange:function(a){var b=this.props.library,c=[],d=!1;if(a.target.checked)d=!0,this.state.items.forEach(function(a){c.push(a.get("key"))});else{var e=Zotero.state.getUrlVar("itemKey");e&&c.push(e)}Zotero.state.selectedItemKeys=c,this.setState({selectedItemKeys:c,allSelected:d}),b.trigger("selectedItemsChanged",{selectedItemKeys:c}),0===c.length&&b.trigger("displayedItemChanged")},openSortingDialog:function(a){var b=this.props.library;b.trigger("chooseSortingDialog")},nonreactBind:function(){J("body").hasClass("lib-body")&&this.fixTableHeaders(J("#field-table"))},componentDidMount:function(){var a=this;a.nonreactBind()},componentDidUpdate:function(){this.nonreactBind()},render:function(){var a=this,b=(this.props.library,this.props.narrow),c=this.state.order,d=this.state.sort,e=this.state.selectedItemKeys,f={};e.forEach(function(a){f[a]=!0});var g;g="desc"==d?React.createElement("span",{className:"glyphicon fonticon glyphicon-chevron-down pull-right"}):React.createElement("span",{className:"glyphicon fonticon glyphicon-chevron-up pull-right"});var h=[React.createElement("th",{key:"checkbox-header"},React.createElement("input",{type:"checkbox",className:"itemlist-editmode-checkbox all-checkbox",name:"selectall",checked:this.state.allSelected,onChange:this.handleSelectAllChange}))];if(b)h.push(React.createElement("th",{key:"single-cell-header",onClick:a.openSortingDialog,className:"clickable"},Zotero.Item.prototype.fieldMap[c],g));else{var i=this.state.displayFields.map(function(b,e){var f=-1!=Zotero.Library.prototype.sortableColumns.indexOf(b),h=b==c?"selected-order sort-"+d+" ":"",i=null;return b==c&&(i=g),React.createElement("th",{key:b,onClick:a.resortItems,className:"field-table-header "+h+(f?"clickable ":""),"data-columnfield":b},Zotero.Item.prototype.fieldMap[b]?Zotero.Item.prototype.fieldMap[b]:b,i)});h=h.concat(i)}var j=this.state.items.map(function(a){var c=f.hasOwnProperty(a.get("key"))?!0:!1,d={key:a.get("key"),item:a,selected:c,narrow:b};return React.createElement(ItemRow,d)});if(0==j.length){var k=this.state.displayFields.map(function(a){return React.createElement("td",{key:a})});k=[React.createElement("td",{key:"check"})].concat(k),j=React.createElement("tr",null,k)}return React.createElement("div",{id:"library-items-div",className:"library-items-div row",ref:"topdiv"},React.createElement("form",{className:"item-select-form",method:"POST"},React.createElement("table",{id:"field-table",ref:"itemsTable",className:"wide-items-table table table-striped"},React.createElement("thead",null,React.createElement("tr",null,h)),React.createElement("tbody",null,j)),React.createElement(LoadingError,{errorLoading:this.state.errorLoading}),React.createElement(LoadingSpinner,{loading:this.state.moreloading})))}}),ItemRow=React.createClass({displayName:"ItemRow",getDefaultProps:function(){return{displayFields:["title","creatorSummary","dateModified"],selected:!1,item:{},narrow:!1}},handleSelectChange:function(a){var b=(this.props.library,this.props.item.get("key"));Zotero.state.toggleItemSelected(b);var c=Zotero.state.getSelectedItemKeys();Zotero.ui.widgets.reactitems.reactInstance.setState({selectedItemKeys:c}),Zotero.ui.widgets.reactitems.reactInstance.props.library.trigger("selectedItemsChanged",{selectedItemKeys:c})},handleItemLinkClick:function(a){a.preventDefault();var b=J(a.target).data("itemkey");Zotero.state.pathVars.itemKey=b,Zotero.state.pushState()},render:function(){var a=this,b=this.props.item,c=this.props.selected;if(this.props.narrow)return React.createElement("tr",{className:c?"highlighed":"","data-itemkey":b.get("key")},React.createElement("td",{className:"edit-checkbox-td","data-itemkey":b.get("key")},React.createElement("input",{type:"checkbox",className:"itemlist-editmode-checkbox itemKey-checkbox",name:"selectitem-"+b.get("key"),"data-itemkey":b.get("key")})),React.createElement(SingleCellItemField,{onClick:a.handleItemLinkClick,item:b,displayFields:this.props.displayFields}));var d=this.props.displayFields.map(function(c){var d=null;return"title"==c&&(d=React.createElement(ColoredTags,{item:b})),React.createElement("td",{onClick:a.handleItemLinkClick,key:c,className:c,"data-itemkey":b.get("key")},d,React.createElement("a",{onClick:a.handleItemLinkClick,className:"item-select-link","data-itemkey":b.get("key"),href:Zotero.url.itemHref(b),title:b.get(c)},Zotero.ui.formatItemField(c,b,!0)))});return React.createElement("tr",{className:c?"highlighed":""},React.createElement("td",{className:"edit-checkbox-td","data-itemkey":b.get("key")},React.createElement("input",{type:"checkbox",onChange:this.handleSelectChange,checked:c,className:"itemlist-editmode-checkbox itemKey-checkbox",name:"selectitem-"+b.get("key"),"data-itemkey":b.get("key")})),d)}}),SingleCellItemField=React.createClass({displayName:"SingleCellItemField",render:function(){var a=this.props.item,b=(this.props.field,[]);return this.props.displayFields.forEach(function(c){var d=Zotero.Item.prototype.fieldMap[c]?Zotero.Item.prototype.fieldMap[c]+":":"";"title"==c?(b.push(React.createElement("span",{key:"itemTypeIcon",className:"sprite-icon pull-left sprite-treeitem-"+a.itemTypeImageClass()})),b.push(React.createElement(ColoredTags,{key:"coloredTags",item:a})),b.push(React.createElement("b",{key:"title"},Zotero.ui.formatItemField(c,a,!0)))):"dateAdded"===c||"dateModified"===c?b.push(React.createElement("p",{key:c,title:a.get(c),dangerouslySetInnerHtml:{__html:d+Zotero.ui.formatItemDateField(c,a,!0)}})):b.push(React.createElement("p",{key:c,title:a.get(c)},d,Zotero.ui.formatItemField(c,a,!0)))}),React.createElement("td",{onClick:this.props.onClick,className:"single-cell-item","data-itemkey":a.get("key")},React.createElement("a",{className:"item-select-link","data-itemkey":a.get("key"),href:Zotero.url.itemHref(a)},b))}}),ColoredTags=React.createClass({displayName:"ColoredTags",render:function(){var a=this.props.item,b=a.owningLibrary,c=b.matchColoredTags(a.apiObj._supplement.tagstrings);Z.debug("coloredTags:"+JSON.stringify(c));var d=c.map(function(a){return React.createElement(ColoredTag,{key:a,color:a})});return React.createElement("span",{className:"coloredTags"},d)}}),ColoredTag=React.createClass({displayName:"ColoredTag",render:function(){var a={color:this.props.color};return React.createElement("span",{style:a},React.createElement("span",{style:a,className:"glyphicons fonticon glyphicons-tag"}))}});Zotero.ui.widgets.library={},Zotero.ui.widgets.library.init=function(a){Z.debug("Zotero.ui.widgets.library.init");var b=Zotero.ui.getAssociatedLibrary(a);ReactDOM.render(React.createElement(ReactZoteroLibrary,{library:b}),document.getElementById("library-widget"))};var ReactZoteroLibrary=React.createClass({displayName:"ReactZoteroLibrary",componentWillMount:function(){Z.debug("ReactZoteroLibrary componentWillMount",3);var a=this;Zotero.reactLibraryInstance=a;var b=this.props.library;b.loadSettings(),b.listen("deleteIdb",function(){b.idbLibrary.deleteDB()}),b.listen("indexedDBError",function(){Zotero.ui.jsNotificationMessage("There was an error initializing your library. Some data may not load properly.","notice")}),b.listen("cachedDataLoaded",function(){}),J(window).on("resize",function(){window.matchMedia("(min-width: 768px)").matches?0!=a.state.narrow&&a.setState({narrow:!1}):1!=a.state.narrow&&a.setState({narrow:!0})})},componentDidMount:function(){var a=this,b=this.props.library;b.listen("displayedItemsChanged",function(){Z.debug("ReactZoteroLibrary displayedItemsChanged"),a.refs.itemsWidget.loadItems()},{}),b.listen("tagsChanged libraryTagsUpdated selectedTagsChanged",function(){Z.debug("setting tags on tagsWidget from Library"),a.refs.tagsWidget.setState({tags:b.tags})}),J(a.refs.itemsPanel).on("scroll",function(){var b=J(a.refs.itemsPanel);b.scrollTop()+b.innerHeight()>=b[0].scrollHeight&&a.refs.itemsWidget.loadMoreItems()})},getInitialState:function(){var a;return window.matchMedia("(min-width: 768px)").matches?a=!1:(Z.debug("Library set to narrow",3),a=!0),{narrow:a,activePanel:"items",deviceSize:"xs"}},showFiltersPanel:function(a){a.preventDefault(),this.setState({activePanel:"filters"})},showItemsPanel:function(a){a.preventDefault(),this.setState({activePanel:"items"})},reflowPanelContainer:function(){},render:function(){Z.debug("react library render");var a,b=this,c=this.props.library,d=Zotero.config.loggedInUser,e=d?d.displayName:null,f=Zotero.config.baseWebsiteUrl,g=f+"/settings",h=f+"/messages/inbox",i=f+"/download",j=f+"/support",k=Zotero.config.baseForumsUrl,l=f+"/user/logout",m=f+"/user/login",n=f,o=function(a){return f+"/static"+a},p=d.unreadMessages>0?React.createElement("strong",null,"Inbox (",d.unreadMessages,")"):"Inbox";a=d?[React.createElement("button",{key:"button",type:"button",href:"#",className:"btn btn-default navbar-btn dropdown-toggle","data-toggle":"dropdown",role:"button","aria-expanded":"false"},e,React.createElement("span",{className:"caret"}),React.createElement("span",{className:"sr-only"},"Toggle Dropdown")),React.createElement("ul",{key:"listEntries",className:"dropdown-menu",role:"menu"},React.createElement("li",null,React.createElement("a",{href:g},"Settings")),React.createElement("li",null,React.createElement("a",{href:h},p)),React.createElement("li",null,React.createElement("a",{href:i},"Download")),React.createElement("li",{className:"divider"}),React.createElement("li",null,React.createElement("a",{href:j,className:"documentation"},"Documentation")),React.createElement("li",null,React.createElement("a",{href:k,className:"forums"},"Forums")),React.createElement("li",{className:"divider"}),React.createElement("li",null,React.createElement("a",{href:l},"Log Out")))]:React.createElement("div",{className:"btn-group"},React.createElement("a",{href:m,className:"btn btn-default navbar-btn",role:"button"},"Log In"),React.createElement("button",{type:"button",href:"#",className:"btn btn-default navbar-btn dropdown-toggle","data-toggle":"dropdown",role:"button","aria-haspopup":"true","aria-expanded":"false"},React.createElement("span",{className:"caret"}),React.createElement("span",{className:"sr-only"},"Toggle Dropdown")),React.createElement("ul",{className:"dropdown-menu",role:"menu"},React.createElement("li",null,React.createElement("a",{href:i},"Download")),React.createElement("li",null,React.createElement("a",{href:j,className:"documentation"},"Documentation")),React.createElement("li",null,React.createElement("a",{href:k,className:"forums"},"Forums"))));var q=b.state.narrow,r=!q,s=!q,t=!q,u=!q,v=!q,w=!q;if(q)switch(b.state.activePanel){case"items":s=!0,t=!0;break;case"item":s=!0,u=!0;break;case"tags":r=!0,v=!0;break;case"collections":r=!0,w=!0;break;case"filters":r=!0}return React.createElement("div",null,React.createElement("nav",{id:"primarynav",className:"navbar navbar-default",role:"navigation"},React.createElement("div",{className:"container-fluid"},React.createElement("div",{className:"navbar-header"},React.createElement("button",{type:"button",className:"navbar-toggle collapsed","data-toggle":"collapse","data-target":"#primary-nav-linklist"},e,React.createElement("span",{className:"sr-only"},"Toggle navigation"),React.createElement("span",{className:"glyphicons fonticon glyphicons-menu-hamburger"})),React.createElement("a",{className:"navbar-brand hidden-sm hidden-xs",href:n},React.createElement("img",{src:o("/images/theme/zotero.png"),alt:"Zotero",height:"20px"})),React.createElement("a",{className:"navbar-brand visible-sm-block visible-xs-block",href:n},React.createElement("img",{src:o("/images/theme/zotero_theme/zotero_48.png"),alt:"Zotero",height:"24px"}))),React.createElement("div",{className:"collapse navbar-collapse",id:"primary-nav-linklist"},React.createElement(ControlPanel,{library:c,editable:Zotero.config.librarySettings.allowEdit,ref:"controlPanel"}),React.createElement("ul",{className:"nav navbar-nav navbar-right"},a),React.createElement("div",{className:"btn-toolbar hidden-xs navbar-right"},React.createElement(LibrarySearchBox,{library:c}))))),React.createElement("div",{id:"js-message"},React.createElement("ul",{id:"js-message-list"})),React.createElement("div",{id:"library",className:"row"},React.createElement("div",{id:"panel-container"},React.createElement("div",{id:"left-panel",hidden:!r,className:"panelcontainer-panelcontainer col-xs-12 col-sm-4 col-md-3"},React.createElement(FilterGuide,{ref:"filterGuide",library:c}),React.createElement("div",{role:"tabpanel"},React.createElement("ul",{className:"nav nav-tabs",role:"tablist"},React.createElement("li",{role:"presentation",className:"active"},React.createElement("a",{href:"#collections-panel","aria-controls":"collections-panel",role:"tab","data-toggle":"tab"},"Collections")),React.createElement("li",{role:"presentation"},React.createElement("a",{href:"#tags-panel","aria-controls":"tags-panel",role:"tab","data-toggle":"tab"},"Tags"))),React.createElement("div",{className:"tab-content"},React.createElement("div",{id:"collections-panel",role:"tabpanel",className:"tab-pane active"},React.createElement(Collections,{ref:"collectionsWidget",library:c})),React.createElement("div",{id:"tags-panel",role:"tabpanel",className:"tab-pane"},React.createElement(Tags,{ref:"tagsWidget",library:c}),React.createElement(FeedLink,{ref:"feedLinkWidget",library:c}))))),React.createElement("div",{id:"right-panel",hidden:!s,className:"panelcontainer-panelcontainer col-xs-12 col-sm-8 col-md-9"},React.createElement("div",{hidden:!t,ref:"itemsPanel",id:"items-panel",className:"panelcontainer-panel col-sm-12 col-md-7"},React.createElement("div",{className:"visible-xs"},React.createElement(LibrarySearchBox,{library:c})),React.createElement(Items,{ref:"itemsWidget",library:c,narrow:q}),React.createElement("div",{id:"load-more-items-div",className:"row"},React.createElement("button",{onClick:function(){c.trigger("loadMoreItems")},type:"button",id:"load-more-items-button",className:"btn btn-default"},"Load More Items"))),React.createElement("div",{hidden:!u,id:"item-panel",className:"panelcontainer-panel col-sm-12 col-md-5"},React.createElement("div",{id:"item-widget-div",className:"item-details-div"},React.createElement(ItemDetails,{ref:"itemWidget",library:c})))),React.createElement("nav",{id:"panelcontainer-nav",className:"navbar navbar-default navbar-fixed-bottom visible-xs-block",role:"navigation"},React.createElement("div",{className:"container-fluid"},React.createElement("ul",{className:"nav navbar-nav"},React.createElement("li",{onClick:b.showFiltersPanel,className:"filters-nav"},React.createElement("a",{href:"#"},"Filters")),React.createElement("li",{onClick:b.showItemsPanel,className:"items-nav"},React.createElement("a",{href:"#"},"Items"))))),React.createElement(SendToLibraryDialog,{ref:"sendToLibraryDialogWidget",library:c}),React.createElement(CreateCollectionDialog,{ref:"createCollectionDialogWidget",library:c}),React.createElement(UpdateCollectionDialog,{library:c}),React.createElement(DeleteCollectionDialog,{library:c}),React.createElement(AddToCollectionDialog,{library:c}),React.createElement(CreateItemDialog,{library:c}),React.createElement(CiteItemDialog,{library:c}),React.createElement(UploadAttachmentDialog,{library:c}),React.createElement(ExportItemsDialog,{library:c}),React.createElement(LibrarySettingsDialog,{library:c}),React.createElement(ChooseSortingDialog,{library:c}))))}});Zotero.ui.widgets.reactlibrarysettingsdialog={},Zotero.ui.widgets.reactlibrarysettingsdialog.init=function(a){Z.debug("librarysettingsdialog widget init",3);var b=Zotero.ui.getAssociatedLibrary(a);ReactDOM.render(React.createElement(LibrarySettingsDialog,{library:b}),document.getElementById("library-settings-dialog"))};var LibrarySettingsDialog=React.createClass({displayName:"LibrarySettingsDialog",componentWillMount:function(){var a=this,b=this.props.library;b.listen("settingsLoaded",a.updateStateFromLibrary,{}),b.listen("librarySettingsDialog",a.openDialog,{})},getInitialState:function(){return{listDisplayedFields:[],itemsPerPage:25,showAutomaticTags:!0}},openDialog:function(){this.refs.modal.open()},closeDialog:function(a){this.refs.modal.close()},updateShowFields:function(a){Z.debug("updateShowFields");var b=this.props.library,c=this.state.listDisplayedFields,d=a.target.value,e=a.target.checked;e?(Z.debug("adding field "+d+" to listDisplayedFields"),c.push(d)):(Z.debug("filtering field "+d+" from listDisplayedFields"),c=c.filter(function(a){return a==d?!1:!0})),this.setState({listDisplayedFields:c}),b.preferences.setPref("listDisplayedFields",c),b.preferences.persist(),b.trigger("displayedItemsChanged")},updateShowAutomaticTags:function(a){var b=this.props.library,c=a.target.checked;this.setState({showAutomaticTags:c}),b.preferences.setPref("showAutomaticTags",c),b.preferences.persist(),b.trigger("tagsChanged")},updateStateFromLibrary:function(){var a=this.props.library;this.setState({listDisplayedFields:a.preferences.getPref("listDisplayedFields"),itemsPerPage:a.preferences.getPref("itemsPerPage"),showAutomaticTags:a.preferences.getPref("showAutomaticTags")})},render:function(){var a=this,b=(this.props.library,this.state.listDisplayedFields),c=(this.state.itemsPerPage,this.state.showAutomaticTags,Zotero.localizations.fieldMap),d=Zotero.Library.prototype.displayableColumns.map(function(d,e){var f=-1!=b.indexOf(d);return React.createElement("div",{key:d,className:"checkbox"},React.createElement("label",{htmlFor:"display-column-field-"+d},React.createElement("input",{onChange:a.updateShowFields,type:"checkbox",checked:f,name:"display-column-field",value:d,id:"display-column-field-"+d,
className:"display-column-field"}),c[d]||d))});return React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"library-settings-dialog",className:"library-settings-dialog",role:"dialog","aria-hidden":"true","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",{className:"modal-title"},"Library Settings")),React.createElement("div",{className:"modal-body"},React.createElement("form",{id:"library-settings-form",className:"library-settings-form",role:"form"},React.createElement("fieldset",null,React.createElement("legend",null,"Display Columns"),d),React.createElement("div",{className:"checkbox"},React.createElement("label",{htmlFor:"show-automatic-tags"},React.createElement("input",{onChange:this.updateShowAutomaticTags,type:"checkbox",id:"show-automatic-tags",name:"show-automatic-tags"}),"Show Automatic Tags"),React.createElement("p",{className:"help-block"},"Automatic tags are tags added automatically when a reference was imported, rather than by a user.")))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{className:"btn btn-default","data-dismiss":"modal","aria-hidden":"true"},"Close"))))))}}),LoadingError=React.createClass({displayName:"LoadingError",render:function(){return React.createElement("p",{hidden:!this.props.errorLoading},"There was an error loading your items. Please try again in a few minutes.")}}),LoadingSpinner=React.createClass({displayName:"LoadingSpinner",render:function(){var a=Zotero.config.baseWebsiteUrl+"/static/images/theme/broken-circle-spinner.gif";return React.createElement("div",{className:"items-spinner",hidden:!this.props.loading},React.createElement("img",{className:"spinner",src:a}))}});Zotero.ui.widgets.reactsearchbox={},Zotero.ui.widgets.reactsearchbox.init=function(a){Z.debug("Zotero.eventful.init.searchbox",3);var b=Zotero.ui.getAssociatedLibrary(a);J(a),ReactDOM.render(React.createElement(LibrarySearchBox,{library:b}),document.getElementById("search-box"))};var LibrarySearchBox=React.createClass({displayName:"LibrarySearchBox",getInitialState:function(){return{searchType:"simple"}},search:function(a){a.preventDefault(),Z.debug("library-search form submitted",3),Zotero.state.clearUrlVars(["collectionKey","tag","q","qmode"]);var b=J(a.target),c=b.find("input.search-query").val(),d=b.find("input.search-query").data("searchtype");return(""!==c||Zotero.state.getUrlVar("q"))&&(Zotero.state.pathVars.q=c,"simple"!=d&&(Zotero.state.pathVars.qmode=d),Zotero.state.pushState()),!1},clearLibraryQuery:function(a){Zotero.state.unsetUrlVar("q"),Zotero.state.unsetUrlVar("qmode"),J(".search-query").val(""),Zotero.state.pushState()},changeSearchType:function(a){a.preventDefault();var b=J(a.target),c=b.data("searchtype");this.setState({searchType:c})},render:function(){var a="";"simple"==this.state.searchType?a="Search Title, Creator, Year":"everything"==this.state.searchType&&(a="Search Full Text");var b=Zotero.state.getUrlVar("q");return React.createElement("div",{className:"btn-toolbar row",id:"search-box",style:{maxWidth:"350px"}},React.createElement("form",{action:"/search/",onSubmit:this.search,className:"navbar-form zsearch library-search",role:"search"},React.createElement("div",{className:"input-group"},React.createElement("div",{className:"input-group-btn"},React.createElement("button",{type:"button",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown"},React.createElement("span",{className:"caret"})),React.createElement("ul",{className:"dropdown-menu"},React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.changeSearchType,"data-searchtype":"simple"},"Title, Creator, Year")),React.createElement("li",null,React.createElement("a",{href:"#",onClick:this.changeSearchType,"data-searchtype":"everything"},"Full Text")))),React.createElement("input",{defaultValue:b,type:"text",name:"q",id:"header-search-query",className:"search-query form-control",placeholder:a}),React.createElement("span",{className:"input-group-btn"},React.createElement("button",{onClick:this.clearLibraryQuery,className:"btn btn-default clear-field-button",type:"button"},React.createElement("span",{className:"glyphicons fonticon glyphicons-remove-2"}))))))}});Zotero.ui.widgets.reactsendToLibraryDialog={},Zotero.ui.widgets.reactsendToLibraryDialog.init=function(a){Z.debug("sendToLibraryDialog widget init",3);var b=Zotero.ui.getAssociatedLibrary(a);ReactDOM.render(React.createElement(SendToLibraryDialog,{library:b}),document.getElementById("send-to-library-dialog"))};var SendToLibraryDialog=React.createClass({displayName:"SendToLibraryDialog",componentWillMount:function(){var a=this,b=this.props.library;b.listen("sendToLibraryDialog",a.openDialog,{})},getInitialState:function(){return{writableLibraries:[],loading:!1,loaded:!1}},handleLibraryChange:function(a){this.setState({targetLibrary:a.target.value})},openDialog:function(){this.refs.modal.open(),this.state.loaded||this.loadForeignLibraries()},closeDialog:function(a){this.refs.modal.close()},loadForeignLibraries:function(){var a=this,b=this.props.library,c=Zotero.config.loggedInUserID,d="u"+c;this.setState({loading:!0});b.groups.fetchUserGroups(c).then(function(b){Z.debug("got member groups",3);for(var e=b.fetchedGroups,f=[{name:"My Library",libraryString:d}],g=0;g<e.length;g++)if(e[g].isWritable(c)){var h="g"+e[g].get("id");f.push({name:e[g].get("name"),libraryString:h})}a.setState({writableLibraries:f,loading:!1,loaded:!0})})["catch"](function(a){Zotero.ui.jsNotificationMessage("There was an error loading group libraries","error"),Z.error(a),Z.error(a.message)})},sendItem:function(a){Z.debug("sendToLibrary callback",3);var b=this.props.library,c=this.state.targetLibrary,d=Zotero.utils.parseLibString(c),e=new Zotero.Library(d.libraryType,d.libraryID);Zotero.libraries[c]=e;var f=Zotero.state.getSelectedItemKeys();if(0===f.length)return Zotero.ui.jsNotificationMessage("No items selected","notice"),this.closeDialog(),!1;var g=b.items.getItems(f);return b.sendToLibrary(g,e).then(function(a){Zotero.ui.jsNotificationMessage("Items sent to other library","notice")})["catch"](function(a){Z.debug(a),Zotero.ui.jsNotificationMessage("Error sending items to other library","notice")}),this.closeDialog(),!1},render:function(){var a=this.state.writableLibraries,b=a.map(function(a){return React.createElement("option",{key:a.libraryString,value:a.libraryString},a.name)});return React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"send-to-library-dialog",className:"send-to-library-dialog",role:"dialog","aria-hidden":"true",title:"Send to Library","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",null,"Send To Library")),React.createElement("div",{className:"send-to-library-div modal-body","data-role":"content"},React.createElement("form",null,React.createElement("div",{"data-role":"fieldcontain"},React.createElement("label",{htmlFor:"destination-library"},"Library"),React.createElement("select",{onChange:this.handleLibraryChange,className:"destination-library-select form-control",name:"desination-library"},b)))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{onClick:this.closeDialog,className:"btn","data-dismiss":"modal","aria-hidden":"true"},"Close"),React.createElement("button",{onClick:this.sendItem,className:"btn btn-primary sendButton"},"Send"))))))}});Zotero.ui.widgets.reacttags={},Zotero.ui.widgets.reacttags.init=function(a){Z.debug("tags widget init",3);var b=Zotero.ui.getAssociatedLibrary(a);ReactDOM.render(React.createElement(Tags,{library:b}),document.getElementById("tags-list-div"))};var TagRow=React.createClass({displayName:"TagRow",getDefaultProps:function(){return{showAutomatic:!1}},handleClick:function(a){a.stopPropagation(),a.preventDefault();var b=this.props.tag;Z.state.toggleTag(b.apiObj.tag),Z.state.clearUrlVars(["tag","collectionKey"]),Z.state.pushState();var c=Zotero.state.getUrlVar("tag");J.isArray(c)||(c=c?[c]:[]),Zotero.ui.widgets.reacttags.reactInstance.setState({selectedTags:c})},render:function(){var a=this.props.tag,b=a.apiObj.tag;a.apiObj.meta.numItems&&(b+=" ("+a.apiObj.meta.numItems+")");var c="",d={};return a.color&&(d={color:a.color,fontWeight:"bold"}),0==this.props.showAutomatic&&0!=a.apiObj.meta.type?null:React.createElement("li",{className:"tag-row"},React.createElement("a",{onClick:this.handleClick,className:"tag-link",title:b,style:d,href:c},Zotero.ui.trimString(a.apiObj.tag,12)))}}),TagList=React.createClass({displayName:"TagList",getDefaultProps:function(){return{tags:[],showAutomatic:!1,id:""}},render:function(){var a=this.props.showAutomatic,b=this.props.tags.map(function(b,c){return React.createElement(TagRow,{key:b.apiObj.tag,tag:b,showAutomatic:a})});return React.createElement("ul",{id:this.props.id},b)}}),Tags=React.createClass({displayName:"Tags",getDefaultProps:function(){return{}},getInitialState:function(){return{tags:new Zotero.Tags,tagColors:null,selectedTags:[],tagFilter:"",showAutomatic:!1,loading:!1}},componentWillMount:function(a){var b=this,c=this.props.library;Zotero.ui.widgets.reacttags.reactInstance=b;var d=c.preferences.getPref("tagColors"),e=Zotero.state.getUrlVar("tag");J.isArray(e)||(e=e?[e]:[]),b.setState({tagColors:d,selectedTags:e}),c.listen("tagsDirty",b.syncTags,{}),c.listen("cachedDataLoaded",b.syncTags,{}),c.listen("tagsChanged libraryTagsUpdated selectedTagsChanged",function(a){b.setState({tags:c.tags})},{})},handleFilterChanged:function(a){this.setState({tagFilter:a.target.value})},syncTags:function(a){Z.debug("Tags.syncTags");var b=this;if(!this.state.loading){var c=this.props.library;a.data&&a.data.checkCached===!1&&c.tags.clear(),b.setState({tags:c.tags,loading:!0});c.loadUpdatedTags().then(function(){Z.debug("syncTags done. clearing loading div"),b.setState({tags:c.tags,loading:!1})},function(a){Z.error("syncTags failed. showing local data and clearing loading div"),b.setState({tags:c.tags,loading:!1}),Zotero.ui.jsNotificationMessage("There was an error loading tags. Some tags may not have been updated.","notice")})}},render:function(){var a=this.state.tags,b=this.state.selectedTags,c=this.state.tagColors;null===c&&(c=[]);var d=this.state.tagFilter,e=a.plainTagsList(a.tagsArray),f=Z.utils.matchAnyAutocomplete(d,e),g=[],h=[];c.forEach(function(b,c){Z.debug("tagColor processing "+c),g.push(b.name.toLowerCase());var d=a.getTag(b.name);d&&(d.color=b.color,h.push(d))});var i=[],j=[];return b.forEach(function(b){var c=a.getTag(b);c&&j.push(c)}),f.forEach(function(c){var d=a.getTag(c);null!==d&&d.apiObj.meta.numItems>0&&-1==b.indexOf(c)&&-1==g.indexOf(c)&&i.push(d)}),React.createElement("div",{id:"tags-list-div",className:"tags-list-div"},React.createElement("div",null,React.createElement("input",{type:"text",id:"tag-filter-input",className:"tag-filter-input form-control",placeholder:"Filter Tags",onChange:this.handleFilterChanged}),React.createElement(LoadingSpinner,{loading:this.state.loading}),React.createElement(TagList,{tags:j,id:"selected-tags-list"}),React.createElement(TagList,{tags:h,id:"colored-tags-list"}),React.createElement(TagList,{tags:i,id:"tags-list"})))}});Zotero.ui.widgets.reactupdateCollectionDialog={},Zotero.ui.widgets.reactupdateCollectionDialog.init=function(a){Z.debug("updatecollectionsdialog widget init",3);var b=Zotero.ui.getAssociatedLibrary(a);ReactDOM.render(React.createElement(UpdateCollectionDialog,{library:b}),document.getElementById("update-collection-dialog"))};var UpdateCollectionDialog=React.createClass({displayName:"UpdateCollectionDialog",componentWillMount:function(){var a=this,b=this.props.library;b.listen("updateCollectionDialog",function(){var c=Zotero.state.getUrlVar("collectionKey"),d=b.collections.getCollection(c),e="",f="";d&&(e=d.get("parentCollection"),f=d.get("name")),a.setState({collectionName:f,parentCollection:e}),a.openDialog()},{})},getInitialState:function(){return{collectionName:"",parentCollection:null}},handleCollectionChange:function(a){this.setState({parentCollection:a.target.value})},handleNameChange:function(a){this.setState({collectionName:a.target.value})},openDialog:function(){this.refs.modal.open()},closeDialog:function(a){this.refs.modal.close()},saveCollection:function(a){var b=this,c=this.props.library,d=this.state.parentCollection,e=this.state.collectionName;""==e&&(e="Untitled");var f=Zotero.state.getUrlVar("collectionKey"),g=c.collections.getCollection(f);return g?(Z.debug("updating collection: "+d+": "+e),void g.update(e,d).then(function(a){Zotero.ui.jsNotificationMessage("Collection Saved","confirm"),c.collections.dirty=!0,c.collections.initSecondaryData(),c.trigger("libraryCollectionsUpdated"),Zotero.state.pushState(!0),b.closeDialog()})["catch"](Zotero.catchPromiseError)):(Zotero.ui.jsNotificationMessage("Selected collection not found","error"),!1)},render:function(){var a=this.props.library,b=a.collections.nestedOrderingArray(),c=b.map(function(a,b){return React.createElement("option",{key:a.get("key"),value:a.get("key")},"-".repeat(a.nestingDepth)," ",a.get("name"))});return c.unshift(React.createElement("option",{key:"emptyvalue",value:""},"None")),React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"update-collection-dialog",className:"update-collection-dialog",role:"dialog",title:"Update Collection","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",null,"Update Collection")),React.createElement("div",{className:"update-collection-div modal-body"},React.createElement("form",{method:"POST",className:"zform"},React.createElement("ol",null,React.createElement("li",null,React.createElement("label",{htmlFor:"updated-collection-title-input"},"Rename Collection"),React.createElement("input",{value:this.state.collectionName,onChange:this.handleNameChange,id:"updated-collection-title-input",className:"updated-collection-title-input form-control"})),React.createElement("li",null,React.createElement("label",{htmlFor:"update-collection-parent-select"},"Parent Collection"),React.createElement("select",{value:this.state.parentCollection,onChange:this.handleCollectionChange,className:"collectionKey-select update-collection-parent form-control"},c))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{className:"btn","data-dismiss":"modal","aria-hidden":"true"},"Close"),React.createElement("button",{onClick:this.saveCollection,className:"btn btn-primary updateButton"},"Update"))))))}});Zotero.ui.widgets.reactuploadDialog={},Zotero.ui.widgets.reactuploadDialog.init=function(a){Z.debug("uploaddialog widget init",3);var b=Zotero.ui.getAssociatedLibrary(a);ReactDOM.render(React.createElement(UploadAttachmentDialog,{library:b}),document.getElementById("upload-dialog"))};var UploadAttachmentDialog=React.createClass({displayName:"UploadAttachmentDialog",componentWillMount:function(){var a=this,b=this.props.library;b.listen("uploadAttachment",function(){Z.debug("got uploadAttachment event; opening upload dialog"),a.setState({itemKey:Zotero.state.getUrlVar("itemKey")}),a.openDialog()},{})},getInitialState:function(){return{title:"",fileInfo:null,filename:"",filesize:0,contentType:null,percentLoaded:0,uploading:!1}},upload:function(){Z.debug("uploadFunction",3);var a=this,b=this.props.library,c=this.state.fileInfo,d=this.state.title,e=function(b){Z.debug("fullUpload.upload.onprogress",3);var c=Math.round(b.loaded/b.total*100);a.setState({percentLoaded:c})};this.setState({uploading:!0});var f,g=Zotero.state.getUrlVar("itemKey"),h=b.items.getItem(g);if(h.get("parentItem"))"attachment"==h.get("itemType")&&"imported_file"==h.get("linkMode")&&(Z.debug("imported_file attachment",3),f=h.uploadFile(c,e));else{Z.debug("no parentItem",3);var i=new Zotero.Item;i.associateWithLibrary(b),f=i.initEmpty("attachment","imported_file").then(function(a){return Z.debug("templateItemDeferred callback",3),a.set("title",d),h.uploadChildAttachment(a,c,e)})}f.then(function(){Z.debug("uploadSuccess",3),b.trigger("uploadSuccessful"),a.closeDialog()})["catch"](a.failureHandler).then(function(){a.closeDialog()})},handleUploadFailure:function(a){switch(Z.debug("Upload failed",3),Z.debug(a,3),Zotero.ui.jsNotificationMessage("There was a problem uploading your file.","error"),a.code){case 400:Zotero.ui.jsNotificationMessage("Bad Input. 400","error");break;case 403:Zotero.ui.jsNotificationMessage("You do not have permission to edit files","error");break;case 409:Zotero.ui.jsNotificationMessage("The library is currently locked. Please try again in a few minutes.","error");break;case 412:Zotero.ui.jsNotificationMessage("File conflict. Remote file has changed","error");break;case 413:Zotero.ui.jsNotificationMessage("Requested upload would exceed storage quota.","error");break;case 428:Zotero.ui.jsNotificationMessage("Precondition required error","error");break;case 429:Zotero.ui.jsNotificationMessage("Too many uploads pending. Please try again in a few minutes","error");break;default:Zotero.ui.jsNotificationMessage("Unknown error uploading file. "+a.code,"error")}},handleFiles:function(a){Z.debug("attachmentUpload handleFiles",3);var b=this;if("undefined"==typeof a||0===a.length)return!1;var c=a[0];Zotero.file.getFileInfo(c).then(function(a){Z.debug(a),b.setState({fileInfo:a,filename:a.filename,filesize:a.filesize,contentType:a.contentType})})},handleDrop:function(a){Z.debug("fileuploaddroptarget drop callback",3),a.stopPropagation(),a.preventDefault();var b=a.originalEvent,c=b.dataTransfer,d=c.files;this.handleFiles(d)},handleFileInputChange:function(a){Z.debug("fileuploaddroptarget callback 1",3),a.stopPropagation(),a.preventDefault();var b=J(this.refs.fileInput).get(0).files;this.handleFiles(b)},handleTitleChange:function(a){this.setState({title:a.target.value})},openDialog:function(){this.refs.modal.open()},closeDialog:function(a){this.refs.modal.close()},render:function(){this.props.library;return React.createElement(BootstrapModalWrapper,{ref:"modal"},React.createElement("div",{id:"upload-attachment-dialog",className:"upload-attachment-dialog",role:"dialog",title:"Upload Attachment","data-keyboard":"true"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-hidden":"true"},"×"),React.createElement("h3",{className:"modal-title"},"Upload Attachment")),React.createElement("div",{className:"upload-attachment-div modal-body","data-role":"content"},React.createElement("form",{className:"attachmentuploadForm zform"},React.createElement("h3",null,"Select a file for upload or drag and drop below"),React.createElement("span",{className:"btn btn-primary btn-file"},"Choose File",React.createElement("input",{onChange:this.handleFileInputChange,ref:"fileInput",type:"file",id:"fileuploadinput",className:"fileuploadinput",multiple:!0})),React.createElement("div",{onDrop:this.handleDrop,id:"fileuploaddroptarget",className:"fileuploaddroptarget"},React.createElement("h3",null,"Drop your file here"),React.createElement("h3",{id:"droppedfilename",className:"droppedfilename"}),React.createElement(LoadingSpinner,{loading:this.state.uploading})),React.createElement("div",{id:"attachmentuploadfileinfo",className:"attachmentuploadfileinfo"},React.createElement("table",{className:"table table-striped"},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("th",null,"Title"),React.createElement("td",null,React.createElement("input",{onChange:this.handleTitleChange,id:"upload-file-title-input",className:"upload-file-title-input form-control",type:"text"}))),React.createElement("tr",null,React.createElement("th",null,"Size"),React.createElement("td",{className:"uploadfilesize"},this.state.filesize)),React.createElement("tr",null,React.createElement("th",null,"Type"),React.createElement("td",{className:"uploadfiletype"},this.state.contentType)),React.createElement("tr",null,React.createElement("th",null,"Upload"),React.createElement("td",{className:"uploadprogress"},React.createElement("meter",{min:"0",max:"100",value:"0",id:"uploadprogressmeter",value:this.state.percentLoaded})))))))),React.createElement("div",{className:"modal-footer"},React.createElement("button",{type:"button",className:"btn btn-default","data-dismiss":"modal","aria-hidden":"true"},"Close"),React.createElement("button",{onClick:this.upload,type:"button",className:"btn btn-primary uploadButton"},"Upload"))))))}});Zotero.ui.widgets.reactGroups={},Zotero.ui.widgets.reactGroups.init=function(a){Z.debug("Zotero.ui.widgets.reactGroups");ReactDOM.render(React.createElement(UserGroups,null),document.getElementById("user-groups-div"))};var GroupNugget=React.createClass({displayName:"GroupNugget",render:function(){var a=this.props.group,b=Zotero.config.loggedInUserID,c=!1,d=1;a.apiObj.data.members&&(d+=a.apiObj.data.members.length),a.apiObj.data.admins&&(d+=a.apiObj.data.admins.length),!b||b!=a.apiObj.data.owner&&-1==J.inArray(b,a.apiObj.data.admins)||(c=!0);var e=null;a.hasImage&&(e=React.createElement("a",{href:Zotero.url.groupViewUrl(a),className:"group-image"},React.createElement("img",{src:Zotero.url.groupImageUrl(a),alt:""})));var f=null;c&&(f=React.createElement("nav",{className:"action-links"},React.createElement("li",null,React.createElement("a",{href:Zotero.url.groupSettingsUrl(a)},"Manage Profile")),React.createElement("li",null,React.createElement("a",{href:Zotero.url.groupMemberSettingsUrl(a)},"Manage Members")),React.createElement("li",null,React.createElement("a",{href:Zotero.url.groupLibrarySettingsUrl(a)},"Manage Library"))));var g=null;if(a.apiObj.data.description){var h={__html:a.apiObj.data.description};g=React.createElement("tr",null,React.createElement("th",{scope:"row"},"Description"),React.createElement("td",{dangerouslySetInnerHTML:h}))}var i=Zotero.Group.prototype.accessMap[a.apiObj.data.libraryReading][a.apiObj.data.libraryEditing];return"Private"==a.apiObj.data.type&&"all"==a.apiObj.data.libraryReading&&(i=Zotero.Group.prototype.accessMap.members[a.apiObj.data.libraryEditing]),React.createElement("div",{key:a.groupID,className:"nugget-group"},React.createElement("div",{className:"nugget-full"},e,React.createElement("div",{className:"nugget-name"},React.createElement("a",{href:Zotero.url.groupViewUrl(a)},a.apiObj.data.name)),React.createElement("nav",{id:"group-library-link-nav",className:"action-links"},React.createElement("ul",null,React.createElement("li",null,React.createElement("a",{href:Zotero.url.groupLibraryUrl(a)},"Group Library")))),f,React.createElement("table",{className:"nugget-profile table"},React.createElement("tr",null,React.createElement("th",{scope:"row"},"Members"),React.createElement("td",null,d)),g,React.createElement("tr",null,React.createElement("th",{scope:"row"},"Group Type"),React.createElement("td",null,Zotero.Group.prototype.typeMap[a.apiObj.data.type])),React.createElement("tr",null,React.createElement("th",{scope:"row"},"Group Library"),React.createElement("td",null,i)))))}}),UserGroups=React.createClass({displayName:"UserGroups",componentWillMount:function(){var a=this,b=new Zotero.Groups;if(Zotero.config.loggedIn&&Zotero.config.loggedInUserID){a.setState({loading:!0});b.fetchUserGroups(Zotero.config.loggedInUserID).then(function(b){var c=b.fetchedGroups;a.setState({groups:c,loading:!1})})["catch"](Zotero.catchPromiseError)}},getInitialState:function(){return{groups:[],loading:!1}},render:function(){var a=this,b=this.state.groups,c=b.map(function(a){return React.createElement(GroupNugget,{group:a})});return React.createElement("div",{id:"user-groups-div",className:"user-groups"},c,React.createElement(LoadingSpinner,{loading:a.state.loading}))}});Zotero.url.requestReadApiKeyUrl=function(a,b,c){var d=Zotero.config.baseWebsiteUrl+"/settings/keys/new";d.replace("http","https");var e={name:"Private Feed"};"group"==a?(e.library_access=0,e["group_"+b]="read",e.redirect=c):"user"==a&&(e.library_access=1,e.notes_access=1,e.redirect=c);var f=[];J.each(e,function(a,b){f.push(encodeURIComponent(a)+"="+encodeURIComponent(b))});var g="?"+f.join("&");return d+g},Zotero.url.groupViewUrl=function(a){return"Private"==a.get("type")?Zotero.config.baseWebsiteUrl+"/groups/"+a.get("id"):Zotero.config.baseWebsiteUrl+"/groups/"+Zotero.utils.slugify(a.get("name"))},Zotero.url.groupLibraryUrl=function(a){return"Private"==a.get("type")?Zotero.config.baseWebsiteUrl+"/groups/"+a.get("id")+"/items":Zotero.config.baseWebsiteUrl+"/groups/"+Zotero.utils.slugify(a.get("name"))+"/items"},Zotero.url.groupSettingsUrl=function(a){return Zotero.config.baseWebsiteUrl+"/groups/"+a.get("id")+"/settings"},Zotero.url.groupMemberSettingsUrl=function(a){return Zotero.config.baseWebsiteUrl+"/groups/"+a.get("id")+"/settings/members"},Zotero.url.groupLibrarySettingsUrl=function(a){return Zotero.config.baseWebsiteUrl+"/groups/"+a.get("id")+"/settings/library"},Zotero.pages={base:{init:function(){this.tagline(),this.setupSearch(),this.setupNav(),J("#sitenav .toggle").click(this.navMenu),J(".support-menu-expand-section").hide(),J(".support-menu-section").on("click","h2",function(){J(this).siblings(".support-menu-expand-section").slideToggle()})},tagline:function(){var a=["See it. Save it. Sort it. Search it. Cite it.","Leveraging the long tail of scholarship.","A personal research assistant. Inside your browser.","Goodbye 3x5 cards, hello Zotero.","Citation management is only the beginning.","The next-generation research tool.","Research, not re-search","The web now has a wrangler."],b=Math.floor(Math.random()*a.length);J("#tagline").text(a[b])},setupSearch:function(){var a="support",b="";switch(void 0!==window.zoterojsSearchContext&&(a=zoterojsSearchContext),a){case"people":b="Search for people";break;case"group":b="Search for groups";break;case"documentation":b="Search documentation";break;case"library":b="Search Library";break;case"grouplibrary":b="Search Library";break;case"support":b="Search support";break;case"forums":b="Search forums";break;default:b="Search support"}("documentation"==a||"support"==a)&&J("#simple-search").on("submit",function(a){a.preventDefault();var b=J(this).find("input[type='text']").val();Z.pages.base.supportSearchRedirect(b)}),("people"==a||"group"==a)&&J("#simple-search").on("submit",function(c){c.preventDefault();var d=Zotero.config.baseZoteroWebsiteUrl+"/search/#type/"+a,e=J(this).find("input[type='text']").val();return""!==e&&e!=b&&(d=d+"/q/"+encodeURIComponent(e)),location.href=d,!1})},supportSearchRedirect:function(a){var b=encodeURIComponent(a+" site:www.zotero.org/support");return void Z.debug(b)},forumSearchRedirect:function(a){var b=encodeURIComponent(a+" site:forums.zotero.org"),c="https://duckduckgo.com/?q="+b;window.location=c},setupNav:function(){var a="";void 0!==window.zoterojsSearchContext&&(a=zoterojsSearchContext,"support"==a&&(a="")),"/"==location.pathname&&location.href.search("forums.")<0&&(a="home"),""!==a&&J(".primarynav").find("a."+a).closest("li").addClass("active")}},settings_cv:{init:function(){J("#cv-sections").on("click",".cv-delete",function(a){return confirm("Are you sure you want to delete this section?")?(Zotero.ui.cleanUpRte(J("#cv-sections")),J(this).closest("div.cv-section").remove(),Zotero.ui.init.rte("default",!1,J("#cv-sections")),!1):void 0}),J(".cv-insert-freetext").on("click",function(a){var b=J("#cv-sections div.cv-section").length,c=b+1;return J("#cv-sections").append(J("#cvsectionTemplate").render({cvSectionIndex:c,cvSectionType:"text",cvEntry:{}})),Zotero.ui.init.rte("default",!1,J("div.cv-section").last()),J("input.cv-heading").last().focus(),!1}),J(".cv-insert-collection").on("click",function(a){var b=J("#cv-sections div.cv-section").length,c=b+1;return Z.debug(zoteroData.collectionOptions),J("#cv-sections").append(J("#cvsectionTemplate").render({cvSectionIndex:c,cvSectionType:"collection",collectionOptions:zoteroData.collectionOptions,cvEntry:{}})),J("input.cv-heading").last().focus(),!1}),J("#cv-sections").on("click",".cv-move-down",function(a){return J(this).closest("div.cv-section").find("textarea").length>0?(Zotero.ui.cleanUpRte(J("#cv-sections")),J(this).closest("div.cv-section").next().after(J(this).closest("div.cv-section")),Zotero.ui.init.rte("default",!1)):J(this).closest("div.cv-section").next().after(J(this).closest("div.cv-section")),!1}),J("#cv-sections").on("click",".cv-move-up",function(a){return J(this).closest("div.cv-section").find("textarea").length>0?(Zotero.ui.cleanUpRte(J("#cv-sections")),J(this).closest("div.cv-section").prev().before(J(this).closest("div.cv-section")),Zotero.ui.init.rte("default",!1)):J(this).closest("div.cv-section").prev().before(J(this).closest("div.cv-section")),!1}),J("#cv-submit").click(function(a){J("#cv-sections div.cv-section").each(function(a){var b;J(this).hasClass("cv-text")?(b=J(this).find(".cv-heading").attr("name","cv_"+(a+1)+"_heading"),"Enter a section name"==b.val()&&b.val(""),J(this).find(".cv-text").attr("name","cv_"+(a+1)+"_text")):J(this).hasClass("cv-collection")&&(b=J(this).find(".cv-heading").attr("name","cv_"+(a+1)+"_heading"),"Enter a section name"==b.val()&&b.val(""),J(this).find("select.cv-collection").attr("name","cv_"+(a+1)+"_collection"))})}),Zotero.ui.init.rte("nolinks",!1,J("#cv-sections"))}},settings_account:{},settings_profile:{init:function(){Zotero.ui.init.rte("nolinks")}},settings_privacy:{init:function(){J("input#privacy_publishLibrary").prop("checked")||J("input#privacy_publishNotes").prop("disabled",!0),J("input#privacy_publishLibrary").bind("change",function(){J("input#privacy_publishLibrary").prop("checked")?J("input#privacy_publishNotes").prop("disabled",!1):J("input#privacy_publishNotes").prop("checked",!1).prop("disabled",!0)})}},settings_apikeys:{init:function(){}},settings_newkey:{init:function(){Z.debug("zoteroPages settings_newkey",3),Zotero.pages.settings_editkey.init()}},settings_newoauthkey:{init:function(){Zotero.pages.settings_newkey.init(),J("button[name='edit']").closest("div.form-group").nextAll().hide(),J("button[name='edit']").click(function(a){a.preventDefault(),J("button[name='edit']").closest("div.form-group").nextAll().show()})},updatePermissionsSummary:function(){J("#permissions-summary").empty().append(Z.pages.settings_newoauthkey.permissionsSummary())},permissionsSummary:function(){var a="",b=J("input#library_access").prop("checked"),c=J("input#notes_access").prop("checked"),d=J("input#write_access").prop("checked");b&&(a+="Access to read your personal library.<br />"),c&&(a+="Access to read notes in your personal library.<br />"),d&&(a+="Access to read and modify your personal library.<br />");var e=J("input[name='groups_all']:checked").val();switch(e){case"read":a+="Access to read any of your group libraries<br />";break;case"write":a+="Access to read and modify any of your group libraries<br />"}var f=J("input#individual_groups").prop("checked");return f&&J("input.individual_group_permission:checked").each(function(b,c){var d=J(c).data("groupname"),e=(J(c).data("groupid"),J(c).val());switch(e){case"read":a+="Access to read library for group '"+d+"'<br />";break;case"write":a+="Access to read and modify library for group '"+d+"'<br />";
}}),a}},settings_editkey:{init:function(){Z.debug("zoteroPages settings_editkey",3),J("input[type='checkbox'][name='library_access']").prop("checked")||J("input[name='notes_access']").prop("disabled","disabled"),J("input#library_access").bind("change",function(){J("input[type='checkbox'][name='library_access']").prop("checked")?(J("input[name='notes_access']").prop("disabled",!1),J("input[name='write_access']").prop("disabled",!1)):(J("input[name='notes_access']").prop("checked",!1).prop("disabled",!0),J("input[name='write_access']").prop("checked",!1).prop("disabled",!0))}),J("input[name='name']").focus(),J("input[type='checkbox'][name='individual_groups']").prop("checked")||J(".individual_group_permission").closest("div.form-group").hide(),J("input[name='individual_groups']").bind("change",function(){Z.debug("individual groups checkbox changed"),J("input[type='checkbox'][name='individual_groups']").prop("checked")?J(".individual_group_permission").closest("div.form-group").show():J(".individual_group_permission").closest("div.form-group").hide()}),J("input").bind("change",Zotero.pages.settings_newoauthkey.updatePermissionsSummary),Zotero.pages.settings_newoauthkey.updatePermissionsSummary()}},settings_storage:{init:function(){var a=J("input[name=storageLevel]:checked").val();Zotero.pages.settings_storage.showSelectedResults(a),J("input[name=storageLevel]").change(function(){Zotero.pages.settings_storage.showSelectedResults(J("input[name=storageLevel]:checked").val())}),J("#purge-button").click(function(){return confirm("You are about to remove all uploaded files associated with your personal library.")?(J("#confirm_delete").val("confirmed"),!0):!1})},showSelectedResults:function(a){2==a?J("#order-result-div").html(zoteroData.orderResult2):3==a?J("#order-result-div").html(zoteroData.orderResult3):4==a?J("#order-result-div").html(zoteroData.orderResult4):5==a?J("#order-result-div").html(zoteroData.orderResult5):6==a&&J("#order-result-div").html(zoteroData.orderResult6)}},settings_deleteaccount:{init:function(){J("button#deleteaccount").click(function(){return confirm("Are you sure you want to permanently delete your account? You will not be able to recover the account or the user name.")?void 0:!1})}},group_new:{init:function(){var a;J("input#name").keyup(function(b){clearTimeout(a),a=setTimeout(Zotero.pages.group_new.nameChange,300)}),J("input[name=group_type]").change(Zotero.pages.group_new.nameChange),J("input#name").after("<label id='slugpreview'>Group URL: "+Zotero.config.baseZoteroWebsiteUrl+"/groups/"+Zotero.utils.slugify(J("input#name").val())+"</label>")},nameChange:function(){J("#slugpreview").css("color","black");var a=J("input[name=group_type]:checked").val();if("Private"==a?J("#slugpreview").text("Group URL: "+Zotero.config.baseZoteroWebsiteUrl+"/groups/<number>"):J("#slugpreview").text("Group URL: "+Zotero.config.baseZoteroWebsiteUrl+"/groups/"+Zotero.utils.slugify(J("input#name").val())),"Private"!=a){var b=J("input#name").val();J.getJSON(baseURL+"/group/checkname/",{input:b},function(a){J("#namePreview span").text(a.slug),a.valid?J("#slugpreview").css({color:"green"}):J("#slugpreview").css({color:"red"}),J("#namePreview img").remove()})}}},group_settings:{init:function(){Zotero.debug("initializing group delete form"),Zotero.ui.init.rte("nolinks"),J("#deleteForm").submit(function(){return confirm("This will permanently delete this group, including any items in the group library")?(J("#confirm_delete").val("confirmed"),!0):!1}),J("#type-PublicOpen").click(function(){return confirm("Changing a group to Public Open will remove all files from Zotero Storage")?!0:!1})}},group_library_settings:{init:function(){J("#type-PublicOpen").prop("checked")&&(J("#fileEditing-admins").prop("disabled","1"),J("#fileEditing-members").prop("disabled","1")),J("#type-Private").prop("checked")&&J("#libraryReading-all").prop("disabled","1"),J("#type-PublicOpen").click(function(){return confirm("Changing a group to Public Open will remove all files from Zotero Storage")?(J("input[name='fileEditing']").val(["none"]),J("#fileEditing-admins").prop("disabled","1"),J("#fileEditing-members").prop("disabled","1"),J("#libraryReading-all").prop("disabled",""),!0):!1}),J("#type-Private").click(function(){J("input[name='libraryReading']").val(["members"]),J("#libraryReading-all").prop("disabled","1"),J("#fileEditing-admins").prop("disabled",""),J("#fileEditing-members").prop("disabled","")}),J("#type-PublicClosed").click(function(){J("#fileEditing-admins").prop("disabled",""),J("#fileEditing-members").prop("disabled",""),J("#libraryReading-all").prop("disabled","")})}},group_view:{init:function(){J("#join-group-button").click(Zotero.pages.group_view.joinGroup),J("#leave-group-button").click(Zotero.pages.group_view.leaveGroup),Zotero.ui.init.rte("nolinks")},joinGroup:function(){Zotero.ui.showSpinner(J(".join-group-div")),J.post("/groups/"+zoteroData.groupID+"/join",{ajax:!0},function(a){a.pending===!0?J(".join-group-div").empty().append("Membership Pending"):a.success===!0?Zotero.ui.jsNotificationMessage("You are now a member of this group","success"):(J(".join-group-div").empty(),Zotero.ui.jsNotificationMessage("There was a problem joining this group.","error"))},"json")},leaveGroup:function(){confirm("Leave group?")&&(Zotero.ui.showSpinner(J(".leave-group-div")),J.post("/groups/"+zoteroData.groupID+"/leave",{ajax:!0},function(a){a.success===!0?(J("leave-group-div").empty(),Zotero.ui.jsNotificationMessage("You are no longer a member of this group","success")):(J("leave-group-div").empty(),Zotero.ui.jsNotificationMessage("There was a problem leaving this group. Please try again in a few minutes.","error"))},"json"))}},group_index:{init:function(){}},groupdiscussion_view:{init:function(){}},user_register:{init:function(){J("input[name='username']").after("<label id='slugpreview'>Profile URL: "+Zotero.config.baseZoteroWebsiteUrl+"/"+Zotero.utils.slugify(J("input[name='username']").val())+"</label>"),J("input[name='username']").bind("keyup change",Zotero.pages.user_register.nameChange)},nameChange:function(){J("#slugpreview").css("color","black"),parent.slug=Zotero.utils.slugify(J("input[name='username']").val()),J("#slugpreview").text("Profile URL: "+Zotero.config.baseZoteroWebsiteUrl+"/"+parent.slug),clearTimeout(parent.checkUserSlugTimeout),parent.checkUserSlugTimeout=setTimeout(Zotero.pages.user_register.checkSlug,500)},checkSlug:function(){J.getJSON(baseURL+"/user/checkslug",{slug:slug},function(a){a.valid?J("#slugpreview").css("color","green"):J("#slugpreview").css("color","red")})}},user_profile:{init:function(){J("#invite-button").click(function(){var a=J("#invite_group").val();J.post("/groups/inviteuser",{ajax:!0,groupID:a,userID:zoteroData.profileUserID},function(a){"true"==a&&(Zotero.ui.jsNotificationMessage("User has been invited to join your group.","success"),J("#invited-user-list").append("<li>"+J("#invite_group > option:selected").html()+"</li>"),J("#invite_group > option:selected").remove(),0===J("#invite_group > option").length&&(J("#invite_group").remove(),J("#invite-button").remove()))},"text")})}},group_compose:{init:function(){Zotero.ui.init.rte("nolinks")}},index_index:{},search_index:{init:function(){}},search_items:{init:function(){try{var a=new Zotero.Library}catch(b){Z.debug("Error initializing library")}J("#item-submit").bind("click submit",J.proxy(function(b){Z.debug("item search submitted",3),b.preventDefault(),b.stopImmediatePropagation();var c=J("#itemQuery").val(),d=a.fetchGlobalItems({q:c});return d.then(function(a){Z.debug("globalItemSearch callback",3),Z.debug(a),J("#search-result-count").empty().append(a.totalResults);var b=J("#search-results");b.empty(),J.each(a.objects,function(a,c){J("#globalitemdetailsTemplate").tmpl({globalItem:c}).appendTo(b)})}),!1},this))}},index_start:{init:function(){Zotero.pages.index_start.sizeIframe(),J(window).resize(Zotero.pages.index_start.sizeIframe),J(".start-select").click(function(){return J("iframe").attr("src",J(this).attr("href")),!1}),J(".start-show-overlay").click(function(){return J("#start-overlay").show(),!1}),J(".start-hide-overlay").click(function(){return J("#start-overlay").hide(),!1}),Zotero.pages.user_register.init()},sizeIframe:function(){J("iframe").css("height",J(window).height()-144)}},index_startstandalone:{init:function(){var a=BrowserDetect.browser;switch(a){case"Chrome":J("#chrome-connector-download-button").closest("li").detach().prependTo("#recommended-download > ul");break;case"Safari":J("#safari-connector-download-button").closest("li").detach().prependTo("#recommended-download > ul");break;case"Firefox":J("#firefox-connector-message").closest("li").detach().prependTo("#recommended-download > ul");break;default:J("#connector-download-button").closest("li").detach().prependTo("#recommended-download > ul"),J("#other-connectors-p").hide()}J("#recommended-download > ul").prepend("<li><p>Zotero Connectors allow you to save to Zotero directly from your web browser.</p></li>"),Zotero.pages.user_register.init()}},index_download:{init:function(){var a=BrowserDetect.browser,b=BrowserDetect.OS,c=-1!=navigator.userAgent.indexOf("x86_64")?"x86_64":"x86";switch("Windows"==b?J("#standalone-windows-download-button").closest("li").clone().prependTo("#recommended-client-download ul"):"Mac"==b?J("#standalone-mac-download-button").closest("li").clone().prependTo("#recommended-client-download ul"):"Linux"==b&&("x86_64"==c?J("#standalone-linux64-download-button").closest("li").clone().prependTo("#recommended-client-download ul"):J("#standalone-linux32-download-button").closest("li").clone().prependTo("#recommended-client-download ul")),J("#recommended-connector-download").show(),a){case"Chrome":J("#chrome-connector-download-button").addClass("recommended-download").closest("li").detach().prependTo("#recommended-connector-download ul");break;case"Safari":J("#safari-connector-download-button").addClass("recommended-download").closest("li").detach().prependTo("#recommended-connector-download ul");break;case"Firefox":J("#firefox-connector-download-button").addClass("recommended-download").closest("li").detach().prependTo("#recommended-connector-download ul");break;default:J("#connector-download-button").closest("li").clone().prependTo("#recommended-connector-download ul"),J("#other-connectors-p").hide()}J("#recommended-download ul").prepend("<li><p>Zotero Connectors allow you to save to Zotero directly from your web browser.</p></li>")}},index_bookmarklet:{init:function(){J(".bookmarklet-instructions").hide();var a=J("#bookmarklet-tabs li.selected").data("section");J("#"+a+"-bookmarklet-div").show(),J("#bookmarklet-tabs li").on("click",function(a){Z.debug("bookmarklet tab clicked"),J("#bookmarklet-tabs li.selected").removeClass("selected"),J(this).addClass("selected");var b=J(this).data("section");Z.debug(b),J(".bookmarklet-instructions").hide(),J("#"+b+"-bookmarklet-div").show()})}}};